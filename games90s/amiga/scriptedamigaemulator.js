Object.prototype.clone||(Object.prototype.clone=function(){var a={},f;for(f in this)this.hasOwnProperty(f)&&(a[f]=this[f]);return a});Math.truncate||(Math.truncate=function(a){return 0<a?this.floor(a):0>a?this.ceil(a):0});Math.decimalRandom||(Math.decimalRandom=function(){return 4294967295*this.random()>>>0});Date.now||(console.warn("This browser does not support 'Date.now()'. Falling back to 'Date.getTime()'..."),Date.now=function(){return(new Date).getTime()});
window.performance||(console.warn("This browser does not support 'window.performance'. Falling back to 'Date'..."),window.performance={});performance.timing||(performance.timing={navigationStart:Date.now()});performance.now||(performance.now=performance.webkitNow?performance.webkitNow:function(){return Date.now()-this.timing.navigationStart});var SAEC_LITTLE_ENDIAN=function(){var a=new ArrayBuffer(2);(new DataView(a)).setInt16(0,256,!0);return 256===(new Int16Array(a))[0]}();function SAEF_bswap16(a){return(a&255)<<8|(a&65280)>>8}function SAEF_bswap32(a){return((a&255)<<24|(a&65280)<<8|(a&16711680)>>>8|(a&4278190080)>>>24)>>>0}function SAEF_be16toh(a){return SAEC_LITTLE_ENDIAN?(a&255)<<8|(a&65280)>>8:a}function SAEF_be32toh(a){return SAEC_LITTLE_ENDIAN?((a&255)<<24|(a&65280)<<8|(a&16711680)>>>8|(a&4278190080)>>>24)>>>0:a}
function SAEF_le32toh(a){return SAEC_LITTLE_ENDIAN?a:((a&255)<<24|(a&65280)<<8|(a&16711680)>>>8|(a&4278190080)>>>24)>>>0}function SAEF_le16toh(a){return SAEC_LITTLE_ENDIAN?a:(a&255)<<8|(a&65280)>>8}function SAEO_MAvg(a){var f=Array(a),d=0,J=0,h=0;this.clr=function(){h=J=d=0};this.get=function(){return h/d};this.set=function(N){d<a?(f[d++]=N,h+=N):(h-=f[J],f[J]=N,h+=N,++J>=a&&(J-=a));return h/d}}var SAEV_crc32Table=new Uint32Array(256),SAEV_crc16Table=new Uint16Array(256),c,w,n,k;
for(n=0;256>n;n++){c=n;w=n<<8;for(k=0;8>k;k++)c=(c>>>1^(c&1?3988292384:0))>>>0,w=w<<1&65535^(w&32768?4129:0);SAEV_crc32Table[n]=c;SAEV_crc16Table[n]=w}function SAEF_crc32(a,f,d){var J=4294967295;if("string"===typeof a)for(;0<d--;)J=SAEV_crc32Table[(J^a.charCodeAt(f++))&255]^J>>>8;else for(;0<d--;)J=SAEV_crc32Table[(J^a[f++])&255]^J>>>8;return(J^4294967295)>>>0}function SAEF_crc16(a,f,d){for(var J=65535;0<d--;)J=J<<8&65535^SAEV_crc16Table[(J>>8^a[f++])&255];return J}
function SAEF_gettimeofday(a,f){var d=performance.now(),d=d+performance.timing.navigationStart,d=Math.floor(1E3*d);a.tv_sec=Math.floor(d/1E6);a.tv_usec=d%1E6}function SAEF_timeval_to_amiga(a,f,d){a=1E3*a.tv_sec+Math.floor(a.tv_usec/1E3);a-=2524608E5;0>a&&(a=0);f.days=Math.floor(a/864E5);a-=864E5*f.days;f.mins=Math.floor(a/6E4);a-=6E4*f.mins;f.ticks=Math.floor(a/(1E3/d))}function SAEF_memset(a,f,d,J){var h=f;for(f+=J;h<f;h++)a[h]=d}
function SAEF_memcpy(a,f,d,J,h){for(var N=0;N<h;N++)a[f+N]=d[J+N]}function SAEF_Array2String(a,f,d){"undefined"==typeof d&&(d=a.length);"undefined"==typeof f&&(f=0);for(var J="";f<d;f++)J+=String.fromCharCode(a[f]);return J}function SAEF_String2Array(a,f,d){"undefined"==typeof d&&(d=a.length);"undefined"==typeof f&&(f=0);for(var J=new Uint8Array(d-f),h=f;h<d;h++)J[h-f]=a.charCodeAt(h);return J}
function SAEF_CompareArray(a,f,d){"undefined"==typeof d&&(d=f.length);for(var J=0;J<d;J++)if("undefined"===typeof a[J]||"undefined"===typeof f[J]||a[J]!=f[J])return 1;return 0}function SAEF_CompareArrayAfter(a,f,d,J){"undefined"==typeof J&&(J=d.length);for(var h=0;h<J;h++)if("undefined"===typeof a[f+h]||"undefined"===typeof d[h]||a[f+h]!=d[h])return 1;return 0}
var sprintfWrapper={init:function(){if("undefined"==typeof arguments||1>arguments.length||"string"!=typeof arguments[0]||"undefined"==typeof RegExp)return null;for(var a=arguments[0],f=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g),d=[],J=[],h=0,N=0,I=0,N=0,E="",K;K=f.exec(a);)K[9]&&(h+=1),I=f.lastIndex-K[0].length,J[J.length]=a.substring(N,I),N=f.lastIndex,d[d.length]={match:K[0],left:K[3]?!0:!1,sign:K[4]||"",pad:K[5]||" ",min:K[6]||0,precision:K[8],code:K[9]||"%",negative:!!(0>
parseInt(arguments[h])),argument:String(arguments[h])};J[J.length]=a.substring(N);if(0==d.length)return a;if(arguments.length-1<h)return null;for(a=0;a<d.length;a++)"%"==d[a].code?f="%":"b"==d[a].code?(d[a].argument=String(Math.abs(parseInt(d[a].argument)).toString(2)),f=sprintfWrapper.convert(d[a],!0)):"c"==d[a].code?(d[a].argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(d[a].argument))))),f=sprintfWrapper.convert(d[a],!0)):"d"==d[a].code?(d[a].argument=String(Math.abs(parseInt(d[a].argument))),
f=sprintfWrapper.convert(d[a])):"f"==d[a].code?(d[a].argument=String(Math.abs(parseFloat(d[a].argument)).toFixed(d[a].precision?d[a].precision:6)),f=sprintfWrapper.convert(d[a])):"o"==d[a].code?(d[a].argument=String(Math.abs(parseInt(d[a].argument)).toString(8)),f=sprintfWrapper.convert(d[a])):"s"==d[a].code?(d[a].argument=d[a].argument.substring(0,d[a].precision?d[a].precision:d[a].argument.length),f=sprintfWrapper.convert(d[a],!0)):"x"==d[a].code?(d[a].argument=String(Math.abs(parseInt(d[a].argument)).toString(16)),
f=sprintfWrapper.convert(d[a])):"X"==d[a].code?(d[a].argument=String(Math.abs(parseInt(d[a].argument)).toString(16)),f=sprintfWrapper.convert(d[a]).toUpperCase()):f=d[a].match,E+=J[a],E+=f;return E+=J[a]},convert:function(a,f){a.sign=f?"":a.negative?"-":a.sign;var d=a.min-a.argument.length+1-a.sign.length,d=Array(0>d?0:d).join(a.pad);return a.left?"0"==a.pad||f?a.sign+a.argument+d.replace(/0/g," "):a.sign+a.argument+d:"0"==a.pad||f?a.sign+d+a.argument:d+a.sign+a.argument}},sprintf=sprintfWrapper.init,
SEEK_SET=0,SEEK_CUR=1,SEEK_END=2;function SAEO_ZFile(){this.originalname=this.name="";this.data=null;this.opencnt=this.seek=this.allocsize=this.datasize=this.size=this.dataseek=0}function SAEF_ZFile_create(a,f){var d=new SAEO_ZFile;d.opencnt=1;null!==a&&a.originalname?d.originalname=a.originalname:f.length&&(d.originalname=f);return d}function SAEF_ZFile_free(a){a.name="";a.originalname="";a.data=null}
function SAEF_ZFile_fopen_empty(a,f,d){a=SAEF_ZFile_create(a,"");a.name=f.length?f:"";d?(a.data=new Uint8Array(d),a.size=d,a.datasize=d,a.allocsize=d):(a.data=new Uint8Array(1E3),a.size=0,a.allocsize=1E3);return a}function SAEF_ZFile_fopen_load_zfile(a){var f=SAEF_ZFile_fopen_empty(a,a.name,a.size);if(null===f)return null;SAEF_ZFile_fseek(a,0,SEEK_SET);SAEF_ZFile_fread(f.data,0,a.size,1,a);return f}
function SAEF_ZFile_fopen_file(a){if(a.size){var f=SAEF_ZFile_create(null,a.name);f.name=a.name.length?a.name:"";f.data=new Uint8Array(a.size);"string"===typeof a.data?f.data.set(SAEF_String2Array(a.data,0,a.size)):f.data.set(a.data);f.size=a.size;f.datasize=a.size;f.allocsize=a.size;var d=(f.data[0]<<24|f.data[1]<<16|f.data[2]<<8|f.data[3])>>>0;1347093252!=d&&67324752!=d||SAEF_fatal(SAEE_Config_Compressed,"A ZIP file was detected. Compressed files are not yet supported.");if(0==SAEF_CompareArray(f.data,
SAEF_String2Array("DMS!"),4)){if(d=(new SAEO_DMS).DMS2ADF(f),null!==d)return f=SAEF_ZFile_getdata(d,0,-1),a.name=SAEF_ZFile_getname(d),a.data=SAEF_Array2String(f),a.size=SAEF_ZFile_size(d),a.prot=!1,d}else if(0==SAEF_CompareArray(f.data,[0,0,3,243,0,0,0,0],8)&&(d=SAER.disk.EXE2ADF(f),null!==d))return f=SAEF_ZFile_getdata(d,0,-1),a.name=SAEF_ZFile_getname(d),a.data=SAEF_Array2String(f),a.size=SAEF_ZFile_size(d),a.prot=!1,d;return f}return null}
function SAEF_ZFile_fclose(a){a&&(0>a.opencnt?SAEF_warn("SAEF_ZFile_fclose() tried to free already closed filehandle!"):(a.opencnt--,0<a.opencnt||(a.opencnt=-100,SAEF_ZFile_free(a))))}function SAEF_ZFile_iscompressed(a){return!1}
function SAEF_ZFile_resize(a,f){if(f>a.allocsize){a.allocsize=f;SAEF_log("SAEF_ZFile_resize() increase %d -> %d bytes",a.size,a.allocsize);var d=new Uint8Array(a.allocsize);d.set(a.data);a.data=d;a.datasize=a.size=f;return 1}return f<a.allocsize?(a.allocsize=f,SAEF_log("SAEF_ZFile_resize() decrease %d -> %d bytes",a.size,a.allocsize),d=new Uint8Array(a.allocsize),d.set(a.data.subarray(0,a.allocsize)),a.data=d,a.datasize=a.size=f,1):0}function SAEF_ZFile_size(a){return a.size}
function SAEF_ZFile_ftell(a){return a.seek}function SAEF_ZFile_fseek(a,f,d){var J=0;switch(d){case SEEK_SET:a.seek=f;break;case SEEK_CUR:a.seek+=f;break;case SEEK_END:a.seek=a.size+f}0>a.seek&&(a.seek=0,J=1);a.seek>a.size&&(a.seek=a.size,J=1);return J}
function SAEF_ZFile_fread(a,f,d,J,h){if(h.datasize<h.size&&h.seek+d*J>h.datasize)return SAEF_warn("SAEF_ZFile_fread() read beyond size"),0;h.seek+d*J>h.size&&(J=d?Math.truncate((h.size-h.seek)/d):0,0>J&&(J=0));a.set(h.data.subarray(h.seek,h.seek+d*J),f);h.seek+=d*J;return J}
function SAEF_ZFile_fwrite(a,f,d,J,h){var N=h.seek+d*J;if(0==h.allocsize)return SAEF_warn("SAEF_ZFile_fwrite() allocsize == 0, aborting..."),0;if(N>h.allocsize){h.allocsize<N&&(h.allocsize=N);h.allocsize+=h.size>>1;1E4>h.allocsize&&(h.allocsize=1E4);SAEF_log("SAEF_ZFile_fwrite() relocate %d -> %d bytes",h.size,h.allocsize);var I=new Uint8Array(h.allocsize);I.set(h.data);h.data=I;h.datasize=h.size=N}h.data.set(a.subarray(f,f+d*J),h.seek);h.seek+=d*J;h.seek>h.size&&(h.size=h.seek);h.size>h.datasize&&
(h.datasize=h.size);return J}function SAEF_ZFile_getdata(a,f,d){var J=SAEF_ZFile_ftell(a);0>d&&(SAEF_ZFile_fseek(a,0,SEEK_END),d=SAEF_ZFile_ftell(a),SAEF_ZFile_fseek(a,0,SEEK_SET));var h=new Uint8Array(d);SAEF_ZFile_fseek(a,f,SEEK_SET);SAEF_ZFile_fread(h,0,d,1,a);SAEF_ZFile_fseek(a,J,SEEK_SET);return h}function SAEF_ZFile_getname(a){return a?a.name:null}function SAEF_ZFile_getoriginalname(a){return a?a.originalname:null}function SAEF_ZFile_getfilename(a){return a.name}
function SAEF_ZFile_crc32(a){return null===a?0:SAEF_crc32(a.data,0,a.size)}function CreateEvent(a,f,d,J){a=new uae_sem_t;a.manual=0!=f;a.signaled=0!=d;return a}function SetEvent(a){return a.signaled=!0}function ResetEvent(a){a.signaled=!1;return!0}var INFINITE=4294967295,WAIT_ABANDONED=128,WAIT_OBJECT_0=0,WAIT_TIMEOUT=258,WAIT_FAILED=4294967295;
function WaitForSingleObject(a,f){if(!a.signaled)if(f==INFINITE)for(var d=0;!a.signaled&&200>d++;)SAEF_sleep(5);else 0<f&&SAEF_sleep(f);return a.signaled?(a.manual||ResetEvent(a),WAIT_OBJECT_0):WAIT_TIMEOUT}function uae_sem_init(a,f,d){a.handle?d?SetEvent(a.handle):ResetEvent(a.handle):a.handle=CreateEvent(null,f,d,null)}function uae_sem_wait(a){WaitForSingleObject(a.handle,INFINITE)}function uae_sem_post(a){SetEvent(a.handle)}function uae_sem_t(){this.value=null;this.signaled=this.manual=!1}
function smp_comm_pipe(){this.lock={handle:null};this.reader_wait={handle:null};this.writer_wait={handle:null};this.dataView=this.data=null;this.writer_waiting=this.reader_waiting=this.wrp=this.rdp=this.chunks=this.size=0}
function init_comm_pipe(a,f,d){a.lock={handle:null};a.reader_wait={handle:null};a.writer_wait={handle:null};a.data=new ArrayBuffer(4*f);a.dataView=new DataView(a.data);a.size=f;a.chunks=d;a.rdp=a.wrp=0;a.reader_waiting=0;a.writer_waiting=0;uae_sem_init(a.lock,0,1);uae_sem_init(a.reader_wait,0,0);uae_sem_init(a.writer_wait,0,0)}
function read_comm_pipe_pt_blocking(a,f){var d;uae_sem_wait(a.lock);a.rdp==a.wrp&&(a.reader_waiting=1,uae_sem_post(a.lock),uae_sem_wait(a.reader_wait),uae_sem_wait(a.lock));switch(f){case 1:d=a.dataView.getInt32(a.rdp<<2,!1);break;case 2:case 3:d=a.dataView.getUint32(a.rdp<<2,!1)}a.rdp=(a.rdp+1)%a.size;a.writer_waiting&&(a.writer_waiting=0,uae_sem_post(a.writer_wait));uae_sem_post(a.lock);return d}function read_comm_pipe_int_blocking(a){return read_comm_pipe_pt_blocking(a,1)}
function read_comm_pipe_u32_blocking(a){return read_comm_pipe_pt_blocking(a,2)}function read_comm_pipe_pvoid_blocking(a){return read_comm_pipe_pt_blocking(a,3)}function maybe_wake_reader(a,f){a.reader_waiting&&(f||(a.wrp-a.rdp+a.size)%a.size>=a.chunks)&&(a.reader_waiting=0,uae_sem_post(a.reader_wait))}
function write_comm_pipe_pt(a,f,d,J){var h=(a.wrp+1)%a.size;if(a.reader_waiting){switch(f){case 1:a.dataView.setInt32(a.wrp<<2,d,SAEC_LITTLE_ENDIAN);break;case 2:case 3:a.dataView.setUint32(a.wrp<<2,d,SAEC_LITTLE_ENDIAN)}a.wrp=h;maybe_wake_reader(a,J)}else{uae_sem_wait(a.lock);h==a.rdp&&(a.writer_waiting=1,uae_sem_post(a.lock),uae_sem_wait(a.writer_wait),uae_sem_wait(a.lock));switch(f){case 1:a.dataView.setInt32(a.wrp<<2,d,SAEC_LITTLE_ENDIAN);break;case 2:case 3:a.dataView.setUint32(a.wrp<<2,d,SAEC_LITTLE_ENDIAN)}a.wrp=
h;maybe_wake_reader(a,J);uae_sem_post(a.lock)}}function write_comm_pipe_int(a,f,d){write_comm_pipe_pt(a,1,f,d)}function write_comm_pipe_u32(a,f,d){write_comm_pipe_pt(a,2,f,d)}function write_comm_pipe_pvoid(a,f,d){write_comm_pipe_pt(a,3,f,d)};function SAEO_DMS(){function a(b){return Z>>>q-b&65535}function f(a){q-=a;for(Z&=T[q];16>q;)Z=(Z<<8|wa[b++])>>>0,q+=8}function d(a){q=Z=0;wa=a;b=0;f(0)}function J(b,a,q){for(var E=0,d=0,t=0,m=0,t=0;d<q;)if(144!=(m=b[E++]))a[d++]=m;else if(t=b[E++]){m=b[E++];255==t&&(t=b[E++],t=(t<<8)+b[E++]);if(d+t>q)return 1;SAEF_memset(a,d,m,t);d+=t}else a[d++]=m;return 0}function h(b,a,q,E){function d(){var b=0;if(wa)return 0;if(f==h){for(;++t<m;)if(ea[t]==f){b=G;G+=y;if(G>r)return wa=1,0;for(;b<G;)K[b++]=t;return t}t=
-1;f++;y>>=1}h++;if(h<T)d(),d();else{if(32<h)return wa=2,0;if((b=Z++)>=2*m-1)return wa=3,0;Da[b]=d();sb[b]=d();if(G>=r)return wa=4,0;h==T&&(K[G++]=b)}h--;return b}var t=0,m=0,r=0,f=0,h=0,T=0,Z=0,G=0,y=0,K=null,wa=0,ea=null,m=Z=b,ea=a,K=E,r=1<<q,y=r>>1,T=q+1,h=f=1,t=-1,wa=G=0;d();if(wa)return wa;d();return wa?wa:G!=r?5:0}function N(b,q,E,m){if(E&8){ta=15;var L=8191}else ta=14,L=4095;d(b);if(E&2){a:{b=a(9);f(9);if(0<b){for(E=0;E<b;E++)Fa[E]=a(5)&255,f(5);for(E=b;510>E;E++)Fa[E]=0;if(h(510,Fa,12,Lb)){b=
1;break a}}else{b=a(9);f(9);for(E=0;510>E;E++)Fa[E]=0;for(E=0;4096>E;E++)Lb[E]=b}b=0}if(b)return 1;a:{b=a(5);f(5);if(0<b){for(E=0;E<b;E++)t[E]=a(4)&255,f(4);for(E=b;E<ta;E++)t[E]=0;if(h(ta,t,8,tb)){b=1;break a}}else{b=a(5);f(5);for(E=0;E<ta;E++)t[E]=0;for(E=0;256>E;E++)tb[E]=b}b=0}if(b)return 2}for(b=0;b<m;){E=Lb[a(12)];if(510>E)f(Fa[E]);else{f(12);var r=a(16),T=32768;do E=r&T?sb[E]:Da[E],T>>=1;while(510<=E);f(Fa[E]-12)}if(256>E)q[b++]=$a[Oa[2]++&L]=E;else{E-=253;r=Oa[2];T=tb[a(8)];if(T<ta)f(t[T]);
else{f(8);var Z=a(16),G=32768;do T=Z&G?sb[T]:Da[T],G>>=1;while(T>=ta);f(t[T]-8)}T!=ta-1&&(0<T&&(T=a(Z=T-1)|1<<T-1,f(Z)),Sa=T);for(r=r-Sa-1;E--;)q[b++]=$a[Oa[2]++&L]=$a[r++&L]}}return 0}function I(){Oa[0]=251;Oa[1]=16318;ta=Sa=Oa[2]=0;Oa[3]=16324;R=!0;SAEF_memset($a,0,0,16328)}function E(b){SAEF_warn("DMS() Ignored error on track %d!\n",b)}function K(b,a){for(var E=0,q=0;a--;)E+=b[q++],65535<E&&(E-=65536);return E}function m(b,a,E){for(var q=0;E--;)q=Ga[(q^b[a++])&255]^q>>8&255;return q}function pa(b,
a,E,q){if(null!==a){for(var d=0;10>d&&null!==a[d];d++);10!=d&&(b=SAEF_ZFile_fopen_empty(null,b,q),null!==b&&(SAEF_ZFile_fwrite(E,0,q,1,b),SAEF_ZFile_fseek(b,0,SEEK_SET),a[d]=b))}}function ja(b,a,E){for(var q=0,d=0,t=0;a--;)t=E[q++],b[d++]=t^ka&255,ka=(ka>>1)+t&65535}function G(b,E,q,t,m,T){switch(m){case 0:E.set(b.subarray(0,t));break;case 1:if(J(b,E,t))return 14;break;case 2:var h=m=0,Z=0;for(d(b);m<q;)if(0!=a(1))f(1),E[m++]=$a[Oa[0]++&255]=a(8)&255,f(8);else for(f(1),Z=a(2)+2,f(2),h=Oa[0]-a(8)-
1,f(8);Z--;)E[m++]=$a[Oa[0]++&255]=$a[h++&255];Oa[0]=Oa[0]+5&255;if(J(E,b,t))return 14;E.set(b.subarray(0,t));break;case 3:Z=h=Z=m=0;for(d(b);m<q;)if(0!=a(1))f(1),E[m++]=$a[Oa[1]++&16383]=a(8)&255,f(8);else for(f(1),Z=a(8),f(8),h=ua[Z]+3,u=y[Z],Z=(Z<<u|a(u))&255,f(u),u=y[Z],Z=ua[Z]<<8|(Z<<u|a(u))&255,f(u),Z=Oa[1]-Z-1;h--;)E[m++]=$a[Oa[1]++&16383]=$a[Z++&16383];Oa[1]=Oa[1]+66&16383;if(J(E,b,t))return 14;E.set(b.subarray(0,t));break;case 4:h=h=Z=m=0;d(b);if(R){for(h=0;314>h;h++)ea[h]=1,r[h]=h+627,Ua[h+
627]=h;h=0;for(Z=314;626>=Z;)ea[Z]=ea[h]+ea[h+1],r[Z]=h,Ua[h]=Ua[h+1]=Z,h+=2,Z++;ea[627]=65535;Ua[626]=0;R=!1}for(;m<q;){for(h=r[626];627>h;)h=r[h+a(1)],f(1);var Z=h-=627,G=0,K=0,wa=G=0;if(32768==ea[626]){for(var pa=K=G=wa=0,ja=0,bb=0,wa=0;627>wa;wa++)627<=r[wa]&&(ea[G]=ea[wa]+1>>1,r[G]=r[wa],G++);wa=0;for(G=314;627>G;wa+=2,G++){K=wa+1;pa=ea[G]=ea[wa]+ea[K];for(K=G-1;pa<ea[K];K--);K++;for(bb=ja=G-K;0<=bb;bb--)ea[K+bb+1]=ea[K+bb];ea[K]=pa;for(bb=ja;0<=bb;bb--)r[K+bb+1]=r[K+bb];r[K]=wa}for(wa=0;627>
wa;wa++)627<=(K=r[wa])?Ua[K]=wa:Ua[K]=Ua[K+1]=wa}Z=Ua[Z+627];do if(G=++ea[Z],G>ea[wa=Z+1]){for(;G>ea[++wa];);wa--;ea[Z]=ea[wa];ea[wa]=G;G=r[Z];Ua[G]=wa;627>G&&(Ua[G+1]=wa);K=r[wa];r[wa]=G;Ua[K]=Z;627>K&&(Ua[K+1]=Z);r[Z]=K;Z=wa}while(0!=(Z=Ua[Z]));if(256>h)E[m++]=$a[Oa[3]++&16383]=h&255;else for(h=h-255+2,Z=Oa[3],wa=a(8),f(8),G=ua[wa]<<8,K=y[wa],wa=(wa<<K|a(K))&255,f(K),Z=Z-(G|wa)-1;h--;)E[m++]=$a[Oa[3]++&16383]=$a[Z++&16383]}Oa[3]=Oa[3]+60&16383;if(J(E,b,t))return 14;E.set(b.subarray(0,t));break;
case 5:case 6:if(5==m){if(N(b,E,T&7,q))return 14}else if(N(b,E,T|8,q))return 14;if(T&4){SAEF_memset(b,0,0,t);if(J(E,b,t))return 14;E.set(b.subarray(0,t))}break;default:return 15}T&1||I();return 0}function bb(b,a,q,d,t,m,r,h,Z,T){var f=0,wa=f=0;if(qa){80!=r&&ja(b,h,b);f=G(b,a,q,d,t,m);if(0==f&&Z==K(a,d))return 0;E(r);if(0>=nb)return 12}nb--;var y=0,ea=0,pa=new Uint8Array(h);pa.set(b.subarray(0,h));for(SAEF_memset(a,0,0,d);;){f=G(b,a,q,d,t,m);if(0==f&&Z==K(a,d)){(qa=ea)&&SAEF_log("DMS() decryption key = 0x%04X\n",
wa);f=0;fa=wa;break}if(80==r||!T){f=12;break}ea=1;ka=wa=fa;fa++;ja(b,h,pa);y++;if(65536==y){f=12;qa=0;break}}return f}function kb(b,a,q,d,t,r,h,Z){r=0;var f=SAEF_ZFile_fread(q,0,1,20,b);if(20!=f)return 0==f?1:6;if(84!=q[0]||82!=q[1])return 8;f=q[18]<<8|q[19];if(m(q,0,18)!=f)return 10;var f=q[2]<<8|q[3],T=q[6]<<8|q[7],G=q[8]<<8|q[9],K=q[10]<<8|q[11],wa=q[12],y=q[13],ea=q[14]<<8|q[15],J=q[16]<<8|q[17];if(32E3<T||32E3<G||32E3<K)return 9;if(SAEF_ZFile_fread(q,0,1,T,b)!=T)return 6;m(q,0,T)!=J&&(E(f),r=
1);b=!1;if(6==t&&80>f&&2048<K){SAEF_memset(d,0,0,K);r||bb(q,d,G,K,y,wa,f,T,ea,h&2);0==f&&11264==SAEF_ZFile_ftell(a)&&(SAEF_ZFile_fseek(a,0,SEEK_SET),t=new Uint8Array(11264),SAEF_ZFile_fread(t,0,11264,1,a),pa("BigFakeBootBlock",Z,t,11264),delete t);SAEF_ZFile_fseek(a,11264*f*(h&16?2:1),SEEK_SET);if(SAEF_ZFile_fwrite(d,0,1,K,a)!=K)return 13;b=!0}else 0==f&&1024==K&&(d.set(0,0,K),r||bb(q,d,G,K,y,wa,f,T,ea,h&2),pa("FakeBootBlock",Z,d,K));if(r)return 0;65535==f&&(bb(q,d,G,K,y,wa,f,T,ea,h&2),Z&&pa("Banner",
Z,d,K));80==f&&(bb(q,d,G,K,y,wa,f,T,ea,h&2),Z&&pa("FILEID.DIZ",Z,d,K));b||I();return 0}var ua=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,
20,20,21,21,21,21,22,22,22,22,23,23,23,23,24,24,25,25,26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,46,46,47,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],y=[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],Oa=new Uint16Array(4),T=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],wa=null,b=0,q=0,Z=0,ea=new Uint16Array(628),Ua=new Uint16Array(941),r=new Uint16Array(627),R=!0,Fa=
new Uint8Array(510),Lb=new Uint16Array(4096),t=new Uint8Array(20),tb=new Uint16Array(256),Da=new Uint16Array(1019),sb=new Uint16Array(1028),Sa=0,ta=0,ka=0,qa=0,nb=0,$a=null,Ga=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8E3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,
53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16E3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,
27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32E3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,
19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448],fa=0;this.DMS2ADF=function(b,a,q){"undefined"==typeof a&&(a=0);q=SAEF_ZFile_getname(b);for(var E="",d=Array(10),E=0;10>E;E++)d[E]=null;E=q.lastIndexOf(".");-1!=E?(E=q.substr(0,E),E+=".ADF"):E=q+".ADF";var t=SAEF_ZFile_fopen_empty(b,E,901120);if(null===t)return null;fa=0;var r;r=t;qa=0;nb=2;b1=new Uint8Array(32E3);b2=new Uint8Array(32E3);$a=new Uint8Array(32E3);
if(56!=SAEF_ZFile_fread(b1,0,1,56,b))$a=null,r=6;else if(68!=b1[0]||77!=b1[1]||83!=b1[2]||33!=b1[3])$a=null,r=5;else if((b1[54]<<8|b1[55])!=m(b1,4,50))$a=null,r=7;else{var h=b1[10]<<8|b1[11],Z=b1[50]<<8|b1[51];ka=0;if(7==Z)$a=null,r=18;else{Z=0;I();for(I();;){Z=kb(b,r,b1,b2,6,1,h,d);if(1==Z)break;if(0!=Z)break}1==Z&&(Z=0);8==Z&&(Z=0);$a=null;r=Z}}if(0==r){SAEF_ZFile_fseek(t,0,SEEK_SET);if(0<a){SAEF_ZFile_fclose(t);t=null;for(r=0;10>r&&d[r];r++);if(a>r){for(r=0;10>r;r++)SAEF_ZFile_fclose(d[r]);return t}t=
d[a-1];d[a-1]=null}SAEF_ZFile_fclose(b);SAEF_log("DMS() converted '%s' to '%s'",q,E)}else SAEF_ZFile_fclose(t),t=null,alert(sprintf("Can't convert '%s' to ADF. (error %d)",q,r));for(r=0;10>r;r++)SAEF_ZFile_fclose(d[r]);return t}};var SAEV_config={},SAEC_Model_A500=1,SAEC_Model_A500P=2,SAEC_Model_A600=3,SAEC_Model_A1000=4,SAEC_Model_A1200=5,SAEC_Model_A2000=6,SAEC_Model_A3000=7,SAEC_Model_A4000=8,SAEC_Model_A4000T=9,SAEC_Model_CDTV=10,SAEC_Model_CD32=11;function SAEO_Config_File(){this.data=this.name="";this.size=0;this.prot=this.crc32=!1;this.clr=function(){this.data=this.name="";this.size=0;this.prot=this.crc32=!1}}
var SAEC_Config_CPU_Model_68000=68E3,SAEC_Config_CPU_Model_68010=68010,SAEC_Config_CPU_Model_68020=68020,SAEC_Config_CPU_Model_68030=68030,SAEC_Config_CPU_Model_68040=68040,SAEC_Config_CPU_Model_68060=68060,SAEC_Config_CPU_Speed_Maximum=-1,SAEC_Config_CPU_Speed_Original=0,SAEC_Config_Chipset_Mask_OCS=0,SAEC_Config_Chipset_Mask_ECS_AGNUS=1,SAEC_Config_Chipset_Mask_ECS_DENISE=2,SAEC_Config_Chipset_Mask_AGA=4,SAEC_Config_Chipset_ColLevel_None=0,SAEC_Config_Chipset_ColLevel_Sprite_Sprite=1,SAEC_Config_Chipset_ColLevel_Sprite_Playfield=
2,SAEC_Config_Chipset_ColLevel_Full=3,SAEC_Config_Chipset_CR_MAX=10,SAEC_Config_Chipset_CR_PAL=SAEC_Config_Chipset_CR_MAX+0,SAEC_Config_Chipset_CR_NTSC=SAEC_Config_Chipset_CR_MAX+1,SAEC_Config_Chipset_CR_TOTAL=SAEC_Config_Chipset_CR_MAX+2;function SAEO_Config_Chipset_Refresh(){this.index=0;this.rtg=this.locked=!1;this.lace=this.vert=this.horiz=0;this.ntsc=!1;this.rate=this.framelength=this.vsync=0;this.commands=this.label=""}
var SAEC_Config_Chipset_Compatible_Manual=0,SAEC_Config_Chipset_Compatible_Generic=1,SAEC_Config_Chipset_Compatible_A500=2,SAEC_Config_Chipset_Compatible_A500P=3,SAEC_Config_Chipset_Compatible_A600=4,SAEC_Config_Chipset_Compatible_A1000=5,SAEC_Config_Chipset_Compatible_A1000V=6,SAEC_Config_Chipset_Compatible_A1200=7,SAEC_Config_Chipset_Compatible_A2000=8,SAEC_Config_Chipset_Compatible_A3000=9,SAEC_Config_Chipset_Compatible_A4000=10,SAEC_Config_Chipset_Compatible_A4000T=11,SAEC_Config_Chipset_Compatible_CDTV=
12,SAEC_Config_Chipset_Compatible_CDTVCR=13,SAEC_Config_Chipset_Compatible_CD32=14,SAEC_Config_Chipset_CIA_TOD_VSync=0,SAEC_Config_Chipset_CIA_TOD_50Hz=1,SAEC_Config_Chipset_CIA_TOD_60Hz=2,SAEC_Config_RTC_Type_None=0,SAEC_Config_RTC_Type_MSM6242B=1,SAEC_Config_RTC_Type_RF5C01A=2,SAEC_Config_RTC_Type_MSM6242B_A2000=3,SAEC_Config_Chipset_IDE_A600A1200=1,SAEC_Config_Chipset_IDE_A4000=2,SAEC_Config_Memory_z3Mapping_Auto=0,SAEC_Config_Memory_z3Mapping_SAE=1,SAEC_Config_Memory_z3Mapping_Real=2,SAEC_Config_Floppy_Type_None=
0,SAEC_Config_Floppy_Type_35_DD=1,SAEC_Config_Floppy_Type_35_HD=2,SAEC_Config_Floppy_Type_35_DD_ESCOM=3,SAEC_Config_Floppy_Type_35_DD_PC=4,SAEC_Config_Floppy_Type_35_HD_PC=5,SAEC_Config_Floppy_Type_525_SD=6,SAEC_Config_Floppy_Speed_Turbo=0,SAEC_Config_Floppy_Speed_Original=100;function SAEO_Config_Floppy_Drive(){this.type=SAEC_Config_Floppy_Type_None;this.file=new SAEO_Config_File}
var SAEC_Config_Mount_Controller_Type_MB_IDE=1,SAEC_Config_Mount_Controller_Type_PCMCIA_SRAM=2,SAEC_Config_Mount_Controller_Type_PCMCIA_IDE=3,SAEC_Config_Mount_Controller_Level_ATA_1=0,SAEC_Config_Mount_Controller_Level_ATA_2=1,SAEC_Config_Mount_Controller_Level_ATA_2S=2,SAEC_Config_Mount_Controller_Level_SCSI_1=0,SAEC_Config_Mount_Controller_Level_SCSI_2=1,SAEC_Config_Mount_Controller_Level_SASI=2,SAEC_Config_Mount_Controller_Level_SASI_ENHANCED=2,SAEC_Config_Mount_Controller_Level_SASI_CHS=3,SAEC_Config_Mount_Bootpri_NOAUTOBOOT=
-128,SAEC_Config_Mount_Bootpri_NOAUTOMOUNT=-129;
function SAEO_Config_Mount_Info(){this.type=this.unit_special_flags=this.unit_feature_level=this.controller_media_type=this.controller_unit=this.controller_type=0;this.file=new SAEO_Config_File;this.readonly=!1;this.sectors=this.surfaces=this.cyls=this.blocksize=0;this.physical_geometry=this.interleave=!1;this.psecs=this.pheads=this.pcyls=0;this.automount=this.bootable=!1;this.flags=this.unit=0;this.devname="";this.dostype=this.bootpri=this.mask=this.maxtransfer=this.bufmemtype=this.buffers=this.highcyl=
this.lowcyl=this.reserved=this.sectorsperblock=0;this.filesys="";this.priority=this.stacksize=0}function SAEO_Config_Mount_Data(){this.ci=new SAEO_Config_Mount_Info;this.unitnum=this.configoffset=0}
var SAEC_Config_Video_API_Canvas=0,SAEC_Config_Video_API_WebGL=1,SAEC_Config_Video_HResolution_LoRes=0,SAEC_Config_Video_HResolution_HiRes=1,SAEC_Config_Video_HResolution_SuperHiRes=2,SAEC_Config_Video_VResolution_NonDouble=0,SAEC_Config_Video_VResolution_Double=1,SAEC_Config_Video_AP_Fullscreen_WINDOW=0,SAEC_Config_Video_AP_Fullscreen_FULLSCREEN=1,SAEC_Config_Video_AP_Fullscreen_FULLWINDOW=2;function SAEO_Config_Video_WH(){this.height=this.width=this.y=this.x=0;this.special=!1}
function SAEO_Config_Video_APMode(){this.gfx_vflip=this.gfx_vsync=this.gfx_display=this.gfx_fullscreen=0;this.gfx_strobo=!1;this.gfx_backbuffers=this.gfx_vsyncmode=0;this.gfx_interlaced=!1;this.gfx_refreshrate=0}var MAX_FILTERSHADERS=4;
function SAEO_Config_Video_FilterData(){this.gfx_filter=0;this.gfx_filtershader=Array(2*MAX_FILTERSHADERS+1);this.gfx_filtermask=Array(2*MAX_FILTERSHADERS+1);this.gfx_filteroverlay="";this.gfx_filteroverlay_pos=new SAEO_Config_Video_WH;this.gfx_filter_gamma=this.gfx_filter_contrast=this.gfx_filter_luminance=this.gfx_filter_saturation=this.gfx_filter_blur=this.gfx_filter_noise=this.gfx_filter_bilinear=this.gfx_filter_filtermode=this.gfx_filter_bottom_border=this.gfx_filter_top_border=this.gfx_filter_right_border=
this.gfx_filter_left_border=this.gfx_filter_vert_offset=this.gfx_filter_horiz_offset=this.gfx_filter_vert_zoom_mult=this.gfx_filter_horiz_zoom_mult=this.gfx_filter_vert_zoom=this.gfx_filter_horiz_zoom=this.gfx_filter_scanlinelevel=this.gfx_filter_scanlineratio=this.gfx_filter_scanlines=this.gfx_filteroverlay_overscan=0;this.gfx_filter_gamma_ch=[0,0,0];for(var a=this.gfx_filter_keep_autoscale_aspect=this.gfx_filter_integerscalelimit=this.gfx_filter_autoscale=this.gfx_filter_aspect=this.gfx_filter_keep_aspect=
0;a<2*MAX_FILTERSHADERS+1;a++)this.gfx_filtershader[a]="",this.gfx_filtermask[a]=""}
var SAEC_Config_Audio_Mode_Off=0,SAEC_Config_Audio_Mode_Off_Emul=1,SAEC_Config_Audio_Mode_On=2,SAEC_Config_Audio_Mode_On_Best=3,SAEC_Config_Audio_Freq_Auto=0,SAEC_Config_Audio_Freq_11025=11025,SAEC_Config_Audio_Freq_22050=22050,SAEC_Config_Audio_Freq_44100=44100,SAEC_Config_Audio_Freq_48000=48E3,SAEC_Config_Audio_Channels_Mono=1,SAEC_Config_Audio_Channels_Stereo=2,SAEC_Config_Audio_Filter_Off=0,SAEC_Config_Audio_Filter_Emul=1,SAEC_Config_Audio_Filter_On=2,SAEC_Config_Audio_FilterType_A500=0,SAEC_Config_Audio_FilterType_A1200=
1,SAEC_Config_Audio_Interpol_None=0,SAEC_Config_Audio_Interpol_Anti=1,SAEC_Config_Audio_Interpol_RH=2,SAEC_Config_Audio_Interpol_Crux=3,SAEC_Config_Ports_Type_None=0,SAEC_Config_Ports_Type_Mouse=1,SAEC_Config_Ports_Type_Joy0=2,SAEC_Config_Ports_Type_Joy1=3,SAEC_Config_Ports_Move_None=0,SAEC_Config_Ports_Move_Arrows=1,SAEC_Config_Ports_Move_Numpad=2,SAEC_Config_Ports_Move_WASD=3,SAEC_Config_Ports_Fire_None=0,SAEC_Config_Debug_Level_Fatal=0,SAEC_Config_Debug_Level_Error=1,SAEC_Config_Debug_Level_Warn=
2,SAEC_Config_Debug_Level_Info=3,SAEC_Config_Debug_Level_Log=4;
function SAEO_Config(){this.cpu={model:0,speed:0,speedThrottle:0,clock:{multiplier:0,frequency:0},compatible:!1,addressSpace24:!1,resetDelay:!1};this.chipset={mask:0,ntsc:!1,genlock:!1,colLevel:0,refreshRate:0,refresh:null,blitter:{immediate:!1,waiting:0,cycle_exact:!1},cia:{todHack:!1,todBug:!1,tod:0,overlay:!1,type6526:!1},rtc:{type:0,adjust:0},compatible:0,mirrorE0:!1,mirrorA8:!1,a1000ram:!1,agnusRev:0,agnusDIP:!1,agnusBltBusyBug:!1,deniseRev:0,deniseNoEHB:!1,fatGaryRev:0,ramseyRev:0,df0idhw:!1,
ide:0,pcmcia:!1,mbdmac:0,jumper1MbChip:!1,bogomemIsFast:!1,z3AutoConfig:!1};this.memory={rom:new SAEO_Config_File,extRom:new SAEO_Config_File,romKey:new SAEO_Config_File,amaxRom:new SAEO_Config_File,kickShifter:!1,chipSize:0,bogoSize:0,z2FastSize:0,z2FastAutoConfig:!1,z3FastSize:0,z3Mapping:0,z3AutoConfigStart:0,ramsey:{lowSize:0,highSize:0},custom:[{addr:0,size:0,mask:0},{addr:0,size:0,mask:0}],logIllegal:!1};this.floppy={drive:null,readOnly:!1,randomBitsMin:0,randomBitsMax:0,speed:0,autoEXT2:0};
this.mount={items:0,config:null};this.video={id:"",enabled:!1,hideCursor:!1,scandoubler:!1,framerate:0,hresolution:0,vresolution:0,pscanlines:0,iscanlines:0,xcenter:0,ycenter:0,lores_mode:!1,extrawidth:0,backgroundColor:0,luminance:0,contrast:0,gamma:0,gammaCh:[0,0,0],alpha:0,antialias:!1,size:new SAEO_Config_Video_WH,size_win:new SAEO_Config_Video_WH,size_fs:new SAEO_Config_Video_WH,apmode:null,gf:null,api:0,colorMode:0,blackerThanBlack:!1,refreshIndicator:!1};this.audio={bufferFrames:0,mode:0,channels:0,
freq:0,stereoSeparation:0,stereoDelay:0,interpol:0,filter:0,filterType:0};this.ports=[{type:SAEC_Config_Ports_Type_Mouse,move:SAEC_Config_Ports_Move_WASD,fire:[49,50]},{type:SAEC_Config_Ports_Type_Joy1,move:SAEC_Config_Ports_Move_Arrows,fire:[16,17]}];this.keyboard={enabled:!0};this.serial={enabled:!1,demand:!1};this.hook={log:{error:function(a,d){}},led:{power:function(a){},hd:function(a){},df:function(a,d,J,h,N){},fps:function(a,d){},cpu:function(a,d){}},event:{started:function(){},stopped:function(){},
reseted:function(a){},paused:function(a){}}};this.debug={level:0};this.chipset.refresh=Array(SAEC_Config_Chipset_CR_TOTAL);for(var a=0;a<SAEC_Config_Chipset_CR_TOTAL;a++)this.chipset.refresh[a]=new SAEO_Config_Chipset_Refresh;this.floppy.drive=Array(4);for(a=0;4>a;a++)this.floppy.drive[a]=new SAEO_Config_Floppy_Drive;this.mount.config=Array(6);for(a=0;6>a;a++)this.mount.config[a]=new SAEO_Config_Mount_Data;this.video.apmode=Array(2);for(a=0;2>a;a++)this.video.apmode[a]=new SAEO_Config_Video_APMode;
this.video.gf=Array(2);for(a=0;2>a;a++)this.video.gf[a]=new SAEO_Config_Video_FilterData}
function SAEO_Configuration(){function a(a){a.cpu.model=SAEC_Config_CPU_Model_68000;a.cpu.speed=SAEC_Config_CPU_Speed_Original;a.cpu.speedThrottle=0;a.cpu.clock.multiplier=0;a.cpu.clock.frequency=0;a.cpu.compatible=!1;a.cpu.addressSpace24=!0;a.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS;a.chipset.colLevel=SAEC_Config_Chipset_ColLevel_Sprite_Playfield;a.chipset.ntsc=!1;a.chipset.genlock=!1;for(var d,m=0;m<a.chipset.refresh.length;m++)d=a.chipset.refresh[m],d.index=m,d.rate=-1;d=a.chipset.refresh[SAEC_Config_Chipset_CR_PAL];
d.index=SAEC_Config_Chipset_CR_PAL;d.horiz=-1;d.vert=-1;d.lace=-1;d.vsync=-1;d.framelength=-1;d.rate=50;d.ntsc=!1;d.locked=!1;d.label="PAL";d=a.chipset.refresh[SAEC_Config_Chipset_CR_NTSC];d.index=SAEC_Config_Chipset_CR_NTSC;d.horiz=-1;d.vert=-1;d.lace=-1;d.vsync=-1;d.framelength=-1;d.rate=60;d.ntsc=!0;d.locked=!1;d.label="NTSC";a.chipset.blitter.immediate=!1;a.chipset.blitter.waiting=0;a.chipset.blitter.cycle_exact=!1;a.chipset.cia.todHack=!1;a.chipset.cia.todBug=!1;a.chipset.cia.tod=SAEC_Config_Chipset_CIA_TOD_VSync;
a.chipset.cia.overlay=!0;a.chipset.rtc.type=SAEC_Config_RTC_Type_None;a.chipset.compatible=SAEC_Config_Chipset_Compatible_Generic;a.chipset.a1000ram=0;a.chipset.mirrorE0=!0;a.chipset.mirrorA8=!1;a.chipset.agnusRev=-1;a.chipset.deniseRev=-1;a.chipset.fatGaryRev=-1;a.chipset.ramseyRev=-1;a.chipset.df0idhw=!0;a.chipset.ide=0;a.chipset.pcmcia=!1;a.chipset.mbdmac=0;a.chipset.z3AutoConfig=!1;a.chipset.bogomemIsFast=!1;a.memory.rom.clr();a.memory.extRom.clr();a.memory.romKey.clr();a.memory.amaxRom.clr();
a.memory.chipSize=524288;a.memory.bogoSize=524288;a.memory.z2FastSize=0;a.memory.z2FastAutoConfig=!0;a.memory.z3FastSize=0;a.memory.z3Mapping=SAEC_Config_Memory_z3Mapping_Auto;a.memory.z3AutoConfigStart=268435456;a.memory.ramsey.lowSize=0;a.memory.ramsey.highSize=0;a.memory.custom[0].addr=0;a.memory.custom[0].size=0;a.memory.custom[1].addr=0;a.memory.custom[1].size=0;a.logIllegal=!1;a.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_DD;a.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_DD;a.floppy.drive[2].type=
SAEC_Config_Floppy_Type_None;a.floppy.drive[3].type=SAEC_Config_Floppy_Type_None;a.floppy.drive[0].file.clr();a.floppy.drive[1].file.clr();a.floppy.drive[2].file.clr();a.floppy.drive[3].file.clr();a.floppy.readOnly=!1;a.floppy.randomBitsMin=1;a.floppy.randomBitsMax=3;a.floppy.speed=100;for(m=a.floppy.autoEXT2=0;6>m;m++)a.mount.config[m].configoffset=-1,a.mount.config[m].unitnum=-1;a.video.id="video";a.video.enabled=!0;a.video.hideCursor=!0;a.video.scandoubler=!1;a.video.framerate=1;a.video.hresolution=
SAEC_Config_Video_HResolution_HiRes;a.video.vresolution=SAEC_Config_Video_VResolution_Double;a.video.pscanlines=0;a.video.iscanlines=0;a.video.xcenter=0;a.video.ycenter=0;a.video.backgroundColor=0;a.video.luminance=0;a.video.contrast=0;a.video.gamma=0;a.video.alpha=255;a.video.antialias=!0;a.video.size_fs.width=screen.width;a.video.size_fs.height=screen.height;a.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH<<1;a.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT<<1;a.video.apmode[0].gfx_display=
1;a.video.apmode[0].gfx_fullscreen=SAEC_Config_Video_AP_Fullscreen_WINDOW;a.video.apmode[1].gfx_fullscreen=SAEC_Config_Video_AP_Fullscreen_WINDOW;a.video.apmode[0].gfx_backbuffers=0;for(m=a.video.apmode[1].gfx_backbuffers=0;1>=m;m++){d=a.video.gf[m];d.gfx_filter=0;d.gfx_filter_scanlineratio=17;for(var h=0;h<=2*MAX_FILTERSHADERS;h++)d.gfx_filtershader[m][0]=0,d.gfx_filtermask[m][0]=0;d.gfx_filter_horiz_zoom_mult=1;d.gfx_filter_vert_zoom_mult=1;d.gfx_filter_bilinear=0;d.gfx_filter_filtermode=0;d.gfx_filter_keep_aspect=
0;d.gfx_filter_autoscale=0;d.gfx_filter_keep_autoscale_aspect=!1;d.gfx_filteroverlay_overscan=0}a.video.api=SAEC_Config_Video_API_WebGL;a.video.colorMode=2;a.video.blackerThanBlack=!1;a.audio.bufferFrames=4096;a.audio.mode=SAEC_Config_Audio_Mode_On_Best;a.audio.channels=SAEC_Config_Audio_Channels_Stereo;a.audio.stereoSeparation=10;a.audio.stereoDelay=0;a.audio.freq=SAEC_Config_Audio_Freq_Auto;a.audio.interpol=SAEC_Config_Audio_Interpol_None;a.audio.filter=SAEC_Config_Audio_Filter_Emul;a.audio.filterType=
0;a.ports[0].type=SAEC_Config_Ports_Type_Mouse;a.ports[0].move=SAEC_Config_Ports_Move_WASD;a.ports[0].fire=[49,50];a.ports[1].type=SAEC_Config_Ports_Type_Joy1;a.ports[1].move=SAEC_Config_Ports_Move_Arrows;a.ports[1].fire=[16,17];a.keyboard.enabled=!0;a.serial.enabled=!1;a.serial.demand=!1;a.debug.level=SAEC_Config_Debug_Level_Warn}function f(a){a.cpu.model=SAEC_Config_CPU_Model_68020;a.cpu.speed=SAEC_Config_CPU_Speed_Original;a.cpu.compatible=!1;a.cpu.addressSpace24=!0;a.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|
SAEC_Config_Chipset_Mask_ECS_DENISE|SAEC_Config_Chipset_Mask_AGA;a.memory.chipSize=2097152;a.memory.bogoSize=0}function d(a){if(a.chipset.compatible==SAEC_Config_Chipset_Compatible_Manual)return 1;a.chipset.cia.todBug=!1;a.chipset.cia.tod=SAEC_Config_Chipset_CIA_TOD_VSync;a.chipset.cia.overlay=!0;a.chipset.cia.type6526=!1;a.chipset.rtc.type=SAEC_Config_RTC_Type_None;a.chipset.rtc.adjust=0;a.chipset.a1000ram=0;a.chipset.mirrorE0=!0;a.chipset.mirrorA8=!1;a.chipset.agnusRev=-1;a.chipset.agnusDIP=!1;
a.chipset.agnusBltBusyBug=!1;a.chipset.deniseRev=-1;a.chipset.deniseNoEHB=!1;a.chipset.fatGaryRev=-1;a.chipset.ramseyRev=-1;a.chipset.df0idhw=!0;a.chipset.ide=0;a.chipset.pcmcia=!1;a.chipset.mbdmac=0;a.chipset.z3AutoConfig=!1;a.chipset.bogomemIsFast=!1;switch(a.chipset.compatible){case SAEC_Config_Chipset_Compatible_Generic:if(a.cpu.model>=SAEC_Config_CPU_Model_68020)a.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A,a.chipset.fatGaryRev=0,a.chipset.ramseyRev=15,a.chipset.ide=-1,a.chipset.mbdmac=-1;
else if(a.cpu.compatible){a.chipset.df0idhw=!1;if(a.memory.bogoSize||524288<a.memory.chipSize||a.memory.z2FastSize)a.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B;a.chipset.cia.todBug=!0}else a.chipset.ide=-1,a.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B;break;case SAEC_Config_Chipset_Compatible_CDTV:a.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B;a.chipset.df0idhw=!0;a.chipset.mirrorE0=!1;break;case SAEC_Config_Chipset_Compatible_CDTVCR:a.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B;a.chipset.df0idhw=
!0;a.chipset.mirrorE0=!1;a.chipset.ide=SAEC_Config_Chipset_IDE_A600A1200;a.chipset.pcmcia=!0;a.chipset.mirrorA8=!0;a.chipset.cia.overlay=!1;a.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_CD32:a.chipset.mirrorE0=!1;a.chipset.mirrorA8=!0;a.chipset.cia.overlay=!1;break;case SAEC_Config_Chipset_Compatible_A500:a.chipset.df0idhw=!1;if(a.memory.bogoSize||524288<a.memory.chipSize||a.memory.z2FastSize)a.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B;a.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A500P:a.chipset.rtc.type=
SAEC_Config_RTC_Type_MSM6242B;a.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A600:a.chipset.ide=SAEC_Config_Chipset_IDE_A600A1200;a.chipset.pcmcia=!0;a.chipset.mirrorA8=!0;a.chipset.cia.overlay=!1;a.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A1000:a.chipset.a1000ram=1;a.chipset.cia.tod=a.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz;a.chipset.mirrorE0=!1;a.chipset.agnusBltBusyBug=!0;a.chipset.agnusDIP=!0;a.chipset.cia.todBug=
!0;break;case SAEC_Config_Chipset_Compatible_A1000V:a.chipset.cia.tod=a.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz;a.chipset.mirrorE0=!1;a.chipset.agnusBltBusyBug=!0;a.chipset.agnusDIP=!0;a.chipset.deniseNoEHB=!0;break;case SAEC_Config_Chipset_Compatible_A1200:a.chipset.ide=SAEC_Config_Chipset_IDE_A600A1200;a.chipset.pcmcia=!0;a.chipset.mirrorA8=!0;a.chipset.cia.overlay=!1;if(a.memory.z2FastSize||a.memory.z3FastSize)a.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B;
break;case SAEC_Config_Chipset_Compatible_A2000:a.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B_A2000;a.chipset.cia.tod=a.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz;a.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A3000:a.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A;a.chipset.fatGaryRev=0;a.chipset.ramseyRev=13;a.chipset.mbdmac=1;a.chipset.mirrorE0=!1;a.chipset.cia.tod=a.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz;
a.chipset.z3AutoConfig=!0;break;case SAEC_Config_Chipset_Compatible_A4000:a.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A;a.chipset.fatGaryRev=0;a.chipset.ramseyRev=15;a.chipset.ide=SAEC_Config_Chipset_IDE_A4000;a.chipset.mbdmac=0;a.chipset.mirrorA8=!1;a.chipset.mirrorE0=!1;a.chipset.cia.overlay=!1;a.chipset.z3AutoConfig=!0;break;case SAEC_Config_Chipset_Compatible_A4000T:a.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A,a.chipset.fatGaryRev=0,a.chipset.ramseyRev=15,a.chipset.ide=SAEC_Config_Chipset_IDE_A4000,
a.chipset.mbdmac=2,a.chipset.mirrorA8=!1,a.chipset.mirrorE0=!1,a.chipset.cia.overlay=!1,a.chipset.z3AutoConfig=!0}return 1}function J(a,d){a.cpu.clock.multiplier=512;switch(d){case 0:a.chipset.blitter.cycle_exact=!0;break;case 1:a.cpu.compatible=!0;break;case 2:a.cpu.compatible=!1}}function h(a,d,m){switch(d){case 0:a.chipset.blitter.cycle_exact=!0;break;case 1:a.cpu.compatible=!0;break;case 2:a.cpu.compatible=!1}}function N(a){a.special||(a.width<SAEC_Video_MIN_UAE_WIDTH&&(SAEF_warn("config.fixup_prefs_dim2() Width (%d) min is %d.",
a.width,SAEC_Video_MIN_UAE_WIDTH),a.width=SAEC_Video_MIN_UAE_WIDTH),a.height<SAEC_Video_MIN_UAE_HEIGHT&&(SAEF_warn("config.fixup_prefs_dim2() Height (%d) min is %d.",a.height,SAEC_Video_MIN_UAE_HEIGHT),a.height=SAEC_Video_MIN_UAE_HEIGHT),a.width>SAEC_Video_MAX_UAE_WIDTH&&(SAEF_warn("config.fixup_prefs_dim2() Width (%d) max is %d.",a.width,SAEC_Video_MAX_UAE_WIDTH),a.width=SAEC_Video_MAX_UAE_WIDTH),a.height>SAEC_Video_MAX_UAE_HEIGHT&&(SAEF_warn("config.fixup_prefs_dim2() Height (%d) max is %d.",a.height,
SAEC_Video_MAX_UAE_HEIGHT),a.height=SAEC_Video_MAX_UAE_HEIGHT))}function I(a){N(a.video.size_win);N(a.video.size_fs);a.video.apmode[1].gfx_vsync&&(a.video.apmode[1].gfx_vsyncmode=1);for(var d=0;2>d;d++){var m=a.video.apmode[d];m.gfx_vflip=0;m.gfx_strobo=!1;m.gfx_vsync?m.gfx_vsyncmode?(1<=m.gfx_backbuffers&&(m.gfx_vflip=1),d||2!=m.gfx_backbuffers||(m.gfx_vflip=1),m.gfx_strobo=a.lightboost_strobo):(m.gfx_vflip=-1,a.video.api==SAEC_Config_Video_API_WebGL&&1>m.gfx_backbuffers&&(m.gfx_backbuffers=1),m.gfx_vflip&&
(m.gfx_strobo=a.lightboost_strobo)):2<=m.gfx_backbuffers&&(m.gfx_vflip=-1)}}SAEV_config=new SAEO_Config;a(SAEV_config);this.setup=function(){var a=SAEV_config;d(a);switch(a.cpu.model){case SAEC_Config_CPU_Model_68000:case SAEC_Config_CPU_Model_68010:a.cpu.clock.multiplier=512;break;case SAEC_Config_CPU_Model_68020:a.cpu.clock.multiplier=1024;break;case SAEC_Config_CPU_Model_68030:a.cpu.clock.multiplier=2048}1E6==a.cpu.clock.frequency&&(a.cpu.clock.frequency=0);a.chipset.blitter.immediate&&a.chipset.blitter.waiting&&
(SAEF_warn("config.fixup_cpu() Immediate blitter and waiting blits can't be enabled simultaneously. Disabling waiting blits..."),a.chipset.blitter.waiting=0);if(0!=(a.memory.chipSize&a.memory.chipSize-1)&&1572864!=a.memory.chipSize||131072>a.memory.chipSize||8388608<a.memory.chipSize)SAEF_warn("config.fixup_prefs() Unsupported chipmem size %d (0x%x). Setting to 2M...",a.memory.chipSize,a.memory.chipSize),a.memory.chipSize=2097152;if(0!=(a.memory.z2FastSize&a.memory.z2FastSize-1)||0!=a.memory.z2FastSize&&
(65536>a.memory.z2FastSize||8388608<a.memory.z2FastSize))SAEF_warn("config.fixup_prefs() Unsupported Zorro II fastmem size %d (0x%x). Disabling fastmem...",a.memory.z2FastSize,a.memory.z2FastSize),a.memory.z2FastSize=0;if(0!=(a.memory.z3FastSize&a.memory.z3FastSize-1)||0!=a.memory.z3FastSize&&1048576>a.memory.z3FastSize)SAEF_warn("config.fixup_prefs() Unsupported Zorro III fastmem size %d (0x%x). Disabling fastmem...",a.memory.z3FastSize,a.memory.z3FastSize),a.memory.z3FastSize=0;a.memory.z3AutoConfigStart=
(a.memory.z3AutoConfigStart&4294901760)>>>0;16777216>a.memory.z3AutoConfigStart&&(a.memory.z3AutoConfigStart=16777216);a.cpu.addressSpace24&&0!=a.memory.z3FastSize&&(a.memory.z3FastSize=0,SAEF_warn("config.fixup_prefs() Can't use Zorro III memory when using a 24 bit address space. Disabling memory..."));0!=a.memory.bogoSize&&524288!=a.memory.bogoSize&&1048576!=a.memory.bogoSize&&1572864!=a.memory.bogoSize&&1835008!=a.memory.bogoSize&&(SAEF_warn("config.fixup_prefs() Unsupported bogomem size %d (0x%x). Disabling bogomem...",
a.memory.bogoSize,a.memory.bogoSize),a.memory.bogoSize=0);1572864<a.memory.bogoSize&&(0<=a.chipset.fatGaryRev||a.chipset.ide||0<=a.chipset.ramseyRev)&&(a.memory.bogoSize=1572864,SAEF_warn("config.fixup_prefs() Possible Gayle bogomem conflict fixed."));2097152<a.memory.chipSize&&262144<a.memory.z2FastSize&&(SAEF_warn("config.fixup_prefs() Can't use Zorro II fastmem and more than 2M chipmem at the same time. Limiting chipmem to 2M..."),a.memory.chipSize=2097152);if(67108864<a.memory.ramsey.lowSize||
a.memory.ramsey.lowSize&1048575)a.memory.ramsey.lowSize=0,SAEF_warn("config.fixup_prefs() Unsupported Mainboard fastmem size. Disabling fastmem... (RAMSEY low)");if(134217728<a.memory.ramsey.highSize||a.memory.ramsey.highSize&1048575)a.memory.ramsey.highSize=0,SAEF_warn("config.fixup_prefs() Unsupported CPU-Board fastmem size. Disabling fastmem... (RAMSEY high)");if(a.audio.mode<SAEC_Config_Audio_Mode_Off||a.audio.mode>SAEC_Config_Audio_Mode_On_Best)SAEF_warn("config.fixup_prefs() Bad 'config.audio.mode'. Disabling audio..."),
a.audio.mode=SAEC_Config_Audio_Mode_Off;a.chipset.z3AutoConfig&&a.cpu.addressSpace24&&(a.chipset.z3AutoConfig=!1,SAEF_warn("config.fixup_prefs() Zorro III autoconfig and 24bit address space are not compatible. Disabling Zorro III autoconfig..."));a.memory.z3FastSize&&a.cpu.addressSpace24&&(SAEF_warn("config.fixup_prefs() Zorro III memory can't be used if address space is 24-bit., Disabling Zorro III memory..."),a.memory.z3FastSize=0);0<a.floppy.speed&&10>a.floppy.speed&&(SAEF_warn("config.fixup_prefs() Invalid floppy speed. Setting to 'Turbo' (100)..."),
a.floppy.speed=100);if(a.chipset.colLevel<SAEC_Config_Chipset_ColLevel_None||a.chipset.colLevel>SAEC_Config_Chipset_ColLevel_Full)SAEF_warn("config.fixup_prefs() Invalid collision support level. Using Sprite-Sprite..."),a.chipset.colLevel=SAEC_Config_Chipset_ColLevel_Sprite_Sprite;a.chipset.compatible==SAEC_Config_Chipset_Compatible_Generic?(a.chipset.fatGaryRev=a.chipset.ramseyRev=-1,a.chipset.ide=0,a.chipset.mbdmac=-1,a.cpu.model>=SAEC_Config_CPU_Model_68020&&(a.chipset.fatGaryRev=0,a.chipset.ramseyRev=
15,a.chipset.ide=-1,a.chipset.mbdmac=0)):a.chipset.compatible==SAEC_Config_Chipset_Compatible_Manual&&a.chipset.ide==SAEC_Config_Chipset_IDE_A4000&&(0>a.chipset.fatGaryRev&&(a.chipset.fatGaryRev=0),0>a.chipset.ramseyRev&&(a.chipset.ramseyRev=15));1048576<=a.memory.chipSize&&(a.chipset.jumper1MbChip=!0);I(a);a.video.api==SAEC_Config_Video_API_Canvas&&5!=a.video.colorMode&&(a.video.colorMode=5,SAEF_warn("config.fixup_prefs() p.video.colorMode must 5 if 'Canvas' is used. (set to 5)"));if(-1E3>a.video.luminance||
1E3<a.video.luminance)a.video.luminance=0,SAEF_warn("config.fixup_prefs() p.video.luminance must be between -1000 and 1000. (reset to 0)");if(-1E3>a.video.contrast||1E3<a.video.contrast)a.video.contrast=0,SAEF_warn("config.fixup_prefs() p.video.contrast must be between -1000 and 1000. (reset to 0)");if(-1E3>a.video.gamma||1E3<a.video.gamma)a.video.gamma=0,SAEF_warn("config.fixup_prefs() p.video.gamma must be between -1000 and 1000. (reset to 0)");if(0>a.video.alpha||255<a.video.alpha)a.video.alpha=
255,SAEF_warn("config.fixup_prefs() p.video.gamma must be between 0 and 255. (reset to 255)");a.chipset.cia.todHack&&a.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_VSync&&(a.chipset.cia.tod=a.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz);d(a);return SAEE_None};this.setModel=function(a,K){var m=SAEV_config;m.cpu.model=SAEC_Config_CPU_Model_68000;m.cpu.speed=SAEC_Config_CPU_Speed_Original;m.cpu.clock.multiplier=0;m.cpu.clock.frequency=0;m.cpu.compatible=!1;m.cpu.addressSpace24=
!0;m.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS;m.chipset.colLevel=SAEC_Config_Chipset_ColLevel_Sprite_Playfield;m.chipset.blitter.immediate=!1;m.chipset.blitter.waiting=0;m.chipset.blitter.cycle_exact=!1;m.chipset.cia.todHack=!1;m.chipset.cia.todBug=!1;m.chipset.cia.tod=SAEC_Config_Chipset_CIA_TOD_VSync;m.chipset.cia.overlay=!0;m.chipset.rtc.type=SAEC_Config_RTC_Type_None;m.chipset.compatible=SAEC_Config_Chipset_Compatible_Generic;m.chipset.a1000ram=!1;m.chipset.mirrorE0=!0;m.chipset.mirrorA8=
!1;m.chipset.agnusRev=-1;m.chipset.deniseRev=-1;m.chipset.fatGaryRev=-1;m.chipset.ramseyRev=-1;m.chipset.df0idhw=!0;m.chipset.ide=0;m.chipset.pcmcia=!1;m.chipset.mbdmac=0;m.chipset.jumper1MbChip=!1;m.memory.chipSize=524288;m.memory.bogoSize=524288;m.memory.z2FastSize=0;m.memory.z3FastSize=0;m.memory.ramsey.lowSize=0;m.memory.ramsey.highSize=0;m.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_DD;m.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_DD;m.floppy.drive[2].type=SAEC_Config_Floppy_Type_None;
m.floppy.drive[3].type=SAEC_Config_Floppy_Type_None;m.floppy.speed=100;m.audio.mode==SAEC_Config_Audio_Mode_Off&&(m.audio.mode=SAEC_Config_Audio_Mode_Off_Emul);switch(a){case SAEC_Model_A500:switch(K){case 0:m.chipset.mask=0;break;case 2:m.memory.bogoSize=0,m.memory.chipSize=1048576}J(m,2);m.chipset.compatible=SAEC_Config_Chipset_Compatible_A500;d(m);break;case SAEC_Model_A500P:J(m,2);m.chipset.compatible=SAEC_Config_Chipset_Compatible_A500P;d(m);m.memory.bogoSize=0;m.memory.chipSize=1048576;1==K?
m.memory.chipSize=2097152:2==K&&(m.memory.chipSize=2097152,m.memory.z2FastSize=4194304);m.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE;break;case SAEC_Model_A600:J(m,2);m.chipset.compatible=SAEC_Config_Chipset_Compatible_A600;d(m);m.memory.bogoSize=0;m.memory.chipSize=1048576;1==K?(m.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,m.memory.chipSize=2097152):2==K&&(m.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,m.memory.chipSize=2097152,m.memory.z2FastSize=4194304);
m.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE;break;case SAEC_Model_A1000:m.chipset.mask=0;m.memory.bogoSize=0;m.audio.filter=SAEC_Config_Audio_Filter_On;J(m,2);m.floppy.drive[1].type=SAEC_Config_Floppy_Type_None;m.chipset.bogomemIsFast=!0;m.chipset.agnusDIP=!0;m.chipset.agnusBltBusyBug=!0;m.chipset.compatible=SAEC_Config_Chipset_Compatible_A1000;d(m);1==K?m.memory.chipSize=262144:2==K?(m.chipset.deniseNoEHB=!0,m.memory.chipSize=262144):3==K&&(m.chipset.mask=
0,m.memory.bogoSize=0,m.audio.filter=SAEC_Config_Audio_Filter_On,J(m,2),m.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,m.chipset.bogomemIsFast=!0,m.chipset.agnusDIP=!0,m.chipset.agnusBltBusyBug=!0,m.chipset.compatible=SAEC_Config_Chipset_Compatible_A1000V,d(m),m.chipset.deniseNoEHB=!0,m.chipset.cia.type6526=!0,m.memory.chipSize=262144);break;case SAEC_Model_A1200:f(m);m.chipset.rtc.type=SAEC_Config_RTC_Type_None;m.chipset.compatible=SAEC_Config_Chipset_Compatible_A1200;d(m);1==K&&(m.memory.z2FastSize=
4194304,m.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B);h(m,2,!1);break;case SAEC_Model_A2000:m.chipset.compatible=SAEC_Config_Chipset_Compatible_A2000;d(m);break;case SAEC_Model_A3000:m.memory.bogoSize=0;m.memory.chipSize=2097152;m.memory.ramsey.lowSize=2097152;m.cpu.model=SAEC_Config_CPU_Model_68030;m.cpu.compatible=m.cpu.addressSpace24=!1;m.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE;m.chipset.blitter.immediate=!1;m.audio.mode=SAEC_Config_Audio_Mode_On;
m.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_HD;m.floppy.speed=0;m.chipset.compatible=SAEC_Config_Chipset_Compatible_A3000;d(m);m.chipset.cia.tod=m.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz;break;case SAEC_Model_A4000:m.memory.bogoSize=0;m.memory.chipSize=2097152;m.memory.ramsey.lowSize=8388608;m.cpu.model=SAEC_Config_CPU_Model_68030;m.cpu.compatible=m.cpu.addressSpace24=!1;m.chipset.mask=SAEC_Config_Chipset_Mask_AGA|SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE;
m.chipset.blitter.immediate=!1;m.audio.mode=SAEC_Config_Audio_Mode_On;m.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_HD;m.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_HD;m.floppy.speed=0;m.chipset.compatible=SAEC_Config_Chipset_Compatible_A4000;d(m);m.chipset.cia.tod=m.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz;break;case SAEC_Model_A4000T:m.memory.bogoSize=0;m.memory.chipSize=2097152;m.memory.ramsey.lowSize=8388608;m.cpu.model=SAEC_Config_CPU_Model_68030;
m.cpu.compatible=m.cpu.addressSpace24=!1;m.chipset.mask=SAEC_Config_Chipset_Mask_AGA|SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE;m.chipset.blitter.immediate=!1;m.audio.mode=SAEC_Config_Audio_Mode_On;m.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_HD;m.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_HD;m.floppy.speed=0;m.chipset.compatible=SAEC_Config_Chipset_Compatible_A4000T;d(m);m.chipset.cia.tod=m.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz;
break;case SAEC_Model_CD32:f(m);m.floppy.drive[0].type=SAEC_Config_Floppy_Type_None;m.floppy.drive[1].type=SAEC_Config_Floppy_Type_None;h(m,2,!0);m.chipset.compatible=SAEC_Config_Chipset_Compatible_CD32;d(m);break;case SAEC_Model_CDTV:1==K?(m.memory.bogoSize=0,m.memory.chipSize=1048576,m.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE,m.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,m.floppy.drive[0].type=SAEC_Config_Floppy_Type_None,m.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,
J(m,2),m.chipset.compatible=SAEC_Config_Chipset_Compatible_CDTVCR):(m.memory.bogoSize=0,m.memory.chipSize=1048576,m.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS,m.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,m.floppy.drive[0].type=SAEC_Config_Floppy_Type_None,m.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,J(m,2),m.chipset.compatible=SAEC_Config_Chipset_Compatible_CDTV),d(m)}m.cpu.model>=SAEC_Config_CPU_Model_68020&&!m.chipset.blitter.immediate&&(m.chipset.blitter.waiting=1);m.audio.filterType==
SAEC_Config_Audio_FilterType_A500&&m.chipset.mask&SAEC_Config_Chipset_Mask_AGA?m.audio.filterType=SAEC_Config_Audio_FilterType_A1200:m.audio.filterType!=SAEC_Config_Audio_FilterType_A1200||m.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(m.audio.filterType=SAEC_Config_Audio_FilterType_A500);return SAEE_None};this.setDefaults=function(){a(SAEV_config);return SAEE_None};this.fixup_prefs_dimensions_ext=function(a){I(a)}};var SAEC_RomType_KICK=256,SAEC_RomType_KICKCD32=512,SAEC_RomType_EXTCD32=1024,SAEC_RomType_EXTCDTV=2048,SAEC_RomType_KEY=4096,SAEC_RomType_CD32CART=32768,SAEC_RomType_AMAX=1048585,SAEC_RomType_NOT=8388608,SAEC_RomType_QUAD=16777216,SAEC_RomType_EVEN=33554432,SAEC_RomType_ODD=67108864,SAEC_RomType_8BIT=134217728,SAEC_RomType_BYTESWAP=268435456,SAEC_RomType_CD32=536870912,SAEC_RomType_SCRAMBLED=1073741824,SAEC_RomType_NONE=2147483648,SAEC_RomType_ALL_KICK=(SAEC_RomType_KICK|SAEC_RomType_KICKCD32|SAEC_RomType_CD32)>>>
0,SAEC_RomType_ALL_EXT=(SAEC_RomType_EXTCD32|SAEC_RomType_EXTCDTV)>>>0,SAEC_RomType_ALL_CART=SAEC_RomType_CD32CART>>>0;function SAEO_RomInfo(){this.name=0;this.models="";this.cpu=this.subRev=this.subVer=this.rev=this.ver=0;this.cloanto=this.addressSpace24=this.cpuExact=!1;this.type=0;this.partNumber="";this.crc32=0;this.checksumValid=this.checksum=!1}
function SAEO_Roms(){function a(a,d,m,h,f,G,I,J,N,y,Oa,T,wa,b,q,Z,ea,Ua,r,R,Fa,Lb){this.num=-1;this.name=a;this.ver=d;this.rev=m;this.subver=h;this.subrev=f;this.model=G;this.size=I;this.id=J;this.cpu=N;this.cloanto=y;this.type=Oa;this.group=T;this.title=wa;this.partnumber=b;this.crc32=q;this.sha1=[Z,ea,Ua,r,R];this.configname="undefined"==typeof Fa?"":Fa;this.defaultfilename="undefined"==typeof Lb?"":Lb}function f(d,h,m,f,I,G,J,N,ua,y,Oa){return new a("X",0,0,0,0,0,f,d,0,0,I,h<<16|m,"","",G,J,N,
ua,y,Oa)}function d(d,h,m,f,I,G,J,N,ua,y,Oa,T){return new a("X",0,0,0,0,0,f,d,0,0,I,h<<16|m,"",G,J,N,ua,y,Oa,T)}function J(a,d,m){for(var h=0;h<N.length;h++){var f=N[h].crc32;if(4294967295!=f&&0!=f&&N[h].size>=d&&N[h].type&m&&a==N[h].crc32)return N[h]}return null}function h(a,d,m){for(var h=0,f=0,G=0;G<m;G+=4)h+=(a[d+G]<<24|a[d+G+1]<<16|a[d+G+2]<<8|a[d+G+3])>>>0,4294967295<h&&(h-=4294967296),h<f&&(h++,4294967295<h&&(h-=4294967296)),f=h;return h}for(var N=[new a("AROS KS ROM (built-in)",0,0,0,0,"AROS",
524288,66,0,0,SAEC_RomType_KICK,0,"","",3903064114,0,0,0,0,0,"AROS"),new a("AROS extended ROM (built-in)",0,0,0,0,"AROS",524288,66,0,0,0,0,"","",1547294752,0,0,0,0,0,"AROS"),new a("Cloanto Amiga Forever ROM key",0,0,0,0,"",2069,0,0,1,SAEC_RomType_KEY,0,"","",2258297265,2149300915,775763768,1842439021,1327329191,3793574004),new a("Cloanto Amiga Forever 2006 ROM key",0,0,0,0,"",750,48,0,1,SAEC_RomType_KEY,0,"","",2954644310,3148408269,294358418,2951566995,1592498032,711339407),new a("Cloanto Amiga Forever 2010 ROM key",
0,0,0,0,"",1544,73,0,1,SAEC_RomType_KEY,0,"","",2353909852,84103010,190560178,2257931945,374332304,4213741476),new a("KS ROM Velvet 23.93",23,93,23,93,"VELVET",131072,125,0,0,SAEC_RomType_KICK,0,"","",2915779785,2083959482,697148378,3462451386,2232538224,1990462812),d(125,1,1,32768,SAEC_RomType_QUAD|SAEC_RomType_EVEN|SAEC_RomType_8BIT,"",496536248,3996747938,2993238836,37343705,4111290291,3772445628),d(125,1,2,32768,SAEC_RomType_QUAD|SAEC_RomType_ODD|SAEC_RomType_8BIT,"",3831935631,1041857897,3489283610,
204021079,3040836895,3414527223),d(125,1,3,32768,SAEC_RomType_QUAD|SAEC_RomType_EVEN|SAEC_RomType_8BIT,"",1901693097,147023360,961070277,1108799372,401334636,3374136186),d(125,1,4,32768,SAEC_RomType_QUAD|SAEC_RomType_ODD|SAEC_RomType_8BIT,"",3302784618,1722954192,2217068632,3754768082,3549040120,1368262308),new a("KS ROM v1.0 (A1000)(NTSC)",1,0,1,0,"A1000",262144,1,0,0,SAEC_RomType_KICK,0,"","",697798911,12669958,3199514795,437693030,3227017441,2814487929),new a("KS ROM v1.1 (A1000)(NTSC)",1,1,31,
34,"A1000",262144,2,0,0,SAEC_RomType_KICK,0,"","",3495974698,1100137733,3509646406,2997724861,3374165619,181074764),new a("KS ROM v1.1 (A1000)(PAL)",1,1,31,34,"A1000",262144,3,0,0,SAEC_RomType_KICK,0,"","",3968260834,383748959,3575956897,3344452388,1470895535,4192447853),new a("KS ROM v1.2 (A1000)",1,2,33,166,"A1000",262144,4,0,0,SAEC_RomType_KICK,0,"","",2664924112,1786510173,3177942807,2667829892,3638121090,1739990843),new a("KS ROM v1.2 (A500,A1000,A2000)",1,2,33,180,"A500|A1000|A2000",262144,
5,0,0,SAEC_RomType_KICK,0,"","315093-01",2798523958,301590060,4070176545,2223201147,712024419,872156552),new a("KS ROM v1.3 (A500,A1000,A2000)",1,3,34,5,"A500|A1000|A2000",262144,6,0,0,SAEC_RomType_KICK,0,"","315093-02",3304125791,2300484180,2004024844,1813624336,3136863310,2818357125),new a("KS ROM v1.3 (A3000)(SK)",1,3,34,5,"A3000",262144,32,0,0,SAEC_RomType_KICK,0,"","",3774050904,3281770761,1296981838,683753759,814126340,101068423),new a("KS ROM v1.4 (A3000)",1,4,36,16,"A3000",524288,59,3,0,SAEC_RomType_KICK,
0,"","",3155083583,4150466239,920645963,553268382,3492694801,3717409543),d(59,1,1,262144,SAEC_RomType_EVEN,"390629-02",1479701814,3513859455,826755673,1223087240,3812001286,485741026),d(59,1,2,262144,SAEC_RomType_ODD,"390630-02",4264525753,3227294802,3491022447,2417562923,1059728092,744982420),new a("KS ROM v2.04 (A500+)",2,4,37,175,"A500+",524288,7,0,0,SAEC_RomType_KICK,0,"","390979-01",3283989056,3313737564,3112860297,1191599166,3539029855,1122186401),new a("KS ROM v2.05 (A600)",2,5,37,299,"A600",
524288,8,0,0,SAEC_RomType_KICK,0,"","391388-01",2197983157,2270203368,886865588,1935265502,1926423496,2732972251),new a("KS ROM v2.05 (A600HD)",2,5,37,300,"A600HD|A600",524288,9,0,0,SAEC_RomType_KICK,0,"","391304-01",1682336810,4146956564,2376874438,2531461904,2241772677,2451989371),new a("KS ROM v2.05 (A600HD)",2,5,37,350,"A600HD|A600",524288,10,0,0,SAEC_RomType_KICK,0,"","391304-02",1135665019,42220610,1404818074,3126024970,2747112069,55496164),new a("KS ROM v2.04 (A3000)",2,4,37,175,"A3000",524288,
71,8,0,SAEC_RomType_KICK,0,"","",592081459,3626941273,2948937024,3723679512,2127504283,2125010320),d(71,1,1,262144,SAEC_RomType_EVEN,"390629-03",2722487263,2210052329,1563921237,2965810789,1631083158,4130888079),d(71,1,2,262144,SAEC_RomType_ODD,"390630-03",2108764971,1223772977,664643189,2018041711,3948091521,2408535916),new a("KS ROM v3.0 (A1200)",3,0,39,106,"A1200",524288,11,0,0,SAEC_RomType_KICK,0,"","",1822099410,1879259176,405798855,3977277011,1940437149,3665230501),d(11,1,1,262144,SAEC_RomType_EVEN,
"391523-01",3343033362,2577315868,1709166714,1911429425,1570359275,2240459142),d(11,1,2,262144,SAEC_RomType_ODD,"391524-01",3579604678,859902093,977283202,3052379451,606912316,2326897641),new a("KS ROM v3.0 (A4000)",3,0,39,106,"A4000",524288,12,6,0,SAEC_RomType_KICK,0,"","",2657796434,4038388194,2651988364,760993538,240023634,2547589079),d(12,1,1,262144,SAEC_RomType_EVEN,"391513-02",922111440,426680127,2628621134,404490202,856177439,171733039),d(12,1,2,262144,SAEC_RomType_ODD,"391514-02",388393557,
1123806516,1406267676,3420359081,2188324113,1976346060),new a("KS ROM v3.1 (A4000)",3,1,40,70,"A4000",524288,13,6,0,SAEC_RomType_KICK,0,"","",725968625,2177249757,158055217,3534721065,2625025908,3681814380),f(13,1,1,262144,SAEC_RomType_EVEN,4190891209,328043700,998445822,383160432,3730863209,3017017230),f(13,1,2,262144,SAEC_RomType_ODD,4163142485,3258422599,2678995216,3246739756,2724771887,451214853),new a("KS ROM v3.1 (A500,A600,A2000)",3,1,40,63,"A500|A600|A2000",524288,14,0,0,SAEC_RomType_KICK,
0,"","",4230262285,998184083,2994610472,821660146,1822911490,77531594),new a("KS ROM v3.1 (A1200)",3,1,40,68,"A1200",524288,15,1,0,SAEC_RomType_KICK,0,"","",344170641,3793044850,1072183118,2436113943,1615797053,1882232049),d(15,1,1,262144,SAEC_RomType_EVEN,"391773-01",148632181,3095400287,2425526288,2661717648,2981646911,2720914231),d(15,1,2,262144,SAEC_RomType_ODD,"391774-01",381713400,2430808510,426815717,1062447536,957043125,2604165570),new a("KS ROM v3.1 (A3000)",3,1,40,68,"A3000",524288,61,2,
0,SAEC_RomType_KICK,0,"","",4021434828,4175565015,726419539,3771316317,574333454,1025193710),f(61,1,1,262144,SAEC_RomType_EVEN,678140429,1734582821,2395247607,1082979939,286109338,394279633),f(61,1,2,262144,SAEC_RomType_ODD,193781354,1594026363,1223408552,2102487638,2956987503,3275967885),new a("KS ROM v3.1 (A4000)(Cloanto)",3,1,40,68,"A4000",524288,31,6,1,SAEC_RomType_KICK,0,"","",1136057634,3284435222,140961293,140395370,618346007,4284528121),new a("KS ROM v3.1 (A4000)",3,1,40,68,"A4000",524288,
16,6,0,SAEC_RomType_KICK,0,"","",3602572084,1608534082,3494529175,552662203,239506561,2571136841),f(16,1,1,262144,SAEC_RomType_EVEN,2997826808,618998622,4227990677,389577399,2980136799,3309319438),f(16,1,2,262144,SAEC_RomType_ODD,3864409763,826047677,2776079958,4053418451,1316360017,1982257282),new a("KS ROM v3.1 (A4000T)",3,1,40,70,"A4000T",524288,17,6,0,SAEC_RomType_KICK,0,"","",1972579386,2968292228,3598091041,3759278577,509757682,4113046049),d(17,1,1,262144,SAEC_RomType_EVEN,"391657-01",212422512,
3011538650,3409142524,379671758,518964671,1539458953),d(17,1,2,262144,SAEC_RomType_ODD,"391658-01",3756011808,3447353452,1125844184,2014630818,3635648272,217336844),new a("KS ROM v3.X (A4000)(Cloanto)",3,10,45,57,"A4000",524288,46,6,1,SAEC_RomType_KICK,0,"","",986291932,1019202017,4265173856,360436065,3732208784,448718828),new a("CD32 KS ROM v3.1",3,1,40,60,"CD32",524288,18,1,0,SAEC_RomType_KICKCD32,0,"","",509793445,891666056,2281151321,702551988,595634078,3756938285),new a("CD32 extended ROM",3,
1,40,60,"CD32",524288,19,1,0,SAEC_RomType_EXTCD32,0,"","",2272553954,1542405474,2363858112,711386852,2920129679,1625788287),new a("CD32 ROM (KS + extended)",3,1,40,60,"CD32",1048576,64,1,0,SAEC_RomType_KICKCD32|SAEC_RomType_EXTCD32|SAEC_RomType_CD32,0,"","",4124373960,2678147109,3288999029,2733352399,844878979,3293046721),d(64,1,1,1048576,SAEC_RomType_CD32,"391640-03",2767964490,2171397829,125334917,209535813,573614522,975766235),new a("CD32 Full Motion Video Cartridge ROM",3,1,40,30,"CD32FMV",262144,
23,1,0,SAEC_RomType_CD32CART,0,"","",3277600703,63603143,2813483471,1690080642,2252261903,1697248309),new a("CD32 Full Motion Video Cartridge ROM",3,1,40,22,"CD32FMV",262144,74,1,0,SAEC_RomType_CD32CART,0,"","391777-01",4044445931,2497997223,1613814962,2582366034,179236765,3041035471),new a("CDTV extended ROM v1.00",1,0,1,0,"CDTV",262144,20,0,0,SAEC_RomType_EXTCDTV,0,"","",1119527204,2074349562,400883949,2683110431,874823041,3653830590),d(20,1,1,131072,SAEC_RomType_EVEN|SAEC_RomType_8BIT,"252606-01",
2031923531,662312824,2453968437,1073632958,1745239338,860053732),d(20,1,2,131072,SAEC_RomType_ODD|SAEC_RomType_8BIT,"252607-01",2899033134,1102081302,2043078291,1010006199,1650468343,1679735900),new a("CDTV extended ROM v2.07",2,7,2,7,"CDTV",262144,22,0,0,SAEC_RomType_EXTCDTV,0,"","",3467536594,1539380411,2728353958,346231156,1530799204,3214960710),f(22,1,1,131072,SAEC_RomType_EVEN|SAEC_RomType_8BIT,920075448,2507466054,1262028439,4069497411,1314934366,4125444362),f(22,1,2,131072,SAEC_RomType_ODD|
SAEC_RomType_8BIT,1854201063,27289502,2304383503,1436316243,4114178155,3561469263),new a("CDTV/A570 extended ROM v2.30",2,30,2,30,"CDTV",262144,21,0,0,SAEC_RomType_EXTCDTV,0,"","391298-01",817185330,3984475677,536820954,840315310,1119358524,3573178043),f(21,1,1,131072,SAEC_RomType_EVEN|SAEC_RomType_8BIT,1222956879,1419010132,577365008,906068994,3791042645,4253616427),f(21,1,2,131072,SAEC_RomType_ODD|SAEC_RomType_8BIT,2320823138,64978959,52446973,2301587070,3959994221,865607308),new a("CDTV-CR extended ROM v3.32",
3,32,3,32,"CDTVCR",262144,107,0,0,SAEC_RomType_EXTCDTV,0,"","",1478133199,3602437106,2236529307,760300921,2502551731,998629556),new a("CDTV-CR extended ROM v3.44",3,44,3,44,"CDTVCR",262144,108,0,0,SAEC_RomType_EXTCDTV,0,"","",192665167,991300698,3195662602,3868345138,2147793822,828552776),new a("A1000 bootstrap ROM",0,0,0,0,"A1000",65536,24,0,0,SAEC_RomType_KICK,0,"","",186307280,3130243256,1554044986,1747082435,999621901,1926430167),f(24,1,1,8192,0,1659968516,3363807149,2767081065,4090273987,1637072514,
731865062),d(24,2,1,4096,SAEC_RomType_EVEN|SAEC_RomType_8BIT,"252179-01",1112882116,2287315327,2051335158,756844761,956228084,3322326875),d(24,2,2,4096,SAEC_RomType_ODD|SAEC_RomType_8BIT,"252180-01",2388367927,3507426660,3114229758,277848130,909019007,1453187779),new a("Macintosh 128K",0,0,0,0,"128K",65536,200,0,0,SAEC_RomType_AMAX,0,"","",1829538344,0,0,0,0,0),new a("Macintosh 512K",0,0,0,0,"512K",65536,200,0,0,SAEC_RomType_AMAX,0,"","",3480591885,0,0,0,0,0),new a("Macintosh Plus (version 1)",0,
0,0,0,"Plus",131072,200,0,0,SAEC_RomType_AMAX,0,"","",1336259481,3772412261,3106795152,3635499556,700461938,2678538194),new a("Macintosh Plus (version 2)",0,0,0,0,"Plus",131072,200,0,0,SAEC_RomType_AMAX,0,"","",2091700623,1941909170,358903312,2376731869,2270063748,1015866401),new a("Macintosh Plus (version 3)",0,0,0,0,"Plus",131072,200,0,0,SAEC_RomType_AMAX,0,"","",2987404942,2100265098,73048993,2990700111,237796627,3800612639),new a("Macintosh SE",0,0,0,0,"SE",262144,200,0,0,SAEC_RomType_AMAX,0,
"","",260044812,0,0,0,0,0),new a("Macintosh SE (FDHD)",0,0,0,0,"SE",262144,200,0,0,SAEC_RomType_AMAX,0,"","",4113615632,0,0,0,0,0),new a("Macintosh Classic",0,0,0,0,"Classic",262144,200,0,0,SAEC_RomType_AMAX,0,"","",2974670046,0,0,0,0,0),new a("Macintosh Portable",0,0,0,0,"Portable",262144,200,0,0,SAEC_RomType_AMAX,0,"","",1232292088,0,0,0,0,0),new a("PowerBook 100",0,0,0,0,"100",262144,200,0,0,SAEC_RomType_AMAX,0,"","",699170537,0,0,0,0,0),new a("Macintosh II (version 1)",0,0,0,0,"II",262144,200,
2,0,SAEC_RomType_AMAX,0,"","",2357959939,0,0,0,0,0),new a("Macintosh II (version 2)",0,0,0,0,"II",262144,200,2,0,SAEC_RomType_AMAX,0,"","",1308020820,0,0,0,0,0),new a("Macintosh LC",0,0,0,0,"LC",524288,200,2,0,SAEC_RomType_AMAX,0,"","",1902647078,0,0,0,0,0)],I=0;I<N.length;I++)N[I].num=I;this.getromname=function(a){var d="";if(null===a)return d;for(;a.group;)a=N[a.num-1];d+=a.name;(a.subrev||a.subver)&&a.subver!=a.ver&&(d+=sprintf(" rev %d.%d",a.subver,a.subrev));0<a.size&&(d+=sprintf(" (%dK)",a.size+
1023>>10));a.partnumber&&0<a.partnumber.length&&(d+=sprintf(" [%s]",a.partnumber));return d};this.getromdatabycrc=function(a,d){"undefined"==typeof d&&(d=!1);var h,f=N.length;for(h=0;h<f;h++)if(0==N[h].group&&a==N[h].crc32&&4294967295!=a&&0!=a)return N[h];if(d)for(h=0;h<f;h++)if(0!=N[h].group&&a==N[h].crc32&&4294967295!=a&&0!=a)return N[h];return null};this.getromdatabydata=function(a,d){if(11<d&&0==SAEF_CompareArray(a,SAEF_String2Array("AMIROMTYPE1"),11)){var h=new Uint8Array(d),f=d-11;h.set(a.subarray(11));
if(0!=this.decode_rom(h,0,f,1,f))return null;a=h;d=f}h=SAEF_crc32(a,0,d);h=J(h,d,4294967295);null===h&&(h=SAEF_crc32(a,0,d>>1),h=J(h,d>>1,4294967295));return h};this.kickstart_fix_checksum=function(a,d,h){var f=0,I=0,G,J=524288==h?524264:262144==h?262120:62;a[d+J]=0;a[d+J+1]=0;a[d+J+2]=0;for(G=a[d+J+3]=0;G<h;G+=4)f+=(a[d+G]<<24|a[d+G+1]<<16|a[d+G+2]<<8|a[d+G+3])>>>0,4294967295<f&&(f-=4294967296),f<I&&(f++,4294967295<f&&(f-=4294967296)),I=f;f=(f^4294967295)>>>0;a[d+J]=f>>>24;a[d+J+1]=f>>>16&255;a[d+
J+2]=f>>>8&255;a[d+J+3]=f&255;SAEF_log("roms.kickstart_fix_checksum() %08X",f)};this.kickstart_verify_checksum=function(a,d,f){a=h(a,d,f);SAEF_log("roms.kickstart_verify_checksum() %08X",a);return 4294967295==a};this.decode_rom=function(a,d,h,f,I){if(1==f){var G=SAEV_config.memory.romKey;if(G.name.length&&G.data.length){f=G.data;var G=G.data.length,J,N;for(N=J=0;J<h;J++,N=(N+1)%G)a[d+J]^=f.charCodeAt(N),I==J+1&&(N=G-1);a=78==a[d+2]&&249==a[d+3]||17==a[d]&&(17==a[d+1]||20==a[d+1])?0:-1}else a=-2;return a}if(2==
f){I=3735944941;for(G=d;G<d+(h>>3);G++)f=(a[8*G+0]<<24|a[8*G+1]<<16|a[8*G+2]<<8|a[8*G+3])>>>0,I=(I^f)>>>0,a[8*G+0]=I>>>24,a[8*G+1]=I>>>16&255,a[8*G+2]=I>>>8&255,a[8*G+3]=I&255,I=(a[8*G+4]<<24|a[8*G+5]<<16|a[8*G+6]<<8|a[8*G+7])>>>0,f=(f^I)>>>0,a[8*G+4]=f>>>24,a[8*G+5]=f>>>16&255,a[8*G+6]=f>>>8&255,a[8*G+7]=f&255;return 0}return-3};this.examine=function(a,d){var f=SAEF_String2Array(d.data),I=d.size,ja=!1;if(11<I&&0==SAEF_CompareArray(f,SAEF_String2Array("AMIROMTYPE1"),11)){ja=new Uint8Array(I);I-=11;
ja.set(f.subarray(11));f=this.decode_rom(ja,0,I,1,I);if(-1==f)return SAEE_Memory_RomDecode;if(-2==f)return SAEE_Memory_RomKey;f=ja;ja=!0}var G=d.crc32;if(!1===G||ja)G=SAEF_crc32(f,0,I),ja||(d.crc32=G);G=J(G,I,4294967295);if(null===G)return SAEE_Memory_RomUnknown;for(;G.group;)G=N[G.num-1];a.name=G.name;if(G.type&SAEC_RomType_AMAX){var bb=f.subarray(8,10),kb=f.subarray(18,20),ua=f.subarray(76,78);a.ver=bb[0]<<8|bb[1];a.rev=kb[0]<<8|kb[1];a.subVer=ua[0]<<8|ua[1];a.subRev=0}else a.ver=G.ver,a.rev=G.rev,
a.subVer=G.subver,a.subRev=G.subrev;a.models=G.model.split("|").join(", ");a.size=G.size;G.cpu&8?a.cpu=68030:3==(G.cpu&3)?(a.cpu=68030,a.cpuExact=!0):2==(G.cpu&3)?a.cpu=68020:(a.cpu=1==(G.cpu&3)?68020:68E3,a.addressSpace24=!0);a.cloanto=ja;a.type=G.type;a.partNumber=G.partnumber;a.crc32=G.crc32;if(G.type&(SAEC_RomType_ALL_KICK|SAEC_RomType_ALL_EXT))a.checksum=h(f,0,I),a.checksumValid=4294967295==a.checksum;else if(G.type&SAEC_RomType_AMAX){ja=f.subarray(0,4);G=0;4194304==I&&(I-=1048576);for(bb=4;bb<
I;bb+=2)G+=f[0+bb]<<8|f[0+bb+1],4294967295<G&&(G-=4294967296);a.checksum=G;a.checksumValid=a.checksum==(ja[0]<<24|ja[1]<<16|ja[2]<<8|ja[3])>>>0}else a.checksum=!1,a.checksumValid=!1;return SAEE_None}};var SAEC_Memory_addrbank_flag_UNK=0,SAEC_Memory_addrbank_flag_RAM=1,SAEC_Memory_addrbank_flag_ROM=2,SAEC_Memory_addrbank_flag_ROMIN=4,SAEC_Memory_addrbank_flag_IO=8,SAEC_Memory_addrbank_flag_NONE=16,SAEC_Memory_addrbank_flag_SAFE=32,SAEC_Memory_addrbank_flag_NOALLOC=128,SAEC_Memory_addrbank_flag_THREADSAFE=512,SAEC_Memory_addrbank_flag_ALLOCINDIRECT=2048,SAEC_Memory_addrbank_flag_CHIPRAM=4096,SAEC_Memory_addrbank_flag_CIA=8192,SAEC_Memory_addrbank_flag_PPCIOSPACE=16384,SAEC_Memory_addrbank_READ=1,
SAEC_Memory_addrbank_WRITE=2,SAEC_Memory_banktype_FAST32=0,SAEC_Memory_banktype_CHIP16=1,SAEC_Memory_banktype_CHIP32=2,SAEC_Memory_banktype_CIA=3,SAEC_Memory_banktype_FAST16=4,SAER_Memory_banks=null,SAER_Memory_banktype=null,SAER_Memory_cachable=null,SAER_Memory_getBank=null,SAER_Memory_get8=null,SAER_Memory_get16=null,SAER_Memory_getInst16=null,SAER_Memory_get32=null,SAER_Memory_getInst32=null,SAER_Memory_put8=null,SAER_Memory_put16=null,SAER_Memory_put32=null,SAER_Memory_check=null,SAER_Memory_chipData=
null,SAER_Memory_chipGet8_indirect=null,SAER_Memory_chipGet16_indirect=null,SAER_Memory_chipGet32_indirect=null,SAER_Memory_chipPut8_indirect=null,SAER_Memory_chipPut16_indirect=null,SAER_Memory_chipPut32_indirect=null,SAER_Memory_chipCheck_indirect=null,SAER_Memory_chipXLate_indirect=null,SAER_Memory_mapBanks=null,SAEV_Memory_chipMask=0,SAEV_Memory_cloantoRom=!1;function SAEO_Memory_addrbank_sub(a,f){this.bank=a;this.offset=f;this.maskval=this.mask=this.suboffset=0}
function SAEO_Memory_addrbank(a,f,d,J,h,N,I,E,K,m,pa,ja,G,bb,kb,ua,y){"undefined"==typeof kb&&(kb=null);"undefined"==typeof ua&&(ua=0);"undefined"==typeof y&&(y=0);this.get32=a;this.get16=f;this.get8=d;this.put32=J;this.put16=h;this.put8=N;this.xlateaddr=I;this.check=E;this.baseaddr=K;this.label=m;this.name=pa;this.getInst32=ja;this.getInst16=G;this.flags=bb;this.sub_banks=kb;this.mask=ua;this.startmask=y;this.allocated=this.start=0}function SAEF_Memory_defaultCheck(a,f){return 0}
var SAEV_Memory_defaultXLate_cnt=0,SAEV_Memory_defaultXLate_recursive=0;
function SAEF_Memory_defaultXLate(a){if(SAEV_Memory_defaultXLate_recursive)return SAER.m68k.cpu_halt(SAEC_CPU_halt_OPCODE_FETCH_FROM_NON_EXISTING_ADDRESS),kickmem_xlate(2);SAEV_Memory_defaultXLate_recursive++;0==SAEV_command&&(SAEV_config.cpu.model>SAEC_Config_CPU_Model_68000||!SAEV_config.cpu.compatible)&&(5>=++SAEV_Memory_defaultXLate_cnt&&(SAEF_warn("memory.default_xlate() Your Amiga program just did something terribly stupid %08X PC=%08X",a,SAER_CPU_getPC()),SAER.memory.map_dump()),SAER.m68k.cpu_halt(SAEC_CPU_halt_OPCODE_FETCH_FROM_NON_EXISTING_ADDRESS));
SAEV_Memory_defaultXLate_recursive--;return kickmem_xlate(2)}var SAEC_Memory_dummyGet_NONEXISTINGDATA=0;function SAEF_Memory_dummyGet32(a){SAER.memory.dummylog(0,a,4,0,0);return SAER.memory.dummyGet(a,4,!1,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyGetInst32(a){SAER.memory.dummylog(0,a,4,0,1);return SAER.memory.dummyGet(a,4,!0,SAEC_Memory_dummyGet_NONEXISTINGDATA)}
function SAEF_Memory_dummyGet16(a){SAER.memory.dummylog(0,a,2,0,0);return SAER.memory.dummyGet(a,2,!1,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyGetInst16(a){SAER.memory.dummylog(0,a,2,0,1);return SAER.memory.dummyGet(a,2,!0,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyGet8(a){SAER.memory.dummylog(0,a,1,0,0);return SAER.memory.dummyGet(a,1,!1,SAEC_Memory_dummyGet_NONEXISTINGDATA)}
function SAEF_Memory_dummyPut32(a,f){SAER.memory.dummylog(1,a,4,f,0);SAER.memory.dummyPut(a,4,f)}function SAEF_Memory_dummyPut16(a,f){SAER.memory.dummylog(1,a,2,f,0);SAER.memory.dummyPut(a,2,f)}function SAEF_Memory_dummyPut8(a,f){SAER.memory.dummylog(1,a,1,f,0);SAER.memory.dummyPut(a,1,f)}function SAEF_Memory_dummyCheck(a,f){return 0}
var SAEV_Memory_dummyBank=new SAEO_Memory_addrbank(SAEF_Memory_dummyGet32,SAEF_Memory_dummyGet16,SAEF_Memory_dummyGet8,SAEF_Memory_dummyPut32,SAEF_Memory_dummyPut16,SAEF_Memory_dummyPut8,SAEF_Memory_defaultXLate,SAEF_Memory_dummyCheck,null,null,null,SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_NONE);function SAEF_Memory_subBankGet32(a){a={value:a};return SAER.memory.getSubBank(a).get32(a.value)}
function SAEF_Memory_subBankGet16(a){a={value:a};return SAER.memory.getSubBank(a).get16(a.value)}function SAEF_Memory_subBankGet8(a){a={value:a};return SAER.memory.getSubBank(a).get8(a.value)}function SAEF_Memory_subBankPut32(a,f){var d={value:a};SAER.memory.getSubBank(d).put32(d.value,f)}function SAEF_Memory_subBankPut16(a,f){var d={value:a};SAER.memory.getSubBank(d).put16(d.value,f)}function SAEF_Memory_subBankPut8(a,f){var d={value:a};SAER.memory.getSubBank(d).put8(d.value,f)}
function SAEF_Memory_subBankGetInst32(a){a={value:a};return SAER.memory.getSubBank(a).getInst32(a.value)}function SAEF_Memory_subBankGetInst16(a){a={value:a};return SAER.memory.getSubBank(a).getInst16(a.value)}function SAEF_Memory_subBankCheck(a,f){var d={value:a};return SAER.memory.getSubBank(d).check(d.value,f)}function SAEF_Memory_subBankXLate(a){a={value:a};return SAER.memory.getSubBank(a).xlateaddr(a.value)}
function SAEO_Memory(){function a(b){return Za[b>>>16].get16(b)}function f(b,a){return Za[b>>>16].check(b,a)}function d(b,a,d){0<sc&&(SAEF_log("memory.gary_wait() Gary timeout: %08x %d %s PC=%08x",b,a,d?"W":"R",SAER_CPU_getPC()),sc--)}function J(b){return 0>SAEV_config.chipset.fatGaryRev||12058624>b?!1:13631488<=b&&14417920>b||14483456<=b&&14548992>b?!0:14647296<=b&&14680064>b||15204352<=b&&16252928>b?!1:!0}function h(){return(65535&~(1<<(Math.decimalRandom()&31)|1<<(Math.decimalRandom()&31)))>>>
0}function N(b){b=(b&W.mask)>>>0;return(W.baseaddr[b]<<24|W.baseaddr[b+1]<<16|W.baseaddr[b+2]<<8|W.baseaddr[b+3])>>>0}function I(b){b=(b&W.mask)>>>0;return W.baseaddr[b]<<8|W.baseaddr[b+1]}function E(b,a){b=(b&W.mask)>>>0;W.baseaddr[b]=a>>>24;W.baseaddr[b+1]=a>>>16&255;W.baseaddr[b+2]=a>>>8&255;W.baseaddr[b+3]=a&255}function K(b,a){b=(b&W.mask)>>>0;return b+a<=Sb}function m(b){return b=(b&W.mask)>>>0}function pa(b){b=(b&hc)>>>0;return b>=Sb-1?0:W.baseaddr[b]<<8|W.baseaddr[b+1]}function ja(b){b=(b&
hc)>>>0;return b>=Sb?0:W.baseaddr[b]}function G(b,a){b=(b&hc)>>>0;b>=Sb-1||(W.baseaddr[b]=a>>8,W.baseaddr[b+1]=a&255)}function bb(b,a){b=(b&hc)>>>0;b>=Sb||(W.baseaddr[b]=a)}function kb(b){b=(b&Aa.mask)+db;return(Aa.baseaddr[b]<<24|Aa.baseaddr[b+1]<<16|Aa.baseaddr[b+2]<<8|Aa.baseaddr[b+3])>>>0}function ua(b){b=(b&Aa.mask)+db;return Aa.baseaddr[b]<<8|Aa.baseaddr[b+1]}function y(b){b=(b&z.mask)>>>0;return(z.baseaddr[b]<<24|z.baseaddr[b+1]<<16|z.baseaddr[b+2]<<8|z.baseaddr[b+3])>>>0}function Oa(b){b=
(b&z.mask)>>>0;return z.baseaddr[b]<<8|z.baseaddr[b+1]}function T(b){b=(b&Ca.mask)>>>0;return(Ca.baseaddr[b]<<24|Ca.baseaddr[b+1]<<16|Ca.baseaddr[b+2]<<8|Ca.baseaddr[b+3])>>>0}function wa(b){b=(b&Ca.mask)>>>0;return Ca.baseaddr[b]<<8|Ca.baseaddr[b+1]}function b(b){null!==Ia&&(0==b?(Ba=!1,SAEF_memcpy(ma.baseaddr,0,ma.baseaddr,262144,262144),mb=ma.baseaddr[262156]<<8|ma.baseaddr[262157]):(Ba=!0,ma.baseaddr.set(Ia),mb=0),65535==mb&&(mb=0))}function q(b){b=(b&ma.mask)>>>0;return(ma.baseaddr[b]<<24|ma.baseaddr[b+
1]<<16|ma.baseaddr[b+2]<<8|ma.baseaddr[b+3])>>>0}function Z(b){b=(b&ma.mask)>>>0;return ma.baseaddr[b]<<8|ma.baseaddr[b+1]}function ea(b){b=(b&va.mask)>>>0;return(va.baseaddr[b]<<24|va.baseaddr[b+1]<<16|va.baseaddr[b+2]<<8|va.baseaddr[b+3])>>>0}function Ua(b){b=(b&va.mask)>>>0;return va.baseaddr[b]<<8|va.baseaddr[b+1]}function r(b){b=(b&Hb.mask)>>>0;return(Hb.baseaddr[b]<<24|Hb.baseaddr[b+1]<<16|Hb.baseaddr[b+2]<<8|Hb.baseaddr[b+3])>>>0}function R(b){b=(b&Hb.mask)>>>0;return Hb.baseaddr[b]<<8|Hb.baseaddr[b+
1]}function Fa(b){b=(b&la.mask)>>>0;return(la.baseaddr[b]<<24|la.baseaddr[b+1]<<16|la.baseaddr[b+2]<<8|la.baseaddr[b+3])>>>0}function Lb(b){b=(b&la.mask)>>>0;return la.baseaddr[b]<<8|la.baseaddr[b+1]}function t(b){b=(b&Ta.mask)>>>0;return(Ta.baseaddr[b]<<24|Ta.baseaddr[b+1]<<16|Ta.baseaddr[b+2]<<8|Ta.baseaddr[b+3])>>>0}function tb(b){b=(b&Ta.mask)>>>0;return Ta.baseaddr[b]<<8|Ta.baseaddr[b+1]}function Da(a,d,q,t,h,f){var r=SAEF_String2Array("exec.library"),Z=r.length,m=new Uint8Array(20),T,G=0,L=
0;0>t&&(SAEF_ZFile_fseek(a,0,SEEK_END),t=SAEF_ZFile_ftell(a)&4294966272,SAEF_ZFile_fseek(a,0,SEEK_SET));T=SAEF_ZFile_ftell(a);SAEF_ZFile_fread(m,0,1,11,a);0==SAEF_CompareArray(m,SAEF_String2Array("KICK"),4)?(SAEF_ZFile_fseek(a,512,SEEK_SET),L=1):0==SAEF_CompareArray(m,SAEF_String2Array("AMIROMTYPE1"),11)?(SAEV_Memory_cloantoRom=!0,G=1):SAEF_ZFile_fseek(a,T,SEEK_SET);SAEF_memset(d,q,0,t);for(m=0;8>m;m++)d[q+t-16+2*m+1]=24+m;d[q+t-20]=t>>>24;d[q+t-19]=t>>>16&255;d[q+t-18]=t>>>8&255;d[q+t-17]=t&255;
m=SAEF_ZFile_fread(d,q,1,t,a);L&&262144<m&&(m=262144);m<t-20&&SAER.roms.kickstart_fix_checksum(d,q,t);for(a=1;a<m;)a<<=1;m=a;f||m!=t>>1||SAEF_memcpy(d,t>>1,d,0,t>>1);if(G){f=SAER.roms.decode_rom(d,q,t,G,m);if(-1==f)return-SAEE_Memory_RomDecode;if(-2==f)return-SAEE_Memory_RomKey}if(SAEV_config.chipset.a1000ram&&262144>m){h=0;for(null===Ia&&(Ia=new Uint8Array(262144));262144>h+m;)Ia.set(ma.baseaddr.subarray(0,m),h),h+=m;SAEF_memset(ma.baseaddr,0,0,ma.allocated);b(1);h=0;m=524288}for(a=0;256>a&&262144<=
m&&0!=SAEF_CompareArrayAfter(d,q+a,r,Z);a++);if(256==a||262144>m)h=0;return h&&!SAER.roms.kickstart_verify_checksum(d,q,t)?-SAEE_Memory_RomChecksum:0<m?m:-SAEE_Memory_RomSize}function sb(b,a){var d=[],q=524288==a?16252928:16515072,t,h,f=0;SAEV_config.chipset.mbdmac&1&&d.push(SAEF_String2Array("scsi.device"));SAEV_config.chipset.mbdmac&2&&d.push(SAEF_String2Array("NCR scsi.device"));if(d.length)for(t=0;t<a-100;t++)if(74==b[t]&&252==b[t+1]){var r=b[t+2]<<24|b[t+3]<<16|b[t+4]<<8|b[t+5]<<0;if(r==t+q&&
(r=b[t+14]<<24|b[t+15]<<16|b[t+16]<<8|b[t+17]<<0,r>=q&&r<q+a))for(h=0;h<d.length;h++)if(0==SAEF_CompareArrayAfter(b,r-q,d[h])){SAEF_log("memory.patch_residents() '%s' at %08X disabled",SAEF_Array2String(d[h]),t+q);b[t]=75;f++;break}}return f}function Sa(){var b=SAEF_ZFile_fopen_file(SAEV_config.memory.extRom);if(!b)return SAEE_Memory_NoExtendedRom;va.allocated=524288;va.mask=524287;va.label="rom_e0";cb=3;ka(va);var a=Da(b,va.baseaddr,0,524288,0,1);SAEF_ZFile_fclose(b);if(0>a)return-a;b=SAEF_ZFile_fopen_file(SAEV_config.memory.rom);
ma.allocated=524288;ma.mask=524287;a=Da(b,ma.baseaddr,0,524288,1,0);SAEF_ZFile_fclose(b);if(0>a)return-a;SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68020&&0==SAEV_config.memory.z2FastSize&&0==SAEV_config.memory.z3FastSize&&0==SAEV_config.memory.ramsey.highSize&&0==SAEV_config.memory.ramsey.lowSize&&(b=SAEV_config.memory.custom[0],b.addr=11010048,b.size=524288,b.mask=0,b=SAEV_config.memory.custom[1],b.addr=11534336,b.size=524288,b.mask=0,SAEF_log("memory.load_kickstart_replacement() enabled 1M extra-memory"));
Qb=!0;return SAEE_None}function ta(){Qb=SAEV_Memory_cloantoRom=!1;if(-1!=SAEV_config.memory.rom.name.indexOf("aros"))return Sa();var b=SAEF_ZFile_fopen_file(SAEV_config.memory.rom);if(null!==b){var a,d,q=524288,t=0;d=524288;SAEF_ZFile_fseek(b,0,SEEK_END);a=SAEF_ZFile_ftell(b);SAEF_ZFile_fseek(b,0,SEEK_SET);901120==a&&(d=a=262144);524296==a&&SAEF_ZFile_fseek(b,8,SEEK_SET);1048576<=a&&SAEF_ZFile_fseek(b,q,SEEK_SET);2097152<=a&&(t=0,SAEF_ZFile_fseek(b,1572864,SEEK_SET));d=Da(b,ma.baseaddr,0,d,1,0);if(0>
d)return SAEF_ZFile_fclose(b),-d;ma.mask=d-1;ma.allocated=d;if(1048576<=a&&!cb){va.allocated=524288;cb=3;va.label="rom_e0";va.start=14680064;ka(va);SAEF_ZFile_fseek(b,t,SEEK_SET);d=Da(b,va.baseaddr,0,va.allocated,0,1);if(0>d)return SAEF_ZFile_fclose(b),-d;va.mask=va.allocated-1}if(1048576<a){Hb.allocated=1048576;ka(Hb);SAEF_ZFile_fseek(b,t+524288,SEEK_SET);d=Da(b,Hb.baseaddr,0,524288,0,1);if(0>d)return SAEF_ZFile_fclose(b),-d;SAEF_ZFile_fseek(b,t+1048576,SEEK_SET);d=Da(b,Hb.baseaddr,524288,524288,
0,1);if(0>d)return SAEF_ZFile_fclose(b),-d;Hb.mask=Hb.allocated-1;Hb.start=11010048}}else return SAEE_Memory_NoKickstartRom;mb=ma.baseaddr[12]<<8|ma.baseaddr[13];65535==mb&&(mb=ma.baseaddr[16]<<8|ma.baseaddr[17],33<mb&&(mb=0));SAEF_log("memory.load_kickstart() kickstart version %d",mb);SAEF_ZFile_fclose(b);return SAEE_None}function ka(b){b.startmask=b.start;try{return b.baseaddr=new Uint8Array(b.allocated+4),!0}catch(a){return b.baseaddr=null,!1}}function qa(b){b.baseaddr=null;db&&"bogo"==b.label&&
(db=0)}function nb(){for(var b=0;65536>b;b++)Za[b]=SAEV_Memory_dummyBank}function $a(b){for(;b&&!(b&1);)b>>>=1;return 0==(b&-2)>>>0}function Ga(){var b=0;SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010?SAEF_memset(za,0,SAEC_Memory_banktype_FAST16,65536):SAEF_memset(za,0,SAEC_Memory_banktype_FAST32,65536);SAEF_memset(Ea,0,0,65536);SAEF_memset(Ea,32,3,SAEV_config.memory.z2FastSize>>>16);SAEF_memset(Ea,192,1,SAEV_config.memory.bogoSize>>>16);SAEF_memset(Ea,SAER_Expansion_z3fastmem_bank.start>>>16,
3,SAEV_config.memory.z3FastSize>>>16);SAEF_memset(Ea,Ca.start>>>16,3,SAEV_config.memory.ramsey.highSize>>>16);SAEF_memset(Ea,z.start>>>16,3,SAEV_config.memory.ramsey.lowSize>>>16);if(Za[0].flags&SAEC_Memory_addrbank_flag_CHIPRAM)for(b=0;32>b;b++)za[b]=SAEV_config.chipset.mbdmac||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?SAEC_Memory_banktype_CHIP32:SAEC_Memory_banktype_CHIP16;if(!SAEV_config.chipset.bogomemIsFast){for(b=192;224>b;b++)za[b]=za[0];for(b=Aa.start>>>16;b<Aa.start+Aa.allocated>>>
16;b++)za[b]=za[0]}for(b=208;224>b;b++)za[b]=SAEC_Memory_banktype_CHIP16;for(b=160;192>b;b++)za[b]=SAEC_Memory_banktype_CIA,Za[b].flags&SAEC_Memory_addrbank_flag_CIA||(za[b]=SAEC_Memory_banktype_FAST32,Ea[b]=1);2==SAEV_config.chipset.mbdmac&&(za[221]=SAEC_Memory_banktype_FAST32);if(SAEV_config.cpu.addressSpace24)for(b=1;256>b;b++)for(var a=0;256>a;a++)za[256*b+a]=za[a]}function fa(){var a;SAEF_log("memory.restore_roms() loading '%s'...",SAEV_config.memory.rom.name);b(0);Ia=null;Ba=!1;qa(va);va.allocated=
0;qa(Hb);cb=Hb.allocated=0;var d=SAEV_config.memory.extRom;a=SAEE_None;if(0!=d.size)if(d=SAEF_ZFile_fopen_file(d),null===d)a=SAEE_Memory_NoExtendedRom;else{SAEF_ZFile_fseek(d,0,SEEK_END);var q=SAEF_ZFile_ftell(d);va.allocated=524288;3E5<q?cb=1:15728640!=SAER.autoconf.need_uae_boot_rom()&&(cb=2);SAEF_log("memory.load_extendedkickstart() type %d",cb);if(cb){SAEF_ZFile_fseek(d,0,SEEK_SET);switch(cb){case 2:va.label="rom_f0";ka(va);va.start=15728640;break;case 1:va.label="rom_e0",ka(va),va.start=14680064}null!==
va.baseaddr&&(va.mask=va.allocated-1,q=Da(d,va.baseaddr,0,va.allocated,0,1),0>q&&(a=-q))}SAEF_ZFile_fclose(d)}if(a!=SAEE_None)return a;ma.mask=524287;if((a=ta())==SAEE_None&&!Qb)if(d=SAER.roms.getromdatabydata(ma.baseaddr,ma.allocated),null!==d){SAEF_log("memory.restore_roms() identified rom as '%s'",d.name);if(d.cpu&8&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68030||3==(d.cpu&3)&&SAEV_config.cpu.model!=SAEC_Config_CPU_Model_68030)return SAEE_CPU_Requires68030;if(1==(d.cpu&3)&&SAEV_config.cpu.model<
SAEC_Config_CPU_Model_68020)return SAEE_CPU_Requires680EC20;if(2==(d.cpu&3)&&(SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020||SAEV_config.cpu.addressSpace24))return SAEE_CPU_Requires68020;d.cloanto&&(SAEV_Memory_cloantoRom=!0);d.cpu&4&&SAEV_config.chipset.compatible!=SAEC_Config_Chipset_Compatible_Manual&&(0>SAEV_config.chipset.ramseyRev&&(SAEV_config.chipset.ramseyRev=15),SAEV_config.chipset.fatGaryRev=0,SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A4000&&(SAEV_config.chipset.ide=-1))}else SAEF_log("memory.restore_roms() unknown rom '%s' loaded",
SAEV_config.memory.rom.name);if(a==SAEE_None){d=0;if(524288<=ma.allocated&&SAEV_config.memory.kickShifter){for(var q=ma.baseaddr,t=[65,248,4,0],h=[65,248,16,0],f=[67,248,4,0],r=0,m=512;768>m;m++)SAEF_CompareArrayAfter(q,m,t,4)&&SAEF_CompareArrayAfter(q,m,h,4)&&SAEF_CompareArrayAfter(q,m,f,4)||(q[m+2]=48,SAEF_log("memory.patch_shapeshifter() KickShifted at %04X",m),r++);d+=r}d+=sb(ma.baseaddr,ma.allocated);null!==va.baseaddr&&(d+=sb(va.baseaddr,va.allocated))&&SAER.roms.kickstart_fix_checksum(va.baseaddr,
0,va.allocated);d&&SAER.roms.kickstart_fix_checksum(ma.baseaddr,0,ma.allocated)}SAEF_log("memory.restore_roms() ...done.");return a}function U(b,a,d,q){b.start=a<<16;b.startmask=a<<16;na(b,a,d,q)}function na(b,a,d,q){var t,h=0,f=256;q||(q=d<<16);d<<16<q&&SAEF_warn("memory.map_banks2() Broken mapping, size=%x, realsize=%x, start=%x",d,q,a);if(256<=a){var r=0;for(t=a;t<a+d;t++)r||(r=q>>>16),Za[t]=b,r--}else{SAEV_config.cpu.addressSpace24&&(f=65536);for(h=0;h<f;h+=256)for(r=0,t=a;t<a+d;t++)r||(r=q>>>
16),Za[t+h]=b,r--;Ga()}}function Xb(b,a,d){if(32>a||160<=a&&233>a||240<=a)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid start address %08X",b.name,a<<16),SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT),!1;if(233<=a){if(240<a+d)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid region %08x - %08X",b.name,a<<16,a+d<<16),SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT),!1}else if(160<a+d)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid region %08x - %08X",
b.name,a<<16,a+d<<16),SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT),!1;if(0>=d||128<d)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid size %08x",b.name,d),SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT),!1;for(var q=a;q<a+d;q++){var t=Za[a];if(t!==SAEV_Memory_dummyBank)return SAEF_error("memory.validate_banks_z2() bank '%s' attempting to override existing memory bank '%s' at %08X",b.name,t.name,q<<16),!1}return!0}function wb(b){return Za[b>>>16].check(b,1)?Za[b>>>
16].xlateaddr(b):null}function L(){this.regions=Array(64);this.num_regions=0}for(var mb=0,pb=!1,zb=0,Pa=0,db=0,Za=Array(65536),xb=0;65536>xb;xb++)Za[xb]=null;SAER_Memory_banks=Za;var za=new Uint8Array(65536);SAER_Memory_banktype=za;var Ea=new Uint8Array(65536);SAER_Memory_cachable=Ea;var Qb=!0;SAER_Memory_getBank=function(b){return Za[b>>>16]};SAER_Memory_get8=function(b){return Za[b>>>16].get8(b)};SAER_Memory_get16=a;SAER_Memory_getInst16=function(b){return Za[b>>>16].getInst16(b)};SAER_Memory_get32=
function(b){return Za[b>>>16].get32(b)};SAER_Memory_getInst32=function(b){return Za[b>>>16].getInst32(b)};SAER_Memory_put8=function(b,a){Za[b>>>16].put8(b,a)};SAER_Memory_put16=function(b,a){Za[b>>>16].put16(b,a)};SAER_Memory_put32=function(b,a){Za[b>>>16].put32(b,a)};SAER_Memory_check=f;var Ub=0;this.dummylog=function(b,a,d,q,t){!SAEV_config.memory.logIllegal||1E3<=Ub||4278190080<=a&&4278190592>=a||14680064<=a&&16252927>=a||134217728<=a&&134217735>=a||133169152<=a&&133169159>=a||133693424<=a&&134217727>=
a||(Ub++,t?SAEF_log("memory.geti%s(0x%08x) illegal access (PC 0x%x)",2==d?"16":"32",a,SAER_CPU_getPC()):b?SAEF_log("memory.put%s(0x%08x, 0x%x) illegal access (PC 0x%x)",1==d?"8":2==d?"16":"32",a,q,SAER_CPU_getPC()):SAEF_log("memory.get%s(0x%08x) illegal access (PC 0x%x)",1==d?"8":2==d?"16":"32",a,SAER_CPU_getPC()))};var sc=50;this.dummyGet=function(b,a,q,t){if(J(b)||1<a&&J(b+a-1))return SAEV_MBRes_gary_timeout&&d(b,a,!1),SAEV_MBRes_gary_toenb&&SAER.cpu.exception2(b,!1,a,(SAER_CPU_regs.s?4:0)|(q?0:
1)),t;SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68040||!SAEV_config.cpu.compatible||(SAEV_config.cpu.addressSpace24&&(b&=16777215),268435456<=b||!(SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010||SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020&&0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)&&SAEV_config.cpu.addressSpace24)||(4==a?(t=SAER_CPU_regs.db&65535,b&1&&(t=t<<8&65535|t>>8),t=(t<<16|t)>>>0):2==a?(t=SAER_CPU_regs.db&65535,b&1&&(t=t<<8&65535|t>>8)):(t=SAER_CPU_regs.db,t=b&
1?t&255:t>>8&255)));return t};this.dummyPut=function(b,a,q){(J(b)||1<a&&J(b+a-1))&&SAEV_MBRes_gary_timeout&&d(b,a,!0)};this.getSubBank=function(b){var a,d=b.value,q=Za[d>>>16].sub_banks;if(null===q)return SAEV_Memory_dummyBank;for(a=0;null!==q[a].bank;a++){var t=d&65535;if(t<q[a+1].offset&&(t&q[a].mask)>>>0==q[a].maskval)return b.value=d-q[a].suboffset,q[a].bank}b.value=d-q[a-1].suboffset;return q[a-1].bank};var Dc=new SAEO_Memory_addrbank(function(b){return(h()<<16|h())>>>0},function(b){return h()},
function(b){return h()},function(b,a){},function(b,a){},function(b,a){},SAEF_Memory_defaultXLate,SAEF_Memory_defaultXLate,null,null,"Dummy Chip memory",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_CHIPRAM),hc=0,Sb=0,W=new SAEO_Memory_addrbank(N,I,function(b){b=(b&W.mask)>>>0;return W.baseaddr[b]},E,function(b,a){b=(b&W.mask)>>>0;W.baseaddr[b]=a>>8;W.baseaddr[b+1]=a&255},function(b,a){b=(b&W.mask)>>>0;W.baseaddr[b]=a},m,K,null,"chip",
"Chip memory",N,I,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE|SAEC_Memory_addrbank_flag_CHIPRAM),Aa=new SAEO_Memory_addrbank(kb,ua,function(b){b=(b&Aa.mask)+db;return Aa.baseaddr[b]},function(b,a){b=(b&Aa.mask)+db;Aa.baseaddr[b]=a>>>24;Aa.baseaddr[b+1]=a>>>16&255;Aa.baseaddr[b+2]=a>>>8&255;Aa.baseaddr[b+3]=a&255},function(b,a){b=(b&Aa.mask)+db;Aa.baseaddr[b]=a>>8;Aa.baseaddr[b+1]=a&255},function(b,a){b=(b&Aa.mask)+db;Aa.baseaddr[b]=a},function(b){return b=(b&Aa.mask)+db},function(b,
a){b&=Aa.mask;return b+a<=Aa.allocated},null,"bogo","Slow memory",kb,ua,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE),z=new SAEO_Memory_addrbank(y,Oa,function(b){b=(b&z.mask)>>>0;return z.baseaddr[b]},function(b,a){b=(b&z.mask)>>>0;z.baseaddr[b]=a>>>24;z.baseaddr[b+1]=a>>>16&255;z.baseaddr[b+2]=a>>>8&255;z.baseaddr[b+3]=a&255},function(b,a){b=(b&z.mask)>>>0;z.baseaddr[b]=a>>8;z.baseaddr[b+1]=a&255},function(b,a){b=(b&z.mask)>>>0;z.baseaddr[b]=a},function(b){return b=(b&z.mask)>>>
0},function(b,a){b=(b&z.mask)>>>0;return b+a<=z.allocated},null,"ramsey_low","RAMSEY memory (low)",y,Oa,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE),Ca=new SAEO_Memory_addrbank(T,wa,function(b){b=(b&Ca.mask)>>>0;return Ca.baseaddr[b]},function(b,a){b=(b&Ca.mask)>>>0;Ca.baseaddr[b]=a>>>24;Ca.baseaddr[b+1]=a>>>16&255;Ca.baseaddr[b+2]=a>>>8&255;Ca.baseaddr[b+3]=a&255},function(b,a){b=(b&Ca.mask)>>>0;Ca.baseaddr[b]=a>>8;Ca.baseaddr[b+1]=a&255},function(b,a){b=(b&Ca.mask)>>>0;Ca.baseaddr[b]=
a},function(b){return b=(b&Ca.mask)>>>0},function(b,a){b=(b&Ca.mask)>>>0;return b+a<=Ca.allocated},null,"ramsey_high","RAMSEY memory (high)",T,wa,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE),Ba=!1,Ia=null;this.a1000_reset=function(){b(1)};var ma=new SAEO_Memory_addrbank(q,Z,function(b){b=(b&ma.mask)>>>0;return ma.baseaddr[b]},function(a,d){pb?(a=(a&ma.mask)>>>0,ma.baseaddr[a]=d>>>24,ma.baseaddr[a+1]=d>>>16&255,ma.baseaddr[a+2]=d>>>8&255,ma.baseaddr[a+3]=d&255):Ba?16515072<=
a?(a=(a&ma.mask)>>>0,ma.baseaddr[a]=d>>>24,ma.baseaddr[a+1]=d>>>16&255,ma.baseaddr[a+2]=d>>>8&255,ma.baseaddr[a+3]=d&255):b(0):SAEV_config.memory.logIllegal&&SAEF_warn("Illegal kickmem put32 at %08x",a)},function(a,d){pb?(a=(a&ma.mask)>>>0,ma.baseaddr[a]=d>>8,ma.baseaddr[a+1]=d&255):Ba?16515072<=a?(a=(a&ma.mask)>>>0,ma.baseaddr[a]=d>>8,ma.baseaddr[a+1]=d&255):b(0):SAEV_config.memory.logIllegal&&SAEF_warn("Illegal kickmem put16 at %08x",a)},function(a,d){pb?(a=(a&ma.mask)>>>0,ma.baseaddr[a]=d):Ba?
16515072<=a?(a=(a&ma.mask)>>>0,ma.baseaddr[a]=d):b(0):SAEV_config.memory.logIllegal&&SAEF_warn("Illegal kickmem put8 at %08x",a)},function(b){return b=(b&ma.mask)>>>0},function(b,a){b=(b&ma.mask)>>>0;return b+a<=ma.allocated},null,"kick","Kickstart ROM",q,Z,SAEC_Memory_addrbank_flag_ROM|SAEC_Memory_addrbank_flag_THREADSAFE),cb=0,va=new SAEO_Memory_addrbank(ea,Ua,function(b){b=(b&va.mask)>>>0;return va.baseaddr[b]},function(b,a){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem put32 at %08x",
b)},function(b,a){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem put16 at %08x",b)},function(b,a){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem put32 at %08x",b)},function(b){return b=(b&va.mask)>>>0},function(b,a){b=(b&va.mask)>>>0;return b+a<=va.allocated},null,null,"Extended Kickstart ROM",ea,Ua,SAEC_Memory_addrbank_flag_ROM|SAEC_Memory_addrbank_flag_THREADSAFE),Hb=new SAEO_Memory_addrbank(r,R,function(b){b=(b&Hb.mask)>>>0;return Hb.baseaddr[b]},function(b,
a){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem2 put32 at %08x",b)},function(b,a){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem2 put16 at %08x",b)},function(b,a){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem2 put32 at %08x",b)},function(b){return b=(b&Hb.mask)>>>0},function(b,a){b=(b&Hb.mask)>>>0;return b+a<=Hb.allocated},null,"rom_a8","Extended 2nd Kickstart ROM",r,R,SAEC_Memory_addrbank_flag_ROM|SAEC_Memory_addrbank_flag_THREADSAFE),la=
new SAEO_Memory_addrbank(Fa,Lb,function(b){b=(b&la.mask)>>>0;return la.baseaddr[b]},function(b,a){b=(b&la.mask)>>>0;la.baseaddr[b]=a>>>24;la.baseaddr[b+1]=a>>>16&255;la.baseaddr[b+2]=a>>>8&255;la.baseaddr[b+3]=a&255},function(b,a){b=(b&la.mask)>>>0;la.baseaddr[b]=a>>8;la.baseaddr[b+1]=a&255},function(b,a){b=(b&la.mask)>>>0;la.baseaddr[b]=a},function(b){return b=(b&la.mask)>>>0},function(b,a){b=(b&la.mask)>>>0;return b+a<=la.allocated},null,"custmem1","Non-autoconfig RAM #1",Fa,Lb,SAEC_Memory_addrbank_flag_RAM|
SAEC_Memory_addrbank_flag_THREADSAFE),Ta=new SAEO_Memory_addrbank(t,tb,function(b){b=(b&Ta.mask)>>>0;return Ta.baseaddr[b]},function(b,a){b=(b&Ta.mask)>>>0;Ta.baseaddr[b]=a>>>24;Ta.baseaddr[b+1]=a>>>16&255;Ta.baseaddr[b+2]=a>>>8&255;Ta.baseaddr[b+3]=a&255},function(b,a){b=(b&Ta.mask)>>>0;Ta.baseaddr[b]=a>>8;Ta.baseaddr[b+1]=a&255},function(b,a){b=(b&Ta.mask)>>>0;Ta.baseaddr[b]=a},function(b){return b=(b&Ta.mask)>>>0},function(b,a){b=(b&Ta.mask)>>>0;return b+a<=Ta.allocated},null,"custmem2","Non-autoconfig RAM #2",
t,tb,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE),Bb=null,Ic=!1;this.a3000_fakekick=function(b){SAEF_log("memory.a3000_fakekick() map %d",b?1:0);if(b){b=z.baseaddr;var a=z.allocated-524288;78==b[a+2]&&249==b[a+3]&&0==b[a+4]&&(null===Bb&&(Bb=new Uint8Array(524288)),Bb.set(ma.baseaddr.subarray(0,524288)),252==b[a+5]?(ma.baseaddr.set(b.subarray(0,262144)),ma.baseaddr.set(b.subarray(0,262144),262144),va.allocated=65536,va.label="rom_f0",va.mask=va.allocated-1,ka(va),va.baseaddr.set(b.subarray(262144,
327680)),na(va,240,1,1),Ic=!0):ma.baseaddr.set(b.subarray(0,524288)))}else Ic&&(na(SAEV_Memory_dummyBank,240,1,1),qa(va),Ic=!1),null!==Bb&&(ma.baseaddr.set(Bb),Bb=null)};this.mapOverlay=function(b){var d=1572864<=W.allocated?W.allocated>>>16:32;Pa&&(d=8);var q=W;b?(na(SAEV_Memory_dummyBank,0,d,0),SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&0==Aa.allocated?(na(q,0,d,W.allocated),d=W.allocated>>>16,1048576>W.allocated?SAEV_config.chipset.jumper1MbChip&&(q=1048576-W.allocated>>>16,na(Dc,
d,q,0),na(Dc,d+16,q,0)):2097152>W.allocated&&1048576<W.allocated&&(q=2097152-W.allocated>>>16,na(Dc,d,q,0))):na(q,0,32,W.allocated)):(b=null,32>d&&0==Pa&&(d=32),q=Za[240],null===b&&q&&q.flags&SAEC_Memory_addrbank_flag_ROM&&4372==a(15728640)&&(b=q),q=Za[224],null===b&&q&&q.flags&SAEC_Memory_addrbank_flag_ROM&&4372==a(14680064)&&(b=q),null===b&&(b=ma),na(b,0,d,524288));Ga();f(SAER_CPU_regs.pc,4)&&SAER.cpu.setPC_normal(SAER_CPU_getPC())};this.getz2size=function(b){return b.memory.z2FastSize};this.getz2endaddr=
function(){return SAEV_config.memory.z2FastSize+2097152};this.cleanup=function(){qa(z);z.baseaddr=null;qa(Ca);Ca.baseaddr=null;qa(Aa);Aa.baseaddr=null;qa(ma);Ia=ma.baseaddr=null;Ba=!1;qa(W);W.baseaddr=null;qa(la);la.baseaddr=null;qa(Ta);Ta.baseaddr=null};this.reset=function(a){pb=!0;2<zb&&(nb(),SAER.devices.virtualdevice_init(),W.allocated=0,W.baseaddr=null,Aa.allocated=0,Aa.baseaddr=null,va.allocated=0,va.baseaddr=null,Hb.allocated=0,Hb.baseaddr=null,cb=0,z.allocated=0,z.baseaddr=null,Ca.allocated=
0,Ca.baseaddr=null,la.allocated=0,la.baseaddr=null,Ta.allocated=0,Ta.baseaddr=null,ma.allocated=524288,ma.baseaddr=null,ka(ma),SAEF_memset(ma.baseaddr,0,0,524288));Ub=SAEV_Memory_defaultXLate_recursive=SAEV_Memory_defaultXLate_cnt=0;sc=50;var d=0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)||SAEV_config.chipset.pcmcia||0<SAEV_config.chipset.ide||SAEV_config.chipset.mbdmac;nb();Pa=0;var q=0!=(Aa.flags&SAEC_Memory_addrbank_flag_NOALLOC)&&(W.allocated!=SAEV_config.memory.chipSize||Aa.allocated!=
SAEV_config.memory.bogoSize);q&&(qa(W),qa(Aa));if(524288==SAEV_config.memory.chipSize&&524288<=SAEV_config.memory.bogoSize&&68020>SAEV_config.cpu.model)if(0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS)&&0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)){if(W.allocated!=SAEV_config.memory.chipSize||Aa.allocated!=SAEV_config.memory.bogoSize){qa(W);qa(Aa);var t=W.allocated=SAEV_config.memory.chipSize,h=Aa.allocated=SAEV_config.memory.bogoSize;W.mask=W.allocated-1;W.start=0;
hc=2*Aa.allocated-1;Sb=1048576;W.allocated=t+h;ka(W);W.allocated=SAEV_config.memory.chipSize;Aa.baseaddr=W.baseaddr;Aa.mask=Aa.allocated-1;Aa.start=12582912;Aa.flags|=SAEC_Memory_addrbank_flag_NOALLOC;db=t}Pa=1}else if(0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS)&&SAEV_config.chipset.jumper1MbChip){if(W.allocated!=SAEV_config.memory.chipSize||Aa.allocated!=SAEV_config.memory.bogoSize)qa(W),qa(Aa),t=W.allocated=SAEV_config.memory.chipSize,h=Aa.allocated=SAEV_config.memory.bogoSize,
W.mask=W.allocated-1,W.start=0,hc=W.allocated-1,Sb=W.allocated,W.allocated=t+h,ka(W),W.allocated=SAEV_config.memory.chipSize,Aa.baseaddr=W.baseaddr,Aa.mask=Aa.allocated-1,Aa.start=W.start+SAEV_config.memory.chipSize,Aa.flags|=SAEC_Memory_addrbank_flag_NOALLOC,db=t;Pa=2}Pa&&SAEF_log("memory.allocate() %dK chip/%dK bogo-ram to %dK chip-ram aliasing enabled",SAEV_config.memory.chipSize>>10,SAEV_config.memory.bogoSize>>10,Sb>>10);if(W.allocated!=SAEV_config.memory.chipSize||q)qa(W),W.flags&=~SAEC_Memory_addrbank_flag_NOALLOC,
2097152<SAEV_config.memory.chipSize&&524288<=SAEV_config.memory.z2FastSize&&SAER.expansion.free_fastmemory_ext(0),t=W.allocated=Sb=SAEV_config.memory.chipSize,hc=W.mask=W.allocated-1,W.start=0,1048576>t&&(t=1048576),1048576<t&&2097152>t&&(t=2097152),W.allocated=t,ka(W),W.allocated=SAEV_config.memory.chipSize,t>W.allocated&&SAEF_memset(W.baseaddr,W.allocated,255,t-W.allocated),hc=W.allocated-1,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?(1048576>W.allocated&&(hc=1048575),1048576<W.allocated&&
2097152>W.allocated&&(hc=W.mask=2097151)):SAEV_config.chipset.jumper1MbChip&&(hc=524287);SAER_Memory_chipData=W.baseaddr;SAEV_Memory_chipMask=hc;if(Aa.allocated!=SAEV_config.memory.bogoSize||q)if(2097152!=Aa.allocated||1572864!=SAEV_config.memory.bogoSize)qa(Aa),Aa.flags&=~SAEC_Memory_addrbank_flag_NOALLOC,Aa.allocated=0,Aa.allocated=SAEV_config.memory.bogoSize,1572864<=Aa.allocated&&(Aa.allocated=2097152),Aa.mask=Aa.allocated-1,Aa.start=12582912,Aa.allocated&&ka(Aa);z.allocated!=SAEV_config.memory.ramsey.lowSize&&
(qa(z),z.allocated=SAEV_config.memory.ramsey.lowSize,z.mask=z.allocated-1,z.start=134217728-z.allocated,z.allocated&&ka(z));Ca.allocated!=SAEV_config.memory.ramsey.highSize&&(qa(Ca),Ca.allocated=SAEV_config.memory.ramsey.highSize,Ca.mask=Ca.allocated-1,Ca.start=134217728,Ca.allocated&&ka(Ca));la.allocated!=SAEV_config.memory.custom[0].size&&(qa(la),la.allocated=SAEV_config.memory.custom[0].size,la.mask=$a(la.allocated)?la.allocated-1:-1,la.start=SAEV_config.memory.custom[0].addr,la.allocated&&!ka(la)&&
(la.allocated=0));Ta.allocated!=SAEV_config.memory.custom[1].size&&(qa(Ta),Ta.allocated=SAEV_config.memory.custom[1].size,Ta.mask=$a(Ta.allocated)?Ta.allocated-1:-1,Ta.start=SAEV_config.memory.custom[1].addr,Ta.allocated&&!ka(Ta)&&(Ta.allocated=0));SAER_Memory_chipGet8_indirect=ja;SAER_Memory_chipGet16_indirect=pa;SAER_Memory_chipGet32_indirect=N;SAER_Memory_chipPut8_indirect=bb;SAER_Memory_chipPut16_indirect=G;SAER_Memory_chipPut32_indirect=E;SAER_Memory_chipCheck_indirect=K;SAER_Memory_chipXLate_indirect=
m;if(1<zb||null!==Ia&&a&&SAER.cpu.is_hardreset())if(a=fa(),a!=SAEE_None)return a;na(SAEV_Custom_bank,192,32,0);na(SAEV_CIA_bank,160,32,0);SAEV_config.chipset.a1000ram||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000||na(SAEV_Memory_dummyBank,216,6,0);a=W.allocated>>>16;a<32+(SAEV_config.memory.z2FastSize>>>16)&&(a=32+(SAEV_config.memory.z2FastSize>>>16));na(SAEV_Memory_dummyBank,a,(d?191:160)-a,0);d&&(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000||SAEV_config.chipset.mbdmac?
na(SAEV_Memory_dummyBank,208,8,0):na(SAEV_Memory_dummyBank,192,24,0));null!==Aa.baseaddr&&(d=SAEV_config.memory.bogoSize>>>16,28<d&&(d=28),24<d&&(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020&&0==SAEV_config.cpu.addressSpace24)&&(d=24),2==Pa?na(Aa,8,d,0):na(Aa,192,d,0));if(SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia){if(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200||SAEV_config.chipset.pcmcia)na(SAEV_Gayle_bank,216,6,
0),na(SAEV_Gayle2_bank,221,2,0);SAER.gayle.map_pcmcia();SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A4000&&2!=SAEV_config.chipset.mbdmac||na(SAEV_Gayle_bank,221,1,0);0>SAEV_config.chipset.ide&&!SAEV_config.chipset.pcmcia&&na(SAEV_Gayle_bank,216,6,0);0>SAEV_config.chipset.ide&&na(SAEV_Gayle_bank,221,1,0)}SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000&&na(SAEV_RTC_bank,216,4,0);SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A?
na(SAEV_RTC_bank,220,1,0):(SAEV_config.chipset.mirrorA8||0<SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia)&&na(SAEV_RTC_bank,220,1,0);(0<=SAEV_config.chipset.fatGaryRev||0<=SAEV_config.chipset.ramseyRev)&&na(SAEV_MBRes_bank,222,1,0);null!==z.baseaddr&&na(z,z.start>>>16,z.allocated>>>16,0);null!==Ca.baseaddr&&na(Ca,Ca.start>>>16,Ca.allocated>>>16,0);U(ma,248,8,0);17==ma.baseaddr[0]&&78==ma.baseaddr[2]&&249==ma.baseaddr[3]&&0==ma.baseaddr[4]&&(d=ma.baseaddr[5],32==d&&2097152>=SAEV_config.memory.chipSize&&
0==SAEV_config.memory.z2FastSize&&U(ma,d,8,0),192==d&&0==SAEV_config.memory.bogoSize&&U(ma,d,8,0),240==d&&U(ma,d,8,0));null!==Ia&&b(1);na(SAER_Expansion_expamem_bank,232,1,0);Ic&&U(va,240,1,0);this.mapOverlay(!0);switch(cb){case 3:U(va,224,8,0);break;case 2:U(va,240,1048576==va.allocated?16:8,0);break;case 1:U(va,224,8,0)}SAER.autoconf.need_uae_boot_rom()&&U(SAER_AutoConf_bank,SAEV_AutoConf_base>>>16,1,0);!SAEV_Memory_cloantoRom&&!SAEV_config.chipset.mirrorE0||cb||na(ma,224,8,0);SAEV_config.chipset.mirrorA8&&
(Hb.allocated?U(Hb,168,16,0):(1==cb||3==cb?na(va,176,8,0):na(ma,176,8,0),na(ma,168,8,0)));for(d=0;2>d;d++)if(a=SAEV_config.memory.custom[d],a.size&&(na(0==d?la:Ta,a.addr>>>16,a.size>>>16,0),a.mask))for(q=a.addr;q&a.mask;q+=a.size)na(0==d?la:Ta,q>>>16,a.size>>>16,0);zb&&this.clear();return SAEE_None};this.clear=function(){zb=0;null!==W.baseaddr&&SAEF_memset(W.baseaddr,0,0,W.allocated);null!==Aa.baseaddr&&SAEF_memset(Aa.baseaddr,0,0,Aa.allocated);null!==z.baseaddr&&SAEF_memset(z.baseaddr,0,0,z.allocated);
null!==Ca.baseaddr&&SAEF_memset(Ca.baseaddr,0,0,Ca.allocated);SAER.expansion.clear()};this.hardreset=function(b){b+1>zb&&(zb=b+1)};this.ks12orolder=function(){return 0<mb&&34>mb};this.ks11orolder=function(){return 0<mb&&33>mb};this.map_banks_cond=function(b,a,d,q){for(var t=0;t<SAEV_config.memory.custom.length;t++){var h=SAEV_config.memory.custom[t].addr>>>16;if(h&&SAEV_config.memory.custom[t].size>>>16&&(a<=h&&a+d>=h||h<=a&&(h+d>=a||a+d>h)))return}na(b,a,d,q)};SAER_Memory_mapBanks=na;this.map_banks_z2=
function(b,a,d){Xb(b,a,d)&&na(b,a,d,0)};this.map_banks_z3=function(b,a,d){var q;a:if(4096>a||0>=d)SAEF_error("memory.validate_banks_z3() invalid bank '%s' start=%08x size=%08x",b.name,a<<16,d<<16),SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT),q=!1;else if(16384<d||61440<a+d)SAEF_error("memory.validate_banks_z3() invalid bank '%s' start=%08x size=%08x",b.name,a<<16,d<<16),q=!1;else{for(q=a;q<a+d;q++){var t=Za[a];if(t!==SAEV_Memory_dummyBank&&t!==b){SAEF_error("memory.validate_banks_z3() bank '%s' attempting to override existing memory bank '%s' at %08X",
b.name,t.name,q<<16);q=!1;break a}}q=!0}q&&na(b,a,d,0)};this.map_dump=function(){if(SAEV_config.debug.level==SAEC_Config_Debug_Level_Log){var b=new L,a,d=Za[0],q="",t=SAEV_config.memory.logIllegal;SAEV_config.memory.logIllegal=!1;for(var h=SAEV_config.cpu.addressSpace24?256:65536,b=a=b.num_regions=0;b<h+1;b++){var f=null;b<h&&(f=Za[b]);if(d!==f){var r,m,Z,T,G=d.name,hc=d.sub_banks,z=0,q=0;r=a;T=wb(r<<16);m=null!==T?1:0;for(r++;r<b&&null!==T;)wb(r<<16)===T&&m++,r++;r=m;for(0==r&&(r=1);65536>q;){T=
q;if(null!==hc){if(null===hc[z].bank)break;Z=(a<<16|q)>>>0;d=SAER.memory.getSubBank({value:Z});for(G=d.name;;){T+=1024;if(65536<=T)break;Z=(a<<16|T)>>>0;if(SAER.memory.getSubBank({value:Z})!==d)break}z++;d=T-q>>10}else d=b-a<<6;null===G&&(G="<none>");Z="K";256<=a&&1024<=Math.floor(d/r)&&!(Math.floor(d/r)&1023)&&(d>>=10,Z="M");q=sprintf("%08X %7d%s/%d = %7d%s %s",(a<<16|q)>>>0,d,Z,m,m?Math.floor(d/m):d,Z,G);q+="\n";SAEF_log(q);if(null===hc)break;q=T}a=b;d=f}}SAEV_config.memory.logIllegal=t}}};var SAER_AutoConf_bank=null,SAEC_AutoConf_RTS=20085,SAEV_AutoConf_base=15728640,SAEV_AutoConf_boot_rom_type=0,SAEV_AutoConf_boot_rom_size=0;
function SAEO_AutoConf(){function a(a){a&=65535;return(I.baseaddr[a]<<24|I.baseaddr[a+1]<<16|I.baseaddr[a+2]<<8|I.baseaddr[a+3])>>>0}function f(a){a&=65535;return(I.baseaddr[a]<<8)+I.baseaddr[a+1]}function d(a){return 65520<=a||16380<=a&&16384>a?!0:(16384<=a&&49152>a?!0:!1)||(61440<=a&&61472>a?!0:!1)}function J(a,h){a&=65535;if(d(a)&&(I.baseaddr[a]=h,61440<=a&&61472>a)){a-=61440;var f=Math.floor(a/8);7==(a&7)&&(255!=h&&254!=h&&1!=h&&2!=h&&SAEF_log("autoconf.rtarea_put8() TRAP %d (%02x)",f,h),254==
h&&atomic_dec(ja),1==h&&atomic_dec(ja),1!=h&&2!=h||SetEvent(N[f]))}}function h(){this.handler=null;this.flags=0;this.name="";this.addr=0}var N=Array(4);this.need_uae_boot_rom=function(){var a=0,d;d=15728640;a=1;1==SAEV_config.chipset.mbdmac&&(d=15663104);null!==SAER_Memory_getBank(15728640)&&SAER_Memory_check(15728640,65536)&&(d=15663104);2097152<SAEV_config.memory.chipSize||(d=a=0);SAEV_AutoConf_boot_rom_type=a;SAEF_log("autoconf.need_uae_boot_rom() type %d",SAEV_AutoConf_boot_rom_type);SAEV_AutoConf_base||
(SAEV_AutoConf_boot_rom_type=d=0);return d};this.rethink_traps=function(){return!1};var I=new SAEO_Memory_addrbank(a,f,function(a){a&=65535;61440<=a&&61472>a?0==(a-61440&7)&&(I.baseaddr[a]=0):65532==a?I.baseaddr[a]=atomic_bit_test_and_reset(0,0):65533==a?I.baseaddr[a]=0!=ja:65534==a&&(I.baseaddr[a]=0);0==ja?atomic_and(0,-8193):(atomic_or(0,8192),set_special_exter(SPCFLAG_UAEINT));return I.baseaddr[a]},function(a,h){a&=65535;d(a)&&(I.baseaddr[a+0]=h>>>24,I.baseaddr[a+1]=h>>>16&255,I.baseaddr[a+2]=
h>>>8&255,I.baseaddr[a+3]=h&255)},function(a,h){a&=65535;h&=65535;if(d(a)&&(J(a,h>>8),J(a+1,h&255),61440<=a&&61472>a)){a-=61440;var f=Math.floor(a/8);0==(a&7)&&(SAEF_log("autoconf.rtarea_put16() TRAP %d (%04x)",f,h),call_hardware_trap(I.baseaddr,SAEV_AutoConf_base,f))}},J,function(a){return a&65535},function(a,d){return 65535>=(a&65535)+d},null,"rtarea","UAE Boot ROM",a,f,SAEC_Memory_addrbank_flag_ROMIN|SAEC_Memory_addrbank_flag_PPCIOSPACE);SAER_AutoConf_bank=I;this.reset=function(){SAEF_memset(I.baseaddr,
16384,0,32768);SAEF_memset(I.baseaddr,61440,0,32)};var E=0;this.db=function(a){I.baseaddr[E++]=a};this.dw=function(a){I.baseaddr[E++]=a>>8;I.baseaddr[E++]=a&255};this.dl=function(a){I.baseaddr[E++]=a>>24;I.baseaddr[E++]=a>>16&255;I.baseaddr[E++]=a>>8&255;I.baseaddr[E++]=a&255};this.calltrap=function(a){this.dw(40960+a)};this.org=function(a){15728640!=(a&4294901760)>>>0&&(a&4294901760)>>>0!=SAEV_AutoConf_base&&SAEF_warn("autoconf.org() corrupt address %08X",a);E=a&65535};this.here=function(){return E+
SAEV_AutoConf_base};this.setup=function(){E=0;this.init_traps();this.need_uae_boot_rom()?I.flags&=~SAEC_Memory_addrbank_flag_ALLOCINDIRECT:I.flags|=SAEC_Memory_addrbank_flag_ALLOCINDIRECT;I.allocated=65536;var a;var d=I;d.startmask=d.start;try{d.baseaddr=new Uint8Array(d.allocated+4),a=!0}catch(h){d.baseaddr=null,a=!1}a||SAEF_fatal(SAEE_NoMemory,"autoconf.init_mem() memory exhausted");SAEF_memset(I.baseaddr,0,0,65536);this.dw(0);this.dw(0);this.define_trap(null,0,"null");SAEV_AutoConf_boot_rom_size=
this.here()-SAEV_AutoConf_base;SAEF_log("autoconf.setup() boot_rom_size %d/%d",SAEV_AutoConf_boot_rom_size,12288);12288<=SAEV_AutoConf_boot_rom_size&&SAEF_fatal(SAEE_NoMemory,"autoconf.setup() RTAREA_TRAPS needs to be increased!");this.org(12288|SAEV_AutoConf_base);this.init_extended_traps()};this.cleanup=function(){I.baseaddr=null;this.free_traps()};this.init=function(){var a=this.need_uae_boot_rom();a&&(SAEF_log("autoconf.init() RTAREA located at %08X",a),SAEV_AutoConf_base=a)};this.makedatatable=
function(a,d,h,f,m,E){var T=this.here();this.dw(57344);this.dw(8);this.dw(h<<8);this.dw(57344);this.dw(9);this.dw(f<<8);this.dw(49152);this.dw(10);this.dl(d);this.dw(57344);this.dw(14);this.dw(1536);this.dw(53248);this.dw(20);this.dw(m);this.dw(53248);this.dw(22);this.dw(E);this.dw(49152);this.dw(24);this.dl(a);this.dw(0);return T};for(var K=1,m=Array(16),pa=0;16>pa;pa++)m[pa]=new h;var ja=0;this.find_trap=function(a){for(var d=0;d<K;d++){var h=m[d];if(h.flags&16&&h.name.length&&h.name==a)return h.addr}return 0};
this.define_trap=function(a,d,h){if(16==K)SAEF_fatal(SAEE_Internal,"define_trap() Ran out of emulator traps. (increase MAX_TRAPS)");else{for(var f=this.here(),y=0;y<K;y++)if(f==m[y].addr)return y;var y=K++,E=m[y];E.handler=a;E.flags=d;E.name=h;E.addr=f;return y}};this.m68k_handle_trap=function(a){var d=m[a],h=0,f=0==(d.flags&2),y=0!=(d.flags&8);d.name.length&&SAEF_log("m68k_handle_trap() TRAP '%s'",d.name);a<K?d.flags&4?SAEF_fatal(SAEE_Internal,"m68k_handle_trap() Extended-traps are not implemented."):
(h=d.handler(null),f&&(SAER_CPU_regs.d[0]=h,SAEF_log("m68k_handle_trap() D0 = %d",h)),y&&(a=SAER_Memory_get32(SAER_CPU_regs.a[7]),SAER_CPU_setPC(a),SAER_CPU_regs.a[7]+=4,SAER_CPU_fill_prefetch())):SAEF_warn("m68k_handle_trap() illegal emulator trap")};this.init_traps=function(){ja=K=0};this.free_traps=function(){};this.init_extended_traps=function(){}};var SAER_Expansion_expamem_bank=null,SAER_Expansion_z3fastmem_bank=null;
function SAEO_Expansion(){function a(){this.rc=this.map=this.initnum=this.initrc=null;this.name="";this.zorro=this.flags=0}function f(b){return b.memory.z3Mapping==SAEC_Config_Memory_z3Mapping_Auto||b.memory.z3Mapping==SAEC_Config_Memory_z3Mapping_SAE}function d(){SAER_Memory_mapBanks(SAEV_Memory_dummyBank,232,1,0);SAEV_config.cpu.addressSpace24||SAER_Memory_mapBanks(SAEV_Memory_dummyBank,65280,1,0)}function J(){na.name="Autoconfig Z2";Xb.name="Autoconfig Z3";d();R=Fa}function h(b){var a=t[b]&240|
t[b+2]>>4;return 0==b||2==b||64==b||66==b?a:~a&255}function N(b,a){b&=65535;0==b||2==b||64==b||66==b?(t[b]=a&240,t[b+2]=(a&15)<<4):(t[b]=~(a&240),t[b+2]=~((a&15)<<4))}function I(){return h(0)&192}function E(b){na.name=Ua[R].name?Ua[R].name:"None";b=Ua[R].initnum?Ua[R].initnum(0):Ua[R].initrc(Ua[R].rc);ka=0;if(!1===b)K(null,null);else{var a=b;null===a&&(a=na);if(a!==na)for(var d=0;64>d;d++)t[d]=a.get8(d);a=h(0);192==(a&192)?(a&=7,nb=Sa=0==a?8388608:32768<<a,$a=sb):128==(a&192)?(268435456>qa&&(qa=SAEV_config.memory.z3AutoConfigStart,
134217728<=SAEV_config.memory.ramsey.highSize&&268435456==qa&&(qa+=SAEV_config.memory.ramsey.highSize-134217728+16777216),f(SAEV_config)||(qa=1073741824)),ta=qa,a&=7,ka=h(8)&32?16777216<<a:16777216,qa+=ka,a=ta,33554432>=ka&&(ta=(ta+ka-1&~(ka-1))>>>0),qa+=ta-a,nb=ka,$a=ta):64==(a&192)&&(nb=Sa=65536,$a=sb);null!==b?(Ga=b,Ua[R].flags&1&&SAEV_config.chipset.z3AutoConfig&&!SAEV_config.cpu.addressSpace24?(SAER_Memory_mapBanks(Xb,65280,1,0),SAER_Memory_mapBanks(SAEV_Memory_dummyBank,232,1,0)):(SAER_Memory_mapBanks(na,
232,1,0),SAEV_config.cpu.addressSpace24||SAER_Memory_mapBanks(SAEV_Memory_dummyBank,65280,1,0))):Ua[R].flags&1&&SAEV_config.chipset.z3AutoConfig&&!SAEV_config.cpu.addressSpace24?(Ga=na,SAER_Memory_mapBanks(Xb,65280,1,0),SAER_Memory_mapBanks(SAEV_Memory_dummyBank,232,1,0)):(Ga=null,SAER_Memory_mapBanks(na,232,1,0),SAEV_config.cpu.addressSpace24||SAER_Memory_mapBanks(SAEV_Memory_dummyBank,65280,1,0))}}function K(b,a){if(b){var q=h(0),f=nb,r="K",f=f>>>10;8192<f&&(r="M",f>>>=10);SAEF_log("memory.boardmessage() Card %d: Z%d 0x%08x %4d%s %s %s%s",
R+1,192==(q&192)?2:128==(q&192)?3:1,$a,f,r,q&16?"ROM":q&32?"RAM":"IO ",b.name,"")}SAEF_memset(t,0,255,65536);for(d();;){++R;if(R>=Fa)break;q=Ua[R];if(f=q.initrc)f=q.zorro,f=5==f||6==f||4==f;if(f)q.initrc(Ua[R].rc);else{E(R);break}}R>=Fa&&(J(),J(),SAEF_log("Memory map after autoconfig:"),SAER.memory.map_dump())}function m(b){b=(b&fa.mask)>>>0;return(fa.baseaddr[b]<<24|fa.baseaddr[b+1]<<16|fa.baseaddr[b+2]<<8|fa.baseaddr[b+3])>>>0}function pa(b){b=(b&fa.mask)>>>0;return fa.baseaddr[b]<<8|fa.baseaddr[b+
1]}function ja(b,a,d,q,t){b=0;var h,f=128,r=new Uint8Array(16);b||(2>=a?h=81:(h=83,f=f|16|(8388608<t?32:1048576==t?6:2097152==t?7:4194304==t?8:8388608==t?10:0)),b=Lb);r[0]=d;r[1]=h;r[2]=f;r[4]=b>>8;r[5]=b&255;r[6]=q>>>24;r[7]=q>>>16&255;r[8]=q>>>8&255;r[9]=q&255;N(0,r[0]);N(4,r[1]);N(8,r[2]);N(16,r[4]);N(20,r[5]);N(24,r[6]);N(28,r[7]);N(32,r[8]);N(36,r[9]);N(40,0);N(44,0);N(64,0)}function G(b){b=224;var a=fa.allocated;0==a?b=!1:(SAEF_memset(t,0,255,65536),65536==a?b|=1:131072==a?b|=2:262144==a?b|=
3:524288==a?b|=4:1048576==a?b|=5:2097152==a?b|=6:4194304==a?b|=7:8388608==a&&(b|=0),ja(0,2,b,1,a),ja(0,-1,b,1,a),b=null);return b}function bb(){var b=fa,a=b.allocated;b.start=(Da|tb>>4)<<16>>>0;b.start&&SAER.memory.map_banks_z2(b,b.start>>>16,a>>>16);return b}function kb(){var b=U.start,a=U,d=SAEV_config.memory.z3FastSize,q=U.allocated,t=ta,h=b;f(SAEV_config)?t&&h!=t&&(SAEF_warn("memory.expamem_map_z3fastmem_2() Z3MEM mapping changed from $%08x to $%08x",h,t),map_banks(SAEV_Memory_dummyBank,h>>>16,
d>>>16,q),b=t,SAER.memory.map_banks_z3(a,h>>>16,d>>>16)):(SAER.memory.map_banks_z3(a,t>>>16,d>>>16),b=t);U.start=b;return a}function ua(b){b=U;var a=U.start,d=SAEV_config.memory.z3FastSize,q=U.allocated,h=1048576==q?5:2097152==q?6:4194304==q?7:8388608==q?0:16777216==q?0:33554432==q?1:67108864==q?2:134217728==q?3:268435456==q?4:536870912==q?5:6;16777216>q&&(h=0);SAEF_memset(t,0,255,65536);ja(0,3,160|h,1,q);SAER.memory.map_banks_z3(b,a>>>16,d>>>16);return null}function y(b){b=(b&U.mask)>>>0;return(U.baseaddr[b]<<
24|U.baseaddr[b+1]<<16|U.baseaddr[b+2]<<8|U.baseaddr[b+3])>>>0}function Oa(b){b=(b&U.mask)>>>0;return U.baseaddr[b]<<8|U.baseaddr[b+1]}function T(b){b.startmask=b.start;try{return b.baseaddr=new Uint8Array(b.allocated+4),!0}catch(a){return b.baseaddr=null,!1}}function wa(){U.start=SAEV_config.memory.z3AutoConfigStart;f(SAEV_config)||(U.start=1073741824);268435456==U.start&&134217728<=SAEV_config.memory.ramsey.highSize&&(U.start+=SAEV_config.memory.ramsey.highSize-134217728+16777216);fa.allocated!=
SAEV_config.memory.z2FastSize&&(fa.baseaddr=null,fa.allocated=SAEV_config.memory.z2FastSize,fa.mask=fa.allocated-1,fa.allocated&&T(fa),SAER.memory.hardreset(1));if(U.allocated!=SAEV_config.memory.z3FastSize){U.baseaddr=null;var b=SAEV_config.memory.z3FastSize;a:{var a=U,d=b;a.allocated=0;a.baseaddr=null;a.mask=0;if(d)for(;1048576<=d;){a.mask=d-1;a.allocated=d;a.label="z3";if(T(a)){b=d;break a}SAEF_warn("expansion.mapped_malloc_dynamic() out of memory for '%s'. (%d bytes)","z3",d);d>>>=1}}SAEV_config.memory.z3FastSize=
b;SAER.memory.hardreset(1)}}function b(b){if(Ga&&Ga!==na)return Ga.get16(b);if(128!=I()&&Ga&&Ga!==na)return Ga.get8(b)<<8;SAEF_warn("expamem_get16() READ.W from address $%08x PC=%x",b,SAER_CPU_getPC());return q(b)<<8|q(b+1)}function q(b){return Ga&&Ga!==na?Ga.get8(b):t[b&65535]}function Z(b){if(!Ga)return 0;var a=b&255;b&256&&(a+=2);return Ga.get8(a)}function ea(b){SAEF_warn("expansion.expamemz3_get16() READ.W from address $%08x PC=%x",b,SAER_CPU_getPC());return Z(b)<<8|Z(b+1)}for(var Ua=Array(16),
r=0;16>r;r++)Ua[r]=new a;var R=0,Fa=0,Lb=0,t=new Uint8Array(65536),tb=0,Da=0,sb=0,Sa=0,ta=0,ka=0,qa=0,nb=0,$a=0,Ga=null,fa=new SAEO_Memory_addrbank(m,pa,function(b){b=(b&fa.mask)>>>0;return fa.baseaddr[b]},function(b,a){b=(b&fa.mask)>>>0;fa.baseaddr[b]=a>>>24;fa.baseaddr[b+1]=a>>>16&255;fa.baseaddr[b+2]=a>>>8&255;fa.baseaddr[b+3]=a&255},function(b,a){b=(b&fa.mask)>>>0;fa.baseaddr[b]=a>>8;fa.baseaddr[b+1]=a&255},function(b,a){b=(b&fa.mask)>>>0;fa.baseaddr[b]=a},function(b){return b=(b&fa.mask)>>>0},
function(b,a){b=(b&fa.mask)>>>0;return b+a<=fa.allocated},null,"fast","Fast memory",m,pa,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE),U=new SAEO_Memory_addrbank(y,Oa,function(b){b=(b&U.mask)>>>0;return U.baseaddr[b]},function(b,a){b=(b&U.mask)>>>0;U.baseaddr[b]=a>>>24;U.baseaddr[b+1]=a>>>16&255;U.baseaddr[b+2]=a>>>8&255;U.baseaddr[b+3]=a&255},function(b,a){b=(b&U.mask)>>>0;U.baseaddr[b]=a>>8;U.baseaddr[b+1]=a&255},function(b,a){b=(b&U.mask)>>>0;U.baseaddr[b]=a},function(b){return b=
(b&U.mask)>>>0},function(b,a){b=(b&U.mask)>>>0;return b+a<=U.allocated},null,"z3","Zorro III Fast RAM",y,Oa,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE);SAER_Expansion_z3fastmem_bank=U;this.free_fastmemory_ext=function(b){0==b&&(fa.baseaddr=null)};this.reset=function(){var b=1;Fa=R=0;Lb=514;wa();na.name="Autoconfig [reset]";0==SAER.autoconf.need_uae_boot_rom()&&(b=0);0>=SAEV_AutoConf_boot_rom_type&&(b=0);SAER.memory.ks12orolder()&&b&&SAEF_log("expansion.reset() Kickstart version is below 1.3! Disabling automount devices.");
SAEV_config.memory.z2FastAutoConfig?null!==fa.baseaddr&&(262144>=fa.allocated||2097152>=SAEV_config.memory.chipSize)&&(Ua[Fa].flags=0,Ua[Fa].name="Z2Fast",Ua[Fa].initnum=G,Ua[Fa++].map=bb):null!==fa.baseaddr&&(fa.name="Fast memory (non-autoconfig)",SAER_Memory_mapBanks(fa,32,fa.allocated>>>16,0));SAEV_config.cpu.addressSpace24||null===U.baseaddr||(b=SAEV_config.memory.z3Mapping!=SAEC_Config_Memory_z3Mapping_Real,z3num=0,Ua[Fa].flags=3,Ua[Fa].name="Z3Fast",Ua[Fa].initnum=ua,Ua[Fa++].map=kb,(b||f(SAEV_config))&&
SAER.memory.map_banks_z3(U,U.start>>>16,SAEV_config.memory.z3FastSize>>>16));qa=ta=sb=0;0==Fa?d():E(0)};this.setup=function(){fa.allocated=0;fa.mask=fa.start=0;fa.baseaddr=null;wa()};this.cleanup=function(){fa.baseaddr=null};this.clear=function(){null!==fa.baseaddr&&fa.allocated&&SAEF_memset(fa.baseaddr,0,0,8388608<fa.allocated?8388608:fa.allocated)};var na=new SAEO_Memory_addrbank(function(a){if(Ga&&Ga!==na)return Ga.get32(a);SAEF_warn("expamem_get32() Z2 READ.L from address $%08x PC=%x",a,SAER_CPU_getPC());
return(b(a)<<16|b(a+2))>>>0},b,q,function(b,a){Ga&&Ga!==na?Ga.put32(b,a):SAEF_warn("expamem_put32() Z2 WRITE.L to address $%08x : value $%08x",b,a)},function(b,a){a&=65535;if(!(R>=Fa)){128!=I()&&SAEF_warn("expamem_put16() WRITE.W to address $%08x : value $%x PC=%08x",b,a,SAER_CPU_getPC());switch(b&255){case 72:if(192==I()){tb=0;Da=a>>8&255;$a=sb=(Da|tb>>4)<<16;if(Ua[R].map){K(Ua[R].map(),null);return}if(Ga&&Ga!==na){Ga.put8(b,a>>8);return}}break;case 68:128==I()&&(Da=a&65280,b=(Da|tb>>4)<<16>>>0,
f(SAEV_config)?b!=ta&&(SAEF_warn("expansion.expamem_put16() hack %08x %08x",b,ta),SAER_Memory_put16(SAER_CPU_regs.a[3]+32,ta>>>16),SAER_Memory_put16(SAER_CPU_regs.a[3]+40,ta>>>16)):ta=b,$a=ta);if(Ua[R].map){K(Ua[R].map(),null);return}break;case 76:if(Ua[R].map){K(null,null);return}}Ga&&Ga!==na&&Ga.put16(b,a)}},function(b,a){a&=255;if(!(R>=Fa)){if(64==I())switch(b&255){case 34:if(Da=a&127,$a=sb=15204352|4096*Da,Ua[R].map){K(Ua[R].map(),null);return}}else switch(b&255){case 72:if(192==I()){if(Da=a&
255,$a=sb=(Da|tb>>4)<<16,Ua[R].map){K(Ua[R].map(),null);return}}else tb=a&255;break;case 74:192==I()&&(tb=a&255);break;case 76:if(Ua[R].map){K(Ga,null);return}}Ga&&Ga!==na&&Ga.put8(b,a)}},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Autoconfig Z2",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_SAFE|SAEC_Memory_addrbank_flag_PPCIOSPACE);SAER_Expansion_expamem_bank=na;var Xb=new SAEO_Memory_addrbank(function(b){SAEF_warn("expansion.expamemz3_get32() READ.L from address $%08x PC=%x",
b,SAER_CPU_getPC());return(ea(b)<<16|ea(b+2))>>>0},ea,Z,function(b,a){SAEF_warn("expansion.expamemz3_put32() WRITE.L to address $%08x, value $%08x",b,a)},function(b,a){if(Ga){var d=b&255;b&256&&(d+=2);if(68==d&&128==I()){Da=a&65280;var q=(Da|tb>>4)<<16>>>0;f(SAEV_config)?q!=ta&&(SAEF_warn("expansion.expamemz3_put16() hack %08x %08x",b,ta),SAER_Memory_put16(SAER_CPU_regs.a[3]+32,ta>>>16),SAER_Memory_put16(SAER_CPU_regs.a[3]+40,ta>>>16)):ta=q;$a=ta}Ga.put16(d,a)}},function(b,a){if(Ga){var d=b&255;b&
256&&(d+=2);72==d?192==I()?(Da=a&255,$a=sb=(Da|tb>>4)<<16>>>0):tb=a&255:74==d&&192==I()&&(tb=a&255);Ga.put8(d,a)}},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Autoconfig Z3",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_SAFE|SAEC_Memory_addrbank_flag_PPCIOSPACE)};var SAEC_Events_CYCLE_UNIT=512,SAEC_Events_CYCLE_UNIT_INV=1/SAEC_Events_CYCLE_UNIT,SAEC_Events_CYCLE_MAX=4294967296*SAEC_Events_CYCLE_UNIT,SAEC_Events_EV_CIA=0,SAEC_Events_EV_AUDIO=1,SAEC_Events_EV_HSYNC=2,SAEC_Events_EV2_BLITTER=0,SAEC_Events_EV2_DISK=1,SAEC_Events_syncbase=1E6,SAER_Events_eventtab=null,SAEV_Events_currcycle=0,SAEV_Events_bogusframe=0,SAEV_Events_timeframes=0,SAEV_Events_hsync_counter=0,SAEV_Events_vsync_counter=0,SAEV_Events_frameskiptime=0,SAEV_Events_reflowtime=0;
function SAEO_Events(){function a(){this.active=!1;this.oldcycles=this.evtime=0;this.handler=null}function f(){this.active=!1;this.evtime=0;this.handler=this.data=null}function d(){var a=SAEC_Events_CYCLE_MAX,d=SAEV_Events_currcycle;if(q)b=!0;else{q++;SAER_Events_eventtab[3].active=!1;for(var h=!0;h;)for(var h=!1,a=SAEC_Events_CYCLE_MAX,f=0;12>f;f++)if(I[f].active)if(I[f].evtime==d){if(I[f].active=!1,I[f].handler(I[f].data),b||I[f].active)h=!0,b=!1}else{var r=I[f].evtime-d;r<a&&(a=r)}a!=SAEC_Events_CYCLE_MAX&&
(SAER_Events_eventtab[3].active=!0,SAER_Events_eventtab[3].oldcycles=d,SAER_Events_eventtab[3].evtime=d+a,SAER.events.schedule());q--}}function J(){Z.clr();ea.clr();SAEV_Events_bogusframe=2;SAEV_Events_timeframes=0;Ua=SAEF_now();r=0}function h(b){var a=SAEF_now();b=a-bb+b;if(b>SAEC_Events_syncbase||b<-SAEC_Events_syncbase)ja=G=bb=a,b=0;return b}var N=Array(4);for(i=0;4>i;i++)N[i]=new a;SAER_Events_eventtab=N;var I=Array(12);for(i=0;12>i;i++)I[i]=new f;var E=0,K=0,m=0,pa=0,ja=0,G=0,bb=0,kb=0,ua=0,
y=0,Oa=0,T=new SAEO_MAvg(128),wa=new SAEO_MAvg(10),b=!1,q=0,Z=new SAEO_MAvg(10),ea=new SAEO_MAvg(10),Ua=0,r=0,R=2,Fa=256*SAEC_Events_CYCLE_UNIT,Lb=0;this.reset=function(){null===N[SAEC_Events_EV_HSYNC].handler&&(N[SAEC_Events_EV_CIA].handler=function(){SAER.cia.handler()},N[SAEC_Events_EV_HSYNC].handler=function(){SAER.playfield.hsync_handler()},N[SAEC_Events_EV_AUDIO].handler=function(){SAER.audio.handler()},N[3].handler=d,I[SAEC_Events_EV2_BLITTER].handler=function(b){SAER.blitter.handler(b)},I[SAEC_Events_EV2_DISK].handler=
function(b){SAER.disk.handler(b)});E=0;R=2;for(var a=0;4>a;a++)N[a].active=!1,N[a].oldcycles=SAEV_Events_currcycle;N[SAEC_Events_EV_HSYNC].evtime=SAEV_Events_currcycle+SAER.playfield.get_maxhpos()*SAEC_Events_CYCLE_UNIT;N[SAEC_Events_EV_HSYNC].active=!0;for(a=0;12>a;a++)I[a].active=!1;this.schedule();b=!1;q=0;J();T.clr();wa.clr();pa=0};this.clr_dmal=function(){y=0};this.pauseResume=function(b){b?(SAER.gui.data.fps=0,SAER.gui.data.idle=0,SAER.gui.fps(0,0,1)):(y=0,J(),T.clr())};this.reset_frame_rate_hack=
function(){0>SAEV_config.cpu.speed&&(K=0,ja=SAEF_now()+kb)};this.calc_vsynctimebase=function(b){kb=SAEC_Events_syncbase/b>>>0;SAEF_log("events.calc_vsynctimebase() %d us (%f)",kb,b);this.reset_frame_rate_hack();return kb};this.schedule=function(){for(var b=SAEC_Events_CYCLE_MAX,a=0;4>a;a++)if(N[a].active){var d=N[a].evtime-SAEV_Events_currcycle;d<b&&(b=d)}E=SAEV_Events_currcycle+b};this.current_hpos=function(){var b=(SAEV_Events_currcycle-N[SAEC_Events_EV_HSYNC].oldcycles)*SAEC_Events_CYCLE_UNIT_INV>>>
0;if(0>b||256<b)SAEF_error("events.current_hpos() hpos = %d !?",b),b=0;return b};this.do_cycles=function(b){if(!(0<=(Lb-=b))){b=-Lb;for(Lb=0;E-SAEV_Events_currcycle<=b;){if(K){if(0<K){var a=SAEF_now(),d=a-ja,a=a-m;if(d>kb||d<-kb)d=0;if(0>d&&0>a){Lb=Fa;return}}else if(0>K&&(a=SAEF_now(),d=a-m,0>d)){Lb=Fa;return}K=0}b-=E-SAEV_Events_currcycle;SAEV_Events_currcycle=E;for(d=0;4>d;d++)N[d].active&&N[d].evtime==SAEV_Events_currcycle&&N[d].handler();this.schedule()}SAEV_Events_currcycle+=b}};this.do_cycles_post=
function(b,a){this.do_cycles(b)};this.event2_newevent_xx=function(b,a,q,h){a=SAEV_Events_currcycle+a;if(0>b){for(b=R;I[b].active&&(I[b].evtime!=a||I[b].data!=q||I[b].handler!==h);)if(b++,12==b&&(b=2),b==R){SAEF_error("events.event2_newevent_xx() out of events!");return}R=b}I[b].active=!0;I[b].evtime=a;I[b].handler=h;I[b].data=q;d()};this.event2_newevent=function(b,a,d){var q=I[b].handler;0>=a?q(d):SAER.events.event2_newevent_xx(b,a*SAEC_Events_CYCLE_UNIT,d,q)};this.event2_remevent=function(b){I[b].active=
!1};this.events_dmal_hsync=function(){y&&SAEF_error("events.events_dmal_hsync() DMAL error!? %04x",y);y=SAER.audio.dmal();y=y<<6&65535;if(y|=SAER.disk.dmal())Oa=0,SAER.events.event2_newevent_xx(-1,7*SAEC_Events_CYCLE_UNIT,13,function(b){for(;y;){if(y&3){var a=Oa+(y&2?1:0);if(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN)if(SAER.events.current_hpos(),6<=a){a-=6;b=a>>1;var a=SAER.audio.getpt(b,0!=(a&1)),d=SAER_Memory_chipGet16_indirect(a);SAEV_Custom_last_value=d;SAER.audio.AUDxDAT(b,d)}else b=a&1,a=SAER.disk.getpt(),
b?0>=SAER.disk.fifostatus()&&(SAEV_Custom_last_value=d=SAER_Memory_chipGet16_indirect(a),SAER.disk.DSKDAT(d)):0<=SAER.disk.fifostatus()&&(d=SAER.disk.DSKDATR(),SAER_Memory_chipPut16_indirect(a,d))}Oa+=2;y>>>=2}})};this.fpscounter=function(b){var a=SAEF_now(),d=a-Ua;Ua=a;SAEV_Events_bogusframe||0>d||(Z.set(d),ea.set(r),r=0,SAEV_Events_timeframes++,0==(SAEV_Events_timeframes&7)&&(d=ea.get(),a=100-(0==d?0:100*d/kb),0>a?a=0:100<a&&(a=100),d=Z.get(),d=0==d?0:SAEC_Events_syncbase/d,999<d&&(d=999),SAEV_Playfield_fake_vblank_hz>
d&&(a*=SAEV_Playfield_fake_vblank_hz/d),SAER.gui.data.fps=d,SAER.gui.data.idle=a,SAER.gui.data.fps_color=b?0:1,0==(SAEV_Events_timeframes&15)&&SAER.gui.fps(d,a,b?0:1)))};this.framewait2_maximum=function(b){b?SAEV_config.cpu.speedThrottle?(ja=SAEF_now(),K=0):(ja=G,m=SAEF_now()+kb,K=2):(ja+=ua,pa++,K=0,0<G-ja&&(0<bb-ja&&(b=SAEF_now(),0<ja-b&&(K=1,m=b+ua,pa=0)),!SAER_Playfield_isvsync()&&!K&&10<=pa&&!SAER.m68k.stopped&&(K=-1,m=SAEF_now()+ua,pa=0)))};this.framewait2_normal=function(){ja+=ua;for(var b=
SAEF_now();0<ja-Math.floor(b+kb/10)&&ja-b<kb;)SAEF_sleep(1),b=SAEF_now()};this.framewait=function(){var b,a;SAER_Playfield_isvsync_chipset();var d=0;K=0;var q=~~T.set(SAEV_Events_frameskiptime);SAEV_Events_frameskiptime=0;a=~~wa.set(SAEV_Events_reflowtime);var d=1,f=kb;if(0>SAEV_config.cpu.speed){SAEV_Playfield_frame_rendered||SAEV_Playfield_picasso_on||(SAEV_Playfield_frame_rendered=SAER.video.render_screen(!1));if(SAEV_config.cpu.speedThrottle)for(;;){b=SAEF_now();if(0>=bb-b||bb-b>2*kb)break;SAEF_sleep(1)}else b=
SAEF_now();q=0;0<b-bb&&b-bb<f>>1&&(q+=b-bb);q+=0;a=SAEV_config.cpu.speedThrottle?Math.truncate(f*(1E3+SAEV_config.cpu.speedThrottle)/1E3-q):f-q;bb=b+f-q;ja=b;0>a?(a=0,ua=1):ua=a/(SAER.playfield.get_maxvpos_display()+1)>>>0;G=b+a}else{b=1/(SAEC_Events_syncbase/1E3);var m=a;SAEV_Playfield_frame_rendered||SAEV_Playfield_picasso_on||(a=SAEF_now(),SAEV_Playfield_frame_rendered=SAER.video.render_screen(!1),m+=SAEF_now()-a);for(a=SAEF_now();!(-4<=h(0)*b);)SAEF_sleep(2);for(;0>h(0););b=SAEF_now();r+=b-a;
ja=b;G=bb=b+f;SAEV_Playfield_frame_rendered&&(SAER.video.show_screen(0),m+=SAEF_now()-b);ua=~~((f-(m+q))/3);0>ua?ua=0:ua>f/3>>>0&&(ua=f/3>>>0);SAEV_Playfield_frame_shown=!0}return 0!=d}};var SAEV_Gayle_bank=null,SAEV_Gayle2_bank=null,SAEV_MBRes_bank=null,SAEV_MBRes_gary_timeout=0,SAEV_MBRes_gary_toenb=0;
function SAEO_Gayle(){function a(){SAEF_memset(nb,0,0,20);$a=-1}function f(){return null===Da[4]||2!=qa||0>$a||null===Da[4].regs0||Da[4].regs0.ide_devcon&2?0:Da[4].irq?4:0}function d(){var b=!1;if(mb)return fa&=-129,0;for(var a=0;2>a;a++)null!==Da[a]&&(Da[a].regs.ide_devcon&2||!(Da[a].irq||Da[a+2]&&Da[a+2].irq)||(b=!0),Da[a].irq&&!SAER.ide.ide_isdrive(Da[a])&&(Da[a].irq=0),Da[a+2]&&Da[a+2].irq&&!SAER.ide.ide_isdrive(Da[a+2])&&(Da[a+2].irq=0));return b?128:0}function J(b,a){var d=!1;na&b&&!a?(na&=
~b,d=!0):na&b||!a||(na|=b,d=!0);d&&(fa|=b,SAER.gayle.rethink(),b&64&&3!=(fa&3)&&(fa&2&&SAER.reset(0,0),fa&1&&SAER_CPU_exception(2)))}function h(b){b?ta&&(J(64,1),wb=8,ka||J(8,1)):(wb=0,J(64,0),J(16,0),J(32,0),J(8,0),J(4,0));SAER.gayle.rethink()}function N(b){b&=65535;if(12320<=b&&12321>=b&&SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000)return{addr:-1,unit:-1};b=(b&-8225)>>2;var a=0;b&1024&&L&&(a=2,b&=-1025);return{addr:b,unit:a+Da[a].ide_drv}}function I(b){b&=65535;if(0>=SAEV_config.chipset.ide)return 8220==
b?127:255;if(12320<=b&&12321>=b&&SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000)return b=fa,fa=0,b;if(16384<=b){if(36864==b){if(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200)return fa}else if(40960==b&&SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200)return U;return 0}b=N(b);return SAER.ide.ide_isdrive(Da[0])||SAER.ide.ide_isdrive(Da[1])||SAER.ide.ide_isdrive(Da[2])||SAER.ide.ide_isdrive(Da[3])?-1!=b.addr?SAER.ide.ide_read_reg(Da[b.unit],b.addr):0:7==b.addr?127:255}
function E(b){var a=0,q=!1;if(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200&&655360!=(b&655360))return 0;b&=65535;SAEV_config.chipset.pcmcia&&(SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A600A1200&&(36864==b?(a=fa,q=!0):40960==b&&(a=U,q=!0)),32768==b?(a=Xb|na,a|=d(),a|=f(),q=!0):45056==b&&(a=wb&15,q=!0));q||(a=I(b));return a}function K(b,d){var q=!1;if(SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A600A1200||655360==(b&655360))if(b&=65535,SAEV_config.chipset.pcmcia&&(SAEV_config.chipset.ide!=
SAEC_Config_Chipset_IDE_A600A1200&&(36864==b?(fa=fa&d|d&3,3==(fa&3)&&a(),q=!0):40960==b&&(U=d,q=!0)),32768==b?(q=na,Xb=d&-4,na&=-4,na|=d&3,(q&1)!=(na&1)&&(SAER.gayle.map_pcmcia(),h(na&1?0:1)),q=!0):45056==b&&(wb=d,q=1)),!q)a:if(q=b,!(0>=SAEV_config.chipset.ide)){if(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200){if(36864==q){fa=fa&d|d&3;3==(fa&3)&&a();break a}if(40960==q){U=d;break a}}16384<=q||(q=N(q),-1!=q.addr&&SAER.ide.ide_write_reg(Da[q.unit],q.addr,d))}}function m(b){var a=N(b);
return 0==a.addr?SAER.ide.ide_get_data(Da[a.unit]):E(b)<<8|E(b+1)}function pa(b,a){var d=N(b);0==d.addr?SAER.ide.ide_put_data(Da[d.unit],a):(K(b,a>>8),K(b+1,a&255))}function ja(b){var a=0;if(4096==(b&65535)){if(0==Ga||1==Ga||3==Ga||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&7==Ga)a=128;Ga++}return a}function G(b){return ja(b)<<8|ja(b+1)}function bb(b,a){var d=0;b&=65535;var q=b&3,h=b>>6&3;4098==b&&0<=SAEV_config.chipset.fatGaryRev&&(zb++,zb&=7,d=SAEV_config.chipset.fatGaryRev<<zb&128);
for(;;){if(1==h&&3==q){0<=SAEV_config.chipset.ramseyRev&&(d=SAEV_config.chipset.ramseyRev);break}if(0==h&&3==q){0<=SAEV_config.chipset.ramseyRev&&(d=pb);break}if(3==q){d=255;break}2==q&&0<=SAEV_config.chipset.fatGaryRev&&(d=Pa?128:0);1==q&&0<=SAEV_config.chipset.fatGaryRev&&(d=SAEV_MBRes_gary_toenb?128:0);0==q&&0<=SAEV_config.chipset.fatGaryRev&&(d=SAEV_MBRes_gary_timeout?128:0);d|=127;break}SAEF_log("gayle.mbres_read(%08x, %d) %08x, PC %x, S %d",b,a,d,SAER_CPU_getPC(),SAER_CPU_regs.s?1:0);return d}
function kb(b,a,d){b&=65535;SAEF_log("gayle.mbres_write(%08x, %08x, %d) PC %x, S %d",b,a,d,SAER_CPU_getPC(),SAER_CPU_regs.s?1:0);32768>b&&(d=b&3,4098==b&&(zb=-1),0==(b>>6&3)&&3==d&&(pb=a),2==d&&(Pa=a&128?1:0),1==d&&(SAEV_MBRes_gary_toenb=a&128?1:0),0==d&&(SAEV_MBRes_gary_timeout=a&128?1:0))}function ua(b){return bb(b,2)}function y(b,a){kb(b,a,2)}function Oa(b,a){b&=524287;if(131072>b||262144<=b)return{reg:-1,unit:-1};b-=131072;65536<=b&&(b=b&-65537|1);var d=4;Da[d].ide_drv&&(d=5);var q=-1;if(1==$a){q=
b&15;if(8>q)return q;q=8==q?0:9==q?0:13==q?1:14==q?1030:15==q?1031:-1}else 2==$a&&(q=496<=b&&503>=b?b-496:1014==b?1030:1015==b?1031:-1);return{reg:q,unit:d}}function T(b){if(0!=ta&&null!==Sa&&!(0<=b&&0==xb[0]&&0==xb[1]&&0==xb[2])){0>b&&(Ea=0,Qb=db);if(0<=Ea&&(512<=Math.abs(Ea-b)||512<=Math.abs(Qb-b))){var a=Sa.hfd.ci.blocksize,d=~(a-1)>>>0,q=(Ea&d)>>>0,a=((Qb+a-1&d)>>>0)-q;0<a&&(SAER.hardfile.hdf_write(Sa.hfd,xb.subarray(q),q,a),Qb=Ea=-1)}if(0>Ea||Ea>b)Ea=b;if(0>Qb||Qb<b)Qb=b}}function wa(b){if(!db)return 0;
b=b-2097152&4194303;return b<db?xb[b]:0}function b(b,a){db&&!ka&&(b=b-2097152&4194303,b<db&&xb[b]!=a&&(T(b),xb[b]=a))}function q(b){return(Z(b)<<16|Z(b+2))>>>0}function Z(b){return wa(b)<<8|wa(b+1)}function ea(a,d){b(a,d>>8);b(a+1,d&255)}function Ua(b){b&=524287;if(262144<=b||b>=Za)return 0;if(2==qa){if(512<=b&&b<512+2*nb.length)return nb[b-512>>1];if(0<=$a){var a=Oa(b,1);if(0<=a.reg){var d=Da[a.unit];if(0==a.reg){if(196608<=b)return Ub&255;Ub=SAER.ide.ide_get_data(d);return Ub>>8&255}return SAER.ide.ide_read_reg(d,
a.reg)}}}return za[b>>1]}function r(b,d){b&=524287;if(262144<=b)a();else if(b<Za&&2==qa){if(512<=b&&b<512+2*nb.length){var q=b-512>>1;nb[q]=d;0==q&&(d&128?a():(q=d&63,1!=q&&2!=q?SAEF_warn("gayle.gayle_attr_write() only config index 1 and 2 emulated, attempted to select %d!",q):($a=q,SAEF_log("gayle.gayle_attr_write() PCMCIA IO configured = %02x",d))))}if(0<=$a&&(q=Oa(b,1),0<=q.reg)){var h=Da[q.unit];0==q.reg?196608<=b?Ub=(d&255)<<8:(Ub&=65280,Ub|=d&255,SAER.ide.ide_put_data(h,Ub)):SAER.ide.ide_write_reg(h,
q.reg,d)}}}function R(b){if(2==qa&&0<=$a){var a=Oa(b,2);if(0==a.reg)return Ub=SAER.ide.ide_get_data(Da[a.unit])}return Ua(b)<<8|Ua(b+1)}function Fa(b,a){if(2==qa&&0<=$a){var d=Oa(b,2);if(0==d.reg){Ub=a;SAER.ide.ide_put_data(Da[d.unit],Ub);return}}r(b,a>>8);r(b+1,a&255)}function Lb(b,a,d){var q=d.length;b.set(SAEF_String2Array(d,0,q),a);b[a+q]=0;return q+1}function t(b,a,d,q,t,f){if(!SAEV_config.chipset.pcmcia)return 0;tb(t);null===Sa&&(Sa=new SAEO_Hardfile_Data_HD);Sa.hfd.handle_valid||(t=!0);Sa.hfd.ci.file.name=
b;Sa.hfd.ci.file.size=a.length;Sa.hfd.ci.file.data=a;Sa.hfd.ci.readonly=d;Sa.hfd.ci.blocksize=512;if(1==q){if(t?b.length&&SAER.hardfile.hdf_hd_open(Sa):Sa.hfd.drive_empty=!1,Sa.hfd.ci.readonly&&(d=!0),db=0,ka=d,Za=256,za=new Uint8Array(Za),qa=q,!Sa.hfd.drive_empty){db=Sa.hfd.virtsize;4194304<Sa.hfd.virtsize&&(SAEF_warn("gayle.initpcmcia() PCMCIA SRAM: too large device (%d bytes)",Sa.hfd.virtsize),db=4194304);xb=new Uint8Array(db);SAEF_log("gayle.initpcmcia() PCMCIA SRAM: '%s' open, size %d",b,db);
SAER.hardfile.hdf_read(Sa.hfd,xb,0,db);ta=1;b=db;a=za;t=q=0;f=512;for(var r=16384;b>r;)r*=4,f*=4,t++;f=31-Math.floor((r-b)/f);a[q++]=1;a[q++]=3;a[q++]=(d?8:0)|100;a[q++]=f<<3|t;a[q++]=255;a[q++]=30;a[q++]=7;a[q++]=2;a[q++]=0;a[q++]=1;a[q++]=1;a[q++]=1;a[q++]=1;a[q++]=255;a[q++]=21;d=q++;a[q++]=4;a[q++]=1;q+=Lb(a,q,"UAE");q+=Lb(a,q,"68000");q+=Lb(a,q,sprintf("Generic Emulated %dKB PCMCIA SRAM Card",b>>10));a[q++]=255;a[d]=q-d-1;a[q++]=33;a[q++]=2;a[q++]=1;a[q++]=0;a[q++]=32;a[q++]=4;a[q++]=255;a[q++]=
255;a[q++]=1;a[q++]=1;a[q++]=255;na&1||(SAER.gayle.map_pcmcia(),h(1))}}else 2==q&&(t&&b.length&&SAER.ide.add_ide_unit(Da,6,4,f,null),SAER.ide.ide_initialize(Da,2),db=0,ka=f.readonly,Za=262144,za=new Uint8Array(Za),qa=q,SAEF_log("gayle.initpcmcia() PCMCIA IDE: '%s' open",b),ta=1,d=za,b=0,d[b++]=1,d[b++]=4,d[b++]=223,d[b++]=74,d[b++]=1,d[b++]=255,d[b++]=28,d[b++]=4,d[b++]=2,d[b++]=217,d[b++]=1,d[b++]=255,d[b++]=24,d[b++]=2,d[b++]=223,d[b++]=1,d[b++]=21,a=b++,d[b++]=4,d[b++]=1,b+=Lb(d,b,"UAE"),b+=Lb(d,
b,"68000"),b+=Lb(d,b,"Generic Emulated PCMCIA IDE"),d[b++]=255,d[a]=b-a-1,d[b++]=33,d[b++]=2,d[b++]=4,d[b++]=1,d[b++]=34,d[b++]=2,d[b++]=1,d[b++]=1,d[b++]=34,d[b++]=3,d[b++]=2,d[b++]=12,d[b++]=15,d[b++]=26,d[b++]=5,d[b++]=1,d[b++]=1,d[b++]=0,d[b++]=2,d[b++]=15,d[b++]=27,d[b++]=6,d[b++]=192,d[b++]=1,d[b++]=33,d[b++]=181,d[b++]=30,d[b++]=77,d[b++]=20,d[b++]=0,d[b]=255,na&1||(SAER.gayle.map_pcmcia(),h(1)));Qb=Ea=-1;return 1}function tb(b){SAEF_log("gayle.freepcmcia() reset %d",b?1:0);null!==Sa&&(T(-1),
b?(SAER.hardfile.hdf_hd_close(Sa),Sa=null):Sa.hfd.drive_empty=!0);SAER.ide.remove_ide_unit(Da,4);ta&&J(64,0);a();ta=0;za=xb=null;na=wb=Za=db=0;return 1}for(var Da=Array(6),sb=0;6>sb;sb++)Da[sb]=null;var Sa=null,ta=0,ka=!1,qa=0,nb=new Uint8Array(20),$a=0,Ga=0,fa=0,U=0,na=0,Xb=0,wb=0,L=0,mb=0;this.rethink=function(){var b=0,a=0,q;if(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000)fa|=d(),fa&128&&!(SAEV_Custom_intreq&8)&&SAER.custom.INTREQ_0(32776);else if(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200||
SAEV_config.chipset.pcmcia)fa|=d(),fa|=f(),q=U&fa,q&136&&(b=1),q&64&&(a=1),q&48&&(U&2?a=1:b=1),q&4&&(U&1?a=1:b=1),!b||SAEV_Custom_intreq&8||SAER.custom.INTREQ_0(32776),!a||SAEV_Custom_intreq&8192||SAER.custom.INTREQ_0(40960)};this.hsync=function(){(SAER.ide.ide_interrupt_hsync(Da[0])||SAER.ide.ide_interrupt_hsync(Da[2])||SAER.ide.ide_interrupt_hsync(Da[4]))&&this.rethink()};this.gayle_dataflyer_enable=function(b){b||(mb=0)};SAEV_Gayle_bank=new SAEO_Memory_addrbank(function(b){var a=N(b);return 0==
a.addr?(b=Da[a.unit],(SAER.ide.ide_get_data(b)<<16|SAER.ide.ide_get_data(b))>>>0):(m(b)<<16|m(b+2))>>>0},m,function(b){return E(b)},function(b,a){var d=N(b);0==d.addr?(d=Da[d.unit],SAER.ide.ide_put_data(d,a>>>16),SAER.ide.ide_put_data(d,a&65535)):(pa(b,a>>>16),pa(b+2,a&65535))},pa,function(b,a){K(b,a)},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Gayle (low)",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO);SAEV_Gayle2_bank=new SAEO_Memory_addrbank(function(b){return(G(b)<<
16|G(b+2))>>>0},G,function(b){return ja(b)},function(b,a){Ga=Ga=Ga=Ga=0},function(b,a){Ga=Ga=0},function(b,a){Ga=0},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Gayle (high)",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO);var pb=0,zb=0,Pa=0,sb=new SAEO_Memory_addrbank(function(b){return(ua(b)<<16|ua(b+2))>>>0},ua,function(b){return bb(b,1)},function(b,a){y(b,a>>>16);y(b+2,a&65535)},y,function(b,a){kb(b,a,1)},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,
null,null,"Motherboard Resources",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO);SAEV_MBRes_bank=new SAEO_Memory_addrbank(SAEF_Memory_subBankGet32,SAEF_Memory_subBankGet16,SAEF_Memory_subBankGet8,SAEF_Memory_subBankPut32,SAEF_Memory_subBankPut16,SAEF_Memory_subBankPut8,SAEF_Memory_subBankXLate,SAEF_Memory_subBankCheck,null,null,"Motherboard Resources",SAEF_Memory_subBankGetInst32,SAEF_Memory_subBankGetInst16,SAEC_Memory_addrbank_flag_IO,[new SAEO_Memory_addrbank_sub(sb,
0),new SAEO_Memory_addrbank_sub(SAEV_Memory_dummyBank,32768),new SAEO_Memory_addrbank_sub(null,0)]);var db=0,Za=0,xb=null,za=null,Ea=0,Qb=0,Ub=0,sc=new SAEO_Memory_addrbank(q,Z,function(b){return wa(b)},function(b,a){ea(b,a>>>16);ea(b+2,a&65535)},ea,function(a,d){b(a,d)},function(b){return b=b-2097152&4194303},function(b,a){if(!db)return 0;b=b-2097152&4194303;return 4194304>=b+a},null,null,"Gayle PCMCIA Common",q,Z,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_SAFE),Dc=new SAEO_Memory_addrbank(function(b){return(R(b)<<
16|R(b+2))>>>0},R,function(b){return Ua(b)},function(b,a){Fa(b,a>>>16);Fa(b+2,a&65535)},Fa,function(b,a){r(b,a)},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Gayle PCMCIA Attribute/Misc",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_SAFE);this.map_pcmcia=function(){SAEV_config.chipset.pcmcia&&(0==ta||na&1?(SAER.memory.map_banks_cond(SAEV_Memory_dummyBank,160,8,0),4194304>=SAEV_config.memory.chipSize&&4194304>=SAER.memory.getz2endaddr()&&
SAER.memory.map_banks_cond(SAEV_Memory_dummyBank,96,64,0)):(SAER.memory.map_banks_cond(Dc,160,8,0),4194304>=SAEV_config.memory.chipSize&&4194304>=SAER.memory.getz2endaddr()&&SAER.memory.map_banks_cond(sc,96,64,0)))};this.free_units=function(){for(var b=0;6>b;b++)SAER.ide.remove_ide_unit(Da,b);tb(!0)};this.gayle_add_ide_unit=function(b,a){return 4<=b?-1:null===SAER.ide.add_ide_unit(Da,6,b,a,null)?0:1};this.gayle_add_pcmcia_sram_unit=function(b){return t(b.file.name,b.file.data,b.readonly,1,!0,null)};
this.gayle_add_pcmcia_ide_unit=function(b){return t(b.file.name,b.file.data,!1,2,!0,b)};this.gayle_modify_pcmcia_sram_unit=function(b,a){return a?t(b.file.name,b.file.data,b.readonly,1,null===Sa,null):tb(!1)};this.gayle_modify_pcmcia_ide_unit=function(b,a){return a?t(b.file.name,b.file.data,!1,2,null===Sa,b):tb(!1)};this.cleanup=function(){};this.reset=function(b){SAER.ide.alloc_ide_mem(Da,6,null);SAER.ide.ide_initialize(Da,0);SAER.ide.ide_initialize(Da,1);L=0;if(SAER.ide.ide_isdrive(Da[2])||SAER.ide.ide_isdrive(Da[3]))L=
1,SAEF_log("gayle.initide() IDE splitter enabled");fa=U=0;b&&(pb=0,Pa=1,SAEV_MBRes_gary_toenb=SAEV_MBRes_gary_timeout=0);b="Gayle (low)";SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000&&(b="A4000 IDE");SAEV_Gayle_bank.name=b;this.gayle_dataflyer_enable(!1)}};function SAEO_IDE_threadState(){this.idetable=null;this.state=this.idetotal=0;this.requests=new smp_comm_pipe}
function SAEO_IDE(){function a(){this.ide_status=this.ide_feat2=this.ide_hcyl2=this.ide_lcyl2=this.ide_sector2=this.ide_nsector2=this.ide_feat=this.ide_error=this.ide_devcon=this.ide_hcyl=this.ide_lcyl=this.ide_sector=this.ide_nsector=this.ide_select=0}function f(){this.hdhfd=new SAEO_Hardfile_Data_HD;this.regs=new a;this.its=this.pair=this.regs1=this.regs0=null;this.byteswap=!1;this.byteswapped_buffer=0;this.adide=!1;this.secbuf=null;this.direction=this.data_multi=this.data_size=this.data_offset=
this.buffer_offset=this.secbuf_size=0;this.lba48cmd=this.lba48=this.intdrq=!1;this.irq=this.irq_delay=this.multiple_mode=this.start_nsec=this.start_lba=0;this.irq_new=!1;this.media_type=this.ide_drv=this.ata_level=this.maxtransferstate=this.blocksize=this.num=0;this.atapi_drdy=this.atapi=this.mode_8bit=!1;this.packet_transfer_size=this.packet_data_offset=this.packet_data_size=this.packet_state=this.cd_unit_num=0}function d(b,a,d){b.byteswap&&(d=d<<8&65535|d>>8);b.adide&&(d=SAER.ide.adide_decode_word(d));
b.secbuf[2*a+0]=d&255;b.secbuf[2*a+1]=d>>8}function J(b,a,d,h){for(var f=d.length,r=0;r<h;r+=2){var m=" ";r<f&&(m=d.charCodeAt(r));var T=" ";r+1<f&&(T=d.charCodeAt(r+1));m|=T<<8;b.byteswap&&(m=m<<8&65535|m>>8);b.adide&&(m=SAER.ide.adide_decode_word(m));b.secbuf[2*a+0]=m>>8;b.secbuf[2*a+1]=m&255;a++}}function h(b,a){if(!(b.secbuf_size>=a)){var d=b.secbuf,h=b.secbuf_size;b.secbuf_size=a+16384;b.secbuf=new Uint8Array(b.secbuf_size);h&&(b.secbuf.set(d),SAEF_log("ide.ide_grow_buffer() IDE%d buffer %d -> %d",
b.num,h,b.secbuf_size))}}function N(b){b.regs.ide_status|=128;b.regs.ide_status&=-9;b.irq_delay=2}function I(b){b.regs.ide_status|=128;b.regs.ide_status&=-9;b.irq_delay=1}function E(b,a){b.regs.ide_error|=a;1!=b.ide_drv||SAER.ide.ide_isdrive(b.pair)||(b.pair.regs.ide_status|=1);b.regs.ide_status|=1;N(b)}function K(b){SAEF_memset(b.secbuf,0,0,b.blocksize);b.data_offset=0;b.data_size=b.blocksize;b.data_multi=1;b.intdrq=!0;N(b)}function m(b){var a;a="";var h=b.atapi;a=0<b.media_type;SAER.ide.ide_isdrive(b)?
(SAEF_memset(b.secbuf,0,0,b.blocksize),b.byteswapped_buffer=1,K(b),b.direction=0,d(b,0,h?34240:a?33930:64),d(b,1,b.hdhfd.cyls_def),d(b,2,51255),d(b,3,b.hdhfd.heads_def),d(b,4,b.blocksize*b.hdhfd.secspertrack_def),d(b,5,b.blocksize),d(b,6,b.hdhfd.secspertrack_def),J(b,10,"68000",20),d(b,20,3),d(b,21,b.blocksize),d(b,22,4),J(b,23,"0.7",8),a=b.atapi?"UAE-ATAPI":sprintf("UAE-IDE %s",b.hdhfd.hfd.product_id),J(b,27,a,40),d(b,47,128>>b.blocksize/512-1),d(b,48,1),d(b,49,768),d(b,51,512),d(b,52,512),d(b,53,
7),d(b,54,b.hdhfd.cyls),d(b,55,b.hdhfd.heads),d(b,56,b.hdhfd.secspertrack),a=b.hdhfd.cyls*b.hdhfd.heads*b.hdhfd.secspertrack,d(b,57,a&65535),d(b,58,a>>>16),a=b.multiple_mode,d(b,59,(0<a?256:0)|a),a=b.blocksize?Math.floor(b.hdhfd.size/b.blocksize):0,268435455<a&&(a=268435455),d(b,60,a&65535),d(b,61,a>>>16),d(b,62,15),d(b,63,15),b.ata_level&&(d(b,64,b.ata_level?3:0),d(b,65,120),d(b,66,120),d(b,67,120),d(b,68,120),d(b,80,126),d(b,81,28),d(b,82,16384|(h?20:0)),d(b,83,28672|(b.lba48?1024:0)),d(b,84,16384),
d(b,85,16384),d(b,86,28672|(b.lba48?1024:0)),d(b,87,16384),d(b,88,63),d(b,93,24577),b.lba48&&(a=Math.floor(b.hdhfd.size/b.blocksize),h=Math.floor(a/4294967296),a%=4294967296,d(b,100,a&65535),d(b,101,a>>>16),d(b,102,h&65535),d(b,103,h>>>16)))):E(b,4)}function pa(b){b.atapi?(b.regs.ide_sector=1,b.regs.ide_nsector=1,b.regs.ide_lcyl=20,b.regs.ide_hcyl=235,b.regs.ide_status=0,b.atapi_drdy=!1):(b.regs.ide_nsector=1,b.regs.ide_sector=1,b.regs.ide_lcyl=0,b.regs.ide_hcyl=0,b.regs.ide_status=0);b.regs.ide_error=
1;b.packet_state=0}function ja(b,a){pa(b);a&&pa(b.pair);a?N(b):b.regs.ide_status&=-129}function G(b){return b.lba48&&b.lba48cmd?0==b.regs.ide_nsector&&0==b.regs.ide_nsector2?65536:b.regs.ide_nsector2<<8|b.regs.ide_nsector:0==b.regs.ide_nsector?256:b.regs.ide_nsector}function bb(b,a){b.lba48&&b.lba48cmd&&b.regs.ide_select&64?a.lba=16777216*(b.regs.ide_hcyl2<<16|b.regs.ide_lcyl2<<8|b.regs.ide_sector2)+(b.regs.ide_hcyl<<16|b.regs.ide_lcyl<<8|b.regs.ide_sector):b.regs.ide_select&64?a.lba=((b.regs.ide_select&
15)<<24|b.regs.ide_hcyl<<16|b.regs.ide_lcyl<<8|b.regs.ide_sector)>>>0:(a.cyl=b.regs.ide_hcyl<<8|b.regs.ide_lcyl,a.head=b.regs.ide_select&15,a.sec=b.regs.ide_sector,a.lba=(a.cyl*b.hdhfd.heads+a.head)*b.hdhfd.secspertrack+a.sec-1)}function kb(b,a){1==a?2>b.maxtransferstate&&0==b.regs.ide_nsector?b.maxtransferstate=1:(2==b.maxtransferstate&&SAEF_log("ide.check_maxtransfer() maxtransfer check detected split >256 block transfer"),b.maxtransferstate=0):2==a&&(1==b.maxtransferstate?b.maxtransferstate++:
b.maxtransferstate=0)}function ua(b){b.regs.ide_status|=128;b.regs.ide_status&=-9}function y(b){var a={};b.data_offset=0;var d=G(b);bb(b,a);d*b.blocksize>b.hdhfd.size-a.lba*b.blocksize&&(d=Math.truncate((b.hdhfd.size-a.lba*b.blocksize)/b.blocksize));if(0>=d)K(b),E(b,16);else{var f=d;h(b,f*b.blocksize);d>b.data_multi&&(d=b.data_multi);0==b.buffer_offset&&(b.start_lba=a.lba,b.start_nsec=f);b.direction||0==b.buffer_offset&&SAER.hardfile.hdf_read(b.hdhfd.hfd,b.secbuf,b.start_lba*b.blocksize,b.start_nsec*
b.blocksize);b.intdrq=!0;f=d;if(b.lba48&&b.lba48cmd){var m=b.regs.ide_nsector2<<8|b.regs.ide_nsector,m=m-f;0>m&&(m+=65536);b.regs.ide_nsector2=m>>8;b.regs.ide_nsector=m&255;f=m}else b.regs.ide_nsector-=f,0>b.regs.ide_nsector&&(b.regs.ide_nsector+=256),f=b.regs.ide_nsector;f=0==f;if(b.ata_level!=SAEC_Config_Mount_Controller_Level_ATA_2S||!f){var m=a.lba,r=a.cyl,T=a.head,a=a.sec,d=f?d-1:d;if(b.lba48&&b.lba48cmd)m+=d,d=m%16777216,a=Math.floor(m/16777216),b.regs.ide_hcyl=d>>>16&255,b.regs.ide_lcyl=d>>>
8&255,b.regs.ide_sector=d&255,b.regs.ide_hcyl2=a>>>16&255,b.regs.ide_lcyl2=a>>>8&255,b.regs.ide_sector2=a&255;else if(b.regs.ide_select&64)m+=d,b.regs.ide_select&=-16,b.regs.ide_select|=m>>>24&15,b.regs.ide_hcyl=m>>>16&255,b.regs.ide_lcyl=m>>>8&255,b.regs.ide_sector=m&255;else{for(a+=d;a>=b.hdhfd.secspertrack;)a-=b.hdhfd.secspertrack,T++,T>=b.hdhfd.heads&&(T-=b.hdhfd.heads,r++);b.regs.ide_select&=-16;b.regs.ide_select|=T;b.regs.ide_sector=a;b.regs.ide_hcyl=r>>8;b.regs.ide_lcyl=r&255}}f&&b.direction&&
(b.intdrq=!1,SAER.hardfile.hdf_write(b.hdhfd.hfd,b.secbuf,b.start_lba*b.blocksize,b.start_nsec*b.blocksize));b.direction?f?I(b):b.irq_delay=1:0==b.buffer_offset?I(b):b.irq_delay=1}}function Oa(b,a){var d={},h=a&1;b.lba48cmd=0!=(a&2);if(h&&0==b.multiple_mode)E(b,4);else{kb(b,1);SAER.gui.flicker_led(SAEC_GUI_LED_HD,b.num,1);var f=G(b);bb(b,d);d.lba*b.blocksize>=b.hdhfd.size?(K(b),E(b,16)):a&4?N(b):(b.data_multi=h?b.multiple_mode:1,b.data_offset=0,b.data_size=f*b.blocksize,b.direction=0,b.buffer_offset=
0,ua(b),y(b))}}function T(b,a){var d={},h=a&1;b.lba48cmd=0!=(a&2);h&&0==b.multiple_mode?E(b,4):(kb(b,1),SAER.gui.flicker_led(SAEC_GUI_LED_HD,b.num,2),nsec=G(b),bb(b,d),d.lba*b.blocksize>=b.hdhfd.size?(K(b),E(b,16)):(nsec*b.blocksize>b.hdhfd.size-d.lba*b.blocksize&&(nsec=Math.truncate((b.hdhfd.size-d.lba*b.blocksize)/b.blocksize)),0>=nsec?(K(b),E(b,16)):(b.data_multi=h?b.multiple_mode:1,b.data_offset=0,b.data_size=nsec*b.blocksize,b.direction=1,b.buffer_offset=0,b.regs.ide_status|=8,b.regs.ide_status&=
-129)))}function wa(b,a,d){var f=d?2:1;0!=b.data_size&&(h(b,b.packet_data_offset+b.data_offset+2),b.packet_state?d?(b.secbuf[b.packet_data_offset+b.data_offset+1]=a&255,b.secbuf[b.packet_data_offset+b.data_offset]=a>>8):b.secbuf[b.packet_data_offset+b.data_offset^1]=a:d?(b.secbuf[b.buffer_offset+b.data_offset+1]=a&255,b.secbuf[b.buffer_offset+b.data_offset]=a>>8):b.secbuf[b.buffer_offset+b.data_offset]=a,b.data_offset+=f,b.data_size-=f,b.packet_state?b.data_offset==b.packet_transfer_size&&(ua(b),
write_comm_pipe_u32(b.its.requests,b.num|128,1)):0==b.data_size?(ua(b),y(b)):0==b.data_offset%b.blocksize&&0==Math.floor(b.data_offset/b.blocksize)%b.data_multi&&(a=b.data_offset,y(b),b.buffer_offset+=a))}this.adide_decode_word=function(b){var a=0;b&32768&&(a|=1);b&1&&(a|=2);b&16384&&(a|=4);b&2&&(a|=8);b&8192&&(a|=16);b&4&&(a|=32);b&4096&&(a|=64);b&8&&(a|=128);b&2048&&(a|=256);b&16&&(a|=512);b&1024&&(a|=1024);b&32&&(a|=2048);b&512&&(a|=4096);b&64&&(a|=8192);b&256&&(a|=16384);b&128&&(a|=32768);return a};
this.adide_encode_word=function(b){var a=0;b&1&&(a|=32768);b&2&&(a|=1);b&4&&(a|=16384);b&8&&(a|=2);b&16&&(a|=8192);b&32&&(a|=4);b&64&&(a|=4096);b&128&&(a|=8);b&256&&(a|=2048);b&512&&(a|=16);b&1024&&(a|=1024);b&2048&&(a|=32);b&4096&&(a|=512);b&8192&&(a|=64);b&16384&&(a|=256);b&32768&&(a|=128);return a};this.ide_isdrive=function(b){return null!==b&&(0!=b.hdhfd.size||b.atapi)};this.ide_interrupt_hsync=function(b){for(var a=!1,d=0;b&&2>d;d++){var h=0==d?b:b.pair;if(h){if(0<h.irq_delay&&(h.irq_delay--,
0==h.irq_delay)){var f=h;f.regs.ide_status&=-9;f.intdrq&&(f.regs.ide_status|=8);f.regs.ide_status&=-129;f.intdrq=!1;f.irq_delay=0;f.regs.ide_devcon&2||(f.irq_new=!0,f.irq=1)}!h.irq||h.regs.ide_devcon&2||(a=!0)}}return a};this.ide_get_data=function(b){var a=!1,d;0==b.data_size?b=SAER.ide.ide_isdrive(b)?0:65535:(b.packet_state?(d=b.secbuf[b.packet_data_offset+b.data_offset]<<8|b.secbuf[b.packet_data_offset+b.data_offset+1],b.data_offset+=2,b.data_size=0>b.data_size?b.data_size+2:b.data_size-2,b.data_offset==
b.packet_transfer_size&&(0==b.data_size?(b.packet_state=0,atapi_data_done(b),a=!0):(ua(b),write_comm_pipe_u32(b.its.requests,b.num|128,1)))):(d=b.secbuf[b.buffer_offset+b.data_offset]<<8|b.secbuf[b.buffer_offset+b.data_offset+1],b.data_offset+=2,0>b.data_size?b.data_size+=2:(b.data_size-=2,0==b.data_offset%b.blocksize&&0==Math.floor(b.data_offset/b.blocksize)%b.data_multi&&b.data_size&&(b.buffer_offset+=b.data_offset,y(b))),0==b.data_size&&(b.regs.ide_status&8||SAEF_warn("ide.ide_get_data_2() IDE%d read finished but DRQ was not active?",
b.num),b.regs.ide_status&=-9)),a&&I(b),b=d);return b};this.ide_put_data=function(b,a){wa(b,a,1)};this.ide_put_data_8bit=function(b,a){wa(b,a,0)};this.ide_read_reg=function(b,a){var d=this.ide_isdrive(b),h=0;if(null===b)return SAEF_warn("ide.ide_read_reg() no handle"),h;b.regs.ide_status&128&&(a=7);if(!this.ide_isdrive(b))return 7==a?(b.pair.irq&&(b.pair.irq=0),h=this.ide_isdrive(b.pair)?1:255):h=0,h;switch(a){case 1024:case 1025:case 1026:case 1027:case 1028:case 1029:h=255;break;case 1031:h=((b.ide_drv?
2:1)|(b.regs.ide_select&15)<<2)^255;break;case 1:h=b.regs.ide_error;break;case 2:d&&(h=b.regs.ide_devcon&128?b.regs.ide_nsector2:b.regs.ide_nsector);break;case 3:d&&(h=b.regs.ide_devcon&128?b.regs.ide_sector2:b.regs.ide_sector,kb(b,2));break;case 4:d&&(h=b.regs.ide_devcon&128?b.regs.ide_lcyl2:b.regs.ide_lcyl);break;case 5:d&&(h=b.regs.ide_devcon&128?b.regs.ide_hcyl2:b.regs.ide_hcyl);break;case 6:h=b.regs.ide_select;break;case 7:b.irq=0,b.irq_new=!1;case 1030:if(d){if(h=b.regs.ide_status,!b.atapi||
b.atapi&&b.atapi_drdy)h|=80}else h=0,b.regs.ide_error&&(h|=1)}return h};this.ide_write_reg=function(b,a,d){if(null===b)SAEF_warn("ide.ide_write_reg() no handle");else switch(b.regs1.ide_devcon&=-129,b.regs0.ide_devcon&=-129,a){case 1030:0==(b.regs.ide_devcon&4)&&0!=(d&4)&&(pa(b),pa(b.pair));b.regs0.ide_devcon=d;b.regs1.ide_devcon=d;break;case 1:b.regs0.ide_feat2=b.regs0.ide_feat;b.regs0.ide_feat=d;b.regs1.ide_feat2=b.regs1.ide_feat;b.regs1.ide_feat=d;break;case 2:b.regs0.ide_nsector2=b.regs0.ide_nsector;
b.regs0.ide_nsector=d;b.regs1.ide_nsector2=b.regs1.ide_nsector;b.regs1.ide_nsector=d;break;case 3:b.regs0.ide_sector2=b.regs0.ide_sector;b.regs0.ide_sector=d;b.regs1.ide_sector2=b.regs1.ide_sector;b.regs1.ide_sector=d;break;case 4:b.regs0.ide_lcyl2=b.regs0.ide_lcyl;b.regs0.ide_lcyl=d;b.regs1.ide_lcyl2=b.regs1.ide_lcyl;b.regs1.ide_lcyl=d;break;case 5:b.regs0.ide_hcyl2=b.regs0.ide_hcyl;b.regs0.ide_hcyl=d;b.regs1.ide_hcyl2=b.regs1.ide_hcyl;b.regs1.ide_hcyl=d;break;case 6:b.regs0.ide_select=d;b.regs1.ide_select=
d;b.pair.ide_drv=b.ide_drv=d&16?1:0;break;case 7:if(b.irq=0,b.irq_new=!1,this.ide_isdrive(b))if(b.regs.ide_status|=128,a=b.lba48,b.regs.ide_status&=-74,b.regs.ide_error=0,b.intdrq=!1,b.lba48cmd=!1,b.byteswapped_buffer=0,b.atapi)b.atapi_drdy=!0,0==d?N(b):8==d?ja(b,!0):161==d?m(b):160==d?atapi_packet(b):144==d?ja(b,!0):(ja(b,!1),b.atapi_drdy=!1,E(b,4),SAEF_warn("ide.ide_do_command() IDE%d: unknown ATAPI command 0x%02x",b.num,d));else if(16==d)SAEF_log("ide.ide_recalibrate() IDE%d recalibrate",b.num),
b.regs.ide_sector=0,b.regs.ide_lcyl=b.regs.ide_hcyl=0,N(b);else if(236==d)m(b);else if(144==d)ja(b,!0);else if(145==d){d=b.hdhfd;if(d.size){if(d.secspertrack=0==b.regs.ide_nsector?256:b.regs.ide_nsector,d.heads=(b.regs.ide_select&15)+1,d.cyls=d.hfd.ci.pcyls?d.hfd.ci.pcyls:Math.floor(Math.floor(d.size/b.blocksize)/(d.secspertrack*d.heads)),16515072<d.heads*d.cyls*d.secspertrack||b.lba48)d.cyls=d.hfd.ci.pcyls?d.hfd.ci.pcyls:d.cyls_def,d.heads=d.heads_def,d.secspertrack=d.secspertrack_def}else b.regs.ide_error|=
4,b.regs.ide_status|=1;SAEF_log("ide.ide_initialize_drive_parameters() IDE%d initialize drive parameters, CYL=%d,SPT=%d,HEAD=%d",b.num,d.cyls,d.secspertrack,d.heads);N(b)}else if(198==d)SAEF_log("ide.ide_set_multiple_mode() IDE%d drive multiple mode = %d",b.num,b.regs.ide_nsector),b.multiple_mode=b.regs.ide_nsector,N(b);else if(32==d||33==d)Oa(b,0);else if(64==d||65==d)Oa(b,4);else if(36==d&&a)Oa(b,2);else if(196==d)Oa(b,1);else if(41==d&&a)Oa(b,3);else if(48==d||49==d)T(b,0);else if(52==d&&a)T(b,
2);else if(197==d)T(b,1);else if(57==d&&a)T(b,3);else if(80==d)N(b);else if(239==d)switch(SAEF_log("ide.ide_set_features() IDE%d set features %02X (%02X)",b.num,b.regs.ide_feat,b.regs.ide_nsector),b.regs.ide_feat){case 1:b.mode_8bit=!0;N(b);break;case 129:b.mode_8bit=!1;N(b);break;case 2:case 130:N(b);break;default:E(b,4)}else 0==d?E(b,4):112==d?N(b):224==d||225==d||231==d||234==d?N(b):229==d?(b.regs.ide_nsector=255,N(b)):(E(b,4),SAEF_warn("ide.ide_do_command() IDE%d: unknown ATA command 0x%02x",
b.num,d))}};this.ide_thread=function(b){var a=!1,d=read_comm_pipe_u32_blocking(b.requests);d&&SAEF_log("ide.ide_thread() unit 0x%08x",d);if(0==b.state||268435455==d)SAEF_log("ide.ide_thread() QUIT"),a=!0;else{var h=b.idetable[d&127];SAER.ide.ide_isdrive(h)&&(d&128?do_process_packet_command(h):y(h))}if(a)return b.state=-1,0;setTimeout(function(){SAER.ide.ide_thread(b)},10)};this.start_ide_thread=function(b){b.state||(SAEF_log("ide.start_ide_thread() state %d",b.state),b.state=1,init_comm_pipe(b.requests,
100,1),setTimeout(function(){SAER.ide.ide_thread(b)},0))};this.stop_ide_thread=function(b){0<b.state&&(SAEF_log("ide.stop_ide_thread() state %d",b.state),b.state=0,write_comm_pipe_u32(b.requests,4294967295,1),b.state=0)};this.ide_initialize=function(b,a){var d=b[2*a+0],h=b[2*a+1];d.regs0=d.regs;d.regs1=h.regs;d.pair=h;h.regs1=h.regs;h.regs0=d.regs;h.pair=d;d.num=2*a+0;h.num=2*a+1;pa(d);pa(d.pair)};this.alloc_ide_mem=function(b,a,d){for(var m=0;m<a;m++){var T;null===b[m]&&(T=b[m]=new f,T.cd_unit_num=
-1);T=b[m];h(T,1024);null!==d&&(T.its=d)}};this.add_ide_unit=function(b,a,d,h,f){this.alloc_ide_mem(b,a,null);if(0>d)return null;b=b[d];null!==h&&(b.hdhfd.hfd.ci=h.clone());if(!SAER.hardfile.hdf_hd_open(b.hdhfd))return null;b.blocksize=b.hdhfd.hfd.ci.blocksize;b.lba48=b.hdhfd.hfd.ci.unit_special_flags&1||137438953472<=b.hdhfd.size?1:0;SAER.gui.flicker_led(SAEC_GUI_LED_HD,d,-1);b.cd_unit_num=-1;b.media_type=h.controller_media_type;b.ata_level=h.unit_feature_level;b.ata_level==SAEC_Config_Mount_Controller_Level_ATA_1&&
(4294967296<=b.hdhfd.size||b.media_type)&&(b.ata_level=SAEC_Config_Mount_Controller_Level_ATA_2);SAEF_log("ide.add_ide_unit() IDE%d HD '%s', LCHS=%d/%d/%d. PCHS=%d/%d/%d %dM. LBA48=%d",d,b.hdhfd.hfd.ci.file.name,b.hdhfd.cyls,b.hdhfd.heads,b.hdhfd.secspertrack,b.hdhfd.hfd.ci.pcyls,b.hdhfd.hfd.ci.pheads,b.hdhfd.hfd.ci.psecs,Math.floor(b.hdhfd.size/1048576),b.lba48);b.regs.ide_status=0;b.data_offset=0;b.data_size=0;return b};this.remove_ide_unit=function(b,a){if(null!==b){var d=b[a];d&&(SAER.hardfile.hdf_hd_close(d.hdhfd),
d.its=d.its)}}};function SAEO_Filesys(){this.uci_set_defaults=function(a,f){a.controller_type=SAEC_Config_Mount_Controller_Type_MB_IDE;a.controller_unit=0;a.controller_media_type=0;a.unit_feature_level=SAEC_Config_Mount_Controller_Level_ATA_2;a.unit_special_flags=0;a.readonly=!1;a.blocksize=512;a.cyls=0;f||(a.surfaces=1,a.sectors=32);a.bootable=!0;a.automount=!0;a.unit=0;a.flags=0;a.devname="";a.sectorsperblock=1;f||(a.reserved=2);a.interleave=!1;a.lowcyl=0;a.highcyl=0;a.buffers=50;a.bufmemtype=1;a.maxtransfer=2147483647;
a.mask=4294967295;a.bootpri=0;a.dostype=1146049281;a.filesys="";a.stacksize=4E3;a.priority=-129};this.start_threads=function(){};this.cleanup=function(){SAER.gayle.free_units()};this.reset=function(){SAER.gayle.free_units();0!=SAEV_config.chipset.ide&&(SAEF_log("filesys.add_mainboard_unit_init() Initializing mainboard IDE"),SAER.gayle.gayle_add_ide_unit(-1,null));for(var a=0;6>a;a++){var f=SAEV_config.mount.config[a].ci,d=f.controller_type,J=f.controller_unit,h=!1;0!=d&&0!=f.file.size&&(d==SAEC_Config_Mount_Controller_Type_MB_IDE?
(h=!1,d==SAEC_Config_Mount_Controller_Type_MB_IDE&&0!=SAEV_config.chipset.ide&&(SAEF_log("filesys.add_ide_unit() Adding mainboard IDE %s unit %d ('%s')","HD",J,f.file.name),SAER.gayle.gayle_add_ide_unit(J,f),h=!0)):d==SAEC_Config_Mount_Controller_Type_PCMCIA_SRAM?(SAER.gayle.gayle_add_pcmcia_sram_unit(f),h=!0):d==SAEC_Config_Mount_Controller_Type_PCMCIA_IDE&&(SAER.gayle.gayle_add_pcmcia_ide_unit(f),h=!0),h&&(d=SAEV_config.mount.config[a],d.configoffset=-1,d.unitnum=-1))}};this.prepare_reset=function(){}}
;function SAEO_Hardfile_Data(){this.offset=this.physsize=this.virtsize=0;this.ci=new SAEO_Config_Mount_Info;this.handle=null;this.handle_valid=0;this.cache=null;this.cache_offset=this.cache_valid=0;this.product_rev=this.product_id=this.vendor_id="";this.virtual_rdb=null;this.virtual_size=0;this.adide=this.byteswap=!1;this.hfd_type=0;this.vhd_header=null;this.vhd_blocksize=this.vhd_bamsize=this.vhd_bamoffset=0;this.vhd_sectormap=null;this.vhd_footerblock=this.vhd_bitmapsize=this.vhd_sectormapblock=
0;this.drive_empty=!1}function SAEO_Hardfile_Data_HD(){this.hfd=new SAEO_Hardfile_Data;this.ansi_version=this.heads_def=this.secspertrack_def=this.cyls_def=this.secspertrack=this.heads=this.cyls=this.size=0}
function SAEO_Hardfile(){function a(a,d){return(a[d]<<24|a[d+1]<<16|a[d+2]<<8|a[d+3])>>>0}function f(a,d){d<<=2;return(a[d]<<24|a[d+1]<<16|a[d+2]<<8|a[d+3])>>>0}function d(a,d,b){d<<=2;a[d]=b>>>24;a[d+1]=b>>>16&255;a[d+2]=b>>>8&255;a[d+3]=b&255}function J(a,d,b,q){var h=q.length;d<<=2;a[d++]=Math.min(h,b);for(var f=0;f<b;f++)a[d++]=f<h?q.charCodeAt(f):32}function h(a,h){for(var b=0,q=f(a,h+1),m=0;m<q;m++)b+=f(a,h+m),4294967295<b&&(b-=4294967296);b=-b;0>b&&(b+=4294967296);d(a,h+2,b)}function N(d,h){"undefined"==
typeof h&&(h=null);if(null===h){if(0==d.ci.file.size)return 0;h=d.ci.file.clone()}d.byteswap=!1;d.adide=!1;d.hfd_type=0;var b;b=h;d.drive_empty=!1;I(d);d.cache=new Uint8Array(16384);d.cache_valid=0;d.virtual_size=0;d.virtual_rdb=null;d.vendor_id="UAE";d.product_id=b.name.substr(0,Math.min(b.name.length,15));d.product_rev="0.1";SAEF_log("hardfile.hdf_open_target() attempting to open HDF '%s'... (%d bytes)",b.name,b.size);d.handle=new G;d.handle.zf=SAEF_ZFile_fopen_file(b);null===d.handle.zf?(I(d),
b=-1):(SAEF_ZFile_fseek(d.handle.zf,0,SEEK_END),d.physsize=d.virtsize=SAEF_ZFile_ftell(d.handle.zf),SAEF_ZFile_fseek(d.handle.zf,0,SEEK_SET),d.handle_valid=1,SAEF_log("hardfile.hdf_open_target() HDF '%s' opened (size %dK, empty %d)",b.name,Math.floor(d.physsize/1024),d.drive_empty?1:0),b=1);if(0>=b)return b;b=new Uint8Array(512);if(512!=y(d,b,0,0,512))return SAEF_log("hardfile.hdf_open() no VHD-image, file samller than 512 bytes"),d.hfd_type=0,1;var q=a(b,8);if(2!=(q&3))return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file features %d != 2",
q&3),d.hfd_type=0,1;q=a(b,12);if(1!=q>>>16)return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file version %d != 1",q>>>16),d.hfd_type=0,1;d.hfd_type=a(b,60);if(2!=d.hfd_type&&3!=d.hfd_type)return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file type %d",d.hfd_type),d.hfd_type=0,1;q=a(b,64);if(0==q)return SAEF_log("hardfile.hdf_open() no VHD-image, error 1"),d.hfd_type=0,1;var f=E(b,64);if(f!=q)return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file checksum 0x%08x != 0x%08x",f,
q),d.hfd_type=0,1;q=new Uint8Array(512);if(512!=y(d,q,0,d.physsize-q.length,512))return SAEF_warn("hardfile.hdf_open() file read error"),bb(d),0;if(0!=SAEF_CompareArray(b,q))return SAEF_log("hardfile.hdf_open() no VHD-image, error 2"),d.hfd_type=0,1;d.vhd_footerblock=d.physsize-512;d.virtsize=4294967296*a(b,48);d.virtsize+=a(b,52);if(3==d.hfd_type&&(f=!0,d.vhd_bamoffset=a(b,20),0<d.vhd_bamoffset&&d.vhd_bamoffset<d.physsize&&512==y(d,b,0,d.vhd_bamoffset,512)&&(q=a(b,36),E(b,36)==q&&(q=a(b,24),1==q>>>
16&&(d.vhd_blocksize=a(b,32),d.vhd_bamoffset=a(b,20),d.vhd_bamsize=4*Math.floor((d.virtsize+d.vhd_blocksize-1)/d.vhd_blocksize)+511&-512,b=d.vhd_bamoffset+d.vhd_bamsize,d.vhd_header=new Uint8Array(b),y(d,d.vhd_header,0,0,b)==b&&(d.vhd_sectormap=new Uint8Array(512),d.vhd_sectormapblock=-1,d.vhd_bitmapsize=Math.floor(d.vhd_blocksize/4096)+511&-512,f=!1)))),f))return bb(d),0;SAEF_log("hardfile.hdf_open() HDF is VHD %s image, virtual size=%dK (%x %d)",2==d.hfd_type?"fixed":"dynamic",Math.floor(d.virtsize/
1024),d.virtsize,d.virtsize);return 1}function I(a){bb(a);a.hfd_type=0;a.vhd_header=null;a.vhd_sectormap=null}function E(a,d){for(var b=0,q=0;512>q;q++)0<=d&&q>=d&&q<d+4||(b+=a[q],4294967295<b&&(b-=4294967296));return~b>>>0}function K(d,h,b,q){if(3==d.hfd_type){var f=0,m=0;if(!(b&511||q&511))for(;0<q;){var E=a(d.vhd_header,4*Math.floor(b/d.vhd_blocksize)+d.vhd_bamoffset);if(4294967295==E)SAEF_memset(h,f,0,512);else{var r=Math.floor(b/512)%(d.vhd_blocksize>>9),I=Math.floor(r/8),G=512*E+(I&-512);if(d.vhd_sectormapblock!=
G){if(512!=y(d,d.vhd_sectormap,0,G,512)){SAEF_warn("hardfile.vhd_read() bitmap read error");break}d.vhd_sectormapblock=G}if(d.vhd_sectormap[I&511]&1<<7-(r&7)){if(512!=y(d,h,f,512*E+d.vhd_bitmapsize+512*r,512)){SAEF_warn("hardfile.vhd_read() data read error");break}}else SAEF_memset(h,f,0,512)}m+=512;q-=512;f+=512;b+=512}d=m}else d=2==d.hfd_type?y(d,h,0,b+512,q):y(d,h,0,b,q);return d}function m(d,h,b,q){if(3==d.hfd_type){var f=0,m=0;if(!(b&511||q&511))for(;0<q;){var E=4*Math.floor(b/d.vhd_blocksize)+
d.vhd_bamoffset,r=a(d.vhd_header,E);if(4294967295==r){var r=d,I=r.vhd_blocksize+r.vhd_bitmapsize+512,G=r.physsize+I-512;SAEF_ZFile_resize(r.handle.zf,G);r.physsize=G;G=new Uint8Array(I);SAEF_memset(G,0,0,I-512);G.set(r.vhd_header.subarray(0,512),I-512);var J=Oa(r,G,0,r.vhd_footerblock,I);delete G;J!=I?(SAEF_warn("hardfile.vhd_write_enlarge() footer write error"),r=!1):(G=Math.floor(r.vhd_footerblock/512),r.vhd_header[E+0]=G>>>24,r.vhd_header[E+1]=G>>>16&255,r.vhd_header[E+2]=G>>>8&255,r.vhd_header[E+
3]=G&255,Oa(r,r.vhd_header,r.vhd_bamoffset,r.vhd_bamoffset,r.vhd_bamsize)!=r.vhd_bamsize?(SAEF_warn("hardfile.vhd_write_enlarge() bam write error"),r=!1):(r.vhd_footerblock+=I-512,r=!0));if(!r)break}else{E=Math.floor(b/512)%(d.vhd_blocksize>>9);I=Math.floor(E/8);G=512*r+(I&-512);if(d.vhd_sectormapblock!=G){if(512!=y(d,d.vhd_sectormap,0,G,512)){SAEF_warn("hardfile.vhd_write() bitmap read error");break}d.vhd_sectormapblock=G}if(512!=Oa(d,h,f,512*r+d.vhd_bitmapsize+512*E,512)){SAEF_warn("hardfile.vhd_write() data write error");
break}if(!(d.vhd_sectormap[I&511]&1<<7-(E&7))&&(d.vhd_sectormap[I&511]|=1<<7-(E&7),512!=Oa(d,d.vhd_sectormap,0,G,512))){SAEF_warn("hardfile.vhd_write() bam write error");break}m+=512;q-=512;f+=512;b+=512}}d=m}else d=2==d.hfd_type?Oa(d,h,0,b+512,q):Oa(d,h,0,b,q);return d}function pa(a,d){SAEF_warn("hardfile.adide_decode() 0x%04x %d",a,d)}function ja(a,d){SAEF_warn("hardfile.hdf_byteswap() 0x%04x %d",a,d)}function G(){this.zf=null;this.firstwrite=!1}function bb(a){var d=a.handle;null!==d&&null!==d.zf&&
(SAEF_ZFile_fclose(d.zf),d.zf=null);a.handle=null;a.handle_valid=0;a.cache=null;a.cache_valid=0;a.virtual_rdb=null;a.virtual_size=0;a.drive_empty=!1}function kb(a,d){if(0==a.handle_valid)return SAEF_warn("hardfile.hdf_seek() hdf handle is not valid. bug."),-1;if(d>=a.physsize-a.virtual_size)return SAEF_warn("hardfile.hdf_seek() tried to seek out of bounds! (%X >= %X - %X)",d,a.physsize,a.virtual_size),-1;d+=a.offset;return d&a.ci.blocksize-1?(SAEF_warn("hardfile.hdf_seek() fail, offset = %X not aligned to blocksize %d! (%X & %04X = %04X)",
d,a.ci.blocksize,d,a.ci.blocksize,d&a.ci.blocksize-1),-1):0!=SAEF_ZFile_fseek(a.handle.zf,d,SEEK_SET)?(SAEF_warn("hardfile.hdf_seek() common seek error"),-1):0}function ua(a,d){var b=SAEF_ZFile_ftell(a.handle.zf);return 0>d?(SAEF_warn("hardfile.poscheck() fail, negative length! (%d)",d),-1):b<a.offset?(SAEF_warn("hardfile.poscheck() fail, offset out of bounds! (%d < %d)",b,a.offset),-1):b>=a.offset+a.physsize-a.virtual_size||b>=a.offset+a.physsize+d-a.virtual_size?(SAEF_warn("hardfile.poscheck() fail, offset out of bounds! (%d >= %d, LEN=%d)",
b,a.offset+a.physsize,d),-1):b&a.ci.blocksize-1?(SAEF_warn("hardfile.poscheck() fail, offset not aligned to blocksize! (%X & %X = %04X)",b,a.ci.blocksize,b&a.ci.blocksize),-1):0}function y(a,d,b,q,h){var f=0;if(a.drive_empty)return 0;if(q<a.virtual_size){h=q+h<=a.virtual_size?h:a.virtual_size-q;if(!a.virtual_rdb)return 0;d.set(a.virtual_rdb.subarray(q,q+h),b);return h}for(q-=a.virtual_size;0<h;){var m,r;if(16384>a.physsize){a.cache_valid=0;if(-1==kb(a,q)||-1==ua(a,h))return-1;r=SAEF_ZFile_fread(d,
b,1,h,a.handle.zf);m=h}else{m=16384<h?16384:h;r=a;var y=d,E=b,I=q,t=m;0==I&&(r.cache_valid=0);var G=r.cache_valid?I>=r.cache_offset&&I+t<=r.cache_offset+16384?I-r.cache_offset:-1:-1;0<=G?(y.set(r.cache.subarray(G,G+t),E),r=t):(r.cache_offset=I,I+16384>r.offset+(r.physsize-r.virtual_size)&&(r.cache_offset=r.offset+(r.physsize-r.virtual_size)-16384),-1==kb(r,r.cache_offset)||-1==ua(r,16384)?r=-1:(G=SAEF_ZFile_fread(r.cache,0,1,16384,r.handle.zf),r.cache_valid=0,16384!=G?r=0:(r.cache_valid=1,G=r.cache_valid?
I>=r.cache_offset&&I+t<=r.cache_offset+16384?I-r.cache_offset:-1:-1,0<=G?(y.set(r.cache.subarray(G,G+t),E),r=t):(SAEF_error("hardfile.hdf_read_target_2() cache bug! offset %d, len %d",I,t),r=r.cache_valid=0))))}if(0>r)return r;f+=r;if(r!=m)break;q+=m;b+=m;h-=m}return f}function Oa(a,d,b,q,h){var f=0;if(a.drive_empty)return 0;if(q<a.virtual_size)return h;for(q-=a.virtual_size;0<h;){var m=16384<h?16384:h,r;r=a;var y=d,I=b,E=q,t=m;r.ci.readonly?r=0:(r.cache_valid=0,-1==kb(r,E)?r=-1:-1==ua(r,t)?r=-1:
(r.cache.set(y.subarray(I,I+t)),r=SAEF_ZFile_fwrite(r.cache,0,1,t,r.handle.zf)));if(0>r)return r;f+=r;if(r!=m)break;q+=m;b+=m;h-=m}return f}this.hdf_hd_open=function(a){if(0>=N(a.hfd))return 0;var m=a.hfd.ci;if(m.physical_geometry)a.cyls=m.pcyls,a.heads=m.pheads,a.secspertrack=m.psecs;else if(m.highcyl&&m.surfaces&&m.sectors)a.cyls=m.highcyl,a.heads=m.surfaces,a.secspertrack=m.sectors;else{var b,q,y;b=a.hfd.virtsize;blocks=Math.floor(b/512);if(16515072<blocks)b=16383,q=16,y=63;else{var I=void 0,E,
r=Math.floor(b/512);"undefined"==typeof I&&(I=0);if(1==I)q=1,y=32,E=Math.floor(r/(q*y));else{I=Array(4);I[0]=63;I[1]=127;I[2]=255;I[3]=-1;for(var G=0;0<=I[G];G++){var K=255>I[G]?16:255;y=I[G];for(q=4;q<=K;q++){E=Math.floor(r/(q*y));if(536870912>=b){if(1023>=E)break}else{if(16383>E)break;if(32767>E&&5<=q)break;if(65535>=E)break}16<K&&(q*=2,q--)}if(16>=q)break}}16<q&&q--;b=E}a.cyls=b;a.heads=q;a.secspertrack=y}a.cyls_def=a.cyls;a.secspertrack_def=a.secspertrack;a.heads_def=a.heads;if(m.surfaces&&m.sectors&&
(y=new Uint8Array(512),y[0]=0,this.hdf_read(a.hfd,y,0,512),0!=y[0]&&0!=SAEF_CompareArray(y,SAEF_String2Array("RDSK"),4)))for(m.highcyl=Math.floor(Math.floor(a.hfd.virtsize/m.blocksize)/(m.sectors*m.surfaces)),m.dostype=f(y,0),SAEF_warn("hardfile.hdf_hd_open() no RDSK, dostype 0x%08x, highcyl %d",m.dostype,m.highcyl),y=a.hfd,q=y.ci.surfaces*y.ci.sectors,b=262144/(512*q),E=q*b*512,SAEF_log("hardfile.create_virtual_rdb() cyl %d, cyls %d, size %d",q,b,E),r=new Uint8Array(E),SAEF_memset(r,0,0,E),y.virtual_rdb=
r,y.virtual_size=E,d(r,0,1380209483),d(r,1,64),d(r,2,0),d(r,3,7),d(r,4,512),d(r,5,0),d(r,6,-1),d(r,7,1),d(r,8,-1),d(r,9,-1),d(r,10,-1),d(r,11,-1),d(r,12,-1),d(r,13,-1),d(r,14,-1),d(r,15,-1),d(r,16,y.ci.highcyl),d(r,17,y.ci.sectors),d(r,18,y.ci.surfaces),d(r,19,y.ci.interleave?1:0),d(r,20,0),d(r,21,-1),d(r,22,-1),d(r,23,-1),d(r,24,0),d(r,25,0),d(r,26,0),d(r,27,-1),d(r,28,-1),d(r,29,-1),d(r,30,-1),d(r,31,-1),d(r,32,0),d(r,33,q*b),d(r,34,b),d(r,35,y.ci.highcyl+b),d(r,36,q),d(r,37,0),d(r,38,2),d(r,39,
-1),J(r,40,8,y.vendor_id),J(r,42,16,y.product_id),J(r,46,4,y.product_rev),h(r,0),d(r,128,1346458196),d(r,129,64),d(r,130,0),d(r,131,0),d(r,132,-1),d(r,133,1),d(r,134,-1),d(r,135,-1),d(r,136,0),J(r,137,30,y.ci.devname),d(r,160,80),d(r,161,128),d(r,162,0),d(r,163,y.ci.surfaces),d(r,164,y.ci.blocksize>>9),d(r,165,y.ci.sectors),d(r,166,y.ci.reserved),d(r,167,0),d(r,168,y.ci.interleave?1:0),d(r,169,b),d(r,170,y.ci.highcyl+b-1),d(r,171,y.ci.buffers),d(r,172,y.ci.bufmemtype),d(r,173,y.ci.maxtransfer),d(r,
174,y.ci.mask),d(r,175,y.ci.bootpri),d(r,176,y.ci.dostype),h(r,128),y.virtsize+=E;m.highcyl*m.surfaces*m.sectors>a.cyls_def*a.secspertrack_def*a.heads_def;)a.cyls_def++;a.size=a.hfd.virtsize;return 1};this.hdf_hd_close=function(a){null!==a&&I(a.hfd)};this.hdf_read=function(a,d,b,q){a.adide?(b=K(a,d,b+512,q),pa(d,q)):b=K(a,d,b,q);a.byteswap&&ja(d,q);return b};this.hdf_write=function(a,d,b,q){a.byteswap&&ja(d,q);a.adide?(b+=512,SAEF_warn("hardfile.adide_encode() 0x%04x %d",d,q),b=m(a,d,b,q),pa(d,q)):
b=m(a,d,b,q);a.byteswap&&ja(d,q);return b};this.reset=function(){}};function SAEO_Mouse(){this.button=[!1,!1,!1];var a=this.pos=0,f=0,d=0,J=0,h=-1,N=-1;this.reset=function(){this.button=[0,0,0];a=f=0;h=N=-1};this.mousedown=function(a){(a=a||window.event)&&(this.button[a.button]=!0)};this.mouseup=function(a){(a=a||window.event)&&(this.button[a.button]=!1)};this.mouseover=function(d){SAEV_config.video.hideCursor&&SAER.video.hideCursor(!0);this.mousemove(d);h=a;N=f};this.mouseout=function(a){this.mouseup(a);SAEV_config.video.hideCursor&&SAER.video.hideCursor(!1)};this.mousemove=
function(d){if(d=d||window.event){if(d.pageX||d.pageY)a=d.pageX,f=d.pageY;else if(d.clientX||d.clientY)a=d.clientX,f=d.clientY;-1==h&&(h=a,N=f)}};this.update=function(){if(-1!=h){var I=a-h,E=f-N;127<I?I=127:-127>I&&(I=-127);d+=I;255<d?d-=256:0>d&&(d+=256);127<E?E=127:-127>E&&(E=-127);J+=E;255<J?J-=256:0>J&&(J+=256)}else d=J=0;h=a;N=f;this.pos=(J<<8)+d}}
function SAEO_Joystick(a){this.type=a;this.button=[!1,!1,!1];this.state=[!1,!1,!1,!1];this.dir=0;this.reset=function(){this.button=[!1,!1,!1];this.state=[!1,!1,!1,!1]};this.update=function(){var a=this.state[1],d=this.state[3];this.state[0]&&(a=!a);this.state[2]&&(d=!d);this.dir=d|this.state[2]<<1|a<<8|this.state[0]<<9}}
function SAEO_Keyboard(){function a(a){J(a,!0)}function f(a){J(a,!1)}function d(a){var d=m+1;512==d&&(d=0);if(d==pa)return SAEF_warn("imput.recordKey() buffer overrun!"),!1;K[m]=a;m=d;return!0}function J(a,f){a=a||window.event;var m="undefined"==typeof a.keyCode?a.which:a.keyCode,E="undefined"==typeof a.location?0:a.location;if(122!=m&&123!=m){a.preventDefault();var y=I[E][m];I[E][m]=f?1:0;if(I[E][m]!=y)a:{y=I[E][m];if(20==m)if(y){if(ja=!ja,!ja)break a}else if(ja)break a;if(SAEV_config.ports[0].type==
SAEC_Config_Ports_Type_Joy0){var J,K,wa,b,q,pa;switch(SAEV_config.ports[0].move){case SAEC_Config_Ports_Move_Arrows:J=37;K=38;wa=39;b=40;break;case SAEC_Config_Ports_Move_Numpad:J=100;K=104;wa=102;b=101;break;case SAEC_Config_Ports_Move_WASD:J=65,K=87,wa=68,b=83}q=SAEV_config.ports[0].fire[0];pa=SAEV_config.ports[0].fire[1];switch(m){case q:SAER.input.joystick[0].button[0]=y;break;case pa:SAER.input.joystick[0].button[1]=y;break;case J:(SAER.input.joystick[0].state[0]=y)&&SAER.input.joystick[0].state[2]&&
(SAER.input.joystick[0].state[2]=!1);break;case K:(SAER.input.joystick[0].state[1]=y)&&SAER.input.joystick[0].state[3]&&(SAER.input.joystick[0].state[3]=!1);break;case wa:(SAER.input.joystick[0].state[2]=y)&&SAER.input.joystick[0].state[0]&&(SAER.input.joystick[0].state[0]=!1);break;case b:(SAER.input.joystick[0].state[3]=y)&&SAER.input.joystick[0].state[1]&&(SAER.input.joystick[0].state[1]=!1)}}if(SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Joy1){switch(SAEV_config.ports[1].move){case SAEC_Config_Ports_Move_Arrows:J=
37;K=38;wa=39;b=40;break;case SAEC_Config_Ports_Move_Numpad:J=100;K=104;wa=102;b=101;break;case SAEC_Config_Ports_Move_WASD:J=65,K=87,wa=68,b=83}q=SAEV_config.ports[1].fire[0];pa=SAEV_config.ports[1].fire[1];switch(m){case q:SAER.input.joystick[1].button[0]=y;break;case pa:SAER.input.joystick[1].button[1]=y;break;case J:(SAER.input.joystick[1].state[0]=y)&&SAER.input.joystick[1].state[2]&&(SAER.input.joystick[1].state[2]=!1);break;case K:(SAER.input.joystick[1].state[1]=y)&&SAER.input.joystick[1].state[3]&&
(SAER.input.joystick[1].state[3]=!1);break;case wa:(SAER.input.joystick[1].state[2]=y)&&SAER.input.joystick[1].state[0]&&(SAER.input.joystick[1].state[0]=!1);break;case b:(SAER.input.joystick[1].state[3]=y)&&SAER.input.joystick[1].state[1]&&(SAER.input.joystick[1].state[1]=!1)}}if(SAEV_config.keyboard.enabled&&(J=!1,SAEC_info.browser.id==SAEC_Info_Brower_ID_Firefox?"undefined"!=typeof N[m]&&(J=N[m]):"undefined"!=typeof h[m]&&(J=h[m]),!1!==J)){switch(J){case 96:2==E&&(J=97);break;case 100:2==E&&(J=
101);break;case 68:3==E&&(J=67)}y?d(J<<1):d(J<<1|1)}}}}for(var h={8:65,9:66,13:68,16:96,17:99,18:100,19:110,20:98,27:69,32:64,33:72,34:73,35:113,36:112,37:79,38:76,39:78,40:77,45:71,46:70,48:10,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,65:32,66:53,67:51,68:34,69:18,70:35,71:36,72:37,73:23,74:38,75:39,76:40,77:55,78:54,79:24,80:25,81:16,82:19,83:33,84:20,85:22,86:52,87:17,88:50,89:49,90:21,91:102,92:103,93:95,96:15,97:29,98:30,99:31,100:45,101:46,102:47,103:61,104:62,105:63,106:93,107:94,109:74,
110:60,111:92,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,144:109,145:107,186:26,187:27,188:56,189:58,190:57,191:43,192:41,219:11,220:0,221:12,222:42,226:48},N={8:65,9:66,13:68,16:96,17:99,18:100,19:110,20:98,27:69,32:64,33:72,34:73,35:113,36:112,37:79,38:76,39:78,40:77,45:71,46:70,48:10,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,60:48,63:11,65:32,66:53,67:51,68:34,69:18,70:35,71:36,72:37,73:23,74:38,75:39,76:40,77:55,78:54,79:24,80:25,81:16,82:19,83:33,84:20,85:22,86:52,
87:17,88:50,89:49,90:21,91:102,92:103,93:95,96:15,97:29,98:30,99:31,100:45,101:46,102:47,103:61,104:62,105:63,106:93,107:94,109:74,110:60,111:92,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,144:109,145:107,160:0,163:43,171:27,173:58,188:56,190:57,192:12},I=Array(4),E=0;4>E;E++)I[E]=new Uint8Array(256);var K=new Uint8Array(512),m=0,pa=0,ja=!1;this.setup=function(){SAEV_config.keyboard.enabled&&(document.addEventListener("keydown",a,!1),document.addEventListener("keyup",f,!1))};
this.cleanup=function(){SAEV_config.keyboard.enabled&&(document.removeEventListener("keydown",a,!1),document.removeEventListener("keyup",f,!1))};this.reset=function(){for(var a=0;a<I.length;a++)for(var d=0;d<I[a].length;d++)I[a][d]=0;m=pa=0};this.keysAvail=function(){return m!=pa};this.nextKey=function(){SAEF_assert(m!=pa);var a=K[pa];512==++pa&&(pa=0);return a};this.keyPress=function(a,d){J(a,d)}}
function SAEO_Input(){this.mouse=new SAEO_Mouse;this.joystick=Array(2);this.joystick[0]=new SAEO_Joystick(SAEC_Config_Ports_Type_Joy0);this.joystick[1]=new SAEO_Joystick(SAEC_Config_Ports_Type_Joy1);this.keyboard=new SAEO_Keyboard;var a=0,f=0;this.setup=function(){this.keyboard.setup()};this.cleanup=function(){this.keyboard.cleanup()};this.reset=function(){this.mouse.reset();this.joystick[0].reset();this.joystick[1].reset();this.keyboard.reset();f=a=0};this.keyPress=function(a,f){this.keyboard.keyPress(a,
f)};this.POTGO=function(d){a=d};this.POTGOR=function(){var d=(a|a<<1)&43520,d=d|d>>1;SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse?(this.mouse.button[2]&&(d&=64511),this.mouse.button[1]&&(d&=65279)):SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Joy0&&(this.joystick[0].button[1]&&(d&=64511),this.joystick[0].button[2]&&(d&=65279));SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Joy1&&(this.joystick[1].button[1]&&(d&=49151),this.joystick[1].button[2]&&(d&=61439));return d};this.POT0DAT=
function(){SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse&&(this.mouse.button[2]&&(f=f&65280|f+1&255),this.mouse.button[1]&&(f=f+256&65535));return f};this.POT1DAT=function(){return 65535};this.JOY0DAT=function(){return SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse?(this.mouse.update(),this.mouse.pos):SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Joy0?(this.joystick[0].update(),this.joystick[0].dir):65535};this.JOY1DAT=function(){return SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Mouse?
(this.mouse.update(),this.mouse.pos):SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Joy1?(this.joystick[1].update(),this.joystick[1].dir):65535};this.JOYTEST=function(a){}};function SAEO_Serial(){var a=new Uint8Array(1024),f=new Uint8Array(1024),d=0,J=0,h=0,N=!1,I=!1,E=!1,K=!1,m=0,pa=0;this.SERPER=function(a){if(SAEV_config.serial.enabled&&m!=a)switch(m=a,a&32768&&SAEF_warn("serial.SERPER() 9bit transmission not implemented."),a&32767){case 11931:case 11796:break;case 5898:case 2949:break;case 1474:case 1465:break;case 745:case 737:break;case 372:case 368:break;case 185:case 184:break;case 92:case 93:break;case 61:break;case 30:break;case 15:break;default:SAEF_warn("serial.SERPER() unsupported baudrate (0x%04x) %d",
a&32767,~~(3579546.471/((a&32767)+1)))}};this.SERDAT=function(a){if(SAEV_config.serial.enabled)if(a&=255,SAEV_config.serial.demand&&!I)E||(SAEF_warn("serial.SERDAT() Your software needs SERIAL ALWAYS to work properly. (disable 'serial.demand' in the config)"),E=!0);else{f[h++]=a;if(h==f.length){if(0<h){a="";for(var m=0;m<h;m++)a+=String.fromCharCode(f[m]);console.log(a)}K?h=0:J=d=h=0}pa|=8192;SAEV_Custom_intreq|=SAEC_Custom_INTF_TBE}};this.SERDATR=function(){if(!SAEV_config.serial.enabled)return 8192;
N=!1;return pa};this.SERDATS=function(){if(!K)return 0;if(N)return SAEV_Custom_intreq|=SAEC_Custom_INTF_RBF,1;var h;h=d<J?a[d++]:!1;return!1!==h?(N=!0,pa=16640,pa|=h&255,SAEV_Custom_intreq|=SAEC_Custom_INTF_RBF,1):0};this.dtr_on=function(){I=!0};this.dtr_off=function(){I=!1;SAEV_config.serial.demand&&(K=!1)};this.readstatus=function(a){return 0};this.writestatus=function(a,d){128==(a&128)&&0==(d&128)&&this.dtr_on();0==(a&128)&&128==(d&128)&&this.dtr_off();return d};this.setup=function(){SAEV_config.serial.enabled&&
(pa=8192)};this.cleanup=function(){I=K=!1};this.reset=function(){h=J=d=0;E=I=N=!1;m=0;pa=8192}};var SAEC_Custom_DMAF_AUD0EN=1,SAEC_Custom_DMAF_AUD1EN=2,SAEC_Custom_DMAF_AUD2EN=4,SAEC_Custom_DMAF_AUD3EN=8,SAEC_Custom_DMAF_DSKEN=16,SAEC_Custom_DMAF_SPREN=32,SAEC_Custom_DMAF_BLTEN=64,SAEC_Custom_DMAF_COPEN=128,SAEC_Custom_DMAF_BPLEN=256,SAEC_Custom_DMAF_DMAEN=512,SAEC_Custom_DMAF_BLTPRI=1024,SAEC_Custom_DMAF_BZERO=8192,SAEC_Custom_DMAF_BBUSY=16384,SAEC_Custom_DMAF_SETCLR=32768,SAEC_Custom_INTF_TBE=1,SAEC_Custom_INTF_DSKBLK=2,SAEC_Custom_INTF_VERTB=32,SAEC_Custom_INTF_BLIT=64,SAEC_Custom_INTF_RBF=
2048,SAEC_Custom_INTF_DSKSYN=4096,SAEC_Custom_INTF_INTEN=16384,SAEC_Custom_INTF_SETCLR=32768,SAER_Custom_put16_real=null,SAEV_Custom_bank=null,SAEV_Custom_dmacon=0,SAEV_Custom_intreq=0,SAEV_Custom_intena=0,SAEV_Custom_adkcon=0,SAEV_Custom_last_value=0;function SAEF_Custom_dmaen(a){return 0!=(SAEV_Custom_dmacon&a)&&0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN)}
function SAEO_Custom(){function a(a){SAER.playfield.decide_line(a);SAER.playfield.decide_fetch_safe(a);SAEV_Custom_dmacon&=-24577;return SAEV_Custom_dmacon=SAEV_Custom_dmacon|(SAEV_Blitter_interrupt||!SAEV_Blitter_interrupt&&SAEV_config.chipset.agnusBltBusyBug&&!SAER_Blitter_blt_info.got_cycle?0:16384)|(SAER_Blitter_blt_info.blitzero?8192:0)}function f(a,b){var d=SAEV_Custom_dmacon;SAER.playfield.decide_line(b);SAER.playfield.decide_fetch_safe(b);SAEV_Custom_dmacon=a&32768?SAEV_Custom_dmacon|a&32767:
SAEV_Custom_dmacon&~a;SAEV_Custom_dmacon&=2047;var h=SAEV_Custom_dmacon^d,f=0!=(d&SAEC_Custom_DMAF_COPEN)&&0!=(d&SAEC_Custom_DMAF_DMAEN),m=0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_COPEN)&&0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN);f!=m&&(m&&!f?SAER.copper.compute_spcflag_copper(b):m||SAER.copper.copper_stop());(SAEV_Custom_dmacon&SAEC_Custom_DMAF_BLTPRI)>(d&SAEC_Custom_DMAF_BLTPRI)&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEF_setSpcFlags(SAEC_spcflag_BLTNASTY);SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&
SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_INIT&&SAER.blitter.blitter_check_start();(SAEV_Custom_dmacon&(SAEC_Custom_DMAF_BLTPRI|SAEC_Custom_DMAF_BLTEN|SAEC_Custom_DMAF_DMAEN))!=(SAEC_Custom_DMAF_BLTPRI|SAEC_Custom_DMAF_BLTEN|SAEC_Custom_DMAF_DMAEN)&&SAEF_clrSpcFlags(SAEC_spcflag_BLTNASTY);h&(SAEC_Custom_DMAF_DMAEN|15)&&SAER.audio.state_machine();h&(SAEC_Custom_DMAF_DMAEN|SAEC_Custom_DMAF_BPLEN)&&SAER.playfield.set_bitplane_maybe_start_hpos(b)}function d(){return SAEV_Custom_intreq}function J(){return SAEV_Custom_intena}
function h(a,b){var d=SAEV_Custom_intena;SAEV_Custom_intena=a&32768?SAEV_Custom_intena|a&32767:SAEV_Custom_intena&~a;if(a&32768||d!=SAEV_Custom_intena||SAEV_Custom_intena!=T)T=SAEV_Custom_intena,a&32768&&SAER.m68k.doint()}function N(){return SAEV_Custom_adkcon}function I(a,b){SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&SAER.audio.update();SAER.disk.update(b);SAER.disk.update_adkcon(b,a);SAEV_Custom_adkcon=a&32768?SAEV_Custom_adkcon|a&32767:SAEV_Custom_adkcon&~a;SAER.audio.update_adkmasks()}
function E(a,b,d,h){h=!1;b&=4095;try{h=ua[(b&510)>>1](a)}catch(f){if(!(f instanceof Error))throw f;h=SAEV_Custom_last_value;SAER.playfield.set_line_cyclebased();d||(SAER.playfield.decide_line(a),SAER.playfield.decide_fetch_safe(a),ja(a,b,0,!0),a=SAER.playfield.is_bitplane_dma(a),h=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?a?SAEV_Custom_last_value&65535:SAEV_Custom_last_value>>>(b&2?0:16)&65535:a?SAEV_Custom_last_value&65535:65535)}return h}function K(a,b){var d=SAER.events.current_hpos();
SAER.copper.sync_copper_with_cpu(d,1);return E(d,a,!1,b)}function m(a){return 32768>(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(a,2,!1,0):a&1?(a&=-2,K(a,!1)<<8&65280|K(a+2,!1)>>8):K(a,!1)}function pa(a){return 32768>(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(a,4,!1,0):(m(a)<<16|m(a+2))>>>0}function ja(a,b,d,h){b&=510;try{y[b>>1](d&65535,a)}catch(f){if(!(f instanceof Error))throw f;h||E(a,b,!0,!1);return!0}return!1}function G(a,b){var d=SAER.events.current_hpos();
32768>(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(a,2,b):(SAER.copper.sync_copper_with_cpu(d,1),a&1?(a&=-2,ja(d,a,b>>8|b&65280,0),ja(d,a+2,b<<8&65280|b&255,0)):ja(d,a,b,0))}function bb(){var h;ua=Array(256);for(h=0;h<ua.length;h++)ua[h]=!1;ua[1]=a;ua[2]=function(){return SAER.playfield.VPOSR()};ua[3]=function(){return SAER.playfield.VHPOSR()};ua[5]=function(){return SAER.input.JOY0DAT()};ua[6]=function(){return SAER.input.JOY1DAT()};ua[7]=function(){return SAER.playfield.CLXDAT()};
ua[8]=N;ua[9]=function(){return SAER.input.POT0DAT()};ua[10]=function(){return SAER.input.POT1DAT()};ua[11]=function(){return SAER.input.POTGOR()};ua[12]=function(){return SAER.serial.SERDATR()};ua[13]=function(b){return SAER.disk.DSKBYTR(b)};ua[14]=J;ua[15]=d;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(ua[62]=function(){return SAER.playfield.DENISEID()});SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(ua[192]=function(){return SAER.playfield.COLOR_READ(0)},ua[193]=function(){return SAER.playfield.COLOR_READ(1)},
ua[194]=function(){return SAER.playfield.COLOR_READ(2)},ua[195]=function(){return SAER.playfield.COLOR_READ(3)},ua[196]=function(){return SAER.playfield.COLOR_READ(4)},ua[197]=function(){return SAER.playfield.COLOR_READ(5)},ua[198]=function(){return SAER.playfield.COLOR_READ(6)},ua[199]=function(){return SAER.playfield.COLOR_READ(7)},ua[200]=function(){return SAER.playfield.COLOR_READ(8)},ua[201]=function(){return SAER.playfield.COLOR_READ(9)},ua[202]=function(){return SAER.playfield.COLOR_READ(10)},
ua[203]=function(){return SAER.playfield.COLOR_READ(11)},ua[204]=function(){return SAER.playfield.COLOR_READ(12)},ua[205]=function(){return SAER.playfield.COLOR_READ(13)},ua[206]=function(){return SAER.playfield.COLOR_READ(14)},ua[207]=function(){return SAER.playfield.COLOR_READ(15)},ua[208]=function(){return SAER.playfield.COLOR_READ(16)},ua[209]=function(){return SAER.playfield.COLOR_READ(17)},ua[210]=function(){return SAER.playfield.COLOR_READ(18)},ua[211]=function(){return SAER.playfield.COLOR_READ(19)},
ua[212]=function(){return SAER.playfield.COLOR_READ(20)},ua[213]=function(){return SAER.playfield.COLOR_READ(21)},ua[214]=function(){return SAER.playfield.COLOR_READ(22)},ua[215]=function(){return SAER.playfield.COLOR_READ(23)},ua[216]=function(){return SAER.playfield.COLOR_READ(24)},ua[217]=function(){return SAER.playfield.COLOR_READ(25)},ua[218]=function(){return SAER.playfield.COLOR_READ(26)},ua[219]=function(){return SAER.playfield.COLOR_READ(27)},ua[220]=function(){return SAER.playfield.COLOR_READ(28)},
ua[221]=function(){return SAER.playfield.COLOR_READ(29)},ua[222]=function(){return SAER.playfield.COLOR_READ(30)},ua[223]=function(){return SAER.playfield.COLOR_READ(31)})}function kb(){var a;y=Array(256);for(a=0;a<y.length;a++)y[a]=!1;y[7]=function(b,a){SAER.playfield.CLXDAT()};y[16]=function(b,a){SAER.disk.DSKPTH(b)};y[17]=function(b,a){SAER.disk.DSKPTL(b)};y[18]=function(b,a){SAER.disk.DSKLEN(b,a)};y[19]=function(b,a){};y[20]=function(b,a){SAER.playfield.REFPTR(b)};y[21]=function(b,a){SAER.playfield.VPOSW(b)};
y[22]=function(b,a){SAER.playfield.VHPOSW(b)};y[23]=function(b,a){SAER.copper.COPCON(b)};y[24]=function(b,a){SAER.serial.SERDAT(b)};y[25]=function(b,a){SAER.serial.SERPER(b)};y[26]=function(b,a){SAER.input.POTGO(b)};y[27]=function(b,a){SAER.input.JOYTEST(b)};y[32]=function(b,a){SAER.blitter.BLTCON0(a,b)};y[33]=function(b,a){SAER.blitter.BLTCON1(a,b)};y[34]=function(b,a){SAER.blitter.BLTAFWM(a,b)};y[35]=function(b,a){SAER.blitter.BLTALWM(a,b)};y[36]=function(b,a){SAER.blitter.BLTCPTH(a,b)};y[37]=function(b,
a){SAER.blitter.BLTCPTL(a,b)};y[38]=function(b,a){SAER.blitter.BLTBPTH(a,b)};y[39]=function(b,a){SAER.blitter.BLTBPTL(a,b)};y[40]=function(b,a){SAER.blitter.BLTAPTH(a,b)};y[41]=function(b,a){SAER.blitter.BLTAPTL(a,b)};y[42]=function(b,a){SAER.blitter.BLTDPTH(a,b)};y[43]=function(b,a){SAER.blitter.BLTDPTL(a,b)};y[44]=function(b,a){SAER.blitter.BLTSIZE(a,b)};SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(y[45]=function(b,a){SAER.blitter.BLTCON0L(a,b)},y[46]=function(b,a){SAER.blitter.BLTSIZV(a,
b)},y[47]=function(b,a){SAER.blitter.BLTSIZH(a,b)});y[48]=function(b,a){SAER.blitter.BLTCMOD(a,b)};y[49]=function(b,a){SAER.blitter.BLTBMOD(a,b)};y[50]=function(b,a){SAER.blitter.BLTAMOD(a,b)};y[51]=function(b,a){SAER.blitter.BLTDMOD(a,b)};y[56]=function(b,a){SAER.blitter.BLTCDAT(a,b)};y[57]=function(b,a){SAER.blitter.BLTBDAT(a,b)};y[58]=function(b,a){SAER.blitter.BLTADAT(a,b)};y[63]=function(b,a){SAER.disk.DSKSYNC(a,b)};y[64]=function(b,a){SAER.copper.COP1LCH(b)};y[65]=function(b,a){SAER.copper.COP1LCL(b)};
y[66]=function(b,a){SAER.copper.COP2LCH(b)};y[67]=function(b,a){SAER.copper.COP2LCL(b)};y[68]=function(b,a){SAER.copper.COPJMP(1,0)};y[69]=function(b,a){SAER.copper.COPJMP(2,0)};y[71]=function(b,a){SAER.playfield.DIWSTRT(a,b)};y[72]=function(b,a){SAER.playfield.DIWSTOP(a,b)};y[73]=function(b,a){SAER.playfield.DDFSTRT(a,b)};y[74]=function(b,a){SAER.playfield.DDFSTOP(a,b)};y[75]=f;y[76]=function(b,a){SAER.playfield.CLXCON(b)};y[77]=h;y[78]=function(b,a){SAER.custom.INTREQ(b)};y[79]=I;y[80]=function(b,
a){SAER.audio.AUDxLCH(0,b)};y[81]=function(b,a){SAER.audio.AUDxLCL(0,b)};y[82]=function(b,a){SAER.audio.AUDxLEN(0,b)};y[83]=function(b,a){SAER.audio.AUDxPER(0,b)};y[84]=function(b,a){SAER.audio.AUDxVOL(0,b)};y[85]=function(b,a){SAER.audio.AUDxDAT(0,b)};y[88]=function(b,a){SAER.audio.AUDxLCH(1,b)};y[89]=function(b,a){SAER.audio.AUDxLCL(1,b)};y[90]=function(b,a){SAER.audio.AUDxLEN(1,b)};y[91]=function(b,a){SAER.audio.AUDxPER(1,b)};y[92]=function(a,d){SAER.audio.AUDxVOL(1,a)};y[93]=function(a,d){SAER.audio.AUDxDAT(1,
a)};y[96]=function(a,d){SAER.audio.AUDxLCH(2,a)};y[97]=function(a,d){SAER.audio.AUDxLCL(2,a)};y[98]=function(a,d){SAER.audio.AUDxLEN(2,a)};y[99]=function(a,d){SAER.audio.AUDxPER(2,a)};y[100]=function(a,d){SAER.audio.AUDxVOL(2,a)};y[101]=function(a,d){SAER.audio.AUDxDAT(2,a)};y[104]=function(a,d){SAER.audio.AUDxLCH(3,a)};y[105]=function(a,d){SAER.audio.AUDxLCL(3,a)};y[106]=function(a,d){SAER.audio.AUDxLEN(3,a)};y[107]=function(a,d){SAER.audio.AUDxPER(3,a)};y[108]=function(a,d){SAER.audio.AUDxVOL(3,
a)};y[109]=function(a,d){SAER.audio.AUDxDAT(3,a)};y[112]=function(a,d){SAER.playfield.BPLxPTH(d,a,0)};y[113]=function(a,d){SAER.playfield.BPLxPTL(d,a,0)};y[114]=function(a,d){SAER.playfield.BPLxPTH(d,a,1)};y[115]=function(a,d){SAER.playfield.BPLxPTL(d,a,1)};y[116]=function(a,d){SAER.playfield.BPLxPTH(d,a,2)};y[117]=function(a,d){SAER.playfield.BPLxPTL(d,a,2)};y[118]=function(a,d){SAER.playfield.BPLxPTH(d,a,3)};y[119]=function(a,d){SAER.playfield.BPLxPTL(d,a,3)};y[120]=function(a,d){SAER.playfield.BPLxPTH(d,
a,4)};y[121]=function(a,d){SAER.playfield.BPLxPTL(d,a,4)};y[122]=function(a,d){SAER.playfield.BPLxPTH(d,a,5)};y[123]=function(a,d){SAER.playfield.BPLxPTL(d,a,5)};SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(y[124]=function(a,d){SAER.playfield.BPLxPTH(d,a,6)},y[125]=function(a,d){SAER.playfield.BPLxPTL(d,a,6)},y[126]=function(a,d){SAER.playfield.BPLxPTH(d,a,7)},y[127]=function(a,d){SAER.playfield.BPLxPTL(d,a,7)});y[128]=function(a,d){SAER.playfield.BPLCON0(d,a)};y[129]=function(a,d){SAER.playfield.BPLCON1(d,
a)};y[130]=function(a,d){SAER.playfield.BPLCON2(d,a)};SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(y[131]=function(a,d){SAER.playfield.BPLCON3(d,a)});y[132]=function(a,d){SAER.playfield.BPL1MOD(d,a)};y[133]=function(a,d){SAER.playfield.BPL2MOD(d,a)};SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(y[134]=function(a,d){SAER.playfield.BPLCON4(d,a)},y[135]=function(a,d){SAER.playfield.CLXCON2(a)});y[136]=function(a,d){SAER.playfield.BPLxDAT(d,0,a)};y[137]=function(a,d){SAER.playfield.BPLxDAT(d,
1,a)};y[138]=function(a,d){SAER.playfield.BPLxDAT(d,2,a)};y[139]=function(a,d){SAER.playfield.BPLxDAT(d,3,a)};y[140]=function(a,d){SAER.playfield.BPLxDAT(d,4,a)};y[141]=function(a,d){SAER.playfield.BPLxDAT(d,5,a)};SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(y[142]=function(a,d){SAER.playfield.BPLxDAT(d,6,a)},y[143]=function(a,d){SAER.playfield.BPLxDAT(d,7,a)});y[144]=function(a,d){SAER.playfield.SPRxPTH(d,a,0)};y[145]=function(a,d){SAER.playfield.SPRxPTL(d,a,0)};y[146]=function(a,d){SAER.playfield.SPRxPTH(d,
a,1)};y[147]=function(a,d){SAER.playfield.SPRxPTL(d,a,1)};y[148]=function(a,d){SAER.playfield.SPRxPTH(d,a,2)};y[149]=function(a,d){SAER.playfield.SPRxPTL(d,a,2)};y[150]=function(a,d){SAER.playfield.SPRxPTH(d,a,3)};y[151]=function(a,d){SAER.playfield.SPRxPTL(d,a,3)};y[152]=function(a,d){SAER.playfield.SPRxPTH(d,a,4)};y[153]=function(a,d){SAER.playfield.SPRxPTL(d,a,4)};y[154]=function(a,d){SAER.playfield.SPRxPTH(d,a,5)};y[155]=function(a,d){SAER.playfield.SPRxPTL(d,a,5)};y[156]=function(a,d){SAER.playfield.SPRxPTH(d,
a,6)};y[157]=function(a,d){SAER.playfield.SPRxPTL(d,a,6)};y[158]=function(a,d){SAER.playfield.SPRxPTH(d,a,7)};y[159]=function(a,d){SAER.playfield.SPRxPTL(d,a,7)};y[160]=function(a,d){SAER.playfield.SPRxPOS(d,a,0)};y[161]=function(a,d){SAER.playfield.SPRxCTL(d,a,0)};y[162]=function(a,d){SAER.playfield.SPRxDATA(d,a,0)};y[163]=function(a,d){SAER.playfield.SPRxDATB(d,a,0)};y[164]=function(a,d){SAER.playfield.SPRxPOS(d,a,1)};y[165]=function(a,d){SAER.playfield.SPRxCTL(d,a,1)};y[166]=function(a,d){SAER.playfield.SPRxDATA(d,
a,1)};y[167]=function(a,d){SAER.playfield.SPRxDATB(d,a,1)};y[168]=function(a,d){SAER.playfield.SPRxPOS(d,a,2)};y[169]=function(a,d){SAER.playfield.SPRxCTL(d,a,2)};y[170]=function(a,d){SAER.playfield.SPRxDATA(d,a,2)};y[171]=function(a,d){SAER.playfield.SPRxDATB(d,a,2)};y[172]=function(a,d){SAER.playfield.SPRxPOS(d,a,3)};y[173]=function(a,d){SAER.playfield.SPRxCTL(d,a,3)};y[174]=function(a,d){SAER.playfield.SPRxDATA(d,a,3)};y[175]=function(a,d){SAER.playfield.SPRxDATB(d,a,3)};y[176]=function(a,d){SAER.playfield.SPRxPOS(d,
a,4)};y[177]=function(a,d){SAER.playfield.SPRxCTL(d,a,4)};y[178]=function(a,d){SAER.playfield.SPRxDATA(d,a,4)};y[179]=function(a,d){SAER.playfield.SPRxDATB(d,a,4)};y[180]=function(a,d){SAER.playfield.SPRxPOS(d,a,5)};y[181]=function(a,d){SAER.playfield.SPRxCTL(d,a,5)};y[182]=function(a,d){SAER.playfield.SPRxDATA(d,a,5)};y[183]=function(a,d){SAER.playfield.SPRxDATB(d,a,5)};y[184]=function(a,d){SAER.playfield.SPRxPOS(d,a,6)};y[185]=function(a,d){SAER.playfield.SPRxCTL(d,a,6)};y[186]=function(a,d){SAER.playfield.SPRxDATA(d,
a,6)};y[187]=function(a,d){SAER.playfield.SPRxDATB(d,a,6)};y[188]=function(a,d){SAER.playfield.SPRxPOS(d,a,7)};y[189]=function(a,d){SAER.playfield.SPRxCTL(d,a,7)};y[190]=function(a,d){SAER.playfield.SPRxDATA(d,a,7)};y[191]=function(a,d){SAER.playfield.SPRxDATB(d,a,7)};y[192]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,0)};y[193]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,1)};y[194]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,2)};y[195]=function(a,d){SAER.playfield.COLOR_WRITE(d,
a&4095,3)};y[196]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,4)};y[197]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,5)};y[198]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,6)};y[199]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,7)};y[200]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,8)};y[201]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,9)};y[202]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,10)};y[203]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,11)};
y[204]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,12)};y[205]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,13)};y[206]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,14)};y[207]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,15)};y[208]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,16)};y[209]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,17)};y[210]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,18)};y[211]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,19)};y[212]=
function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,20)};y[213]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,21)};y[214]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,22)};y[215]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,23)};y[216]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,24)};y[217]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,25)};y[218]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,26)};y[219]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,27)};y[220]=function(a,
d){SAER.playfield.COLOR_WRITE(d,a&4095,28)};y[221]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,29)};y[222]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,30)};y[223]=function(a,d){SAER.playfield.COLOR_WRITE(d,a&4095,31)};SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(y[224]=function(a,d){SAER.playfield.HTOTAL(a)},y[225]=function(a,d){SAER.playfield.HSSTOP(a)},y[226]=function(a,d){SAER.playfield.HBSTRT(a)},y[227]=function(a,d){SAER.playfield.HBSTOP(a)},y[228]=function(a,d){SAER.playfield.VTOTAL(a)},
y[229]=function(a,d){SAER.playfield.VSSTOP(a)},y[230]=function(a,d){SAER.playfield.VBSTRT(a)},y[231]=function(a,d){SAER.playfield.VBSTOP(a)},y[238]=function(a,d){SAER.playfield.BEAMCON0(a)},y[239]=function(a,d){SAER.playfield.HSSTRT(a)},y[240]=function(a,d){SAER.playfield.VSSTRT(a)},y[241]=function(a,d){SAER.playfield.HCENTER(a)});SAEV_config.chipset.mask&(SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE)&&(y[242]=function(a,d){SAER.playfield.DIWHIGH(d,a)});SAEV_config.chipset.mask&
SAEC_Config_Chipset_Mask_AGA&&(y[254]=function(a,d){SAER.playfield.FMODE(d,a)});y[255]=function(a,d){SAER.playfield.FNULL(a)}}var ua=null,y=null,Oa=0,T=0;this.setup=function(){bb();kb()};this.reset=function(){Oa=SAEV_Custom_intena=T=SAEV_Custom_dmacon=0};this.INTREQ_0=function(a){var b=SAEV_Custom_intreq;SAEV_Custom_intreq=a&32768?SAEV_Custom_intreq|a&32767:SAEV_Custom_intreq&~a;var d=Oa;Oa=SAEV_Custom_intreq;if(b==SAEV_Custom_intreq&&d==Oa)return!1;a&32768&&SAER.m68k.doint();return!0};this.INTREQ=
function(a){this.INTREQ_0(a)&&SAER.devices.rethink()};this.send_interrupt=function(a,b){this.INTREQ_0(SAEC_Custom_INTF_SETCLR|a)};this.intlev=function(){var a=Oa&T;if(a&&T&SAEC_Custom_INTF_INTEN){if(a&24576)return 6;if(a&6144)return 5;if(a&1920)return 4;if(a&112)return 3;if(a&8)return 2;if(a&7)return 1}return-1};SAER_Custom_put16_real=ja;SAEV_Custom_bank=new SAEO_Memory_addrbank(pa,m,function(a){return 32768>(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(a,1,!1,0):K(a&-2,!0)>>(a&
1?0:8)&255},function(a,b){32768>(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(a,4,b):(G(a&65534,b>>>16),G(a+2&65534,b&65535))},G,function(a,b){32768>(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(a,1,b):G(a&-2,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?a&1?b&255:b<<8|b&255:b<<8|b&255)},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Custom chipset",function(a){return SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst32(a):
pa(a)},function(a){return SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst16(a):m(a)},SAEC_Memory_addrbank_flag_IO,null,511,14675968)}
function SAEO_Devices(){this.virtualdevice_init=function(){SAER.autoconf.init();SAER.autoconf.setup();SAER.expansion.setup()};this.reset=function(a){SAER.gayle.reset(a);SAER.memory.a1000_reset();SAER.disk.reset();SAER.cia.reset();SAER.gayle.reset(0);SAER.expansion.reset();SAER.autoconf.reset()};this.vsync_pre=function(){SAER.cia.vsync()};this.vsync_post=function(){};this.hsync=function(a){SAER.blitter.decide_blitter(-1);SAER.disk.hsync();SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&SAER.audio.hsync();
(0<=SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia)&&SAER.gayle.hsync()};this.rethink=function(){SAER.cia.rethink();SAER.gayle.rethink()};this.update_sound=function(a,f){SAER.audio.update_sound(a)}};var SAER_Blitter_blt_info=null,SAEC_Blitter_bltstate_DONE=0,SAEC_Blitter_bltstate_INIT=1,SAEC_Blitter_bltstate_READ=2,SAEC_Blitter_bltstate_WORK=3,SAEC_Blitter_bltstate_WRITE=4,SAEC_Blitter_bltstate_NEXT=5,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE,SAEV_Blitter_interrupt=!1,SAEV_Blitter_dangerous=!1;
function SAEO_Blitter(){function a(){if(Mb)switch(ca){case 1:return Ua[0];case 2:return r[0];case 3:return R;default:return Ua[0]}return Ab?pb||Nb?Lb:Fa:lb}function f(b){if(0>b)return 0;var d=a();if(b<d[0])return d[1+b];b-=d[0];b%=d[0];return d[1+d[0]+b]}function d(b){if(0>b)return 0;var d=a();if(b<d[0])return b;b-=d[0];return b%=d[0]}function J(a){return SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)?SAER.playfield.is_bitplane_dma(a)?0:1:-1}function h(){if(!(0>Ga))switch(Ga=-1,fa){case 1:ta=$a;break;
case 2:ka=$a;break;case 3:qa=$a;break;case 4:nb=$a}}function N(a,b){Ga==a&&b==fa&&(Ga=-1,SAEF_warn("blitter.check_channel_mods() %08x write to %d ignored!",$a,b))}function I(a,b){SAEV_Blitter_interrupt||!b&&(!tb||Da||0>SAEV_config.cpu.speed||SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68030)||(SAEV_Blitter_interrupt=!0,SAER.custom.send_interrupt(SAEC_Custom_INTF_BLIT,4*SAEC_Events_CYCLE_UNIT))}function E(a){Kc=dc=0;SAEV_Blitter_bltstate=0==la||!tb||Da?SAEC_Blitter_bltstate_DONE:SAEC_Blitter_bltstate_INIT;
I(a,1);SAER.copper.blitter_done_notify(a);SAER.events.event2_remevent(SAEC_Events_EV2_BLITTER);SAEF_clrSpcFlags(SAEC_spcflag_BLTNASTY);SAEV_Blitter_dangerous=!1}function K(){if(sb&512){if(!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN))return;t.bltcdat=SAER_Memory_chipData[qa]<<8|SAER_Memory_chipData[qa+1];SAEV_Custom_last_value=t.bltcdat}SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_WORK}function m(){t.bltddat&&(t.blitzero=0);if(sb&512){if(!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN))return;SAER_Memory_chipData[nb]=
t.bltddat>>8;SAER_Memory_chipData[nb+1]=t.bltddat&255}SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_NEXT}function pa(){var a=(L&t.bltafwm)>>wb,b=t.bltcdat;t.bltbhold=mb&1?65535:0;Ub=!Za||Za&&!Ea;t.bltddat=z[sb&255](a,t.bltbhold,b)&65535;Ea++}function ja(){sb&2048&&(ta=Qb?ta+t.bltbmod:ta+t.bltamod);Qb||(Sa&16?(qa=Sa&8?qa-t.bltcmod:qa+t.bltcmod,Ea=0):Sa&8?0==wb--&&(wb=15,qa-=2):16==++wb&&(wb=0,qa+=2));Sa&16?Sa&4?0==wb--&&(wb=15,qa-=2):16==++wb&&(wb=0,qa+=2):(qa=Sa&4?qa-t.bltcmod:qa+t.bltcmod,Ea=0);Qb=
0!=(ta&32768);SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_WRITE}function G(){mb=(mb<<1|mb>>15)&65535;t.vblitsize--;SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_READ}function bb(){if(pb){do K(),Kc&&(nb=qa),Kc=1,pa(),ja(),G(),Ub&&(m(),Ub=0),0==t.vblitsize&&(SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE);while(SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE);nb=qa}else{if(xb){var a,b,d=0,Db=0,h=0,f=0,A=sb&255;Ba[0]=t.bltafwm;Ba[t.hblitsize-1]&=t.bltalwm;sb&2048&&(d=ta,ta-=(2*t.hblitsize+t.bltamod)*
t.vblitsize);sb&1024&&(Db=ka,ka-=(2*t.hblitsize+t.bltbmod)*t.vblitsize);sb&512&&(h=qa,qa-=(2*t.hblitsize+t.bltcmod)*t.vblitsize);sb&256&&(f=nb,nb-=(2*t.hblitsize+t.bltdmod)*t.vblitsize);if(0===ke[A]||Pa){var X=t.bltbhold,oa=0,q=0,r=0,O=0;for(b=0;b<t.vblitsize;b++){zb=!!(Sa&4);for(a=0;a<t.hblitsize;a++){var F,ec;d?(t.bltadat=F=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2):F=t.bltadat;F&=Ba[a];ec=(F<<16|oa)>>>0>>>t.blitdownashift;oa=F;Db&&(t.bltbdat=F=SAER_Memory_chipData[Db]<<8|SAER_Memory_chipData[Db+
1],Db-=2,X=(F<<16|q)>>>0>>>t.blitdownbshift,q=F);h&&(t.bltcdat=SAER_Memory_chipData[h]<<8|SAER_Memory_chipData[h+1],h-=2);O&&(SAER_Memory_chipData[r]=t.bltddat>>8,SAER_Memory_chipData[r+1]=t.bltddat&255);t.bltddat=z[A](ec,X,t.bltcdat)&65535;if(Pa){ec=t.bltddat;F=db?2:0;var H=Ca[ec&255][F+zb][1];t.bltddat=Ca[ec&255][F+zb][0]+(Ca[ec>>8][F+H][0]<<8);zb=Ca[ec>>8][F+H][1]}t.bltddat&&(t.blitzero=0);f&&(r=f,O=1,f-=2)}d&&(d-=t.bltamod);Db&&(Db-=t.bltbmod);h&&(h-=t.bltcmod);f&&(f-=t.bltdmod)}O&&(SAER_Memory_chipData[r]=
t.bltddat>>8,SAER_Memory_chipData[r+1]=t.bltddat&255);t.bltbhold=X}else ke[A](d,Db,h,f,t)}else if(f=h=Db=d=0,A=sb&255,Ba[0]=t.bltafwm,Ba[t.hblitsize-1]&=t.bltalwm,sb&2048&&(d=ta,ta+=(2*t.hblitsize+t.bltamod)*t.vblitsize),sb&1024&&(Db=ka,ka+=(2*t.hblitsize+t.bltbmod)*t.vblitsize),sb&512&&(h=qa,qa+=(2*t.hblitsize+t.bltcmod)*t.vblitsize),sb&256&&(f=nb,nb+=(2*t.hblitsize+t.bltdmod)*t.vblitsize),0===le[A]||Pa){X=t.bltbhold;for(b=O=r=q=oa=0;b<t.vblitsize;b++){zb=!!(Sa&4);for(a=0;a<t.hblitsize;a++)d?(t.bltadat=
F=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2):F=t.bltadat,F&=Ba[a],ec=(oa<<16|F)>>>0>>>t.blitashift,oa=F,Db&&(t.bltbdat=F=SAER_Memory_chipData[Db]<<8|SAER_Memory_chipData[Db+1],Db+=2,X=(q<<16|F)>>>0>>>t.blitbshift,q=F),h&&(t.bltcdat=SAER_Memory_chipData[h]<<8|SAER_Memory_chipData[h+1],h+=2),O&&(SAER_Memory_chipData[r]=t.bltddat>>8,SAER_Memory_chipData[r+1]=t.bltddat&255),t.bltddat=z[A](ec,X,t.bltcdat)&65535,Pa&&(ec=t.bltddat,F=db?2:0,H=Ca[ec&255][F+zb][1],t.bltddat=Ca[ec&255][F+zb][0]+
(Ca[ec>>8][F+H][0]<<8),zb=Ca[ec>>8][F+H][1]),t.bltddat&&(t.blitzero=0),f&&(O=1,r=f,f+=2);d&&(d+=t.bltamod);Db&&(Db+=t.bltbmod);h&&(h+=t.bltcmod);f&&(f+=t.bltdmod)}O&&(SAER_Memory_chipData[r]=t.bltddat>>8,SAER_Memory_chipData[r+1]=t.bltddat&255);t.bltbhold=X}else le[A](d,Db,h,f,t);Ba[0]=65535;Ba[t.hblitsize-1]=65535;SAEV_Blitter_bltstate=SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE}}function kb(){0==t.vblitsize||pb&&2!=t.hblitsize||bb();E(SAER.events.current_hpos())}function ua(){var a,b;b=t.bltadat;
0==Rc&&(b&=t.bltafwm);Rc==t.hblitsize-1&&(b&=t.bltalwm);a=xb?(b<<16|od)>>>0>>>t.blitdownashift:(od<<16|b)>>>0>>>t.blitashift;od=b;a=z[sb&255](a,t.bltbhold,t.bltcdat)&65535;if(Sa&24){b=a;var d=db?2:0,Db=Ca[b&255][d+zb][1];a=Ca[b&255][d+zb][0]+(Ca[b>>8][d+Db][0]<<8);zb=Ca[b>>8][d+Db][1]}a&&(t.blitzero=0);return a}function y(a){var b=ca;if(a&2&&(xb=Sa&2,t.blitbshift=Sa>>12,t.blitdownbshift=16-t.blitbshift,Sa&1&&!za)){SAEF_warn("blitter.blit_bltset() linedraw enabled after starting normal blit!");return}a&
1&&(t.blitashift=sb>>12,t.blitdownashift=16-t.blitashift);Aa=(sb&3840)>>8;pb=Sa&1;Pa=!!(Sa&24);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_INIT&&pb&&za&&(pb=0,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE,SAEV_Blitter_interrupt=!0,SAEF_warn("blitter.blit_bltset() register modification during linedraw!"));pb?(lb=R,ca=3):(a&2&&(zb=!!(Sa&4),db=!!(Sa&8),24==(Sa&24)&&(db=0)),Pa&&r[Aa][0]?(lb=r[Aa],ca=2):(lb=Ua[Aa],ca=1));SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&
SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_INIT&&(a=2==ca,b=2==b,b!=a&&0<pd&&(SAEF_warn("blitter.blit_bltset() on the fly %d (%d) -> %d (%d) switch!",na,b,Aa,a),pd--),Xb==a?xa=0:b&&!a?(xa=1,SAEF_warn("blitter.blit_bltset() frozen! %d (%d) -> %d (%d)",na,b,Aa,a)):!b&&a&&(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)||(xa=1)));SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_INIT&&(b=na+(Xb?16:0),a=Aa+(Pa?16:0),b!=a&&10>Sc[32*b+a]&&(Sc[32*b+a]++,SAEF_warn("blitter.blit_bltset() channel mode changed while active (%02x->%02x)",
b,a)),13==Aa&&1==na&&(Mb=1));Mb&&(Aa=0,lb=Ua[Aa],ca=1);yb=cc=0;Nb=1;for(b=0;b<lb[0];b++)a=lb[1+lb[0]+b],4>=a&&yb++,0<a&&4>a&&cc++,4==a&&(Nb=0);0==cc&&(Kc=dc=0)}function Oa(){sc=xb?-2:2;var a=xb?-1:1;Dc=a*t.bltamod;hc=a*t.bltbmod;Sb=a*t.bltcmod;W=a*t.bltdmod}function T(a){a&1&&(wb=sb>>12);a&2&&(Qb=!!(Sa&64));SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&(a&&y(a),Oa())}function wa(){for(var a=!1;SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN);)a=!0,
SAER.events.do_cycles(8*SAEC_Events_CYCLE_UNIT);jd&&a&&(jd--,SAEF_warn("blitter.waitingblits() waiting blits detected"));return SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_DONE}function b(){t.blitzero=1;xa=qd=od=0;za=Sa&1;y(3);Oa();Kc=dc=0;SAEV_Blitter_interrupt=!1;pb&&(L=t.bltadat,mb=t.bltbdat>>t.blitbshift|t.bltbdat<<16-t.blitbshift&65535,Ub=Ea=0,Za=Sa&2)}function q(a,d){if(SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&tb)SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&t.got_cycle&&(la=2,ma=d);
else{var Ec,Db=0;SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_DONE&&(0<Mb&&(Mb=0),Db=1);SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE;tb=SAEV_config.chipset.blitter.cycle_exact;Da=SAEV_config.chipset.blitter.immediate;t.got_cycle=0;tc=a+1;Bb=Ic=SAEV_Events_currcycle;Hb=Ia=cb=Bc=Ta=0;b();pb?Ec=t.vblitsize:(Ec=t.vblitsize*t.hblitsize,Bb=Ic+lb[0]*t.hblitsize*SAEC_Events_CYCLE_UNIT+SAEV_CPU_cycles);Db&&(na=Aa,Xb=Pa);SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_INIT;va=0;SAEF_clrSpcFlags(SAEC_spcflag_BLTNASTY);
SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTPRI)&&SAEF_setSpcFlags(SAEC_spcflag_BLTNASTY);SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&(SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_WORK);cb=2147483647;ma=0;tb?Da?SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&kb():(Pc=eb=Rc=Xc=0,Nb&&(eb=t.vblitsize),Ia=-2,ma=d,la=0,cb=t.hblitsize*t.vblitsize+2):0==t.vblitsize||pb&&2!=t.hblitsize?SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&E(a):(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&(t.got_cycle=1),Da?SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&
kb():(Ia=Ec*(cc+(Nb?0:1)),SAER.events.event2_newevent(SAEC_Events_EV2_BLITTER,Ia,0),SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&SAEV_config.chipset.blitter.waiting&&yb==lb[0]&&SAEV_spcflags&SAEC_spcflag_BLTNASTY&&wa()))}}function Z(a,b){h();if(SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE){if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)){var d=!1;3==SAEV_config.chipset.blitter.waiting?d=!0:2==SAEV_config.chipset.blitter.waiting?yb==lb[0]&&SAEV_spcflags&SAEC_spcflag_BLTNASTY&&(d=!0):1==SAEV_config.chipset.blitter.waiting&&
(yb==lb[0]&&SAEV_spcflags&SAEC_spcflag_BLTNASTY?d=!0:0>SAEV_config.cpu.speed&&(d=!0));if(d&&wa())return}Tc&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&t.got_cycle&&(Tc--,SAEF_warn("blitter.maybe_blit() program does not wait for blitter"));tb?SAER.blitter.decide_blitter(a):1==b&&0>SAEV_Events_currcycle-Bb||SAER.blitter.handler(0)}}function ea(){if(null===z){var a=0;z=Array(256);z[a++]=function(a,b,d){return 0};z[a++]=function(a,b,d){return~d&~b&~a};z[a++]=function(a,b,d){return d&~b&~a};z[a++]=function(a,
b,d){return~b&~a};z[a++]=function(a,b,d){return~d&b&~a};z[a++]=function(a,b,d){return~d&~a};z[a++]=function(a,b,d){return d&~b&~a|~d&b&~a};z[a++]=function(a,b,d){return~b&~a|~d&~a};z[a++]=function(a,b,d){return d&b&~a};z[a++]=function(a,b,d){return~d&~b&~a|d&b&~a};z[a++]=function(a,b,d){return d&~a};z[a++]=function(a,b,d){return~b&~a|d&~a};z[a++]=function(a,b,d){return b&~a};z[a++]=function(a,b,d){return~d&~a|b&~a};z[a++]=function(a,b,d){return d&~a|b&~a};z[a++]=function(a,b,d){return~a};z[a++]=function(a,
b,d){return~d&~b&a};z[a++]=function(a,b,d){return~d&~b};z[a++]=function(a,b,d){return d&~b&~a|~d&~b&a};z[a++]=function(a,b,d){return~b&~a|~d&~b};z[a++]=function(a,b,d){return~d&b&~a|~d&~b&a};z[a++]=function(a,b,d){return~d&~a|~d&~b};z[a++]=function(a,b,d){return d&~b&~a|~d&b&~a|~d&~b&a};z[a++]=function(a,b,d){return~b&~a|~d&~a|~d&~b};z[a++]=function(a,b,d){return d&b&~a|~d&~b&a};z[a++]=function(a,b,d){return~d&~b|d&b&~a};z[a++]=function(a,b,d){return d&~a|~d&~b&a};z[a++]=function(a,b,d){return~b&
~a|d&~a|~d&~b};z[a++]=function(a,b,d){return b&~a|~d&~b&a};z[a++]=function(a,b,d){return~d&~a|b&~a|~d&~b};z[a++]=function(a,b,d){return d&~a|b&~a|~d&~b&a};z[a++]=function(a,b,d){return~a|~d&~b};z[a++]=function(a,b,d){return d&~b&a};z[a++]=function(a,b,d){return~d&~b&~a|d&~b&a};z[a++]=function(a,b,d){return d&~b};z[a++]=function(a,b,d){return~b&~a|d&~b};z[a++]=function(a,b,d){return~d&b&~a|d&~b&a};z[a++]=function(a,b,d){return~d&~a|d&~b&a};z[a++]=function(a,b,d){return d&~b|~d&b&~a};z[a++]=function(a,
b,d){return~b&~a|~d&~a|d&~b};z[a++]=function(a,b,d){return d&b&~a|d&~b&a};z[a++]=function(a,b,d){return~d&~b&~a|d&b&~a|d&~b&a};z[a++]=function(a,b,d){return d&~a|d&~b};z[a++]=function(a,b,d){return~b&~a|d&~a|d&~b};z[a++]=function(a,b,d){return b&~a|d&~b&a};z[a++]=function(a,b,d){return~d&~a|b&~a|d&~b&a};z[a++]=function(a,b,d){return d&~a|b&~a|d&~b};z[a++]=function(a,b,d){return~a|d&~b};z[a++]=function(a,b,d){return~b&a};z[a++]=function(a,b,d){return~d&~b|~b&a};z[a++]=function(a,b,d){return d&~b|~b&
a};z[a++]=function(a,b,d){return~b};z[a++]=function(a,b,d){return~d&b&~a|~b&a};z[a++]=function(a,b,d){return~d&~a|~b&a};z[a++]=function(a,b,d){return d&~b|~d&b&~a|~b&a};z[a++]=function(a,b,d){return~b|~d&~a};z[a++]=function(a,b,d){return d&b&~a|~b&a};z[a++]=function(a,b,d){return~d&~b|d&b&~a|~b&a};z[a++]=function(a,b,d){return d&~a|~b&a};z[a++]=function(a,b,d){return~b|d&~a};z[a++]=function(a,b,d){return b&~a|~b&a};z[a++]=function(a,b,d){return~d&~a|b&~a|~b&a};z[a++]=function(a,b,d){return d&~a|b&
~a|~b&a};z[a++]=function(a,b,d){return~a|~b};z[a++]=function(a,b,d){return~d&b&a};z[a++]=function(a,b,d){return~d&~b&~a|~d&b&a};z[a++]=function(a,b,d){return d&~b&~a|~d&b&a};z[a++]=function(a,b,d){return~b&~a|~d&b&a};z[a++]=function(a,b,d){return~d&b};z[a++]=function(a,b,d){return~d&~a|~d&b};z[a++]=function(a,b,d){return d&~b&~a|~d&b};z[a++]=function(a,b,d){return~b&~a|~d&~a|~d&b};z[a++]=function(a,b,d){return d&b&~a|~d&b&a};z[a++]=function(a,b,d){return~d&~b&~a|d&b&~a|~d&b&a};z[a++]=function(a,b,
d){return d&~a|~d&b&a};z[a++]=function(a,b,d){return~b&~a|d&~a|~d&b&a};z[a++]=function(a,b,d){return b&~a|~d&b};z[a++]=function(a,b,d){return~d&~a|b&~a|~d&b};z[a++]=function(a,b,d){return d&~a|b&~a|~d&b};z[a++]=function(a,b,d){return~a|~d&b};z[a++]=function(a,b,d){return~d&a};z[a++]=function(a,b,d){return~d&~b|~d&a};z[a++]=function(a,b,d){return d&~b&~a|~d&a};z[a++]=function(a,b,d){return~b&~a|~d&a};z[a++]=function(a,b,d){return~d&b|~d&a};z[a++]=function(a,b,d){return~d};z[a++]=function(a,b,d){return d&
~b&~a|~d&b|~d&a};z[a++]=function(a,b,d){return~b&~a|~d};z[a++]=function(a,b,d){return d&b&~a|~d&a};z[a++]=function(a,b,d){return~d&~b|d&b&~a|~d&a};z[a++]=function(a,b,d){return d&~a|~d&a};z[a++]=function(a,b,d){return~b&~a|d&~a|~d&a};z[a++]=function(a,b,d){return b&~a|~d&a};z[a++]=function(a,b,d){return~d|b&~a};z[a++]=function(a,b,d){return d&~a|b&~a|~d&a};z[a++]=function(a,b,d){return~a|~d};z[a++]=function(a,b,d){return d&~b&a|~d&b&a};z[a++]=function(a,b,d){return~d&~b&~a|d&~b&a|~d&b&a};z[a++]=function(a,
b,d){return d&~b|~d&b&a};z[a++]=function(a,b,d){return~b&~a|d&~b|~d&b&a};z[a++]=function(a,b,d){return~d&b|d&~b&a};z[a++]=function(a,b,d){return~d&~a|d&~b&a|~d&b};z[a++]=function(a,b,d){return d&~b|~d&b};z[a++]=function(a,b,d){return~b&~a|~d&~a|d&~b|~d&b};z[a++]=function(a,b,d){return d&b&~a|d&~b&a|~d&b&a};z[a++]=function(a,b,d){return~d&~b&~a|d&b&~a|d&~b&a|~d&b&a};z[a++]=function(a,b,d){return d&~a|d&~b|~d&b&a};z[a++]=function(a,b,d){return~b&~a|d&~a|d&~b|~d&b&a};z[a++]=function(a,b,d){return b&
~a|d&~b&a|~d&b};z[a++]=function(a,b,d){return~d&~a|b&~a|d&~b&a|~d&b};z[a++]=function(a,b,d){return d&~a|b&~a|d&~b|~d&b};z[a++]=function(a,b,d){return~a|d&~b|~d&b};z[a++]=function(a,b,d){return~b&a|~d&a};z[a++]=function(a,b,d){return~d&~b|~b&a|~d&a};z[a++]=function(a,b,d){return d&~b|~b&a|~d&a};z[a++]=function(a,b,d){return~b|~d&a};z[a++]=function(a,b,d){return~d&b|~b&a};z[a++]=function(a,b,d){return~d|~b&a};z[a++]=function(a,b,d){return d&~b|~d&b|~b&a};z[a++]=function(a,b,d){return~b|~d};z[a++]=function(a,
b,d){return d&b&~a|~b&a|~d&a};z[a++]=function(a,b,d){return~d&~b|d&b&~a|~b&a|~d&a};z[a++]=function(a,b,d){return d&~a|~b&a|~d&a};z[a++]=function(a,b,d){return~b|d&~a|~d&a};z[a++]=function(a,b,d){return b&~a|~b&a|~d&a};z[a++]=function(a,b,d){return~d|b&~a|~b&a};z[a++]=function(a,b,d){return d&~a|b&~a|~b&a|~d&a};z[a++]=function(a,b,d){return~a|~b|~d};z[a++]=function(a,b,d){return d&b&a};z[a++]=function(a,b,d){return~d&~b&~a|d&b&a};z[a++]=function(a,b,d){return d&~b&~a|d&b&a};z[a++]=function(a,b,d){return~b&
~a|d&b&a};z[a++]=function(a,b,d){return~d&b&~a|d&b&a};z[a++]=function(a,b,d){return~d&~a|d&b&a};z[a++]=function(a,b,d){return d&~b&~a|~d&b&~a|d&b&a};z[a++]=function(a,b,d){return~b&~a|~d&~a|d&b&a};z[a++]=function(a,b,d){return d&b};z[a++]=function(a,b,d){return~d&~b&~a|d&b};z[a++]=function(a,b,d){return d&~a|d&b};z[a++]=function(a,b,d){return~b&~a|d&~a|d&b};z[a++]=function(a,b,d){return b&~a|d&b};z[a++]=function(a,b,d){return~d&~a|b&~a|d&b};z[a++]=function(a,b,d){return d&~a|b&~a|d&b};z[a++]=function(a,
b,d){return~a|d&b};z[a++]=function(a,b,d){return~d&~b&a|d&b&a};z[a++]=function(a,b,d){return~d&~b|d&b&a};z[a++]=function(a,b,d){return d&~b&~a|~d&~b&a|d&b&a};z[a++]=function(a,b,d){return~b&~a|~d&~b|d&b&a};z[a++]=function(a,b,d){return~d&b&~a|~d&~b&a|d&b&a};z[a++]=function(a,b,d){return~d&~a|~d&~b|d&b&a};z[a++]=function(a,b,d){return d&~b&~a|~d&b&~a|~d&~b&a|d&b&a};z[a++]=function(a,b,d){return~b&~a|~d&~a|~d&~b|d&b&a};z[a++]=function(a,b,d){return d&b|~d&~b&a};z[a++]=function(a,b,d){return~d&~b|d&
b};z[a++]=function(a,b,d){return d&~a|~d&~b&a|d&b};z[a++]=function(a,b,d){return~b&~a|d&~a|~d&~b|d&b};z[a++]=function(a,b,d){return b&~a|~d&~b&a|d&b};z[a++]=function(a,b,d){return~d&~a|b&~a|~d&~b|d&b};z[a++]=function(a,b,d){return d&~a|b&~a|~d&~b&a|d&b};z[a++]=function(a,b,d){return~a|~d&~b|d&b};z[a++]=function(a,b,d){return d&a};z[a++]=function(a,b,d){return~d&~b&~a|d&a};z[a++]=function(a,b,d){return d&~b|d&a};z[a++]=function(a,b,d){return~b&~a|d&a};z[a++]=function(a,b,d){return~d&b&~a|d&a};z[a++]=
function(a,b,d){return~d&~a|d&a};z[a++]=function(a,b,d){return d&~b|~d&b&~a|d&a};z[a++]=function(a,b,d){return~b&~a|~d&~a|d&a};z[a++]=function(a,b,d){return d&b|d&a};z[a++]=function(a,b,d){return~d&~b&~a|d&b|d&a};z[a++]=function(a,b,d){return d};z[a++]=function(a,b,d){return~b&~a|d};z[a++]=function(a,b,d){return b&~a|d&a};z[a++]=function(a,b,d){return~d&~a|b&~a|d&a};z[a++]=function(a,b,d){return d|b&~a};z[a++]=function(a,b,d){return~a|d};z[a++]=function(a,b,d){return~b&a|d&a};z[a++]=function(a,b,
d){return~d&~b|~b&a|d&a};z[a++]=function(a,b,d){return d&~b|~b&a|d&a};z[a++]=function(a,b,d){return~b|d&a};z[a++]=function(a,b,d){return~d&b&~a|~b&a|d&a};z[a++]=function(a,b,d){return~d&~a|~b&a|d&a};z[a++]=function(a,b,d){return d&~b|~d&b&~a|~b&a|d&a};z[a++]=function(a,b,d){return~b|~d&~a|d&a};z[a++]=function(a,b,d){return d&b|~b&a};z[a++]=function(a,b,d){return~d&~b|d&b|~b&a};z[a++]=function(a,b,d){return d|~b&a};z[a++]=function(a,b,d){return~b|d};z[a++]=function(a,b,d){return b&~a|~b&a|d&a};z[a++]=
function(a,b,d){return~d&~a|b&~a|~b&a|d&a};z[a++]=function(a,b,d){return d|b&~a|~b&a};z[a++]=function(a,b,d){return~a|~b|d};z[a++]=function(a,b,d){return b&a};z[a++]=function(a,b,d){return~d&~b&~a|b&a};z[a++]=function(a,b,d){return d&~b&~a|b&a};z[a++]=function(a,b,d){return~b&~a|b&a};z[a++]=function(a,b,d){return~d&b|b&a};z[a++]=function(a,b,d){return~d&~a|b&a};z[a++]=function(a,b,d){return d&~b&~a|~d&b|b&a};z[a++]=function(a,b,d){return~b&~a|~d&~a|b&a};z[a++]=function(a,b,d){return d&b|b&a};z[a++]=
function(a,b,d){return~d&~b&~a|d&b|b&a};z[a++]=function(a,b,d){return d&~a|b&a};z[a++]=function(a,b,d){return~b&~a|d&~a|b&a};z[a++]=function(a,b,d){return b};z[a++]=function(a,b,d){return~d&~a|b};z[a++]=function(a,b,d){return d&~a|b};z[a++]=function(a,b,d){return~a|b};z[a++]=function(a,b,d){return~d&a|b&a};z[a++]=function(a,b,d){return~d&~b|b&a};z[a++]=function(a,b,d){return d&~b&~a|~d&a|b&a};z[a++]=function(a,b,d){return~b&~a|~d&a|b&a};z[a++]=function(a,b,d){return~d&b|~d&a|b&a};z[a++]=function(a,
b,d){return~d|b&a};z[a++]=function(a,b,d){return d&~b&~a|~d&b|~d&a|b&a};z[a++]=function(a,b,d){return~b&~a|~d|b&a};z[a++]=function(a,b,d){return d&b|~d&a};z[a++]=function(a,b,d){return~d&~b|d&b|b&a};z[a++]=function(a,b,d){return d&~a|~d&a|b&a};z[a++]=function(a,b,d){return~b&~a|d&~a|~d&a|b&a};z[a++]=function(a,b,d){return b|~d&a};z[a++]=function(a,b,d){return~d|b};z[a++]=function(a,b,d){return d&~a|b|~d&a};z[a++]=function(a,b,d){return~a|~d|b};z[a++]=function(a,b,d){return d&a|b&a};z[a++]=function(a,
b,d){return~d&~b&~a|d&a|b&a};z[a++]=function(a,b,d){return d&~b|b&a};z[a++]=function(a,b,d){return~b&~a|d&a|b&a};z[a++]=function(a,b,d){return~d&b|d&a};z[a++]=function(a,b,d){return~d&~a|d&a|b&a};z[a++]=function(a,b,d){return d&~b|~d&b|b&a};z[a++]=function(a,b,d){return~b&~a|~d&~a|d&a|b&a};z[a++]=function(a,b,d){return d&b|d&a|b&a};z[a++]=function(a,b,d){return~d&~b&~a|d&b|d&a|b&a};z[a++]=function(a,b,d){return d|b&a};z[a++]=function(a,b,d){return~b&~a|d|b&a};z[a++]=function(a,b,d){return b|d&a};
z[a++]=function(a,b,d){return~d&~a|b|d&a};z[a++]=function(a,b,d){return d|b};z[a++]=function(a,b,d){return~a|d|b};z[a++]=function(a,b,d){return a};z[a++]=function(a,b,d){return~d&~b|a};z[a++]=function(a,b,d){return d&~b|a};z[a++]=function(a,b,d){return~b|a};z[a++]=function(a,b,d){return~d&b|a};z[a++]=function(a,b,d){return~d|a};z[a++]=function(a,b,d){return d&~b|~d&b|a};z[a++]=function(a,b,d){return~b|~d|a};z[a++]=function(a,b,d){return d&b|a};z[a++]=function(a,b,d){return~d&~b|d&b|a};z[a++]=function(a,
b,d){return d|a};z[a++]=function(a,b,d){return~b|d|a};z[a++]=function(a,b,d){return b|a};z[a++]=function(a,b,d){return~d|b|a};z[a++]=function(a,b,d){return d|b|a};z[a]=function(a,b,d){return 65535}}}var Ua=[[2,0,0,0,0],[2,0,0,0,4],[2,0,3,0,3],[3,0,3,0,0,3,4],[3,0,2,0,0,2,0],[3,0,2,0,0,2,4],[3,0,2,3,0,2,3],[4,0,2,3,0,0,2,3,4],[2,1,0,1,0],[2,1,0,1,4],[2,1,3,1,3],[3,1,3,0,1,3,4],[3,1,2,0,1,2,0],[3,1,2,0,1,2,4],[3,1,2,3,1,2,3],[4,1,2,3,0,1,2,3,4]],r=[[0],[3,0,0,0,0,4,0],[0],[0],[0],[4,0,2,0,0,0,2,4,0],
[0],[0],[0],[3,1,0,0,1,4,0],[0],[0],[0],[4,1,2,0,0,1,2,4,0],[0],[0]],R=[4,0,3,5,4,0,3,5,4],Fa=[2,0,4,0,4],Lb=[2,0,0,0,0],t=new function(){this.got_cycle=this.bltdmod=this.bltcmod=this.bltbmod=this.bltamod=this.hblitsize=this.vblitsize=this.bltalwm=this.bltafwm=this.bltbhold=this.bltahold=this.bltddat=this.bltcdat=this.bltbdat=this.bltadat=this.blitdownbshift=this.blitdownashift=this.blitbshift=this.blitashift=this.blitzero=0};SAER_Blitter_blt_info=t;var tb=!1,Da=!1,sb=0,Sa=0,ta=0,ka=0,qa=0,nb=0,$a=
0,Ga=0,fa=0,U=0,na=0,Xb=0,wb=0,L=0,mb=0,pb=0,zb=0,Pa=0,db=0,Za=0,xb=0,za=0,Ea=0,Qb=!1,Ub=0,sc=0,Dc=0,hc=0,Sb=0,W=0,Aa=0,z=null,Ca=null,Ba=null,Ia=0,ma=0,cb=0,va=0,Hb=0,la=0,Ta=0,Bb=0,Ic=0,Bc=0,yb=0,cc=0,Nb=0,lb=null,ca=0,xa=0,Mb=0,Ab=0,lc=0,Vb=0,qb=0,Kc=0,dc=0,od=0,qd=0,tc=0,ed=0,Rc=0,Xc=0,Pc=0,eb=0,Fc=0,Qd=0,Vd=0,fd=0,bd=0,ad=0,Sc=new Uint8Array(1024),pd=10,jd=10,Tc=10;this.setup=function(){if(null===Ba){Ba=new Uint32Array(2048);for(var a=0;a<Ba.length;a++)Ba[a]=65535;Ca=Array(256);for(var b=0;256>
b;b++)for(Ca[b]=Array(4),a=0;4>a;a++){var d=a&1,h=b;Ca[b][a]=new Uint8Array(2);for(var f=1;256!=f;f<<=1){var t=h;d&&(h=a&2?h|f:h^f);t&f&&(d=!d)}Ca[b][a][0]=h;Ca[b][a][1]=d}}ea();return SAEE_None};this.reset=function(){Ga=-1;for(var a=qd=od=ca=0;a<Sc.length;a++)Sc[a]=0;Tc=jd=pd=10;Qd=Vd=fd=bd=ad=Fc=Pc=eb=Rc=Xc=ed=0};this.handler=function(a){if(!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&(SAER.events.event2_newevent(SAEC_Events_EV2_BLITTER,10,0),Fc++,2E4>Fc||!Da))return;Fc=0;0<va&&!Da?(SAER.events.event2_newevent(SAEC_Events_EV2_BLITTER,
va,0),va=-1):kb()};this.decide_blitter=function(a){var b=0>a;if(Da)SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&kb();else{if(0<la)a:for(var Ec=a,Db=tc;Db<Ec;){var ef=J(Db);Db++;if(0<ef&&(la--,0==la)){Mb&&(Mb=-1);SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE;Ab=0;q(Db,0);ma=Ia=la=0;Mb&&(Mb=1);break a}}0<lc&&b&&(lc--,lc||SAER.custom.send_interrupt(SAEC_Custom_INTF_BLIT,2*SAEC_Events_CYCLE_UNIT));if(SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&
tb)if(0>a&&(a=SAER.playfield.get_maxhpos()),pb)a:{t.got_cycle=1,Ec=0;for(Ab&&t.vblitsize&&(Ab=0);tc<a;){for(Ec=f(Ia);;){Db=J(tc);if(ma){ma=0;break}if(Ab){Ia++;Hb++;if(2<=Ia){E(tc);break a}break}if(0>=Db){Ta++;U++;break}Ia++;Hb++;N(tc,Ec);if(3==Ec)K(),qa=Ec=qa,U++;else if(5==Ec)Kc&&(nb=qa),Kc=1,pa(),ja(),G();else if(4==Ec&&(Ub&&(m(),nb=Ec=nb,Ub=0,U++),0==t.vblitsize)){nb=qa;Ab=1;ma=Ia=0;I(tc,0);break}break}tc++}b&&(tc=0);h()}else{for(;tc<a;){for(Ec=f(Ia);;){Db=J(tc);if(ma){ma=0;break}if(0==Ec&&0==
Db||0>Db){if(0>Ia||!Ab){Ta++;break}if(Pa&&r[Aa][0]){Ta++;U++;break}}if(xa){Ta++;break}if(0==Ec){t.got_cycle=1;Ia++;0==Ia&&(Ab=0);Hb++;if(0==Aa&&Ia>=cb){E(tc);return}break}U++;if(0>=Db){Ta++;break}t.got_cycle=1;if(4==Ec)a:{Db=void 0;Db=0;if(0==cc)Db=ua();else if(dc)Db=qb,dc=0;else if(Kc)Db=Vb,Kc=0;else break a;SAER_Memory_chipData[nb]=Db>>8;SAER_Memory_chipData[nb+1]=Db&255;nb=Db=nb;nb+=sc;Xc++;Xc==t.hblitsize&&(Xc=0,nb+=W,eb++,0==cc&&Pc++,eb>Pc&&(Pc=eb));1==Aa&&(Rc=Xc)}else if(Pc<t.vblitsize){Db=
0;switch(Ec){case 1:t.bltadat=SAER_Memory_chipData[ta]<<8|SAER_Memory_chipData[ta+1];SAEV_Custom_last_value=t.bltadat;ta=Db=ta+=sc;break;case 2:t.bltbdat=SAER_Memory_chipData[ka]<<8|SAER_Memory_chipData[ka+1];SAEV_Custom_last_value=t.bltbdat;ka+=sc;t.bltbhold=xb?(t.bltbdat<<16|qd)>>>0>>>t.blitdownbshift:(qd<<16|t.bltbdat)>>>0>>>t.blitbshift;qd=t.bltbdat;ka=Db=ka;break;case 3:t.bltcdat=SAER_Memory_chipData[qa]<<8|SAER_Memory_chipData[qa+1],SAEV_Custom_last_value=t.bltcdat,qa=Db=qa+=sc}ed++;ed>=cc&&
(ed=0,qb=Vb,dc=Kc,Kc=0,Vb=ua(),sb&256&&(Kc=1),Rc++,Rc==t.hblitsize&&(Rc=0,sb&2048&&(ta+=Dc),sb&1024&&(ka+=hc),sb&512&&(qa+=Sb),Pc++,zb=!!(Sa&4)))}Ia++;Hb++;if(Pc>=t.vblitsize&&eb>=t.vblitsize&&!Kc&&!dc){E(tc);return}N(tc,Ec);break}SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&!Ab&&(Pc==t.vblitsize||Pc==t.vblitsize-1&&Rc==t.hblitsize-1&&0==cc)&&d(Ia-1)==lb[0]-1&&(I(tc,0),Ia=0,Ab=1);tc++}h();b&&(tc=0)}}};this.blitter_check_start=function(){SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_INIT&&(b(),SAEV_Blitter_bltstate=
SAEC_Blitter_bltstate_WORK,Da&&kb())};this.check_is_blit_dangerous=function(a,b,d){SAEV_Blitter_dangerous=!1;if(SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&tb)for(var h=0;h<b;h++){var f=a[h],t=(nb&SAEV_Memory_chipMask)>>>0;if(t>=f-2*d&&t<f+2*d){SAEV_Blitter_dangerous=!0;break}}};this.blitnasty=function(){if(SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_DONE||!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN))return 0;if(tb){if(SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_Blitter_bltstate!=
SAEC_Blitter_bltstate_DONE){var a=SAEV_Custom_dmacon;SAEV_Custom_dmacon=SAEV_Custom_dmacon|SAEC_Custom_DMAF_DMAEN|SAEC_Custom_DMAF_BLTEN;SAEF_log("blitter.blitter_force_finish() forcing finish");if(tb&&!Da){for(var b=1E4;SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&0<b;)SAER.blitter.decide_blitter(-1),b--;0==b&&SAEF_warn("blitter.blitter_force_finish() froze!?");la=0}else bb();E(SAER.events.current_hpos());SAEV_Custom_dmacon=a}return-1}if(Bc>=lb[0]&&yb==lb[0])return 0;a=(SAEV_Events_currcycle-
Ic)*SAEC_Events_CYCLE_UNIT_INV>>>0;for(b=0;Bc<a;)f(Bc++)||b++;return b};this.blitter_slowdown=function(a,b,d,h){if(!(!d||0>a||0>b)){if(a!=Qd||b!=Vd||d!=fd||bd!=h){var f=(b-a+d-1)/d*h>>>0,t=((b-a+d-1)/d*d>>>0)*yb/lb[0]>>>0;Qd=a;Vd=b;fd=d;bd=h;ad=0;t>f&&(ad=t-f)}0>va||pb||(va+=ad,Ta+=ad)}};this.BLTADAT=function(a,b){Z(a,0);t.bltadat=b};this.BLTBDAT=function(a,b){Z(a,0);t.bltbhold=Sa&2?b<<(Sa>>12)&65535:b>>(Sa>>12)&65535;t.bltbdat=b};this.BLTCDAT=function(a,b){Z(a,0);t.bltcdat=b;T(0)};this.BLTAMOD=function(a,
b){Z(a,1);t.bltamod=b&65534;t.bltamod&32768&&(t.bltamod-=65536);T(0)};this.BLTBMOD=function(a,b){Z(a,1);t.bltbmod=b&65534;t.bltbmod&32768&&(t.bltbmod-=65536);T(0)};this.BLTCMOD=function(a,b){Z(a,1);t.bltcmod=b&65534;t.bltcmod&32768&&(t.bltcmod-=65536);T(0)};this.BLTDMOD=function(a,b){Z(a,1);t.bltdmod=b&65534;t.bltdmod&32768&&(t.bltdmod-=65536);T(0)};this.BLTCON0=function(a,b){Z(a,2);sb=b;T(1)};this.BLTCON0L=function(a,b){Z(a,2);sb=sb&65280|b&255;T(1)};this.BLTCON1=function(a,b){Z(a,2);Sa=b;T(2)};
this.BLTAFWM=function(a,b){Z(a,2);t.bltafwm=b;T(0)};this.BLTALWM=function(a,b){Z(a,2);t.bltalwm=b;T(0)};this.BLTAPTH=function(a,b){b&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31;Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(ta&65535|b<<16)>>>0,Ga=a,fa=1):ta=(ta&65535|b<<16)>>>0};this.BLTAPTL=function(a,b){Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(ta&4294901760|b&65534)>>>
0,Ga=a,fa=1):ta=(ta&4294901760|b&65534)>>>0};this.BLTBPTH=function(a,b){b&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31;Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(ka&65535|b<<16)>>>0,Ga=a,fa=2):ka=(ka&65535|b<<16)>>>0};this.BLTBPTL=function(a,b){Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(ka&4294901760|b&65534)>>>0,Ga=a,fa=2):ka=(ka&4294901760|b&65534)>>>0};this.BLTCPTH=
function(a,b){b&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31;Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(qa&65535|b<<16)>>>0,Ga=a,fa=3):qa=(qa&65535|b<<16)>>>0};this.BLTCPTL=function(a,b){Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(qa&4294901760|b&65534)>>>0,Ga=a,fa=3):qa=(qa&4294901760|b&65534)>>>0};this.BLTDPTH=function(a,b){b&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?
7:31;Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(nb&65535|b<<16)>>>0,Ga=a,fa=4):nb=(nb&65535|b<<16)>>>0};this.BLTDPTL=function(a,b){Z(a,0);SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?($a=(nb&4294901760|b&65534)>>>0,Ga=a,fa=4):nb=(nb&4294901760|b&65534)>>>0};this.BLTSIZE=function(a,b){Z(a,0);t.vblitsize=b>>6;t.hblitsize=b&63;t.vblitsize||(t.vblitsize=1024);t.hblitsize||(t.hblitsize=64);q(a,SAEV_Copper_access);
SAER.playfield.dcheck_is_blit_dangerous()};this.BLTSIZV=function(a,b){Z(a,0);t.vblitsize=b&32767};this.BLTSIZH=function(a,b){Z(a,0);t.hblitsize=b&2047;t.vblitsize||(t.vblitsize=32768);t.hblitsize||(t.hblitsize=2048);q(a,SAEV_Copper_access)};var le=[function(a,b,d,h,f){var t=d=0,A=0;for(b=0;b<f.vblitsize;b++){for(a=0;a<f.hblitsize;a++)A&&(SAER_Memory_chipData[A]=t>>8,SAER_Memory_chipData[A+1]=t&255),t=0,d|=t,h&&(A=h,h+=2);h&&(h+=f.bltdmod)}A&&(SAER_Memory_chipData[A]=t>>8,SAER_Memory_chipData[A+1]=
t&255);0!=d&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A=0,X=0,oa=f.bltcdat,q=0,r=0;for(m=0;m<f.vblitsize;m++){for(b=0;b<f.hblitsize;b++){var O,F;d&&(oa=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);a?(O=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):O=t.bltadat;O&=Ba[b];F=(X<<16|O)>>>0>>>f.blitashift;X=O;r&&(SAER_Memory_chipData[r]=q>>8,SAER_Memory_chipData[r+1]=q&255);q=~F&oa&65535;A|=q;h&&(r=h,h+=2)}a&&(a+=f.bltamod);d&&(d+=f.bltcmod);h&&(h+=
f.bltdmod)}f.bltcdat=oa;r&&(SAER_Memory_chipData[r]=q>>8,SAER_Memory_chipData[r+1]=q&255);0!=A&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,q=0,r=f.bltbhold,O=f.bltcdat,F=0,ec=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,y;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,r=(q<<16|H)>>>0>>>f.blitbshift,q=H);a?(H=t.bltadat=
SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];y=(oa<<16|H)>>>0>>>f.blitashift;oa=H;ec&&(SAER_Memory_chipData[ec]=F>>8,SAER_Memory_chipData[ec+1]=F&255);F=O&~(y&r)&65535;X|=F;h&&(ec=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=r;f.bltcdat=O;ec&&(SAER_Memory_chipData[ec]=F>>8,SAER_Memory_chipData[ec+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,function(a,b,d,h,f){var m,A=0,X=0,oa=0,r=f.bltbhold,q=0,O=0;for(m=0;m<f.vblitsize;m++){for(d=
0;d<f.hblitsize;d++){var F,ec;b&&(F=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,r=(oa<<16|F)>>>0>>>f.blitbshift,oa=F);a?(F=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):F=t.bltadat;F&=Ba[d];ec=(X<<16|F)>>>0>>>f.blitashift;X=F;O&&(SAER_Memory_chipData[O]=q>>8,SAER_Memory_chipData[O+1]=q&255);q=ec&~r&65535;A|=q;h&&(O=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);h&&(h+=f.bltdmod)}f.bltbhold=r;O&&(SAER_Memory_chipData[O]=q>>8,SAER_Memory_chipData[O+1]=q&255);
0!=A&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,q=0,r=f.bltbhold,O=f.bltcdat,F=0,ec=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,y;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,r=(q<<16|H)>>>0>>>f.blitbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];y=(oa<<16|H)>>>0>>>f.blitashift;oa=H;ec&&(SAER_Memory_chipData[ec]=
F>>8,SAER_Memory_chipData[ec+1]=F&255);F=(r^(y|r^O))&65535;X|=F;h&&(ec=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=r;f.bltcdat=O;ec&&(SAER_Memory_chipData[ec]=F>>8,SAER_Memory_chipData[ec+1]=F&255);0!=X&&(f.blitzero=0)},0,function(a,b,d,h,f){var m,A=0,X=0,oa=0,q=f.bltbhold,r=0,O=0;for(m=0;m<f.vblitsize;m++){for(d=0;d<f.hblitsize;d++){var F,y;b&&(F=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(oa<<16|F)>>>0>>>f.blitbshift,oa=F);
a?(F=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):F=t.bltadat;F&=Ba[d];y=(X<<16|F)>>>0>>>f.blitashift;X=F;O&&(SAER_Memory_chipData[O]=r>>8,SAER_Memory_chipData[O+1]=r&255);r=(y^q)&65535;A|=r;h&&(O=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);h&&(h+=f.bltdmod)}f.bltbhold=q;O&&(SAER_Memory_chipData[O]=r>>8,SAER_Memory_chipData[O+1]=r&255);0!=A&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=
0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=(O^z&(q|O))&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=
f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=
t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=(O^z&q)&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,
A,X=0,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=O&(~z|q)&65535;X|=
F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,function(a,b,d,h,f){var m,A,X=0,oa=0,q=0,r=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,r=(q<<16|H)>>>0>>>f.blitbshift,
q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=r&(~z|O)&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=r;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,r=0,q=f.bltbhold,
O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=(O^z&~q)&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);
b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,q=0,r=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,r=(q<<16|H)>>>0>>>f.blitbshift,q=
H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=O&(z|r)&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=r;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,function(a,b,d,h,f){var m=0,A=f.bltcdat,X=0,oa=0;for(b=0;b<f.vblitsize;b++){for(a=
0;a<f.hblitsize;a++)d&&(A=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2),oa&&(SAER_Memory_chipData[oa]=X>>8,SAER_Memory_chipData[oa+1]=X&255),X=A&65535,m|=X,h&&(oa=h,h+=2);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltcdat=A;oa&&(SAER_Memory_chipData[oa]=X>>8,SAER_Memory_chipData[oa+1]=X&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<
8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=~(z^(O|z^q))&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=
F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,q=0,r=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,r=(q<<16|H)>>>0>>>f.blitbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;
H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=(O^z&(r^O))&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=r;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,function(a,b,d,h,f){var m=0,A=0,X=f.bltbhold,oa=0,r=0;for(d=0;d<f.vblitsize;d++){for(a=0;a<f.hblitsize;a++){if(b){var q=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+
1];b+=2;X=(A<<16|q)>>>0>>>f.blitbshift;A=q}r&&(SAER_Memory_chipData[r]=oa>>8,SAER_Memory_chipData[r+1]=oa&255);oa=X&65535;m|=oa;h&&(r=h,h+=2)}b&&(b+=f.bltbmod);h&&(h+=f.bltdmod)}f.bltbhold=X;r&&(SAER_Memory_chipData[r]=oa>>8,SAER_Memory_chipData[r+1]=oa&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=
2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=(z^O&(z^q))&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+
1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=
F>>8,SAER_Memory_chipData[y+1]=F&255);F=(O^q&(z^O))&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A,X=0,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<
8|SAER_Memory_chipData[b+1],b+=2,q=(r<<16|H)>>>0>>>f.blitbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):H=t.bltadat;H&=Ba[m];z=(oa<<16|H)>>>0>>>f.blitashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=(O|z&q)&65535;X|=F;h&&(y=h,h+=2)}a&&(a+=f.bltamod);b&&(b+=f.bltbmod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=X&&(f.blitzero=0)},0,0,0,0,0,function(a,
b,d,h,f){var m=0,A=0,X=0,oa=0;for(d=0;d<f.vblitsize;d++){for(b=0;b<f.hblitsize;b++){var r,q;a?(r=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):r=t.bltadat;r&=Ba[b];q=(A<<16|r)>>>0>>>f.blitashift;A=r;oa&&(SAER_Memory_chipData[oa]=X>>8,SAER_Memory_chipData[oa+1]=X&255);X=q&65535;m|=X;h&&(oa=h,h+=2)}a&&(a+=f.bltamod);h&&(h+=f.bltdmod)}oa&&(SAER_Memory_chipData[oa]=X>>8,SAER_Memory_chipData[oa+1]=X&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m,A=0,X=0,oa=
f.bltcdat,r=0,q=0;for(m=0;m<f.vblitsize;m++){for(b=0;b<f.hblitsize;b++){var O,F;d&&(oa=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d+=2);a?(O=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):O=t.bltadat;O&=Ba[b];F=(X<<16|O)>>>0>>>f.blitashift;X=O;q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=r&255);r=(F|oa)&65535;A|=r;h&&(q=h,h+=2)}a&&(a+=f.bltamod);d&&(d+=f.bltcmod);h&&(h+=f.bltdmod)}f.bltcdat=oa;q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=
r&255);0!=A&&(f.blitzero=0)},0,function(a,b,d,h,f){var m,A=0,X=0,oa=0,r=f.bltbhold,q=0,O=0;for(m=0;m<f.vblitsize;m++){for(d=0;d<f.hblitsize;d++){var F,y;b&&(F=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b+=2,r=(oa<<16|F)>>>0>>>f.blitbshift,oa=F);a?(F=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a+=2):F=t.bltadat;F&=Ba[d];y=(X<<16|F)>>>0>>>f.blitashift;X=F;O&&(SAER_Memory_chipData[O]=q>>8,SAER_Memory_chipData[O+1]=q&255);q=(y|r)&65535;A|=q;h&&(O=h,h+=2)}a&&(a+=
f.bltamod);b&&(b+=f.bltbmod);h&&(h+=f.bltdmod)}f.bltbhold=r;O&&(SAER_Memory_chipData[O]=q>>8,SAER_Memory_chipData[O+1]=q&255);0!=A&&(f.blitzero=0)},0,0,0],ke=[function(a,b,d,h,f){var m=a=0,A=0;for(d=0;d<f.vblitsize;d++){for(b=0;b<f.hblitsize;b++)A&&(SAER_Memory_chipData[A]=m>>8,SAER_Memory_chipData[A+1]=m&255),m=0,a|=m,h&&(A=h,h-=2);h&&(h-=f.bltdmod)}A&&(SAER_Memory_chipData[A]=m>>8,SAER_Memory_chipData[A+1]=m&255);0!=a&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){b=0;var m,A,X=0,oa=f.bltcdat,
r=0,q=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var O,F;d&&(oa=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);a?(O=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):O=t.bltadat;O&=Ba[m];F=(O<<16|X)>>>0>>>f.blitdownashift;X=O;q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=r&255);r=~F&oa&65535;b|=r;h&&(q=h,h-=2)}a&&(a-=f.bltamod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltcdat=oa;q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=r&255);
0!=b&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m=0,A,X,oa=0,r=0,q=f.bltbhold,O=f.bltcdat,F=0,y=0;for(X=0;X<f.vblitsize;X++){for(A=0;A<f.hblitsize;A++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,q=(H<<16|r)>>>0>>>f.blitdownbshift,r=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];z=(H<<16|
oa)>>>0>>>f.blitdownashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=O&~(z&q)&65535;m|=F;h&&(y=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltbhold=q;f.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,function(a,b,d,h,f){d=0;var m,A,X=0,oa=0,r=f.bltbhold,q=0,O=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var F,y;b&&(F=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+
1],b-=2,r=(F<<16|oa)>>>0>>>f.blitdownbshift,oa=F);a?(F=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):F=t.bltadat;F&=Ba[m];y=(F<<16|X)>>>0>>>f.blitdownashift;X=F;O&&(SAER_Memory_chipData[O]=q>>8,SAER_Memory_chipData[O+1]=q&255);q=y&~r&65535;d|=q;h&&(O=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);h&&(h-=f.bltdmod)}f.bltbhold=r;O&&(SAER_Memory_chipData[O]=q>>8,SAER_Memory_chipData[O+1]=q&255);0!=d&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,f,h){var m=0,A,X,oa=0,q=0,r=h.bltbhold,
O=h.bltcdat,F=0,y=0;for(X=0;X<h.vblitsize;X++){for(A=0;A<h.hblitsize;A++){var H,z;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,r=(H<<16|q)>>>0>>>h.blitdownbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];z=(H<<16|oa)>>>0>>>h.blitdownashift;oa=H;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);F=(r^(z|r^O))&65535;m|=F;f&&(y=f,f-=2)}a&&
(a-=h.bltamod);b&&(b-=h.bltbmod);d&&(d-=h.bltcmod);f&&(f-=h.bltdmod)}h.bltbhold=r;h.bltcdat=O;y&&(SAER_Memory_chipData[y]=F>>8,SAER_Memory_chipData[y+1]=F&255);0!=m&&(h.blitzero=0)},0,function(a,b,d,h,f){d=0;var m,A,X=0,oa=0,q=f.bltbhold,r=0,O=0;for(A=0;A<f.vblitsize;A++){for(m=0;m<f.hblitsize;m++){var F,y;b&&(F=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,q=(F<<16|oa)>>>0>>>f.blitdownbshift,oa=F);a?(F=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):F=t.bltadat;
F&=Ba[m];y=(F<<16|X)>>>0>>>f.blitdownashift;X=F;O&&(SAER_Memory_chipData[O]=r>>8,SAER_Memory_chipData[O+1]=r&255);r=(y^q)&65535;d|=r;h&&(O=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);h&&(h-=f.bltdmod)}f.bltbhold=q;O&&(SAER_Memory_chipData[O]=r>>8,SAER_Memory_chipData[O+1]=r&255);0!=d&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m=0,A,X,r=0,q=0,y=f.bltbhold,O=f.bltcdat,F=0,z=0;for(X=0;X<f.vblitsize;X++){for(A=0;A<f.hblitsize;A++){var H,U;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+
1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,y=(H<<16|q)>>>0>>>f.blitdownbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];U=(H<<16|r)>>>0>>>f.blitdownashift;r=H;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);F=(O^U&(y|O))&65535;m|=F;h&&(z=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltbhold=y;f.bltcdat=O;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+
1]=F&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,f,h){var m=0,A,X,r=0,q=0,y=h.bltbhold,O=h.bltcdat,F=0,z=0;for(X=0;X<h.vblitsize;X++){for(A=0;A<h.hblitsize;A++){var H,U;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,y=(H<<16|q)>>>0>>>h.blitdownbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];
U=(H<<16|r)>>>0>>>h.blitdownashift;r=H;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);F=(O^U&y)&65535;m|=F;f&&(z=f,f-=2)}a&&(a-=h.bltamod);b&&(b-=h.bltbmod);d&&(d-=h.bltcmod);f&&(f-=h.bltdmod)}h.bltbhold=y;h.bltcdat=O;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);0!=m&&(h.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m=0,A,X,r=0,q=0,y=f.bltbhold,O=f.bltcdat,F=0,z=0;for(X=0;X<f.vblitsize;X++){for(A=0;A<f.hblitsize;A++){var H,
U;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,y=(H<<16|q)>>>0>>>f.blitdownbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];U=(H<<16|r)>>>0>>>f.blitdownashift;r=H;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);F=O&(~U|y)&65535;m|=F;h&&(z=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltbhold=y;
f.bltcdat=O;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);0!=m&&(f.blitzero=0)},0,function(a,b,d,f,h){var m=0,A,X,r=0,q=0,y=h.bltbhold,O=h.bltcdat,F=0,z=0;for(X=0;X<h.vblitsize;X++){for(A=0;A<h.hblitsize;A++){var H,U;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,y=(H<<16|q)>>>0>>>h.blitdownbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;
H&=Ba[A];U=(H<<16|r)>>>0>>>h.blitdownashift;r=H;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);F=y&(~U|O)&65535;m|=F;f&&(z=f,f-=2)}a&&(a-=h.bltamod);b&&(b-=h.bltbmod);d&&(d-=h.bltcmod);f&&(f-=h.bltdmod)}h.bltbhold=y;h.bltcdat=O;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);0!=m&&(h.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m=0,A,X,r=0,q=0,y=f.bltbhold,O=f.bltcdat,F=0,z=0;for(X=0;X<f.vblitsize;X++){for(A=0;A<f.hblitsize;A++){var H,U;d&&(O=
SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,y=(H<<16|q)>>>0>>>f.blitdownbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];U=(H<<16|r)>>>0>>>f.blitdownashift;r=H;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);F=(O^U&~y)&65535;m|=F;h&&(z=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltbhold=y;f.bltcdat=
O;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,f,h){var m=0,A,X,r=0,q=0,y=h.bltbhold,O=h.bltcdat,F=0,z=0;for(X=0;X<h.vblitsize;X++){for(A=0;A<h.hblitsize;A++){var H,U;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,y=(H<<16|q)>>>0>>>h.blitdownbshift,q=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=
2):H=t.bltadat;H&=Ba[A];U=(H<<16|r)>>>0>>>h.blitdownashift;r=H;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);F=O&(U|y)&65535;m|=F;f&&(z=f,f-=2)}a&&(a-=h.bltamod);b&&(b-=h.bltbmod);d&&(d-=h.bltcmod);f&&(f-=h.bltdmod)}h.bltbhold=y;h.bltcdat=O;z&&(SAER_Memory_chipData[z]=F>>8,SAER_Memory_chipData[z+1]=F&255);0!=m&&(h.blitzero=0)},0,function(a,b,d,h,f){a=0;var m,A=f.bltcdat,r=0,q=0;for(m=0;m<f.vblitsize;m++){for(b=0;b<f.hblitsize;b++)d&&(A=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+
1],d-=2),q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=r&255),r=A&65535,a|=r,h&&(q=h,h-=2);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltcdat=A;q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=r&255);0!=a&&(f.blitzero=0)},0,0,0,0,0,0,function(a,b,d,h,f){var m=0,A,r,q=0,y=0,z=f.bltbhold,O=f.bltcdat,F=0,U=0;for(r=0;r<f.vblitsize;r++){for(A=0;A<f.hblitsize;A++){var H,E;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+
1],b-=2,z=(H<<16|y)>>>0>>>f.blitdownbshift,y=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];E=(H<<16|q)>>>0>>>f.blitdownashift;q=H;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);F=~(E^(O|E^z))&65535;m|=F;h&&(U=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltbhold=z;f.bltcdat=O;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,function(a,b,d,f,h){var m=0,A,r,q=0,y=0,z=h.bltbhold,O=h.bltcdat,F=0,U=0;for(r=0;r<h.vblitsize;r++){for(A=0;A<h.hblitsize;A++){var H,E;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,z=(H<<16|y)>>>0>>>h.blitdownbshift,y=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];E=(H<<16|q)>>>0>>>h.blitdownashift;q=H;U&&(SAER_Memory_chipData[U]=F>>8,
SAER_Memory_chipData[U+1]=F&255);F=(O^E&(z^O))&65535;m|=F;f&&(U=f,f-=2)}a&&(a-=h.bltamod);b&&(b-=h.bltbmod);d&&(d-=h.bltcmod);f&&(f-=h.bltdmod)}h.bltbhold=z;h.bltcdat=O;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);0!=m&&(h.blitzero=0)},0,function(a,b,d,h,f){a=0;var m,A=0,r=f.bltbhold,q=0,y=0;for(m=0;m<f.vblitsize;m++){for(d=0;d<f.hblitsize;d++){if(b){var z=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1];b-=2;r=(z<<16|A)>>>0>>>f.blitdownbshift;A=z}y&&(SAER_Memory_chipData[y]=
q>>8,SAER_Memory_chipData[y+1]=q&255);q=r&65535;a|=q;h&&(y=h,h-=2)}b&&(b-=f.bltbmod);h&&(h-=f.bltdmod)}f.bltbhold=r;y&&(SAER_Memory_chipData[y]=q>>8,SAER_Memory_chipData[y+1]=q&255);0!=a&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,function(a,b,d,h,f){var m=0,A,r,q=0,y=0,z=f.bltbhold,O=f.bltcdat,F=0,U=0;for(r=0;r<f.vblitsize;r++){for(A=0;A<f.hblitsize;A++){var H,E;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,z=
(H<<16|y)>>>0>>>f.blitdownbshift,y=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];E=(H<<16|q)>>>0>>>f.blitdownashift;q=H;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);F=(E^O&(E^z))&65535;m|=F;h&&(U=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltbhold=z;f.bltcdat=O;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,f,h){var m=
0,A,r,q=0,y=0,z=h.bltbhold,O=h.bltcdat,F=0,U=0;for(r=0;r<h.vblitsize;r++){for(A=0;A<h.hblitsize;A++){var H,E;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,z=(H<<16|y)>>>0>>>h.blitdownbshift,y=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];E=(H<<16|q)>>>0>>>h.blitdownashift;q=H;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);F=(O^z&(E^O))&
65535;m|=F;f&&(U=f,f-=2)}a&&(a-=h.bltamod);b&&(b-=h.bltbmod);d&&(d-=h.bltcmod);f&&(f-=h.bltdmod)}h.bltbhold=z;h.bltcdat=O;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);0!=m&&(h.blitzero=0)},0,0,0,0,0,0,0,function(a,b,d,h,f){var m=0,A,r,q=0,y=0,z=f.bltbhold,O=f.bltcdat,F=0,U=0;for(r=0;r<f.vblitsize;r++){for(A=0;A<f.hblitsize;A++){var H,E;d&&(O=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);b&&(H=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,z=(H<<
16|y)>>>0>>>f.blitdownbshift,y=H);a?(H=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):H=t.bltadat;H&=Ba[A];E=(H<<16|q)>>>0>>>f.blitdownashift;q=H;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);F=(O|E&z)&65535;m|=F;h&&(U=h,h-=2)}a&&(a-=f.bltamod);b&&(b-=f.bltbmod);d&&(d-=f.bltcmod);h&&(h-=f.bltdmod)}f.bltbhold=z;f.bltcdat=O;U&&(SAER_Memory_chipData[U]=F>>8,SAER_Memory_chipData[U+1]=F&255);0!=m&&(f.blitzero=0)},0,0,0,0,0,function(a,b,d,f,h){b=0;var m,A=0,r=0,
q=0;for(m=0;m<h.vblitsize;m++){for(d=0;d<h.hblitsize;d++){var y,z;a?(y=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):y=t.bltadat;y&=Ba[d];z=(y<<16|A)>>>0>>>h.blitdownashift;A=y;q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=r&255);r=z&65535;b|=r;f&&(q=f,f-=2)}a&&(a-=h.bltamod);f&&(f-=h.bltdmod)}q&&(SAER_Memory_chipData[q]=r>>8,SAER_Memory_chipData[q+1]=r&255);0!=b&&(h.blitzero=0)},0,0,0,0,0,0,0,0,0,function(a,b,d,f,h){b=0;var m,A,r=0,q=h.bltcdat,y=0,z=0;for(A=0;A<
h.vblitsize;A++){for(m=0;m<h.hblitsize;m++){var O,F;d&&(q=SAER_Memory_chipData[d]<<8|SAER_Memory_chipData[d+1],d-=2);a?(O=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):O=t.bltadat;O&=Ba[m];F=(O<<16|r)>>>0>>>h.blitdownashift;r=O;z&&(SAER_Memory_chipData[z]=y>>8,SAER_Memory_chipData[z+1]=y&255);y=(F|q)&65535;b|=y;f&&(z=f,f-=2)}a&&(a-=h.bltamod);d&&(d-=h.bltcmod);f&&(f-=h.bltdmod)}h.bltcdat=q;z&&(SAER_Memory_chipData[z]=y>>8,SAER_Memory_chipData[z+1]=y&255);0!=b&&(h.blitzero=0)},
0,function(a,b,d,f,h){d=0;var m,A,r=0,q=0,y=h.bltbhold,z=0,O=0;for(A=0;A<h.vblitsize;A++){for(m=0;m<h.hblitsize;m++){var F,U;b&&(F=t.bltbdat=SAER_Memory_chipData[b]<<8|SAER_Memory_chipData[b+1],b-=2,y=(F<<16|q)>>>0>>>h.blitdownbshift,q=F);a?(F=t.bltadat=SAER_Memory_chipData[a]<<8|SAER_Memory_chipData[a+1],a-=2):F=t.bltadat;F&=Ba[m];U=(F<<16|r)>>>0>>>h.blitdownashift;r=F;O&&(SAER_Memory_chipData[O]=z>>8,SAER_Memory_chipData[O+1]=z&255);z=(U|y)&65535;d|=z;f&&(O=f,f-=2)}a&&(a-=h.bltamod);b&&(b-=h.bltbmod);
f&&(f-=h.bltdmod)}h.bltbhold=y;O&&(SAER_Memory_chipData[O]=z>>8,SAER_Memory_chipData[O+1]=z&255);0!=d&&(h.blitzero=0)},0,0,0]};var SAER_Copper_cop_state=null,SAEV_Copper_access=!1,SAEV_Copper_last_hpos=0,SAEV_Copper_enabled_thisline=0;
function SAEO_Copper(){function a(a){var E=SAER.playfield.get_vpos()&(d.saved_i2>>8&127|128),K=d.hpos,m;if(8==d.state&&E<d.vcmp)SAEV_Copper_enabled_thisline=0,d.state=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER);else if(!(a<=SAEV_Copper_last_hpos)){m=SAER.playfield.get_maxhpos();for(a>(m&-2)&&(a=m&-2);;){var pa=K;if(K>=a)break;SAER.playfield.decide_line(K);SAER.playfield.decide_fetch(K);if(0<d.movedelay&&(d.movedelay--,0==d.movedelay)){m=K;var ja=d.moveaddr,G=d.movedata;SAEV_Copper_access=!0;SAER_Custom_put16_real(m,
ja,G,0);SAEV_Copper_access=!1}m=SAER.playfield.get_maxhpos();K=K==m-3&&m&1?K+1:K+2;switch(d.state){case 5:if(SAER.playfield.copper_cant_read(pa,0))continue;d.state=7;break;case 6:if(SAER.playfield.copper_cant_read(pa,0))continue;d.state=9;break;case 14:d.state=10;break;case 10:if(SAER.playfield.copper_cant_read(pa,1))continue;m=SAER.playfield.get_maxhpos();pa==m-2?(d.state=2,d.ip=1==d.strobe?J:h,d.strobe=0):(d.state=11,d.ip+=2);break;case 11:d.state=2;d.ip=1==d.strobe?J:h;d.strobe=0;break;case 12:d.state=
13;break;case 13:if(SAER.playfield.copper_cant_read(pa,1))continue;d.state=2;d.ip=1==d.strobe?J:h;d.strobe=0;break;case 15:if(SAER.playfield.copper_cant_read(pa,1))continue;d.state=2;d.i1=SAEV_Custom_last_value=SAER_Memory_chipData[d.ip]<<8|SAER_Memory_chipData[d.ip+1];d.ip=J;break;case 2:if(SAER.playfield.copper_cant_read(pa,1))continue;d.i1=SAEV_Custom_last_value=SAER_Memory_chipData[d.ip]<<8|SAER_Memory_chipData[d.ip+1];d.ip+=2;d.state=3;break;case 3:if(SAER.playfield.copper_cant_read(pa,1))continue;
d.i2=SAEV_Custom_last_value=SAER_Memory_chipData[d.ip]<<8|SAER_Memory_chipData[d.ip+1];d.ip+=2;d.saved_i1=d.i1;d.saved_i2=d.i2;d.saved_ip=d.ip;if(d.i1&1)d.ignore_next=!1,d.state=d.i2&1?6:5;else{ja=d.i1&510;m=d.i2;d.state=2;(ja&510)<(N&2?SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?0:64:128)&&(SAEV_Copper_enabled_thisline=d.state=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER));if(!SAEV_Copper_enabled_thisline){d.hpos=K;SAEV_Copper_last_hpos=a;return}d.ignore_next&&(ja=510);136==ja?(d.strobe=
1,d.state=10):138==ja?(d.strobe=2,d.state=10):f[ja>>1]?(d.moveaddr=ja,d.movedata=m,d.movedelay=f[ja>>1]):(SAEV_Copper_access=!0,SAER_Custom_put16_real(pa,ja,m,0),SAEV_Copper_access=!1);d.ignore_next=!1}0>SAEV_Copper_enabled_thisline&&!SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)&&(SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER));break;case 7:d.state=8;d.vcmp=(d.saved_i1&(d.saved_i2|32768))>>8;d.hcmp=d.saved_i1&d.saved_i2&254;E=SAER.playfield.get_vpos()&(d.saved_i2>>8&127|128);if(65535==
d.saved_i1&&65534==d.saved_i2){d.state=1;SAEV_Copper_enabled_thisline=0;SAEF_clrSpcFlags(SAEC_spcflag_COPPER);d.hpos=K;SAEV_Copper_last_hpos=a;return}if(E<d.vcmp){SAEV_Copper_enabled_thisline=0;SAEF_clrSpcFlags(SAEC_spcflag_COPPER);d.hpos=K;SAEV_Copper_last_hpos=a;return}case 8:m=K;m&1&&(m=0);if(0==(d.saved_i2&32768)&&(SAER.blitter.decide_blitter(pa),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE)){d.state=4;SAEV_Copper_enabled_thisline=0;SAEF_clrSpcFlags(SAEC_spcflag_COPPER);d.hpos=K;SAEV_Copper_last_hpos=
a;return}if(SAER.playfield.copper_cant_read(pa,0))continue;pa=m&d.saved_i2&254;if(E==d.vcmp&&pa<d.hcmp)break;d.state=2;break;case 9:m=SAER.playfield.get_maxhpos();if(K>=(m&-2)||K&1)break;if(SAER.playfield.copper_cant_read(pa,0))continue;pa=(d.saved_i1&(d.saved_i2|32768))>>8;m=d.saved_i1&d.saved_i2&254;ja=SAER.playfield.get_vpos()&(d.saved_i2>>8&127|128);G=K&d.saved_i2&254;!(ja>pa||ja==pa&&G>=m)||0==(d.saved_i2&32768)&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE||(d.ignore_next=!0);d.state=2}}d.hpos=
K;SAEV_Copper_last_hpos=a}}var f=[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=new function(){this.vpos=this.hpos=this.saved_ip=this.ip=this.state_prev=this.state=this.saved_i2=this.i2=this.saved_i1=this.i1=0;this.ignore_next=!1;this.movedelay=this.movedata=this.moveaddr=this.strobe=this.hcmp=this.vcmp=0};SAER_Copper_cop_state=d;var J=0,h=0,N=0;this.reset=function(){N=0;d.state=0;d.movedelay=0;d.strobe=0;d.ignore_next=!1};this.clr_copcon=function(){N=0};this.copper_stop=function(){if(SAEV_Copper_enabled_thisline)switch(d.state){case 3:SAEV_Copper_enabled_thisline=
-1}0<=SAEV_Copper_enabled_thisline&&(SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER))};this.compute_spcflag_copper=function(a){var f=SAEV_Copper_enabled_thisline;SAEV_Copper_enabled_thisline=0;SAEF_clrSpcFlags(SAEC_spcflag_COPPER);if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)&&0!=d.state&&1!=d.state&&4!=d.state&&!(8==d.state&&(SAER.playfield.get_vpos()&(d.saved_i2>>8&127|128))<d.vcmp)){if(!f&&d.hpos<a&&a<SAER.playfield.get_maxhpos()){var h=SAER.playfield.get_maxhpos_short();a=
a+2&-2;a>(h&-2)&&(a=h&-2);d.hpos=a}f||14!=d.state||(d.state=10);SAEV_Copper_enabled_thisline=1;SAEF_setSpcFlags(SAEC_spcflag_COPPER)}};this.blitter_done_notify=function(a){if(4==d.state){var f=SAER.playfield.get_vpos(),h=f&(d.saved_i2>>8&127|128),m=SAER.playfield.get_maxhpos();a++;a&=-2;a>=m&&(a-=m,f++);d.hpos=a;d.vpos=f;d.state=8;d.saved_i2|=32768;SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)&&h>=d.vcmp?(SAEV_Copper_enabled_thisline=1,SAEF_setSpcFlags(SAEC_spcflag_COPPER)):SAEF_clrSpcFlags(SAEC_spcflag_COPPER)}};
this.cycle=function(){var d=SAER.events.current_hpos();a(d)};this.sync_copper_with_cpu=function(d,f){SAEV_Copper_enabled_thisline&&a(d)};this.COP1LCH=function(a){a&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31;J=(J&65535|a<<16)>>>0};this.COP1LCL=function(a){J=(J&4294901760|a&65534)>>>0};this.COP2LCH=function(a){a&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31;h=(h&65535|a<<16)>>>0};this.COP2LCL=function(a){h=(h&4294901760|a&65534)>>>0};this.COPJMP=function(a,f){var h=
d.strobe,m=0==d.state&&!f;SAEF_clrSpcFlags(SAEC_spcflag_COPPER);d.ignore_next=!1;h||(d.state_prev=d.state);8!=d.state&&1!=d.state||f||!SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)?d.state=f?15:SAEV_Copper_access?10:14:d.state=12;d.vpos=SAER.playfield.get_vpos();d.hpos=SAER.events.current_hpos()&-2;SAEV_Copper_enabled_thisline=0;d.strobe=a;if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN))this.compute_spcflag_copper(SAER.events.current_hpos());else if(m||0<h&&h!=a&&8==d.state_prev)d.state=0};this.COPCON=function(a){N=
a}};var SAEC_Playfield_CLOCK_PAL=3546895,SAEC_Playfield_CLOCK_NTSC=3579545,SAEV_Playfield_fake_vblank_hz=0,SAEV_Playfield_frame_rendered=!1,SAEV_Playfield_frame_shown=!1,SAEV_Playfield_picasso_requested_on=!1,SAEV_Playfield_picasso_on=!1,SAER_Playfield_gfxvidinfo=null,SAER_Playfield_isvsync_chipset=null,SAER_Playfield_isvsync=null,SAER_Playfield_init_row_map=null;
function SAEF_Playfield_getvsyncrate(a,f){0>a?(f.mult=0,f.hz=0):85<a?(f.mult=-1,f.hz=a/2):35>a&&0<a?(f.mult=SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0].gfx_interlaced?0:1,f.hz=2*a):(f.mult=0,f.hz=a)}
function SAEO_Playfield(){function a(a){return a-56<<Zb}function f(a){a>>=Zb;return a+56}function d(a){a=f(a);return a-1}function J(){this.color_regs_ecs=new Uint16Array(32);this.acolors=new Uint32Array(256);this.color_regs_aga=new Uint32Array(256);this.extra=0}function h(a){return SAEC_LITTLE_ENDIAN?(lh[a&255]|mh[a>>>8&255]|nh[a>>>16&255])>>>0:(lh[a>>>24&255]|mh[a>>>16&255]|nh[a>>>8&255])>>>0}function N(a){return $h?h(a):ic[a]}function I(a,b){if(we)for(var g=0;256>g;g++)a.acolors[g]=b.acolors[g],
a.color_regs_aga[g]=b.color_regs_aga[g];else for(g=0;32>g;g++)a.color_regs_ecs[g]=b.color_regs_ecs[g],a.acolors[g]=b.acolors[g];a.extra=b.extra}function E(){this.value=this.regno=this.linepos=0}function K(){this.first_pixel=this.max=this.pos=0;this.has_attached=!1}function m(){this.bplres=this.nr_planes=this.bplcon4=this.bplcon3=this.bplcon2=this.bplcon0=this.ctable=this.diwlastword=this.diwfirstword=this.plflinelen=this.plfright=this.plfleft=0;this.bordersprite_seen=this.ham_at_start=this.ham_seen=
this.ehb_seen=!1;this.clr=function(){this.bplres=this.nr_planes=this.bplcon4=this.bplcon3=this.bplcon2=this.bplcon0=this.ctable=this.diwlastword=this.diwfirstword=this.plflinelen=this.plfright=this.plfleft=0;this.bordersprite_seen=this.ham_at_start=this.ham_seen=this.ehb_seen=!1}}function pa(){this.nr_sprites=this.nr_color_changes=this.last_color_change=this.first_color_change=this.last_sprite_entry=this.first_sprite_entry=0;this.clr=function(){this.nr_sprites=this.nr_color_changes=this.last_color_change=
this.first_color_change=this.last_sprite_entry=this.first_sprite_entry=0}}function ja(){var a=SAEV_config.video.hresolution;Zb=a;Zb!=a&&Sa();0<x&&(2>Zb&&Zb++,Zb=a=Zb,Zb!=a&&Sa());Cc=SAEV_config.video.hresolution;0<x&&Cc<SAEC_Config_Video_HResolution_SuperHiRes&&Cc++}function G(){this.flush_line=function(a,b,g){};this.flush_block=function(a,b,g,d){};this.flush_screen=function(a,b,g,d){};this.flush_clear_screen=function(a,b){};this.lockscr=function(a,b){return 1};this.unlockscr=function(a,b){};this.bufmem=
this.emergmem=this.linemem=null;this.bufmemend_pos=this.bufmemend=this.bufmem_pos=0;this.bufmem_allocated=this.realbufmem=null;this.bufmem_lockable=!1;this.inheight2=this.inwidth2=this.inheight=this.inwidth=this.outheight=this.outwidth=this.height_allocated=this.width_allocated=this.pixbytes=this.rowbytes=0;this.tempbufferinuse=this.nativepositioning=!1;this.inyoffset=this.inxoffset=this.yoffset=this.xoffset=this.extrawidth=0;this.clr=function(){this.bufmem=this.emergmem=this.linemem=null;this.bufmemend_pos=
this.bufmemend=this.bufmem_pos=0;this.bufmem_allocated=this.realbufmem=null;this.bufmem_lockable=!1;this.inheight2=this.inwidth2=this.inheight=this.inwidth=this.outheight=this.outwidth=this.height_allocated=this.width_allocated=this.pixbytes=this.rowbytes=0;this.tempbufferinuse=this.nativepositioning=!1;this.inyoffset=this.inxoffset=this.yoffset=this.xoffset=this.extrawidth=0}}function bb(){this.data=this.stdata=this.attach=0;this.clr=function(){this.data=this.stdata=this.attach=0}}function kb(a,
b,g){if(0==b)return 0;a=a<<24>>>32-b;a<<=g;return a>>>0}function ua(a,b,g){return 8<=b?a<<g>>>0:a>>8-b<<g>>>0}function y(a){if(null!==a.bufmem_allocated)for(var b=0;b<a.bufmem_allocated.length;b++)a.bufmem_allocated[b]=0}function Oa(){for(var a=0;1189>a;a++)fc[a]=1}function T(a){return 0<=Mc?a>>Mc:a<<-Mc}function wa(){Wd=xe;Rd=Ue;l&&(Wd<a(2*Yc)&&(Wd=a(2*Yc)),Rd>a(2*v)&&(Rd=a(2*v)))}function b(){return zf==SAEC_Config_Video_HResolution_SuperHiRes?0:oh>>2-SAEV_config.video.hresolution}function q(g){var d=
2*Ob.plfleft+1,e=2*Ob.plfright+1;g&&(d=56);cd=a(d);ce=a(e);g=cd;0>cd&&(cd=0);ce<cd&&(ce=cd);ye=Ob.diwfirstword;me=Ob.diwlastword;me<ye&&(me=ye);e=Mc;Mc=Zb-zf;Mc!=e&&Sa();wc=ye;Nc=me;wc<cd&&(wc=cd);Nc>ce&&(Nc=ce);wc<Wb&&(wc=Wb);wc>vd&&(wc=vd);Nc<Wb&&(Nc=Wb);Nc>vd&&(Nc=vd);ff=de=wc;ze=Nc;Zc.nr_sprites&&(0!=(S.extra&1)?(ff=0,Nc<me&&Rd>Nc&&(Nc=me)):(Nc<me&&Rd>Nc&&(Nc=me),e=a(2*Ob.plfleft),e<Wb&&(e=Wb),e<wc&&e>=ye&&(wc=e)));ph=!1;if(Ob.bordersprite_seen&&0==(S.extra&1)&&Zc.nr_sprites){for(var p=vd,Ae=
Wb,e=0;e<Zc.nr_sprites;e++){var l;l=Sd[Zc.first_sprite_entry+e].pos;l<p&&(p=l);l=Sd[Zc.first_sprite_entry+e].max+3;l>Ae&&(Ae=l)}p=a(p>>Cc)+(1<<Zb);Ae=a(Ae>>Cc)+(1<<Zb);p<wc&&(wc=p);wc<Wb&&(wc=Wb);Ae>Nc&&(Nc=Ae);Nc>vd&&(Nc=vd);ff=0;ph=!0}Ig=Wb<wc?0:Wb-wc;Ig=T(Ig);e=Af;p=Bf;if(e<p&&(Ob.bordersprite_seen&&0==(S.extra&1)&&(e>Wb&&(e=Wb),p<vd&&(p=vd)),0>e&&(e=0),1758<p&&(p=1758),e<p))for(;e<=p;e++)aa[e].clr();Bf=0;Af=1759;ee=1760-(d-56<<zf);d=wc-g;Wd>wc&&(d+=Wd-wc);ne=1760+T(d);if(0!=Zc.nr_sprites){we&&
(d=b())&&(0<ff?ff-=d:wc-=d);if(ye<cd){g=T(cd-ye);d=1760-g;g=d+g;for(e=d;e<g;e++)D.apixels[e]=0;ye=cd}if(me>ce){d=1760+T(ce-cd);g=d+T(me-ce);for(e=d;e<g;e++)D.apixels[e]=0;ye=cd}}}function Z(a,b,g){g=g||rd||0!=(S.extra&1)?0:S.acolors[0];a+=B;for(b+=B;a<b;a++)Ma[a]=g}function ea(a,b){for(var g=rd||0!=(S.extra&1)?0:S.acolors[0],d=a+B,e=a+B+b;d<e;d++)Ma[d]=g}function Ua(a){var b=Wb,g=Wb+ra.drawbuffer.inwidth;a<oe||a>=Be?(g=rd,rd=3,ea(b,ra.drawbuffer.inwidth),rd=g):rd?(rd=3,ea(b,ra.drawbuffer.inwidth)):
Wd<=b&&Rd>=g?ea(b,ra.drawbuffer.inwidth):(b<Wd&&(a=Wd<g?Wd:g,Z(b,a,!0),b=a),b<Rd&&(a=Rd<g?Rd:g,Z(b,a,!1),b=a),b<g&&Z(b,g,!0))}function r(a,b,g,d){var e=aa[a],p=e.data;b=b?Ya?qh:Jg:rh;a+=sh;g=b[g];p&=~(Cf>>>g>>>g);return(0<Ce||a>=ff)&&0!=p?(a=p&255,a=0==a?4+Kg[p>>8]:Kg[a],p=p>>>2*a&15,e.attach&&e.stdata&3<<a?(e=p,e=d?e+cg[1]:e+16):(e=p&3,p>>=2,e=e?e:p,e=d?0<p?e+cg[1]:e+cg[0]:e+16,e+=2*a),e):0}function R(a,b){return(a>>dg&th)+(b>>dg&th)>>1<<dg|(a>>eg&uh)+(b>>eg&uh)>>1<<eg|(a>>fg&vh)+(b>>fg&vh)>>1<<
fg}function Fa(a,b){return((a>>16&255)+(b>>16&255)>>1<<16|(a>>8&255)+(b>>8&255)>>1<<8|(a>>0&255)+(b>>0&255)>>1<<0)>>>0}function Lb(a,b,g){ne=ac(ne,a,b)}function t(a,b,g){ne=bc(ne,a,b)}function tb(a,b,g){return a}function Da(a,g,d){var e=b();e&&Lg(a,g,g+e);B+=e;a=ai(a,g,d);B-=e;return a}function sb(a,g,d){if(g<de&&d>de)a=kd(a,g,g+(de-g)),g=de;else if(d<=de)return a=kd(a,g,d);var e=b();e&&Lg(a,g,g+e);sh=e;da+=e;B+=e;a=Lg(a,g,d);B-=e;da-=e;sh=0;return a}function Sa(){C=S.acolors;fb=ic;mc=255;Mg&&(C=
bi.acolors);aa=ci;da=0;kd=tb;if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA){if(0==Mc)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_aga_genlock:Ti;bc=Pb?linetoscr_16_aga_spr_genlock:Ui;kd=Vi;break;case 4:ac=Pb?linetoscr_32_aga_genlock:Wi,bc=Pb?linetoscr_32_aga_spr_genlock:Xi,kd=Yi}else if(2==Mc)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_stretch2_aga_genlock:Zi;bc=Pb?linetoscr_16_stretch2_aga_spr_genlock:$i;kd=aj;break;case 4:ac=Pb?linetoscr_32_stretch2_aga_genlock:
bj,bc=Pb?linetoscr_32_stretch2_aga_spr_genlock:cj,kd=dj}else if(1==Mc)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_stretch1_aga_genlock:ej;bc=Pb?linetoscr_16_stretch1_aga_spr_genlock:fj;kd=gj;break;case 4:ac=Pb?linetoscr_32_stretch1_aga_genlock:hj,bc=Pb?linetoscr_32_stretch1_aga_spr_genlock:ij,kd=jj}else if(-1==Mc)if(SAEV_config.video.lores_mode)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_shrink1f_aga_genlock:kj;bc=Pb?linetoscr_16_shrink1f_aga_spr_genlock:lj;kd=mj;break;case 4:ac=
Pb?linetoscr_32_shrink1f_aga_genlock:nj,bc=Pb?linetoscr_32_shrink1f_aga_spr_genlock:oj,kd=pj}else switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_shrink1_aga_genlock:qj;bc=Pb?linetoscr_16_shrink1_aga_spr_genlock:rj;kd=sj;break;case 4:ac=Pb?linetoscr_32_shrink1_aga_genlock:tj,bc=Pb?linetoscr_32_shrink1_aga_spr_genlock:uj,kd=vj}else if(-2==Mc)if(SAEV_config.video.lores_mode)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_shrink2f_aga_genlock:wj;bc=Pb?linetoscr_16_shrink2f_aga_spr_genlock:
xj;kd=yj;break;case 4:ac=Pb?linetoscr_32_shrink2f_aga_genlock:zj,bc=Pb?linetoscr_32_shrink2f_aga_spr_genlock:Aj,kd=Bj}else switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_shrink2_aga_genlock:Cj;bc=Pb?linetoscr_16_shrink2_aga_spr_genlock:Dj;kd=Ej;break;case 4:ac=Pb?linetoscr_32_shrink2_aga_genlock:Fj,bc=Pb?linetoscr_32_shrink2_aga_spr_genlock:Gj,kd=Hj}b()&&(ai=ac,Lg=bc,ac=Da,bc=sb)}if(!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)&&Df)if(0==Mc)switch(ra.drawbuffer.pixbytes){case 2:ac=
Ij;bc=Jj;break;case 4:ac=Kj,bc=Lj}else if(-1==Mc)if(SAEV_config.video.lores_mode)switch(ra.drawbuffer.pixbytes){case 2:ac=Mj;bc=Nj;break;case 4:ac=Oj,bc=Pj}else switch(ra.drawbuffer.pixbytes){case 2:ac=Qj;bc=Rj;break;case 4:ac=Sj,bc=Tj}else if(-2==Mc)if(SAEV_config.video.lores_mode)switch(ra.drawbuffer.pixbytes){case 2:ac=Uj;bc=Vj;break;case 4:ac=Wj,bc=Xj}else switch(ra.drawbuffer.pixbytes){case 2:ac=Yj;bc=Zj;break;case 4:ac=ak,bc=bk}if(!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||Df))if(0==
Mc)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_genlock:ck;bc=Pb?linetoscr_16_spr_genlock:dk;break;case 4:ac=Pb?linetoscr_32_genlock:ek,bc=Pb?linetoscr_32_spr_genlock:fk}else if(2==Mc)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_stretch2_genlock:gk;bc=Pb?linetoscr_16_stretch2_spr_genlock:hk;break;case 4:ac=Pb?linetoscr_32_stretch2_genlock:ik,bc=Pb?linetoscr_32_stretch2_spr_genlock:jk}else if(1==Mc)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_stretch1_genlock:kk;
bc=Pb?linetoscr_16_stretch1_spr_genlock:lk;break;case 4:ac=Pb?linetoscr_32_stretch1_genlock:mk,bc=Pb?linetoscr_32_stretch1_spr_genlock:nk}else if(-1==Mc)if(SAEV_config.video.lores_mode)switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_shrink1f_genlock:ok;bc=Pb?linetoscr_16_shrink1f_spr_genlock:pk;break;case 4:ac=Pb?linetoscr_32_shrink1f_genlock:qk,bc=Pb?linetoscr_32_shrink1f_spr_genlock:rk}else switch(ra.drawbuffer.pixbytes){case 2:ac=Pb?linetoscr_16_shrink1_genlock:sk;bc=Pb?linetoscr_16_shrink1_spr_genlock:
tk;break;case 4:ac=Pb?linetoscr_32_shrink1_genlock:uk,bc=Pb?linetoscr_32_shrink1_spr_genlock:vk}}function ta(a,b,g){g?Z(a,b,g):kd(ne,a,b)}function ka(a,b,g){}function qa(a,b,g){a=T(b-a);if(Eb)if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)if(7<=Ce)for(;0<a--;){b=D.apixels[Gd]^gc;switch(b&3){case 0:Ra=S.color_regs_aga[b>>2]&16777215;break;case 1:Ra&=16776963;Ra|=b&252;break;case 2:Ra&=262143;Ra|=(b&252)<<16;break;case 3:Ra&=16712703,Ra|=(b&252)<<8}ya[Gd++]=Ra}else for(;0<a--;){b=D.apixels[Gd]^
gc;switch(b&48){case 0:Ra=S.color_regs_aga[b]&16777215;break;case 16:Ra&=16776960;Ra|=(b&15)<<4;break;case 32:Ra&=65535;Ra|=(b&15)<<20;break;case 48:Ra&=16711935,Ra|=(b&15)<<12}ya[Gd++]=Ra}else for(;0<a--;){b=D.apixels[Gd];switch(b&48){case 0:Ra=S.color_regs_ecs[b]&4095;break;case 16:Ra&=4080;Ra|=b&15;break;case 32:Ra&=255;Ra|=(b&15)<<8;break;case 48:Ra&=3855,Ra|=(b&15)<<4}ya[Gd++]=Ra}else for(;0<a--;)b=D.apixels[Gd],Ra=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?S.color_regs_aga[b^gc]&
16777215:S.color_regs_ecs[b]&4095,ya[Gd++]=Ra}function nb(a,b,g){b=a.pos+(-55<<Cc);b<Af&&(Af=b);for(var d=a.pos;d<a.max;d++,b++)0<=b&&1760>b&&(aa[b].data=yd[a.first_pixel-a.pos+d],aa[b].stdata=$c.bytes[a.first_pixel-a.pos+d],aa[b].attach=g);b>Bf&&(Bf=b)}function $a(){var a=ra.drawbuffer,b=2==a.pixbytes,g,d;a.height_allocated>SAEC_Video_MAX_UAE_HEIGHT&&SAEF_fatal(SAEE_Internal,"playfield.init_row_map() resolution too high, aborting...");null===zd&&(zd=Array(SAEC_Video_MAX_UAE_HEIGHT+1));if(null===
Ng||Ng!==a.bufmem||Ef!=a.height_allocated||rb!=a.rowbytes||0!=Og){wh=null;d=0==Ef?SAEC_Video_MAX_UAE_HEIGHT:Ef;for(g=a.height_allocated;g<SAEC_Video_MAX_UAE_HEIGHT+1&&g<d+1;g++)zd[g]=b?new Uint16Array(Pg):new Uint32Array(Pg);if(null!==a.bufmem){var e=a.bufmem.byteLength;g=0;for(d=a.bufmem_pos;g<a.height_allocated;g++,d+=a.rowbytes)zd[g]=d+a.rowbytes<=e?b?new Uint16Array(a.bufmem,d,a.rowbytes>>1):new Uint32Array(a.bufmem,d,a.rowbytes>>2):b?new Uint16Array(Pg):new Uint32Array(Pg)}Ng=a.bufmem;Ef=a.height_allocated;
rb=a.rowbytes;Og=!1}}function Ga(){var a=!1;zf=Ob.bplres;Ce=Ob.nr_planes;Eb=Ob.ham_seen;Gb=Ob.ehb_seen;0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)&&0!=(Ob.bplcon2&512)&&(Gb=!1);di=0!=(Ob.bplcon0&512);a=Df;Df=zf==SAEC_Config_Video_HResolution_SuperHiRes&&0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)&&0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA);a=a!=Df;ei=Ob.bplcon2&7;xh=Ob.bplcon2>>3&7;Cf=4294901760<<4*xh;Cf|=65535<<4*ei&65535;Cf>>>=0;Fb=1024==
(Ob.bplcon0&1024);Ya=64==(Ob.bplcon2&64);Mg!=(0!=(Ob.bplcon0&32))&&(mc=255,Mg=0!=(Ob.bplcon0&32),a=!0);Mg&&(Eb&&6==Ce&&(mc=15),Eb&&8==Ce&&(mc=252),Eb=!1,Gb&&(mc=31),Gb=!1);gb=Ob.bplcon3>>10&7;cg[0]=(Ob.bplcon4>>4&15)<<4;cg[1]=(Ob.bplcon4>>0&15)<<4;gc=Ob.bplcon4>>8;var b=S.extra>>4&3;b!=oh&&(oh=b,a=!0);a&&Sa()}function fa(a){var b=Ub(a);if(!(a&2048))return 0;if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA){if(6==b||8==b)return 1}else{if(0<za(a))return 0;if(5<=b)return 1}return 0}function U(a,
b){if(Ib!=a||0>b){if(b)I(S,Qg[a]),jb=1;else{for(var g=0;g<S.acolors.length;g++)S.acolors[g]=Qg[a].acolors[g];S.extra=Qg[a].extra;jb=0}Ib=a}else b&&1!=jb&&(I(S,Qg[a]),jb=1)}function na(b,g,d){for(var e=Wb,Ae=Wb+ra.drawbuffer.inwidth,p=Zc.first_color_change;p<=Zc.last_color_change;p++){var P=Uc[p].regno,l=Uc[p].value,x,f;f=x=p==Zc.last_color_change?Ae:a(Uc[p].linepos);x>Ae&&(f=Ae);f>e&&e<Wd&&(x=f<=Wd?f:Wd,b(e,x,!0),e=x);f>e&&e<wc&&(x=f<=wc?f:wc,b(e,x,!1),e=x);if(f>e&&e>=wc&&e<Nc){x=f<=Nc?f:Nc;if(5<
xh&&!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)){var h=e,A=x,v=Zb,h=h>>v,A=A>>v;if(5==Ce&&!Fb)for(h=ee+h;h<ee+A;h++)D.apixels[h]&16&&(D.apixels[h]=16);else if(Fb&&Ya)for(h=ee+h;h<ee+A;h++)D.apixels[h]&42&&(D.apixels[h]|=64);else if(Fb&&!Ya)for(h=ee+h;h<ee+A;h++)D.apixels[h]&=-43}if(gc&&ph&&g!==ta){A=g;h=x;if(e<de){var v=h<de?h:de,m=v-e;ta(e,v,!1);m=0<=Mc?m>>Mc:m<<Mc;ne+=m;e=v}A(e,h<ze?h:ze,!1);h>ze&&ta(ze,h,!1)}else g(e,x,!1);e=x}f>e&&e>=Nc&&(x=f<=Rd?f:Rd,b(e,x,!1),e=x);f>Rd&&(b(Rd,f,
!0),e=f);if(4096<=P)if(65535==P)rd=1;else{P-=4096;switch(P){case 256:Ob.bplcon0=l;Ob.bplres=za(l);Ob.nr_planes=Ub(l);Ob.ham_seen=fa(l);break;case 260:Ob.bplcon2=l;break;case 262:Ob.bplcon3=l;break;case 268:Ob.bplcon4=l}Ga();l=Mc;Mc=Zb-zf;Mc!=l&&Sa()}else 0<=P&&(0==P&&l&2147483648?(S.extra&=-2,S.extra&=-3,S.extra&=-5,S.extra|=0!=(l&1)?1:0,S.extra|=2==(l&3)?4:0,S.extra|=4==(l&5)?2:0):0==P&&l&1073741824?(S.extra&=-17,S.extra&=-33,S.extra|=(l&3)<<4,Ga()):(f=S,x=P,A=l,we?f.color_regs_aga[x]=A:f.color_regs_ecs[x]=
A,S.acolors[P]=N(l)));if(e>=Ae)break}(d<oe||d>=Be)&&b(Wb,Wb+ra.drawbuffer.inwidth,!0)}function Xb(){var a,b;for(a=0;2>=a;a++)fi[a]=0;gi=0;yh=-1;zh=0;hi++;ja();if(gg){a=gg[0].first_pixel;b=gg[Ok].first_pixel-a;for(var g=0;g<b;g++)yd[a+g]=0,$c.bytes[a+g]=0}Ok=Ff;ii=Ff=Hd=0;De=-1;gg=Ve[Ee];Sd=Ve[Ee^1];Pk=Rg[Ee];Uc=Rg[Ee^1];Qk=Gf[Ee];Qg=Gf[Ee^1];Rk=gf[Ee];Fe=gf[Ee^1];Ee^=1;Ah=ji=-1;Sd[0].first_pixel=2089120*Ee;ki=1;0>Id&&(Id=Y);Id>hf&&(hf=Id);b=(Ka+1<<pe)+2;for(a=0;a<b;a++)switch(fc[a]){case 8:fc[a]=
9;break;case 6:break;default:fc[a]=1}qe?(Oa(),Bh=1,qe--):Bh=0;a=Wb;b=Xd;g=ra.drawbuffer.inwidth;SAEV_config.video.xcenter&&0<Ge&&!SAEV_config.video.gf[0].gfx_filter_autoscale?(Wb=Ge-He<g&&2==SAEV_config.video.xcenter?Math.truncate((Ge-He-g)/2)+He:Ge-g-Math.truncate((Ge-He-g)/2),Wb&=~((0>Zb?1>>-Zb:1<<Zb)-1),hg||li||2==SAEV_config.video.xcenter&&Wb<a&&a<He&&32>=He-Wb&&(Wb=a)):ra.drawbuffer.extrawidth?(Wb=(412<<Zb)-g,0<ra.drawbuffer.extrawidth&&(Wb+=ra.drawbuffer.extrawidth<<SAEV_config.video.hresolution)):
Wb=0>ra.drawbuffer.inxoffset?0:ra.drawbuffer.inxoffset-56;Wb>(412<<Zb)-32&&(Wb=(412<<Zb)-32);0>Wb&&(Wb=0);Ch=Wb&=~((0>Zb?1>>-Zb:1<<Zb)-1);vd=Wb+g;vd>412<<Zb&&(vd=412<<Zb);g=Hf;g>ra.drawbuffer.inheight&&(g=ra.drawbuffer.inheight);g>>=pe;Xd=Y;SAEV_config.video.ycenter&&0<=Id&&!SAEV_config.video.gf[0].gfx_filter_autoscale&&(Xd=hf-Id<g&&2==SAEV_config.video.ycenter?Math.truncate((hf-Id-g)/2)+Id:Id,hg||mi||2==SAEV_config.video.ycenter&&Xd!=b&&b<=Id&&b+g>hf&&(Xd=b));Xd+g>ga+(ga>>1)&&(Xd=ga+(ga>>1)-g);0>
Xd&&(Xd=0);Dh=Xd<<pe;Eh=Ka-Y+1<<pe;if(a!=Wb||b!=Xd)a=0<Gc&&pe?2:1,a>qe&&(qe=a);Ge=0;He=3E4;ra.drawbuffer.xoffset=224+(Wb<<2-SAEV_config.video.hresolution);ra.drawbuffer.yoffset=Xd<<1;li=mi=hg=!1;Ib=hf=Id=-1}function wb(a,b,g,d,e){if(!(0>=g))switch(b){case 1:a[g]=d&255;break;case 2:a[g]=d&65535;break;case 4:a[g]=d}}function L(){wk=-1;$b=0;jf=-1;We=Jd=0;Fh!=Sk&&(li=mi=!0);Sk=Fh;if(Ie!=Tk||Je!=Uk)li=!0;Tk=Ie;Uk=Je;if(kf!=Vk||lf!=Wk||Gh!=Xk||Hh!=Yk)mi=!0;Vk=kf;Wk=lf;Xk=Gh;Yk=Hh;Je=Ie=0;kf=412<<Zb;lf=
0;Gh=412<<Zb;ig=Hh=0;mf=ga+(Tb?1:0);for(var a=ni=Fh=0;8>a;a++)Qc[a].ptxhpos=256,Qc[a].ptxvpos2=-1;vb=8}function mb(a,b,g,d){Sg++;if(b||0>=Gc||SAEV_config.video.iscanlines&&0<Gc||2<=Sg||a||0>x){Sg=0;if(0==Kd)if(a=ra.drawbuffer,ra.outbuffer=a,SAER.video.lockscr(a,!1)){for(b=0;b<Eh;b++){var e=b+Xe;g=b+Dh;d=Ad[e];e=Ad[e+1];if(d>=a.inheight)break;if(!(0>d)){rd=0;a:{var p=0,P=0,l=void 0,h=0,l=fc[g];Ob=sd[g];Zc=Fe[g];0<=Ob.plfleft&&(gi++,fi[Ob.bplres]++);switch(l){case 9:Ih||(SAEF_warn("playfield.pfield_draw_line() Shouldn't get here... this is a bug."),
Ih++);break a;case 5:fc[g]=6;p=-1;break;case 6:break a;case 4:Ob=sd[g-1];Zc=Fe[g-1];fc[g]=8;0>Ob.plfleft&&(p=1);break;case 8:case 7:break a;case 3:0<=e&&(P=1,fc[g+1]=8);default:0>Ob.plfleft&&(p=1),fc[g]=7}var l=Uc[Zc.first_color_change].regno,f=Zc.nr_color_changes,l=1<f||1==f&&65535!=l&&-1!=l;Ma=null;B=0;null!==ra.drawbuffer.linemem&&(h=1,Ma=2==ra.drawbuffer.pixbytes?new Uint16Array(ra.drawbuffer.linemem):new Uint32Array(ra.drawbuffer.linemem));null===Ma&&null!==ra.drawbuffer.emergmem&&P&&(0==p||
l)&&(h=2,Ma=2==ra.drawbuffer.pixbytes?new Uint16Array(ra.drawbuffer.emergmem):new Uint32Array(ra.drawbuffer.emergmem));null===Ma&&(h=0,Ma=zd[d]);B-=Ch;null!==wh&&(wh[d]=di);if(0==p){Ga();q(!1);var p=Ob.plflinelen,A=440;if(0==Ce)for(var v=A,p=A+8*p;v<p;v++)D.apixels_l[v]=0;else{for(var f=re[g],v=0,m=50,r=100,Rb=150,X=200,oa=250,y=300,F=350;0<p--;){var O=0,C=0,z=0,kc=0,H=0,Jc=0,E=0,Lc=0;switch(Ce){case 8:O=f[F++];case 7:C=f[y++];case 6:z=f[oa++];case 5:kc=f[X++];case 4:H=f[Rb++];case 3:Jc=f[r++];case 2:E=
f[m++];case 1:Lc=f[v++]}var la=(O^C>>>1)&1431655765,O=O^la,C=C^la<<1,la=(z^kc>>>1)&1431655765,z=z^la,kc=kc^la<<1,la=(H^Jc>>>1)&1431655765,H=H^la,Jc=Jc^la<<1,la=(E^Lc>>>1)&1431655765,E=E^la,Lc=Lc^la<<1,la=(O^z>>>2)&858993459,O=O^la,z=z^la<<2,la=(C^kc>>>2)&858993459,C=C^la,kc=kc^la<<2,la=(H^E>>>2)&858993459,H=H^la,E=E^la<<2,la=(Jc^Lc>>>2)&858993459,Jc=Jc^la,Lc=Lc^la<<2,la=(O^H>>>4)&252645135,O=O^la,H=H^la<<4,la=(C^Jc>>>4)&252645135,C=C^la,Jc=Jc^la<<4,la=(z^E>>>4)&252645135,z=z^la,E=E^la<<4,la=(kc^Lc>>>
4)&252645135,kc=kc^la,Lc=Lc^la<<4,la=(O^C>>>8)&16711935,O=O^la,C=C^la<<8,la=(z^kc>>>8)&16711935,z=z^la,kc=kc^la<<8,la=(H^Jc>>>8)&16711935,H=H^la,Jc=Jc^la<<8,la=(E^Lc>>>8)&16711935,E=E^la,Lc=Lc^la<<8,la=(O^z>>>16)&65535,O=O^la,z=z^la<<16,la=(C^kc>>>16)&65535,C=C^la,kc=kc^la<<16,la=(H^E>>>16)&65535,H=H^la,E=E^la<<16,la=(Jc^Lc>>>16)&65535,Jc=Jc^la,Lc=Lc^la<<16;SAEC_LITTLE_ENDIAN?(D.apixels_l[A]=(O&255)<<24|(O&65280)<<8|(O&16711680)>>>8|(O&4278190080)>>>24,D.apixels_l[A+1]=(H&255)<<24|(H&65280)<<8|(H&
16711680)>>>8|(H&4278190080)>>>24,D.apixels_l[A+2]=(C&255)<<24|(C&65280)<<8|(C&16711680)>>>8|(C&4278190080)>>>24,D.apixels_l[A+3]=(Jc&255)<<24|(Jc&65280)<<8|(Jc&16711680)>>>8|(Jc&4278190080)>>>24,D.apixels_l[A+4]=(z&255)<<24|(z&65280)<<8|(z&16711680)>>>8|(z&4278190080)>>>24,D.apixels_l[A+5]=(E&255)<<24|(E&65280)<<8|(E&16711680)>>>8|(E&4278190080)>>>24,D.apixels_l[A+6]=(kc&255)<<24|(kc&65280)<<8|(kc&16711680)>>>8|(kc&4278190080)>>>24,D.apixels_l[A+7]=(Lc&255)<<24|(Lc&65280)<<8|(Lc&16711680)>>>8|(Lc&
4278190080)>>>24):(D.apixels_l[A]=O,D.apixels_l[A+1]=H,D.apixels_l[A+2]=C,D.apixels_l[A+3]=Jc,D.apixels_l[A+4]=z,D.apixels_l[A+5]=E,D.apixels_l[A+6]=kc,D.apixels_l[A+7]=Lc);A+=8}if(null!==If&&Jf>g){p=Ob.plflinelen;A=new Uint32Array(If,3520*g);p*=8;m=!0;for(v=0;v<p;v++)if(A[v]!=f[v]){m=!1;break}if(m)255!=Ye[g]&&(Ye[g]++,Ye[g]>Ze[g]&&(Ze[g]=Ye[g]));else{for(v=0;v<p;v++)A[v]=f[v];Ye[g]!=Ze[g]&&(Ze[g]=0);Ye[g]=0}}}U(Ob.ctable,Ob.ham_seen||Gb||Df);if(Ob.ham_seen){p=rd;f=Ig;Gd=ne;Ra=we?S.color_regs_aga[0]:
S.color_regs_ecs[0];if(Eb)if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)if(7<=Ce)for(;0<f--;)switch(A=D.apixels[Gd++]^gc,A&3){case 0:Ra=S.color_regs_aga[A>>2]&16777215;break;case 1:Ra&=16776963;Ra|=A&252;break;case 2:Ra&=262143;Ra|=(A&252)<<16;break;case 3:Ra&=16712703,Ra|=(A&252)<<8}else for(;0<f--;)switch(A=D.apixels[Gd++]^gc,A&48){case 0:Ra=S.color_regs_aga[A]&16777215;break;case 16:Ra&=16776960;Ra|=(A&15)<<4;break;case 32:Ra&=65535;Ra|=(A&15)<<20;break;case 48:Ra&=16711935,Ra|=(A&15)<<
12}else for(;0<f--;)switch(A=D.apixels[Gd++],A&48){case 0:Ra=S.color_regs_ecs[A]&4095;break;case 16:Ra&=4080;Ra|=A&15;break;case 32:Ra&=255;Ra|=(A&15)<<8;break;case 48:Ra&=3855,Ra|=(A&15)<<4}else 0<f&&(A=D.apixels[Gd+f-1],Ra=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?S.color_regs_aga[A^gc]&16777215:S.color_regs_ecs[A]&4095);na(ka,qa,g);l&&(U(Ob.ctable,-1),Ga());rd=p;Gd=ne;Eb=Ob.ham_at_start}if(Zc.nr_sprites){p=l=void 0;if(0!=(S.extra&4)&&Ob.bordersprite_seen&&0==(S.extra&1)){l=Mc;p=f=f=
void 0;if(0>l){l=-l;f=ee+(wc<<l);for(p=f+(de-wc<<l);f<p;f++)D.apixels[f]=0;f=ee+(ze<<l);p=f+(Nc-ze<<l)}else{f=ee+(wc>>l);for(p=f+(de-wc>>l);f<p;f++)D.apixels[f]=0;f=ee+(ze>>l);p=f+(Nc-ze>>l)}for(;f<p;f++)D.apixels[f]=0}for(l=0;l<Zc.nr_sprites;l++)p=Sd[Zc.first_sprite_entry+l],nb(p,Fb,p.has_attached)}Zc.nr_sprites&&0!=(S.extra&4)&&0==(S.extra&1)&&Ob.bordersprite_seen?na(ta,t,g):na(Z,Zc.nr_sprites?t:Lb,g);2==h&&zd[d].set(Ma.subarray(0,ra.drawbuffer.inwidth));P&&(2==h?zd[e].set(Ma.subarray(0,ra.drawbuffer.inwidth)):
0==h&&zd[e].set(zd[d].subarray(0,ra.drawbuffer.inwidth)));if(Zc.nr_sprites){if(Af<cd)for(d=T(cd-Af),g=1760-d,d=g+d;g<d;g++)D.apixels[g]=0;if(Bf>ce)for(g=1760+T(ce-cd),d=g+T(Bf-ce);g<d;g++)D.apixels[g]=0}}else if(0<p){p=!1;U(Ob.ctable,0);if(Ob.bordersprite_seen&&0==(S.extra&1)&&Zc.nr_sprites&&(p=!0,Ga(),q(!0),!(vd<=Wb)))for(f=A=0,Wb<cd&&(f=T(cd-Wb),A=-f),vd>cd&&(f+=T(vd-cd)),A=1760-A,f=A+f;A<f;A++)D.apixels[A]=0;if(p||l){if(p){for(l=0;l<Zc.nr_sprites;l++)p=Sd[Zc.first_sprite_entry+l],nb(p,Fb,p.has_attached);
na(ta,ta,g)}else Nc=wc=vd,na(Z,Z,g);2==h&&zd[d].set(Ma.subarray(0,ra.drawbuffer.inwidth));P&&(2==h?zd[e].set(Ma.subarray(0,ra.drawbuffer.inwidth)):0==h&&zd[e].set(zd[d].subarray(0,ra.drawbuffer.inwidth)))}else-1>Ob.plfleft?(d=rd,rd=1,Ua(g),rd=d):Ua(g),P&&0==h&&(Ma=zd[e],B=0-Ch,Ua(g))}else d=rd,rd=1,Ua(g),rd=d}}}if(null!==If)for(b=0;b<Eh;b++){e=b+Xe;g=b+Dh;d=Ad[e];e=Ad[e+1];if(d>=a.inheight)break;if(!(0>d)){if(g>=Jf)break;Ma=zd[d];d=Ze[g];0<=e&&(d=Ze[g&-2]);e=g=0;4>=d?g=e=Jb[d]:8>=d&&(e=Jb[d-5]);for(d=
0;8>d;d++)wb(Ma,ra.drawbuffer.pixbytes,d,ic[g],1);for(d=8;16>d;d++)wb(Ma,ra.drawbuffer.pixbytes,d,ic[e],1)}}a===ra.outbuffer&&SAER.video.unlockscr(a)}else qe=2;if(0>SAEV_command){SAEV_command=-SAEV_command;Tg|=2;SAEF_setSpcFlags(SAEC_spcflag_BRK|SAEC_spcflag_MODE_CHANGE);return}Kd++;Kd>=SAEV_config.video.framerate&&(Kd=0);Tg&&(Kd=1);0==Kd&&Xb()}SAER.gui.flicker_led(-1,0,0)}function pb(a,g,b){if(0==Kd)switch(b|=0!=qe||null!==If?1:0,g){case 0:fc[a]=b?2:7;break;case 1:fc[a]=b?3:7;b|=9!=fc[a+1]?1:0;fc[a+
1]=b?4:8;break;case 4:fc[a]=b?2:7;6!=fc[a+1]&&(fc[a+1]=5);break;case 3:0<a&&1==fc[a-1]&&(fc[a-1]=2);fc[a]=b?2:7;break;case 2:fc[a]=b?2:7;if(1==fc[a+1]||9==fc[a+1]||4==fc[a+1])fc[a+1]=2;break;case 8:fc[a+1]=5;fc[a]=2;break;case 6:b|=7!=fc[a]?1:0;fc[a+1]=7;fc[a]=b?2:7;break;case 7:fc[a]=2;0<a&&(fc[a-1]=5);Gc||a!=2*(ga+Tb)-2||(fc[a+1]=5);break;case 5:b|=7!=fc[a]?1:0,fc[a]=b?2:7,0<a&&(fc[a-1]=7),Gc||a!=2*(ga+Tb)-2||(fc[a+1]=7)}}function zb(){ra.drawbuffer.flush_line=function(a,b,g){};ra.drawbuffer.flush_block=
function(a,b,g,d){};ra.drawbuffer.flush_screen=function(a,b,g,d){};ra.drawbuffer.flush_clear_screen=function(a,b){};ra.drawbuffer.lockscr=function(a,b){return 1};ra.drawbuffer.unlockscr=function(a,b){}}function Pa(a){var b=!1;a?(0==Gc&&(b=!0),Gc=SAEV_config.video.vresolution?1:-1):(Gc&&(b=!0),Gc=0);return b}function db(){Ge=0;ja();Oa();var a,b,g;g=ra.drawbuffer.height_allocated;if(0!=g){Jh=pe=SAEV_config.video.vresolution;0<x&&0>=Gc&&(pe=0,Jh=1);Ad=Array(1187);Ug=Array(g);b=593<<Jh;Xe=Y<<pe;Hf=-1;
for(a=0;a<b;a++){var d=a-Xe;d>=g&&0>Hf&&(Hf=d);if(a<Xe||d>=g)d=-1;Ad[a]=d}0>Hf&&(Hf=b-Xe);for(a=0;a<g;a++)Ug[a]=-1;for(a=b-1;a>=Xe;a--)if(-1!=Ad[a])for(b=Ad[a];b<g&&-1==Ug[b];b++)Ug[b]=a>>pe;ra.xchange=1<<2-SAEV_config.video.hresolution;ra.ychange=pe?1:2;xe=0;Ue=3E4;oe=0;Be=3E4;wa()}Ng=null;rb=Ef=0;Og=!1;$a();Sg=0;SAEF_memset(yd,0,0,4178240);SAEF_memset($c.bytes,0,0,4178240);Xb();Sa();qe=2;hg=!0;y(ra.drawbuffer);y(ra.tempbuffer);hg=!0;Ih=0}function Za(){Ze=Ye=If=null;SAEV_config.video.refreshIndicator&&
(Jf=600,If=new ArrayBuffer(3520*Jf),Ye=new Uint8Array(Jf),Ze=new Uint8Array(Jf));if(null===Jg){Jg=Array(256);qh=Array(256);rh=Array(256);Vc=Array(256);Wc=Array(256);xc=Array(256);yc=Array(256);zc=Array(256);Ac=Array(256);Kg=Array(256);oi=new Uint32Array(256);for(var a=0;256>a;a++){var b=a>>0&1|a>>1&2|a>>2&4|a>>3&8,g=a>>1&1|a>>2&2|a>>3&4|a>>4&8;xc[a]=0==b&&0!=g;yc[a]=0!=g;zc[a]=0==b?g:b;Ac[a]=0==g?b:g;Jg[a]=0==b?0==g?16:8:0;qh[a]=0==g?0==b?16:0:8;rh[a]=0==a?16:8;0<g&&(g+=8);Vc[a]=128<=a?a&127:0==b?
g:b;Wc[a]=128<=a?a&127:0==g?b:g;a&64&&(Wc[a]=0,Vc[a]=0);Kg[a]=a&15?0:2;oi[a]=(a&3&&a&12)<<9|(a&3&&a&48)<<10|(a&3&&a&192)<<11|(a&12&&a&48)<<12|(a&12&&a&192)<<13|(a&48&&a&192)<<14}}for(a=0;256>a;a++)bi.acolors[a]=h((a<<16|a<<8|a)>>>0);SAEV_Playfield_picasso_requested_on=SAEV_Playfield_picasso_on=!1;Ma=null!==ra.drawbuffer.bufmem?2==ra.drawbuffer.pixbytes?new Uint16Array(ra.drawbuffer.bufmem):new Uint32Array(ra.drawbuffer.bufmem):null;Tg=0;zb();db()}function xb(){var a=SAEV_config.video.apmode[0];return SAEV_Playfield_picasso_on||
!a.gfx_vsync?0:0==a.gfx_vsyncmode?1:0<=SAEV_config.cpu.speed?-1:-2}function za(a){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||(a&=-65);return a&64?SAEC_Config_Video_HResolution_SuperHiRes:a&32768?SAEC_Config_Video_HResolution_HiRes:SAEC_Config_Video_HResolution_LoRes}function Ea(a){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(a&=-65);return a&64?SAEC_Config_Video_HResolution_SuperHiRes:a&32768?SAEC_Config_Video_HResolution_HiRes:SAEC_Config_Video_HResolution_LoRes}
function Qb(a){a=a>>2&3;return 3==a?64:0==a?16:32}function Ub(a){return a&16&&a&28672?0:a&16?8:a>>12&7}function sc(){this.ptxvpos2=this.ptxhpos2=this.ptxhpos=this.dmacycle=this.dmastate=this.armed=this.dblscan=this.vstop=this.vstart=this.xpos=this.pt=0;this.ignoreverticaluntilnextline=!1;this.clr=function(){this.ptxvpos2=this.ptxhpos2=this.ptxhpos=this.dmacycle=this.dmastate=this.armed=this.dblscan=this.vstop=this.vstart=this.xpos=this.pt=0;this.ignoreverticaluntilnextline=!1}}function Dc(){return SAEV_config.video.vresolution&&
0>x&&592>V}function hc(){kc=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?Rb:0;nf=Qb(kc)}function Sb(){$h=we=0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA);Zk=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?25:SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?17:1;hc()}function W(a){if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)for(var b=0;256>b;b++){var g=we?a.color_regs_aga[b]:a.color_regs_ecs[b];0>g||16777215<g||(a.acolors[b]=N(g))}else for(b=0;32>
b;b++)g=we?a.color_regs_aga[b]:a.color_regs_ecs[b],0>g||4095<g||(a.acolors[b]=N(g))}function Aa(){Sb();W(Kb);W(S);for(var a=0;1186>a;a++)W(Gf[0][a]),W(Gf[1][a])}function z(){if(!(1188<=ii))if(0>De&&(I(Qg[ii],Kb),De=ii++),sa.ctable=De,0>Ah||ji!=De||sd[$b].ctable!=Ah){var a=sd[$b].ctable,b=0;if(0>a)b=1,Ah=ji=-1;else{var g;a:{g=Qk[a];if(we)for(var d=0;256>d;d++){if(g.color_regs_aga[d]!=Kb.color_regs_aga[d]){g=1;break a}}else for(d=0;32>d;d++)if(g.color_regs_ecs[d]!=Kb.color_regs_ecs[d]){g=1;break a}g=
g.extra==Kb.extra?0:1}($k=0!=g)&&(b=1);Ah=a;ji=De}Oc|=b}else $k&&(Oc=1)}function Ca(){return nc&128||nc&16384||Cb&64}function Ba(){return Ca()?ba:212}function Ia(a){var b=a>=ba?2*ba+1:2*a+2;!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)&&V<=hb+(Qa?ld?1:0:0)&&(b=Kh);for(b&=511;;){var g=b;Vg>g&&(g=512);g>=xk&&Vg<xk&&0==jg&&(0>sa.diwfirstword&&(sa.diwfirstword=0>$e?-56<<Zb:$e),jg=1);(a>=ba&&Ca()||g>=yk&&Vg<yk)&&1==jg&&(0>sa.diwlastword&&(sa.diwlastword=0>of?0:of),jg=0);if(512!=g)break;
Vg=-1}Vg=b}function ma(a){var b=Ea(a);a=Ub(a);return Lh[uc][b][a]}function cb(){0<kg&&(Kf=zk,kg=0);0<lg&&(Lf=Ak,lg=0)}function va(a){var b=al[4*uc+Bd],g=8<=b?8:b;if(5>vb){var d;d=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?vc+4<a||vc>Ba()?Ba():vc:vc+4<=a||vc>Ba()?Ba():vc;d=Cd+(d-a+4)+b-1&~(b-1)}else d=Cd+b-1&~(b-1),7==vb&&(d-=b);bl=a+(d-Cd)+g}function Hb(a,b,g){a*=2;4364==b&&a++;Uc[Hd].linepos=a;Uc[Hd].regno=b;Uc[Hd].value=g;Hd++;Uc[Hd].regno=-1}function la(a,b){return SAEV_config.chipset.mask&
SAEC_Config_Chipset_Mask_AGA?24576==(a&28688):SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?24576==(a&64512)||28672==(a&64512):(24576==(a&64512)||28672==(a&64512))&&!SAEV_config.chipset.deniseNoEHB}function Ta(){return 0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)&&0==Bd&&7==mg}function Bb(){return!(nc&2048||nc&32)&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS)&&SAEV_config.chipset.ntsc?!0:!1}
function Ic(a){var b=a&15|(a&3072)>>6,g=a>>4&15|(a>>4&3072)>>6,d=a>>8&3;a=a>>12&3;var e=Mf>>td;md[0]=(b&e)<<td;md[0]|=d>>2-td;md[1]=(g&e)<<td;md[1]|=a>>2-td;var p=Nf-((pi-24&Of)<<1);pf[0]=(b+p&e)<<td;pf[0]|=d>>2-td;pf[1]=(g+p&e)<<td;pf[1]|=a>>2-td}function Bc(){Ca()?(Pf[0]=512<<Bd,Pf[1]=512<<Bd):(Pf[0]=2*(ba+1)+0<<Bd,Pf[1]=Pf[0],Bb()&&Pf[1]++)}function yb(a){switch(kc&3){case 0:uc=0;break;case 1:case 2:uc=1;break;case 3:uc=2}cl=Ea(Cb)!=za(Cb);Bd=Ea(Cb);mg=Ub(Cb);qi=ma(Cb);Mh=al[4*uc+Bd];Wg=Mh-1;dl=
el[4*uc+Bd];ri=1<<dl;Of=ri-1;fl=gl[4*uc+Bd];Nh=1<<fl;hl=Mh-ri;Nf=16<<uc;Bk=2<<uc;Mf=Nf-1;Bc();Ic(Qf);0>sa.plfleft&&(sa.bplres=Bd,sa.bplcon0=Cb,sa.nr_planes=mg);il=Rf[uc][Bd][qi];va(a);Ke=-1;Oh=0;ng=mg;Ta()&&(ng=6);wd=2}function cc(a){switch(Oh){case 0:Hg(a,Cb,!1);Oh++;Ke+=jl;break;case 1:yb(a)}}function Nb(a){wd=2;20>a+3+(SAEV_Copper_access?1:0)+(8==mg?1:0)?(Hg(a,Cb,!1),yb(a)):0>Ke&&(Ke=a+(SAEV_Copper_access?1:0),jl=3+(8==mg?1:0),Oh=0,SAEV_Copper_access||cc(a))}function lb(a){if(ng>sa.nr_planes){if(Le)for(var b=
sa.nr_planes;b<ng;b++){var g=re[$b],d=50*b,e=Le;if(!Oc)for(var p=d,P=d+e;p<P;p++)if(g[p]){Oc=1;break}p=d;for(P=d+e;p<P;p++)g[p]=0;0<=sa.plfleft&&(Ph[b]=0,a&&(Qh[b]=Rh[b]=0))}sa.nr_planes=ng}}function ca(a,b,g){if(a<qi){var d,e=Bk;g>ba-3&&!(nc&128)&&(d=Bk,g==ba-1?SAEF_warn("playfield.fetch_warn() BPL fetch conflicts with strobe refresh slot!"):SAEF_warn("playfield.fetch_warn() BPL fetch at hpos %d/%d",g,ba),d=fe,Sf=g,e=d);d=Yb[a];Yb[a]+=e;qc[a]+=e;0==a&&(og=!0);switch(b){case 0:Tf[a]=SAER_Memory_chipGet16_indirect(d);
SAEV_Custom_last_value=Tf[a];break;case 1:Xg[a]=0;se[a]=SAER_Memory_chipGet32_indirect(d);SAEV_Custom_last_value=se[a];Tf[a]=se[a]&65535;break;case 2:Xg[a]=SAER_Memory_chipGet32_indirect(d),se[a]=SAER_Memory_chipGet32_indirect(d+4),SAEV_Custom_last_value=se[a],Tf[a]=se[a]&65535}7==vb&&Cd>=(Cd&~Wg)+hl&&(kg!=g&&kg&&(Kf=zk,kg=0),lg!=g&&lg&&(Lf=Ak,lg=0),b=kc&16384?(Yg>>8^V)&1?Lf:Kf:a&1?Lf:Kf,Yb[a]+=b,qc[a]+=b,cb())}}function xa(a,b,g){var d,e=16-g;for(d=a;d<sa.nr_planes;d+=b)ud[d]<<=g;for(d=a;d<pg;d+=
b)ud[d]|=Uf[d]>>>e,Uf[d]<<=g}function Mb(a,b,g,d){var e=Nf-g,p=65535>>16-g;for(d=a;d<sa.nr_planes;d+=b)ud[d]<<=g;for(d=a;d<pg;d+=b)ud[d]=32>e?ud[d]|(te[d]<<32-e|ue[d]>>>e)&p:ud[d]|te[d]>>>e-32&p,te[d]=te[d]<<g|ue[d]>>>32-g,ue[d]<<=g}function Ab(a,b,g,d){2==b?0==d?xa(a,2,g):Mb(a,2,g,d):0==d?xa(0,1,g):Mb(0,1,g,d)}function lc(a,b){if(0==b)for(var g=Td&Mf,d=0;2>d;d++){var e=md[d];g>e&&(e+=Nf);var p=e-g,e=a;if(e>p&&(Ab(d,2,p,0),e-=p,Ld[d])){for(p=d;p<qf;p+=2)Uf[p]=Ph[p];Ld[d]=!1}e&&Ab(d,2,e,0)}else for(g=
Td&Mf,d=0;2>d;d++){e=md[d];g>e&&(e+=Nf);p=e-g;e=a;if(e>p&&(Ab(d,2,p,b),e-=p,Ld[d])){for(p=d;p<qf;p+=2)te[p]=Qh[p],ue[p]=Rh[p];Ld[d]=!1}e&&Ab(d,2,e,b)}}function Vb(a,b){if(Td+a>=Pf[ge]){var g=Pf[ge]-Td,d=a;d>=g&&(lc(g,b),d-=g,Td=0,0<=Sh&&(Ic(Sh),Sh=-1),md[0]-=2,md[0]&=Mf,md[1]-=2,md[1]&=Mf);d&&(lc(d,b),Td+=d)}else{if(md[0]==md[1])if(0==b){g=Td&Mf;d=md[0];g>d&&(d+=Nf);d-=g;g=a;if(g>d&&(Ab(0,1,d,0),g-=d,Ld[0])){for(d=0;d<qf;d++)Uf[d]=Ph[d];Ld[0]=!1;Ld[1]=!1}g&&Ab(0,1,g,0)}else{g=Td&Mf;d=md[0];g>d&&(d+=
Nf);d-=g;g=a;if(g>d&&(Ab(0,1,d,b),g-=d,Ld[0])){for(d=0;d<qf;d++)te[d]=Qh[d],ue[d]=Rh[d];Ld[0]=!1;Ld[1]=!1}g&&Ab(0,1,g,b)}else lc(a,b);Td+=a}gd+=a;if(32==gd){for(var g=re[$b],d=Le,e=0;e<sa.nr_planes;e++)g[d]!=ud[e]&&(g[d]=ud[e],Oc=1),ud[e]=0,d+=50;Le++;gd=0}}function qb(a,g){switch(g){case 0:Kc(a,0);break;case 1:Kc(a,1);break;case 2:Kc(a,2)}}function Kc(a,g){16<a&&(qb(16,g),a-=16);var b=32-gd;b<a&&(Vb(b,g),a-=b);Vb(a,g)}function dc(a){0<hd&&0<=sa.plfleft&&qb(hd,a);hd=0}function od(a){if(SAEV_config.chipset.mask&
SAEC_Config_Chipset_Mask_AGA||ve[0]||ve[1]){var g=ve[0],b=ve[1],d=Qf>>12&3;ve[0]=(Qf>>8&3)>>td;ve[1]=(d&3)>>td;if(0<=a&&ve[0]!=g||ve[1]!=b)Sc(a,0,1073741824|ve[0]),Kb.extra&=-17,Kb.extra&=-33,Kb.extra|=ve[0]<<4,De=-1}}function qd(a){za(Me)!=td&&dc(uc);td=za(Me);si=2<<td;Td=2*a<<td;Ck!=Me&&(Hb(a,4352,Me),Ck=Me);Ne=Ub(Me);Ta()?6>pg&&(pg=6):pg=Ne;qf=pg;od(a)}function tc(a,g){return SAER_Memory_chipCheck_indirect(a,g)?SAER_Memory_chipXLate_indirect(a):null}function ed(a,g){var b;if(0==g)for(b=0;8>b;b++)Ph[b]=
Tf[b];else for(b=0;8>b;b++)Qh[b]=Xg[b],Rh[b]=se[b];Ld[0]=Ld[1]=!0;0>sa.plfleft&&(sa.plfleft=a);qd(a);ng>sa.nr_planes&&lb(g)}function Rc(a,g,b,d){var e=tc(Yb[a],2*g),p=pf[a&1],P=gd,l=ud[a],x=Tf[a],f=re[$b],h=50*a+Le;d&&(Yb[a]+=2*g,qc[a]+=2*g);if(null!==e){for(var A=Uf[a]<<p;0<g;){var v=32-P,A=(A|x)>>>0,m=A>>>p&65535;b&&16>v?(l=l<<v&4294967295,l=(l|m>>>16-v)>>>0,Oc|=(f[h]^l)>>>0,f[h++]=l,l=m,P=16-v):(l=(l<<16&4294967295|m)>>>0,P+=16,32==P&&(Oc|=(f[h]^l)>>>0,f[h++]=l,P=0));A=A<<16&4294967295;g--;d&&
(x=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2)}Tf[a]=x;Uf[a]=A>>>p;ud[a]=l}}function Xc(a,g,b,d){var e=tc(Yb[a],2*g),p=pf[a&1],P=gd,l,x,f=ud[a],h=se[a],A=re[$b],v=50*a+Le,m=16+p;d&&(Yb[a]+=2*g,qc[a]+=2*g);if(null!==e){l=te[a];x=ue[a];p&&(l=(l<<p&4294967295|x>>>32-p)>>>0,x=x<<p&4294967295);for(;0<g;){x=(x|h)>>>0;for(var r=0;2>r;r++){var q,Rb=32-P;q=32>m?(l<<32-m|x>>>m)&65535:l>>>m-32&65535;b&&16>Rb?(f=f<<Rb&4294967295,f=(f|q>>>16-Rb)>>>0,Oc|=(A[v]^f)>>>0,A[v++]=f,f=q,P=16-Rb):(f=(f<<
16&4294967295|q)>>>0,P+=16,32==P&&(Oc|=(A[v]^f)>>>0,A[v++]=f,P=0));l=(l<<16&4294967295|x>>>16)>>>0;x=x<<16&4294967295}g-=2;d&&(h=(SAER_Memory_chipData[e]<<24|SAER_Memory_chipData[e+1]<<16|SAER_Memory_chipData[e+2]<<8|SAER_Memory_chipData[e+3])>>>0,e+=4)}se[a]=h;p?(ue[a]=l<<32-p&4294967295|x>>>p,te[a]=l>>>p):(te[a]=l,ue[a]=x);ud[a]=f}}function Pc(a,g){g&&(g&=31,a[3]=a[3]<<g|a[2]>>>32-g,a[2]=a[2]<<g|a[1]>>>32-g,a[1]=a[1]<<g|a[0]>>>32-g,a[0]<<=g)}function eb(a,g,b,d){var e=tc(Yb[a],2*g),p=pf[a&1],P=
gd,l=new Uint32Array(4),x=ud[a],f=Xg[a],h=se[a],A=re[$b],v=50*a+Le,m=48+p;d&&(Yb[a]+=2*g,qc[a]+=2*g);if(null!==e){l[3]=0;l[2]=0;l[1]=te[a];l[0]=ue[a];for(Pc(l,p);0<g;){l[1]|=f;l[0]|=h;for(var r=0;4>r;r++){var q,Rb=32-P;q=32>m?(l[1]<<32-m|l[0]>>>m-0)&65535:64>m?(l[2]<<64-m|l[1]>>>m-32)&65535:96>m?(l[3]<<96-m|l[2]>>>m-64)&65535:l[3]>>>m-96&65535;b&&16>Rb?(x=x<<Rb&4294967295,x=(x|q>>>16-Rb)>>>0,Oc|=(A[v]^x)>>>0,A[v++]=x,x=q,P=16-Rb):(x=(x<<16&4294967295|q)>>>0,P+=16,32==P&&(Oc|=(A[v]^x)>>>0,A[v++]=x,
P=0));Pc(l,16)}g-=4;d&&(f=(SAER_Memory_chipData[e]<<24|SAER_Memory_chipData[e+1]<<16|SAER_Memory_chipData[e+2]<<8|SAER_Memory_chipData[e+3])>>>0,h=(SAER_Memory_chipData[e+4]<<24|SAER_Memory_chipData[e+5]<<16|SAER_Memory_chipData[e+6]<<8|SAER_Memory_chipData[e+7])>>>0,e+=8)}Xg[a]=f;se[a]=h;if(g=p)g&=31,l[0]=l[1]<<32-g|l[0]>>>g,l[1]=l[2]<<32-g|l[1]>>>g,l[2]=l[3]<<32-g|l[2]>>>g,l[3]>>>=g;te[a]=l[1];ue[a]=l[0];ud[a]=x}}function Fc(a,g,b){0>sa.plfleft||2<=qg||(qg=2,dc(g),sa.plfright=a,b||SAEV_config.chipset.mask&
SAEC_Config_Chipset_Mask_ECS_AGNUS&&(Dd=0))}function Qd(a,g){var b=!1;if(!(7!=vb||2!=Dd&&1!=Dd||Zg)&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN)){do{b=Cd&Of;switch(Nh){case 8:switch(b){case 0:ca(7,g,a);break;case 1:ca(3,g,a);break;case 2:ca(5,g,a);break;case 3:ca(1,g,a);break;case 4:ca(6,g,a);break;case 5:ca(2,g,a);break;case 6:ca(4,g,a);break;case 7:ca(0,g,a);break;default:Fc(a,g,!0);return}break;case 4:switch(b){case 0:ca(3,g,a);break;case 1:ca(1,g,a);break;case 2:ca(2,g,a);break;case 3:ca(0,g,a);
break;default:Fc(a,g,!0);return}break;case 2:switch(b){case 0:ca(1,g,a);break;case 1:ca(0,g,a);break;default:Fc(a,g,!0);return}}Cd++;hd+=si;16<hd&&(hd=0);16==hd&&dc(g);b=!0;Sf=a}while(0!=(Cd&Wg));b&&0<Dk&&(Dk--,SAEF_warn("playfield.maybe_finish_last_fetch() bitplane DMA crossing scanlines!"))}Fc(a,g,!0)}function Vd(a,g,b){var d=!0,e=1==We;if(4==vb&&g&&e)$g=0,d=!1,0<=Oe&&(Oe=g?-5:-4),0>Oe&&(Oe++,0==Oe&&(vb=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?5:3));else if(!g||!e){d=!1;if(3==
vb||5==vb||6==vb)$g=1,0>=Oe&&(Oe=g?5:4);0<Oe&&(d=!0,Oe--,0==Oe&&(d=!1,vb=4))}(g&&e||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS)&&4!=vb&&(a==vc&&Ek!=a?(5>vb&&(vb=5),Pe=a+4):a==Pe&&(rg=!0,6>vb&&(vb=6)));if(0==(Cd&Wg)){if(7==vb)return Fc(a,b,!1),1;6==vb&&(vb=7)}a==Ba()&&4>vb&&(vb=6);0<Ke&&a>=Ke&&cc(a);if(d)switch(g=Cd&Of,Nh){case 8:switch(g){case 0:ca(7,b,a);break;case 1:ca(3,b,a);break;case 2:ca(5,b,a);break;case 3:ca(1,b,a);break;case 4:ca(6,b,a);break;case 5:ca(2,b,a);break;case 6:ca(4,
b,a);break;case 7:ca(0,b,a);break;default:6==vb&&(Zg=!0)}break;case 4:switch(g){case 0:ca(3,b,a);break;case 1:ca(1,b,a);break;case 2:ca(2,b,a);break;case 3:ca(0,b,a);break;default:6==vb&&(Zg=!0)}break;case 2:switch(g){case 0:ca(1,b,a);break;case 1:ca(0,b,a);break;default:6==vb&&(Zg=!0)}}og&&(Dd=3,og=!1);Cd++;hd+=si;Fk&&(dc(b),Ic(Qf),Fk=!1);16<hd&&(SAEF_error("one_fetch_cycle() toscr_nbits > 16 (%d)",hd),hd=0);16==hd&&dc(b);return 0}function fd(a,g){if(0==Kd){var b=Md;for(lb(g);b<a;b++)hd+=si,16<hd&&
(SAEF_error("update_fetch_x() toscr_nbits > 16 (%d)",hd),hd=0),16==hd&&dc(g);a>=ba?Qd(b,g):dc(g)}}function bd(){hd=Le=gd=0;sa.bplres=Bd}function ad(){return SAEV_config.chipset.agnusDIP?!1:V+1>=ga+Tb}function Sc(a,g,b){if(!(4096>g&&0!=Kd||V<Y)){Ia(a);SAER.playfield.decide_line(a);0>sa.ctable&&z();if((4096>g||4364==g)&&9>a&&!(nc&128)&&0<=jf){var d=Fe[jf],e=d.last_color_change,p=!1;65535==Uc[e-1].regno&&(e--,p=!0);d.last_color_change++;d.nr_color_changes++;Uc[e].linepos=2*(a+ba)+(4364==g?1:0);Uc[e].regno=
g;Uc[e].value=b;p?(Uc[e+1].linepos=2*v,Uc[e+1].regno=65535,Uc[e+2].regno=-1):Uc[e+1].regno=-1}Hb(a,g,b)}}function pd(a,g,b){var d=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&g&1&&b&32;g=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&g&1&&b&16;0<=a&&(0!=(Kb.extra&1)!=d||0!=(Kb.extra&2)!=g)&&(Sc(a,0,2147483648|(d?1:0)|(0!=(Kb.extra&4)?2:0)|(g?4:0)),Kb.extra&=-2,Kb.extra&=-3,Kb.extra|=d?1:0,Kb.extra|=g?2:0,De=-1);return d}function jd(a,g,b){g=SAEV_config.chipset.mask&
SAEC_Config_Chipset_Mask_AGA&&g&1&&b&2;0<=a&&0!=(Kb.extra&4)!=g&&(Sc(a,0,2147483648|(0!=(Kb.extra&1)?1:0)|(0!=(Kb.extra&2)?4:0)|(g?2:0)),Kb.extra&=-5,Kb.extra|=g?4:0,De=-1,g&&0==(Kb.extra&1)&&(sa.bordersprite_seen=!0));return g&&0==(Kb.extra&1)}function Tc(a,g,b){256==g?(b&2048&&(sa.ham_seen=1),sa.ehb_seen=la(b,rf),pd(a,b,dd),jd(a,b,dd)):260==g?sa.ehb_seen=la(Cb,b):262==g&&(pd(a,Cb,b),jd(a,Cb,b));Sc(a,g+4096,b)}function le(a,g){var b;switch(g>>6&3){case 0:b=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&
za(a)==SAEC_Config_Video_HResolution_SuperHiRes?SAEC_Config_Video_HResolution_HiRes:SAEC_Config_Video_HResolution_LoRes;break;case 1:b=SAEC_Config_Video_HResolution_LoRes;break;case 2:b=SAEC_Config_Video_HResolution_HiRes;break;case 3:b=SAEC_Config_Video_HResolution_SuperHiRes;break;default:b=SAEC_Config_Video_HResolution_LoRes}return b}function ke(a,g,b,d,e,p,P,l){for(var x=0;b;){var f=0,h=0;if(a>=ah&&a<Gk||dd&2)f=(b&3)<<2*d;if(0==(x&p)){var A=yd[g]|f;yd[g++]=A;P&&(h|=A);a++}0<e&&(A=yd[g]|f,yd[g++]=
A,P&&(h|=A),a++);1<e&&(A=yd[g]|f,yd[g++]=A,P&&(h|=A),A=yd[g]|f,yd[g++]=A,P&&(h|=A),a++,a++);x++;b>>>=2;P&&(h&=l)&&(Yd|=Q[M[h&255]|M[h>>8]<<2])}}function df(a,g,b,d,e){var p;for(p=0;p<a&&!(d[p]>b)&&!(d[p]==b&&e[p]<g);p++);for(;a>p;a--)d[a]=d[a-1],e[a]=e[a-1];d[a]=b;e[a]=g}function Pd(g,b){"undefined"==typeof b&&(b=!1);var d=new Int32Array(16),e=new Int32Array(16),p=256<<Cc,l=!1;if(!(0>sa.plfleft)||dd&2){var P=2*g;g>=ba&&(P+=14*Cc);if(!(0!=Kd||20>g||0==bh||P==ch)){Ia(g);SAER.playfield.decide_line(g);
Gk=32767;ah=0;0<=sa.diwlastword&&(Gk=f(sa.diwlastword-(1<<Zb))<<Cc);0<=sa.diwfirstword&&(ah=f(sa.diwfirstword-(1<<Zb))<<Cc);if(0<=sa.plfleft){var x=2*sa.plfleft-1<<Cc,h=2*sa.plfright-1<<Cc;if(x>ah&&x<h)if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)ah=x;else if(40<=sa.plfleft||ti)ah=x}for(x=h=0;8>x;x++){var A=Qc[x].xpos,v=kc&32768?A&~p:A,m=v>>Cc,q=b&&he[x]&Zk?0:1;0>A||!Qc[x].armed||(m>ch&&m<=P+q&&df(h++,x,v,e,d),kc&32768&&!(v&p)?(v|=p,m=v>>Cc,m>ch&&m<=P+q&&df(h++,8+x,v,e,d)):!(kc&
128)&&A>=2<<Cc&&A<=9<<Cc&&(v+=2*ba<<Cc,m=v>>Cc,m>ch&&m<=P+q&&df(h++,8+x,v,e,d)))}for(x=0;x<h;x++){var r=p=d[x]&7,Rb=e[x],X=Qe[p],t=Re[p],A=Sd[Ff],oa=Ff,y=q=v=void 0,F=m=void 0,O=void 0,B=0,C=void 0,z=0,O=0,F=Cc-Th;0>F&&(O=-F,F=0,B=1<<O);m=nf<<Cc>>Th;C=he[r|1]&128;!ki&&Sd[oa-1].max+nf>=Rb?A=Sd[--oa]:(Ff++,A.pos=Rb,A.has_attached=0);Rb<A.pos&&SAEF_error("record_sprite() sprxp < e.pos (%d < %d)",Rb,A.pos);A.max=Rb+m;Sd[oa+1].first_pixel=A.first_pixel+(A.max-A.pos+3&-4);ki=0;y=oc[Hk>>12];q=A.first_pixel+
Rb-A.pos;for(v=0;v<nf;v+=16){var oa=X[z],D=t[z],oa=(rc[oa&255]<<16|rc[oa>>8]|Ed[D&255]<<16|Ed[D>>8])>>>0,D=v<<F>>O;SAEV_config.chipset.colLevel>SAEC_Config_Chipset_ColLevel_None&&y?ke(Rb+D,q+D,oa,r,F,B,1,y):ke(Rb+D,q+D,oa,r,F,B,0,y);z++}if(C&&(!(Bd==SAEC_Config_Video_HResolution_SuperHiRes&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)){r=16843009<<(r&254)>>>0&255;for(v=0;v<m;v+=8)$c.bytes[q+0]|=r,$c.bytes[q+1]|=r,$c.bytes[q+
2]|=r,$c.bytes[q+3]|=r,$c.bytes[q+4]|=r,$c.bytes[q+5]|=r,$c.bytes[q+6]|=r,$c.bytes[q+7]|=r,q+=8;A.has_attached=1}if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_SPREN)&&Cb&1&&dd&2&&!(dd&32)&&0<p){for(A=l=0;l<nf;l+=16,A++)if(v=a(e[x]+l>>Cc)+(1<<Zb),Qe[p][A]||Re[p][A])kf>v&&v>=48<<SAEV_config.video.hresolution&&(kf=v),lf<v+16&&v<=448<<SAEV_config.video.hresolution&&(lf=v+16);l=!0}}ch=P;l&&(V<Ie&&(Ie=V),V<mf&&(mf=V),V>Je&&(Je=V),V>ig&&(ig=V))}}}function Ec(a,g){var b=Sd[a.first_sprite_entry],d=Sd[a.last_sprite_entry],
e=gg[g.first_sprite_entry],p;if(a.nr_sprites!=g.nr_sprites)return 1;if(0==a.nr_sprites)return 0;for(p=0;p<a.nr_sprites;p++){var P=Sd[a.first_sprite_entry+p],l=gg[g.first_sprite_entry+p];if(P.pos!=l.pos||P.max!=l.max||P.has_attached!=l.has_attached)return 1}d=d.first_pixel+(d.max-d.pos)-b.first_pixel;for(p=0;p<d;p++)if(yd[b.first_pixel+p]!=yd[e.first_pixel+p]||$c.bytes[b.first_pixel+p]!=$c.bytes[e.first_pixel+p])return 1;return 0}function Db(a,g){if(a.nr_color_changes!=g.nr_color_changes)return 1;
if(0==a.nr_color_changes)return 0;for(var b=0;b<a.nr_color_changes;b++){var d=Uc[a.first_color_change],e=Pk[g.first_color_change];if(0!=(d.linepos==e.linepos&&d.regno==e.regno&&d.value==e.value?0:1))return 1}return 0}function ef(){var a,g,b,d,e=ba;if(0==Kd){Ia(e);SAER.playfield.decide_line(e);SAER.playfield.decide_fetch_safe(e);0>sa.plfleft||(2>qg&&Fc(ba,uc,!0),qg=3,Zg&&5<=vb&&(vb=8),a=sa.plfright,b=uc,g=0,16>=gd&&(g+=16,Vb(16,b)),0!=gd&&(g+=32-gd,Vb(32-gd,b)),g+=32,Vb(16,b),Vb(16,b),2==b&&(g+=32,
Vb(16,b),Vb(16,b),g+=32,Vb(16,b),Vb(16,b)),sa.plfright=a+(g>>1+td),sa.plflinelen=Le,V>=Y&&(0>Id||V<Id)&&(Id=V),hf=V,sd[$b].plflinelen==sa.plflinelen&&sd[$b].plfleft==sa.plfleft&&sd[$b].bplcon0==sa.bplcon0&&sd[$b].bplcon2==sa.bplcon2&&sd[$b].bplcon3==sa.bplcon3&&sd[$b].bplcon4==sa.bplcon4)||(Oc=1);Hb(v,65535,0);0<=sa.plfleft&&0>sa.plflinelen&&(0!=Dd&&SAEF_warn("playfield.finish_decisions() fetch_state != fetch_not_started"),sa.plfright=sa.plfleft,sa.plflinelen=0,sa.bplres=SAEC_Config_Video_HResolution_LoRes);
1==jg&&(sa.diwlastword=412<<Zb,0>sa.diwfirstword&&(sa.diwfirstword=0));sa.diwfirstword!=sd[$b].diwfirstword&&(Oc=1);sa.diwlastword!=sd[$b].diwlastword&&(Oc=1);a=Fe[$b];g=Rk[$b];b=sd[$b];d=Oc|Bh;if(0<=sa.plfleft&&0<sa.nr_planes){var p=$e;of>Ge&&(Ge=of);p<He&&(He=p)}Pd(e+1);a.last_sprite_entry=Ff;a.last_color_change=Hd;0>sa.ctable&&z();a.nr_color_changes=Hd-a.first_color_change;a.nr_sprites=Ff-a.first_sprite_entry;sa.plfleft!=sd[$b].plfleft&&(d=1);!d&&Db(a,g)&&(d=1);!d&&(0<=sa.plfleft||sa.bplcon0&1&&
sa.bplcon3&2&&!(sa.bplcon3&32))&&Ec(a,g)&&(d=1);d?(Oc=1,e=sa,b.plfleft=e.plfleft,b.plfright=e.plfright,b.plflinelen=e.plflinelen,b.diwfirstword=e.diwfirstword,b.diwlastword=e.diwlastword,b.ctable=e.ctable,b.bplcon0=e.bplcon0,b.bplcon2=e.bplcon2,b.bplcon3=e.bplcon3,b.bplcon4=e.bplcon4,b.nr_planes=e.nr_planes,b.bplres=e.bplres,b.ehb_seen=e.ehb_seen,b.ham_seen=e.ham_seen,b.ham_at_start=e.ham_at_start,b.bordersprite_seen=e.bordersprite_seen):b.ctable=sa.ctable;Hd+=5;Kh+=2*ba;SAEV_config.chipset.mask&
SAEC_Config_Chipset_Mask_ECS_DENISE||V!=hb+(Qa?ld?1:0:0)-1||Kh++;if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||V>hb+(Qa?ld?1:0:0)||SAEV_config.chipset.agnusDIP&&0==V)Kh=2*ba,Vg=1;303586<=Hd&&(SAEF_warn("playfield.finish_decisions() color_change buffer overflow!"),Hd=0,a.nr_color_changes=0,a.first_color_change=0,a.last_color_change=0)}}function yf(){if(0==Kd){Ne=pg=0;sa.bplres=Bd;sa.nr_planes=0;dh=og=!1;sa.plfleft=-1;sa.plflinelen=-1;sa.ham_seen=!!(Cb&2048);sa.ehb_seen=!!la(Cb,rf);
sa.ham_at_start=!!(Cb&2048);sa.bordersprite_seen=jd(-1,Cb,dd);sa.diwfirstword=-1;sa.diwlastword=-1;1==jg&&(sa.diwfirstword=0,sa.diwfirstword!=sd[$b].diwfirstword&&(Oc=1));sa.ctable=-1;Oc=0;Fe[$b].first_color_change=Hd;Fe[$b].first_sprite_entry=Ff;ki=1;Dd=ch=0;0<=Ke&&(Hg(0,Cb,!0),yb(0));Ke=-1;Oh=0;ti=!1;cb();Td=0;Ic(Qf);if(7<=vb||4==vb)vb=0;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(rg||(vb=3));pi=256;qg=0;Pe=ie=260;Oe=Vf=Ek=-1;wd&&(wd--,wd||($g=0));Ld[0]=Ld[1]=!1;for(var a=0;8>
a;a++)ud[a]=0,Ph[a]=0,Uf[a]=0;if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)for(a=0;8>a;a++)Qh[a]=Rh[a]=0,te[a]=ue[a]=0;Zg=!1;Sf?(Sf-=ba-3,0<Sf&&(dh=og=!0,bd(),ed(Sf,uc)),Sf=0):bd();xd=-5;Md=eh=-1;if(ui)for(ui=!1,a=0;8>a;a++)Qc[a].ignoreverticaluntilnextline=!1;sa.bplcon0=Cb;sa.bplcon2=rf;sa.bplcon3=dd;sa.bplcon4=Uh;af++}}function A(){var a=Ja,b=La,d=1;jc=SAEV_Playfield_fake_vblank_hz=0;g=1;if(.1<Math.abs(SAEV_config.chipset.refreshRate)&&(d=SAEV_config.chipset.refreshRate/Va,Na=SAEV_config.chipset.refreshRate,
xb())){var e={};SAEF_Playfield_getvsyncrate(Na,e);e.hz!=Na&&(SAEF_Playfield_getvsyncrate(Na,e),Na=e.hz,jc=e.mult,0<jc&&(g=0))}SAEV_Playfield_fake_vblank_hz||(SAEV_Playfield_fake_vblank_hz=Na);SAEV_Audio_vsynctimebase_orig=SAER.events.calc_vsynctimebase(SAEV_Playfield_fake_vblank_hz);Bb()&&(b+=.5);Gc?a+=.5:ld&&(a+=1);SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&(e=a*b*SAEV_Playfield_fake_vblank_hz,SAEF_log("playfield.compute_vsynctime() %.1f*%.1f*%.6f=%.6f, syncadjust %f",a,b,SAEV_Playfield_fake_vblank_hz,
e,d),SAER.devices.update_sound(e,d))}function X(){var a=Gc?1:0,g=nc&32?0:1;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(g=SAEV_config.chipset.ntsc?1:0);for(var b=0;b<SAEV_config.chipset.refresh.length;b++){var d=SAEV_config.chipset.refresh[b];if((0>d.horiz||d.horiz==ba)&&(0>d.vert||d.vert==Ka)&&(0>d.ntsc||0<d.ntsc&&g||0==d.ntsc&&!g)&&(0>d.lace||0<d.lace&&a||0==d.lace&&!a)&&(0>d.framelength||0<d.framelength&&Tb||0==d.framelength&&!Tb||0<=d.framelength&&a)&&(d.rtg&&SAEV_Playfield_picasso_on||
!d.rtg&&!SAEV_Playfield_picasso_on)&&(0>d.vsync||0<d.vsync&&xb()||0==d.vsync&&!xb()))return d}return null}function oa(){var a=Gc?1:0,g=nc&32?0:1,b=!1;Na=a?Se:ld?Wa:ab;for(var d=X();null!==d;){var l=-1;if(SAEV_Playfield_picasso_on||SAEV_Playfield_picasso_requested_on)l=0==d.locked?Na:d.rate,SAEV_config.chipset.refreshRate=l;else{if(0==d.locked){SAEV_config.chipset.refreshRate=Na;break}else l=d.rate;0>l&&(l=d.rate);0<l&&(SAEV_config.chipset.refreshRate=l)}b=!0;break}b||(SAEV_config.chipset.refreshRate=
Na);p=d;nd=e=Zd=je=0;ra.drawbuffer.inxoffset=-1;ra.drawbuffer.inyoffset=-1;if(nc&128){Ea(Cb);b=SAEV_config.video.hresolution;0<x&&b++;2<b&&(b=2);l=SAEV_config.video.vresolution;0<x&&!a&&l--;0>l&&(l=0);2<l&&(l=2);var f=Yc;ra.drawbuffer.inwidth=2*(ba-(ba-v+28)+1)<<b;ra.drawbuffer.inxoffset=2*f;ra.drawbuffer.extrawidth=0;ra.drawbuffer.inwidth2=ra.drawbuffer.inwidth;ra.drawbuffer.inheight=(Xa<ga?Xa:ga)-Y+1<<l}else ra.drawbuffer.inwidth=SAEC_Video_MAX_AMIGA_WIDTH<<SAEV_config.video.hresolution,ra.drawbuffer.extrawidth=
-1,ra.drawbuffer.inwidth2=ra.drawbuffer.inwidth,ra.drawbuffer.inheight=Ka-Y+1<<SAEV_config.video.vresolution;ra.drawbuffer.inheight2=ra.drawbuffer.inheight;ra.drawbuffer.inwidth>ra.drawbuffer.width_allocated&&(ra.drawbuffer.inwidth=ra.drawbuffer.width_allocated);ra.drawbuffer.inwidth2>ra.drawbuffer.width_allocated&&(ra.drawbuffer.inwidth2=ra.drawbuffer.width_allocated);ra.drawbuffer.inheight>ra.drawbuffer.height_allocated&&(ra.drawbuffer.inheight=ra.drawbuffer.height_allocated);ra.drawbuffer.inheight2>
ra.drawbuffer.height_allocated&&(ra.drawbuffer.inheight2=ra.drawbuffer.height_allocated);ra.drawbuffer.outwidth=ra.drawbuffer.inwidth;ra.drawbuffer.outheight=ra.drawbuffer.inheight;ra.drawbuffer.outwidth>ra.drawbuffer.width_allocated&&(ra.drawbuffer.outwidth=ra.drawbuffer.width_allocated);ra.drawbuffer.outheight>ra.drawbuffer.height_allocated&&(ra.drawbuffer.outheight=ra.drawbuffer.height_allocated);for(b=0;b<sd.length;b++)sd[b].clr(),sd[b].plfleft=-2;for(b=0;b<gf[0].length;b++)gf[0][b].clr(),gf[1][b].clr();
A();ob=(SAEV_config.chipset.ntsc?SAEC_Playfield_CLOCK_NTSC:SAEC_Playfield_CLOCK_PAL)/(ba+(Bb()?.5:0));SAEF_log("playfield.compute_framesync() %s mode%s%s V=%.4fHz H=%0.4fHz (%dx%d+%d) IDX=%d (%s) DSP=%d RTG=%d/%d",g?"NTSC":"PAL",a?" lace":sf?" loflace":"",0<x?" dblscan":"",Na,ob,ba,ga,Tb?1:0,null!==d?d.index:-1,null!==d&&d.label.length?d.label:"<?>",SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0].gfx_display,SAEV_Playfield_picasso_on?1:0,SAEV_Playfield_picasso_requested_on?1:0);SAER.video.target_graphics_buffer_update()&&
db()}function Lc(a){var g,b=x,d=ga,e=Na,p=0;a||(ia=0);ha=ia;x=0;l=!1;(nc&160)!=(Wf&160)&&(p=1);nc!=Wf&&(SAEF_log("playfield.init_hz() BEAMCON0 0x%04x -> 0x%04x",nc,Wf),ha=ia=0);nc=Wf;a=nc&32?0:1;g=Gc?1:0;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(a=SAEV_config.chipset.ntsc?1:0);var P=SAEV_config.chipset.ntsc?SAEC_Playfield_CLOCK_NTSC:SAEC_Playfield_CLOCK_PAL;a?(ga=262,ba=227,Y=21,Va=Na=60,tf=20,hb=10,Qa=!1,ab=P/((ga+0)*(ba+.5)),Wa=P/((ga+1)*(ba+.5)),Se=P/((ga+.5)*(ba+.5))):(ga=
312,ba=227,Y=26,Va=Na=50,tf=25,hb=8,Qa=!0,ab=P/((ga+0)*ba),Wa=P/((ga+1)*ba),Se=P/((ga+.5)*ba));Ka=Ja=ga;0<ia?(10>ia&&(ia=10),Va=ab=Wa=Se=Na=(a?15734:15625)/ia,Ja=ia-(ld?1:0),Ka=256<=Ja&&313>=Ja||nc&128?Ja:256>Ja?255:313,db()):0==ia&&(ha=ia=ga);Xa=ga+1;nc&128&&(592<=Jc&&(Jc=591),ga=Jc+1,Xa=ga+1,256<=sg&&(sg=255),ba=sg+1,ab=Va=Na=3541200/(ga*ba),Wa=3552550/(ga*ba),Se=3546875/(ga*ba),nc&4096&&nc&512?(Y=Xf>Yf?Xf:Yf,Y>ga>>1&&(Y=Xf>Yf?Yf:Xf),Xa=Vh):nc&512?(Y=Xf,Y>ga>>1&&(Y=0)):nc&4096&&(Y=Yf,Y>ga>>1&&(Y=
0),Xa=Vh),2>Y&&(Y=2),Y>=ga&&(Y=ga-1),Xa<Y&&(Xa=ga+1),tf=Y-2,Ka=Ja=ga,hb=-1,(x=164>=sg&&350<=Jc?1:0)&&140<=sg&&Cb&64&&(x=0),Wh=l=!0,ha=ia=Ja,p=1);592<=Ja&&(Ja=592);592<=Ka&&(Ka=592);SAEV_config.video.scandoubler&&0==x&&(x=-1);if(x!=b||ga!=d)p=1;10>Na&&(Na=10);300<Na&&(Na=300);La=ba;Bc();nc&128&&nc&256?(v=vi,Yc=tg,Cb&1&&dd&1&&(ug>ba>>1?v<ug&&(v=ug):v>ug&&(v=ug),vg>ba>>1?Yc>vg&&(Yc=vg):Yc<vg&&(Yc=vg)),v<Yc&&(v=ba+v),Yc--,2>Yc&&(Yc=2)):(v=La+13,Yc=24);SAER_Events_eventtab[SAEC_Events_EV_HSYNC].oldcycles=
SAEV_Events_currcycle;SAER_Events_eventtab[SAEC_Events_EV_HSYNC].evtime=SAEV_Events_currcycle+ba*SAEC_Events_CYCLE_UNIT;SAER.events.schedule();p&&(Gc=g,db());Hc=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?2047:511;592<Hc&&(Hc=592);oa();Na!=e&&SAER.video.updatedisplayarea();Wh&&(Wh=!1)}function Zh(){ba=La+ge;SAER_Events_eventtab[SAEC_Events_EV_HSYNC].evtime=SAEV_Events_currcycle+ba*SAEC_Events_CYCLE_UNIT;SAER_Events_eventtab[SAEC_Events_EV_HSYNC].oldcycles=SAEV_Events_currcycle}function O(){var a=
Yg&255,g=wi&255,b=Yg>>8,d=wi>>8;uf&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?(b|=(wg&7)<<8,d|=(wg>>8&7)<<8):0==(d&128)&&(d|=256);uf&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?(a|=(wg>>5&1)<<8,g|=(wg>>13&1)<<8):g+=256;xk=a;yk=g;$e=a-56+1-1<<Zb;of=g-56+1-1<<Zb;$e>=of&&($e=0,of=412<<Zb);0>$e&&($e=0);b==V&&d!=V&&0==We&&(wd=2,Vf=SAER.events.current_hpos());fh=b;gh=d;Ud=xg-4;vc=yg-4;xi=2}function F(){return 0!=(Cb&2)&&!SAEV_config.chipset.genlock}function ec(){return!SAEV_config.chipset.genlock||
0<=SAEV_config.cpu.speed?!1:258==Cb?!0:!1}function H(){nc&128&&(Wh=!0)}function Hg(a,g,b){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(g&=-177):g&=-242;g&=-929;if(Me!=g||b)if(Ck=-1,la(Me,rf)&&(g|=128),b?Tc(a,256,g):Tc(a,256,Me&-3201|g&3201),Me=g&-129,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(Pd(a),Th=le(g,dd)),0>sa.plfleft)qd(a);else{g=Ub(Me);if(g<qf&&a>sa.plfright&&sa.plfright&&(Ld[0]||Ld[1])){for(b=a-sa.plfright<<
1+td;16<=b;)Vb(16,uc),b-=16;b&&Vb(b,uc);sa.plfright+=a-sa.plfright}SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020&&(qf=g,Ta()&&6>qf&&(qf=6))}}function hh(a,g){switch(g){case 0:bh-=Qc[a].armed;Qc[a].armed=0;break;default:bh+=1-Qc[a].armed,Qc[a].armed=1}}function zg(a){V<tf||ad()||a.ignoreverticaluntilnextline||(V==a.vstart&&(a.dmastate=1),V==a.vstop&&(a.dmastate=0))}function yi(a){var g,b=Qc[a];zg(b);g=2*(ih[a]&255)+(he[a]&1);g<<=Cc;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?(g|=(he[a]>>
3&3)>>2-Cc,b.dblscan=ih[a]&128):SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(g|=(he[a]>>3&2)>>2-Cc);b.xpos=g;b.vstart=ih[a]>>8;b.vstart|=he[a]&4?256:0;b.vstop=he[a]>>8;b.vstop|=he[a]&2?256:0;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(b.vstart|=he[a]&64?512:0,b.vstop|=he[a]&32?512:0);zg(b)}function zi(a,g,b){b>=ba-2&&he[g]!=a&&V<ga-1&&(b=Qc[g],V++,zg(b),V--,ui=b.ignoreverticaluntilnextline=!0);he[g]=a;hh(g,0);yi(g)}function Ai(a,g,b){b>=ba-2&&ih[g]!=a&&V<ga-1&&
(b=Qc[g],V++,zg(b),V--,ui=b.ignoreverticaluntilnextline=!0);ih[g]=a;yi(g)}function Bi(a,g,b){Qe[g][0]=a;Qe[g][1]=a;Qe[g][2]=a;Qe[g][3]=a;hh(g,1)}function Ci(a,g,b){Re[g][0]=a;Re[g][1]=a;Re[g][2]=a;Re[g][3]=a}function Di(){if(SAEV_Copper_access&&!(20>V||pd(-1,Cb,dd)))if(V>=Y){var a=ni?Y:V;0==Ie&&(Ie=a-2);mf==ga+(Tb?1:0)&&(mf=a-2);if(a>Je||a>ig)ig=Je=a+3;ni=0}else ni++}function Ei(a,g,b,d,e){b=SAEV_Custom_last_value&65535;g&&(b=SAEV_Custom_last_value=SAER_Memory_chipGet16_indirect(a.pt));a.pt+=2;return b}
function vf(a,g,b,d){g=SAER_Memory_chipGet16_indirect(a.pt);a.pt+=2;return g}function Fi(a){if(!(V<tf||Dc()&&Gc&&$b&1)){var g=a,b=eh+1;if(!(b>=g||eh==a)&&(53<=g&&(g=52),21>b&&(b=21),b!=g)){for(;b<=g;b++){var d=-1,e=b-21>>2;switch(b-21&3){case 0:d=0;Qc[e].dmacycle=0;break;case 2:d=1}if(0<=d){Qc[e].ptxhpos=256;a:{var p=b,P=Qc[e],l=void 0,x=0,f=void 0,l=SAEF_Custom_dmaen(SAEC_Custom_DMAF_SPREN)||e&1&&Qc[e&-2].dmacycle;if(!ad())if(l&&P.dblscan&&kc&32768&&(V&1)!=(P.vstart&1)&&P.dmastate)hh(e,1);else{if(V==
P.vstart){P.dmastate=1;if(P.ptxvpos2==V&&p<P.ptxhpos2)break a;0==e&&0==d&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_SPREN)&&0!=Ie&&(Ag[0]=0,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?(f=(Uh>>4&15)<<4,Ag[1]=Kb.color_regs_aga[f+1],Ag[2]=Kb.color_regs_aga[f+2],Ag[3]=Kb.color_regs_aga[f+3]):(Ag[1]=ic[Kb.color_regs_ecs[17]],Ag[2]=ic[Kb.color_regs_ecs[18]],Ag[3]=ic[Kb.color_regs_ecs[19]]))}if(V==P.vstop||V==tf)P.dmastate=0;if(l){l=p<Gi||1!=We;if(V==P.vstop||V==tf){P.dmastate=0;x=1;if(l){f=Ei(P,l,p,
d,0);switch(nf){case 64:vf(P,p,d,0),vf(P,p,d,0);case 32:vf(P,p,d,0)}0==d?(Ai(f,e,p),P.dmacycle=1):(zi(f,e,p),P.dmastate=0,zg(P))}V==tf&&(P.dmastate=0)}if(P.dmastate&&!x&&l)switch(f=Ei(P,l,p,d,1),0==d?(Bi(f,e,p),P.dmacycle=1):(Ci(f,e,p),hh(e,1)),nf){case 64:x=vf(P,p,d,1);f=vf(P,p,d,1);p=vf(P,p,d,1);l&&(0==d?(Qe[e][3]=p,Qe[e][2]=f,Qe[e][1]=x):(Re[e][3]=p,Re[e][2]=f,Re[e][1]=x));break;case 32:x=vf(P,p,d,1),l&&(0==d?Qe[e][1]=x:Re[e][1]=x)}}}}}}eh=a}}}function Ik(a){return 0}function Jk(a){if(0==SAER_CPU_regs.d[0])return Xh;
Xh=10;a={};SAEF_gettimeofday(a,null);SAER_Memory_put32(SAER_CPU_regs.a[0],a.tv_sec-252460800);SAER_Memory_put32(SAER_CPU_regs.a[0]+4,a.tv_usec);return 0}function $d(a,g,b,d){if(!d)return b;a=r(a,0,g,0);if(!a)return b;b=S.color_regs_ecs[a]&3276;return ic[b|b>>2]}function Hi(a,g,b,d){for(var e=Ma;g<b;){var p,P,l,x;p=D.apixels[a++];P=D.apixels[a++];x=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[x]&3276)<<0;l|=l>>2;e[g+B]=$d(g,p,ic[l],d);g++;l=(S.color_regs_ecs[x]&819)<<2;l|=l>>2;e[g+B]=$d(g,P,ic[l],
d);g++}return a}function Jj(a,g,b){return Hi(a,g,b,!0)}function Ij(a,g,b){return Hi(a,g,b,!1)}function Ii(a,g,b,d){for(var e=Ma;g<b;){var p,P,l,x;p=D.apixels[a++];P=D.apixels[a++];x=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[x]&3276)<<0;l|=l>>2;e[g+B]=$d(g,p,ic[l],d);g++;l=(S.color_regs_ecs[x]&819)<<2;l|=l>>2;e[g+B]=$d(g,P,ic[l],d);g++}return a}function Lj(a,g,b){return Ii(a,g,b,!0)}function Kj(a,g,b){return Ii(a,g,b,!1)}function Ji(a,g,b,d){for(var e=Ma;g<b;){var p,P;p=D.apixels[a++];P=D.apixels[a++];
P=(S.color_regs_ecs[4*(P&3)+(p&3)+((p|P)&16)]&3276)<<0;P|=P>>2;e[g+B]=$d(g,p,ic[P],d);g++}return a}function Tj(a,g,b){return Ji(a,g,b,!0)}function Sj(a,g,b){return Ji(a,g,b,!1)}function Ki(a,g,b,d){for(var e=Ma;g<b;){var p,P,l,x;p=D.apixels[a++];P=D.apixels[a++];x=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[x]&3276)<<0;l|=l>>2;P=ic[l];l=(S.color_regs_ecs[x]&819)<<2;l|=l>>2;e[g+B]=$d(g,p,Fa(P,ic[l]),d);g++}return a}function Pj(a,g,b){return Ki(a,g,b,!0)}function Oj(a,g,b){return Ki(a,g,b,!1)}function Li(a,
g,b,d){for(var e=Ma;g<b;){var p,P;p=D.apixels[a++];P=D.apixels[a++];P=(S.color_regs_ecs[4*(P&3)+(p&3)+((p|P)&16)]&3276)<<0;P|=P>>2;e[g+B]=$d(g,p,ic[P],d);g++}return a}function Rj(a,g,b){return Li(a,g,b,!0)}function Qj(a,g,b){return Li(a,g,b,!1)}function Mi(a,g,b,d){for(var e=Ma;g<b;){var p,P,l,x;p=D.apixels[a++];P=D.apixels[a++];x=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[x]&3276)<<0;l|=l>>2;P=ic[l];l=(S.color_regs_ecs[x]&819)<<2;l|=l>>2;e[g+B]=$d(g,p,R(P,ic[l]),d);g++}return a}function Nj(a,g,
b){return Mi(a,g,b,!0)}function Mj(a,g,b){return Mi(a,g,b,!1)}function Ni(a,g,b,d){for(var e=Ma;g<b;){var p,P;p=D.apixels[a++];P=D.apixels[a++];P=(S.color_regs_ecs[4*(P&3)+(p&3)+((p|P)&16)]&3276)<<0;P|=P>>2;e[g+B]=$d(g,p,ic[P],d);a+=2;g++}return a}function bk(a,g,b){return Ni(a,g,b,!0)}function ak(a,g,b){return Ni(a,g,b,!1)}function Oi(a,g,b,d){for(var e=Ma;g<b;){var p,P,l,x,f;p=D.apixels[a++];P=D.apixels[a++];f=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[f]&3276)<<0;l|=l>>2;P=ic[l];l=(S.color_regs_ecs[f]&
819)<<2;l|=l>>2;l=ic[l];x=Fa(P,l);p=D.apixels[a++];P=D.apixels[a++];f=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[f]&3276)<<0;l|=l>>2;P=ic[l];l=(S.color_regs_ecs[f]&819)<<2;l|=l>>2;l=ic[l];P=Fa(P,l);e[g+B]=$d(g,p,Fa(x,P),d);g++}return a}function Xj(a,g,b){return Oi(a,g,b,!0)}function Wj(a,g,b){return Oi(a,g,b,!1)}function Pi(a,g,b,d){for(var e=Ma;g<b;){var p,P;p=D.apixels[a++];P=D.apixels[a++];P=(S.color_regs_ecs[4*(P&3)+(p&3)+((p|P)&16)]&3276)<<0;P|=P>>2;e[g+B]=$d(g,p,ic[P],d);a+=2;g++}return a}
function Zj(a,g,b){return Pi(a,g,b,!0)}function Yj(a,g,b){return Pi(a,g,b,!1)}function Qi(a,g,b,d){for(var e=Ma;g<b;){var p,P,l,x,f;p=D.apixels[a++];P=D.apixels[a++];f=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[f]&3276)<<0;l|=l>>2;P=ic[l];l=(S.color_regs_ecs[f]&819)<<2;l|=l>>2;l=ic[l];x=Fa(P,l);p=D.apixels[a++];P=D.apixels[a++];f=4*(P&3)+(p&3)+((p|P)&16);l=(S.color_regs_ecs[f]&3276)<<0;l|=l>>2;P=ic[l];l=(S.color_regs_ecs[f]&819)<<2;l|=l>>2;l=ic[l];P=Fa(P,l);e[g+B]=$d(g,p,R(x,P),d);g++}return a}
function Vj(a,g,b){return Qi(a,g,b,!0)}function Uj(a,g,b){return Qi(a,g,b,!1)}function ck(a,g,b){var d=Ma;if(Eb){if(g+B&2){var e=0,e=0,e=ya[a],e=fb[e];a++;d[g+B]=e;g++}if(g>=b)return a;var p=b+B&2;for(p&&b--;g<b;){var P=0,e=ya[a],e=fb[e];a++;P=e;e=ya[a];e=fb[e];a++;P=(P<<16|e&65535)>>>0;d[g+B]=P>>>16;d[g+B+1]=P&65535;g+=2}p&&(e=ya[a],e=fb[e],a++,d[g+B]=e)}else if(Fb){var l=Ya?Wc:Vc;g+B&2&&(e=D.apixels[a],e=C[l[e]],a++,d[g+B]=e,g++);if(g>=b)return a;for((p=b+B&2)&&b--;g<b;)e=D.apixels[a],e=C[l[e]],
a++,P=e,e=D.apixels[a],e=C[l[e]],a++,P=(P<<16|e&65535)>>>0,d[g+B]=P>>>16,d[g+B+1]=P&65535,g+=2;p&&(e=D.apixels[a],e=C[l[e]],a++,d[g+B]=e)}else if(Gb){g+B&2&&(e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,d[g+B]=e,g++);if(g>=b)return a;for((p=b+B&2)&&b--;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,P=e,e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,P=(P<<16|e&65535)>>>0,d[g+B]=P>>>16,d[g+B+1]=P&65535,g+=2;p&&(e=D.apixels[a],e=31>=
e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,d[g+B]=e)}else{g+B&2&&(e=D.apixels[a],e=C[e],a++,d[g+B]=e,g++);if(g>=b)return a;for((p=b+B&2)&&b--;g<b;)e=D.apixels[a],e=C[e],a++,P=e,e=D.apixels[a],e=C[e],a++,P=(P<<16|e&65535)>>>0,d[g+B]=P>>>16,d[g+B+1]=P&65535,g+=2;p&&(e=D.apixels[a],e=C[e],a++,d[g+B]=e)}return a}function kk(a,g,b){var d=Ma;if(Eb)for(;g<b;){var e=0,e=e=0,e=ya[a],e=fb[e];a++;d[g+B]=e>>>16;d[g+B+1]=e&65535;g+=2}else if(Fb)for(var p=Ya?Wc:Vc;g<b;)e=D.apixels[a],e=C[p[e]],a++,d[g+B]=e>>>
16,d[g+B+1]=e&65535,g+=2;else if(Gb)for(;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,d[g+B]=e>>>16,d[g+B+1]=e&65535,g+=2;else for(;g<b;)e=D.apixels[a],e=C[e],a++,d[g+B]=e>>>16,d[g+B+1]=e&65535,g+=2;return a}function gk(a,g,b){var d=Ma;if(Eb)for(;g<b;){var e=0,e=e=0,e=ya[a],e=fb[e];a++;d[g+B]=e>>>16;d[g+B+1]=e&65535;g+=2;d[g+B]=e>>>16;d[g+B+1]=e&65535;g+=2}else if(Fb)for(var p=Ya?Wc:Vc;g<b;)e=D.apixels[a],e=C[p[e]],a++,d[g+B]=e>>>16,d[g+B+1]=e&65535,g+=2,d[g+B]=e>>>16,
d[g+B+1]=e&65535,g+=2;else if(Gb)for(;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,d[g+B]=e>>>16,d[g+B+1]=e&65535,g+=2,d[g+B]=e>>>16,d[g+B+1]=e&65535,g+=2;else for(;g<b;)e=D.apixels[a],e=C[e],a++,d[g+B]=e>>>16,d[g+B+1]=e&65535,g+=2,d[g+B]=e>>>16,d[g+B+1]=e&65535,g+=2;return a}function sk(a,g,b){var d=Ma;if(Eb){if(g+B&2){var e=0,e=0,e=ya[a],e=fb[e];a+=2;d[g+B]=e;g++}if(g>=b)return a;var p=b+B&2;for(p&&b--;g<b;){var P=0,e=ya[a],e=fb[e];a+=2;P=e;e=ya[a];e=fb[e];a+=2;P=(P<<
16|e&65535)>>>0;d[g+B]=P>>>16;d[g+B+1]=P&65535;g+=2}p&&(e=ya[a],e=fb[e],a+=2,d[g+B]=e)}else if(Fb){var l=Ya?Wc:Vc;g+B&2&&(e=D.apixels[a],e=C[l[e]],a+=2,d[g+B]=e,g++);if(g>=b)return a;for((p=b+B&2)&&b--;g<b;)e=D.apixels[a],e=C[l[e]],a+=2,P=e,e=D.apixels[a],e=C[l[e]],a+=2,P=(P<<16|e&65535)>>>0,d[g+B]=P>>>16,d[g+B+1]=P&65535,g+=2;p&&(e=D.apixels[a],e=C[l[e]],a+=2,d[g+B]=e)}else if(Gb){g+B&2&&(e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a+=2,d[g+B]=e,g++);if(g>=b)return a;for((p=b+
B&2)&&b--;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a+=2,P=e,e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a+=2,P=(P<<16|e&65535)>>>0,d[g+B]=P>>>16,d[g+B+1]=P&65535,g+=2;p&&(e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a+=2,d[g+B]=e)}else{g+B&2&&(e=D.apixels[a],e=C[e],a+=2,d[g+B]=e,g++);if(g>=b)return a;for((p=b+B&2)&&b--;g<b;)e=D.apixels[a],e=C[e],a+=2,P=e,e=D.apixels[a],e=C[e],a+=2,P=(P<<16|e&65535)>>>0,d[g+B]=P>>>16,d[g+B+1]=P&65535,
g+=2;p&&(e=D.apixels[a],e=C[e],a+=2,d[g+B]=e)}return a}function ok(a,g,b){var d=Ma;if(Eb){if(g+B&2){var e=0,e=0,e=ya[a],e=fb[e],p;a++;p=e;e=ya[a];e=fb[e];e=R(e,p);a++;d[g+B]=e;g++}if(g>=b)return a;var P=b+B&2;for(P&&b--;g<b;){var l=0,e=ya[a],e=fb[e];a++;p=e;e=ya[a];e=fb[e];e=R(e,p);a++;l=e;e=ya[a];e=fb[e];a++;p=e;e=ya[a];e=fb[e];e=R(e,p);a++;l=(l<<16|e&65535)>>>0;d[g+B]=l>>>16;d[g+B+1]=l&65535;g+=2}P&&(e=ya[a],e=fb[e],a++,p=e,e=ya[a],e=fb[e],e=R(e,p),a++,d[g+B]=e)}else if(Fb){var x=Ya?Wc:Vc;g+B&2&&
(e=D.apixels[a],e=C[x[e]],a++,p=e,e=D.apixels[a],e=C[x[e]],e=R(e,p),a++,d[g+B]=e,g++);if(g>=b)return a;for((P=b+B&2)&&b--;g<b;)e=D.apixels[a],e=C[x[e]],a++,p=e,e=D.apixels[a],e=C[x[e]],e=R(e,p),a++,l=e,e=D.apixels[a],e=C[x[e]],a++,p=e,e=D.apixels[a],e=C[x[e]],e=R(e,p),a++,l=(l<<16|e&65535)>>>0,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2;P&&(e=D.apixels[a],e=C[x[e]],a++,p=e,e=D.apixels[a],e=C[x[e]],e=R(e,p),a++,d[g+B]=e)}else if(Gb){g+B&2&&(e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,
p=e,e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],e=R(e,p),a++,d[g+B]=e,g++);if(g>=b)return a;for((P=b+B&2)&&b--;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,p=e,e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],e=R(e,p),a++,l=e,e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,p=e,e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],e=R(e,p),a++,l=(l<<16|e&65535)>>>0,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2;P&&(e=
D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,p=e,e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],e=R(e,p),a++,d[g+B]=e)}else{g+B&2&&(e=D.apixels[a],e=C[e],a++,p=e,e=D.apixels[a],e=C[e],e=R(e,p),a++,d[g+B]=e,g++);if(g>=b)return a;for((P=b+B&2)&&b--;g<b;)e=D.apixels[a],e=C[e],a++,p=e,e=D.apixels[a],e=C[e],e=R(e,p),a++,l=e,e=D.apixels[a],e=C[e],a++,p=e,e=D.apixels[a],e=C[e],e=R(e,p),a++,l=(l<<16|e&65535)>>>0,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2;P&&(e=D.apixels[a],
e=C[e],a++,p=e,e=D.apixels[a],e=C[e],e=R(e,p),a++,d[g+B]=e)}return a}function dk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a++;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a++,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else for(;g<
b;)e=p=D.apixels[a],p=C[p],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;return a}function lk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a++;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+B]=p;g++;d[g+B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a++,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,aa[g+da].data&&
(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++;else for(;g<b;)e=p=D.apixels[a],p=C[p],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++;return a}function hk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a++;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+B]=p;g++;d[g+B]=p;g++;d[g+B]=p;g++;d[g+B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a++,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++,
d[g+B]=p,g++,d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++;else for(;g<b;)e=p=D.apixels[a],p=C[p],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++;return a}function tk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a+=2;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+
B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a+=2,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a+=2,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else for(;g<b;)e=p=D.apixels[a],p=C[p],a+=2,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;return a}function pk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,l=p=0,p=ya[a],p=fb[p];a++;l=p;p=ya[a];p=fb[p];e=D.apixels[a];
p=R(p,l);a++;l=p;aa[g+da].data&&(e=r(g,0,e,0))&&(l=e=C[e]);d[g+B]=l;g++}else if(Fb)for(var x=Ya?Wc:Vc;g<b;)p=D.apixels[a],p=C[x[p]],a++,l=p,e=p=D.apixels[a],p=C[x[p]],p=R(p,l),a++,l=p,aa[g+da].data&&(e=r(g,1,e,0))&&(l=e=C[e]),d[g+B]=l,g++;else if(Gb)for(;g<b;)p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,l=p,e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],p=R(p,l),a++,l=p,aa[g+da].data&&(e=r(g,0,e,0))&&(l=e=C[e]),d[g+B]=l,g++;else for(;g<b;)p=D.apixels[a],p=
C[p],a++,l=p,e=p=D.apixels[a],p=C[p],p=R(p,l),a++,l=p,aa[g+da].data&&(e=r(g,0,e,0))&&(l=e=C[e]),d[g+B]=l,g++;return a}function Vi(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function gj(a,g,b){for(var d=Ma,e=0;g<b;){e=0;a++;var p=e=C[0],l=e;aa[g+da].data&&(e=r(g,0,0,1))&&(p=C[e]);aa[g+da+1].data&&(e=r(g+1,0,0,1))&&(l=C[e]);d[g+B]=p;g++;d[g+B]=l;g++}return a}function aj(a,g,b){for(var d=Ma,e=0;g<b;){e=0;a++;var p=e=C[0],l=e,x=e,f=
e;aa[g+da].data&&(e=r(g,0,0,1))&&(p=C[e]);aa[g+da+1].data&&(e=r(g+1,0,0,1))&&(l=C[e]);aa[g+da+2].data&&(e=r(g+2,0,0,1))&&(x=C[e]);aa[g+da+3].data&&(e=r(g+3,0,0,1))&&(f=C[e]);d[g+B]=p;g++;d[g+B]=l;g++;d[g+B]=x;g++;d[g+B]=f;g++}return a}function sj(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function mj(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function Ej(a,g,
b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function yj(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function Ti(a,g,b){var d=Ma,e=gc,p=mc;if(Eb){if(g+B&2){var l=0,l=0,l=ya[a],l=h(l);a++;d[g+B]=l;g++}if(g>=b)return a;var x=b+B&2;for(x&&b--;g<b;){var f=0,l=ya[a],l=h(l);a++;f=l;l=ya[a];l=h(l);a++;f=(f<<16|l&65535)>>>0;d[g+B]=f>>>16;d[g+B+1]=f&65535;g+=2}x&&(l=ya[a],l=
h(l),a++,d[g+B]=l)}else if(Fb){var p=Ya?Ac:zc,A=Ya?yc:xc;if(g+B&2){var l=D.apixels[a],v=p[l];A[l]&&(v+=ib[gb]);l=C[v^e];a++;d[g+B]=l;g++}if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)l=D.apixels[a],v=p[l],A[l]&&(v+=ib[gb]),v^=e,l=C[v],a++,f=l,l=D.apixels[a],v=p[l],A[l]&&(v+=ib[gb]),v^=e,l=C[v],a++,f=(f<<16|l&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(l=D.apixels[a],v=p[l],A[l]&&(v+=ib[gb]),v^=e,l=C[v],a++,d[g+B]=l)}else if(Gb){g+B&2&&(l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>
1&8355711,l=h(l)):l=C[l],a++,d[g+B]=l,g++);if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a++,f=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a++,f=(f<<16|l&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a++,d[g+B]=l)}else{g+B&2&&(l=(D.apixels[a]^e)&p,l=C[l],a++,d[g+B]=l,g++);if(g>=b)return a;
for((x=b+B&2)&&b--;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,f=l,l=(D.apixels[a]^e)&p,l=C[l],a++,f=(f<<16|l&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(l=(D.apixels[a]^e)&p,l=C[l],a++,d[g+B]=l)}return a}function ej(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,l=l=0,l=ya[a],l=h(l);a++;d[g+B]=l>>>16;d[g+B+1]=l&65535;g+=2}else if(Fb)for(var p=Ya?Ac:zc,x=Ya?yc:xc;g<b;){var l=D.apixels[a],f=p[l];x[l]&&(f+=ib[gb]);f^=e;l=C[f];a++;d[g+B]=l>>>16;d[g+B+1]=l&65535;g+=2}else if(Gb)for(;g<b;)l=(D.apixels[a]^
e)&p,l=32<=l&&64>l?h(S.color_regs_aga[l-32]>>>1&8355711):C[l],a++,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2;return a}function Zi(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,l=l=0,l=ya[a],l=h(l);a++;d[g+B]=l>>>16;d[g+B+1]=l&65535;g+=2;d[g+B]=l>>>16;d[g+B+1]=l&65535;g+=2}else if(Fb)for(var p=Ya?Ac:zc,x=Ya?yc:xc;g<b;){var l=D.apixels[a],f=p[l];x[l]&&(f+=ib[gb]);f^=e;l=C[f];a++;d[g+B]=l>>>16;d[g+B+1]=l&65535;g+=2;d[g+
B]=l>>>16;d[g+B+1]=l&65535;g+=2}else if(Gb)for(;g<b;)l=(D.apixels[a]^e)&p,l=32<=l&&64>l?h(S.color_regs_aga[l-32]>>>1&8355711):C[l],a++,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2,d[g+B]=l>>>16,d[g+B+1]=l&65535,g+=2;return a}function qj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb){if(g+B&2){var l=0,l=0,l=ya[a],l=h(l);a+=2;d[g+B]=l;g++}if(g>=b)return a;var x=b+B&2;for(x&&b--;g<b;){var f=0,l=ya[a],l=h(l);
a+=2;f=l;l=ya[a];l=h(l);a+=2;f=(f<<16|l&65535)>>>0;d[g+B]=f>>>16;d[g+B+1]=f&65535;g+=2}x&&(l=ya[a],l=h(l),a+=2,d[g+B]=l)}else if(Fb){var p=Ya?Ac:zc,A=Ya?yc:xc;if(g+B&2){var l=D.apixels[a],v=p[l];A[l]&&(v+=ib[gb]);l=C[v^e];a+=2;d[g+B]=l;g++}if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)l=D.apixels[a],v=p[l],A[l]&&(v+=ib[gb]),v^=e,l=C[v],a+=2,f=l,l=D.apixels[a],v=p[l],A[l]&&(v+=ib[gb]),v^=e,l=C[v],a+=2,f=(f<<16|l&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(l=D.apixels[a],v=p[l],A[l]&&(v+=ib[gb]),
v^=e,l=C[v],a+=2,d[g+B]=l)}else if(Gb){g+B&2&&(l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a+=2,d[g+B]=l,g++);if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a+=2,f=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a+=2,f=(f<<16|l&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>
1&8355711,l=h(l)):l=C[l],a+=2,d[g+B]=l)}else{g+B&2&&(l=(D.apixels[a]^e)&p,l=C[l],a+=2,d[g+B]=l,g++);if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a+=2,f=l,l=(D.apixels[a]^e)&p,l=C[l],a+=2,f=(f<<16|l&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(l=(D.apixels[a]^e)&p,l=C[l],a+=2,d[g+B]=l)}return a}function kj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb){if(g+B&2){var l=0,l=0,l=ya[a],l=h(l),x;a++;x=l;l=ya[a];l=h(l);l=R(l,x);a++;d[g+B]=l;g++}if(g>=b)return a;var f=b+B&2;for(f&&b--;g<b;){var A=
0,l=ya[a],l=h(l);a++;x=l;l=ya[a];l=h(l);l=R(l,x);a++;A=l;l=ya[a];l=h(l);a++;x=l;l=ya[a];l=h(l);l=R(l,x);a++;A=(A<<16|l&65535)>>>0;d[g+B]=A>>>16;d[g+B+1]=A&65535;g+=2}f&&(l=ya[a],l=h(l),a++,x=l,l=ya[a],l=h(l),l=R(l,x),a++,d[g+B]=l)}else if(Fb){var p=Ya?Ac:zc,v=Ya?yc:xc;if(g+B&2){var l=D.apixels[a],m=p[l];v[l]&&(m+=ib[gb]);l=C[m^e];a++;x=l;l=D.apixels[a];m=p[l];v[l]&&(m+=ib[gb]);m^=e;l=C[m];l=R(l,x);a++;d[g+B]=l;g++}if(g>=b)return a;for((f=b+B&2)&&b--;g<b;)l=D.apixels[a],m=p[l],v[l]&&(m+=ib[gb]),m^=
e,l=C[m],a++,x=l,l=D.apixels[a],m=p[l],v[l]&&(m+=ib[gb]),m^=e,l=C[m],l=R(l,x),a++,A=l,l=D.apixels[a],m=p[l],v[l]&&(m+=ib[gb]),m^=e,l=C[m],a++,x=l,l=D.apixels[a],m=p[l],v[l]&&(m+=ib[gb]),m^=e,l=C[m],l=R(l,x),a++,A=(A<<16|l&65535)>>>0,d[g+B]=A>>>16,d[g+B+1]=A&65535,g+=2;f&&(l=D.apixels[a],m=p[l],v[l]&&(m+=ib[gb]),m^=e,l=C[m],a++,x=l,l=D.apixels[a],m=p[l],v[l]&&(m+=ib[gb]),m^=e,l=C[m],l=R(l,x),a++,d[g+B]=l)}else if(Gb){g+B&2&&(l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=
h(l)):l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],l=R(l,x),a++,d[g+B]=l,g++);if(g>=b)return a;for((f=b+B&2)&&b--;g<b;)l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],l=R(l,x),a++,A=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=
S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],l=R(l,x),a++,A=(A<<16|l&65535)>>>0,d[g+B]=A>>>16,d[g+B+1]=A&65535,g+=2;f&&(l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(l=S.color_regs_aga[l-32]>>>1&8355711,l=h(l)):l=C[l],l=R(l,x),a++,d[g+B]=l)}else{g+B&2&&(l=(D.apixels[a]^e)&p,l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,l=C[l],l=R(l,x),a++,d[g+B]=l,g++);if(g>=b)return a;for((f=b+B&2)&&b--;g<b;)l=(D.apixels[a]^e)&p,l=C[l],
a++,x=l,l=(D.apixels[a]^e)&p,l=C[l],l=R(l,x),a++,A=l,l=(D.apixels[a]^e)&p,l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,l=C[l],l=R(l,x),a++,A=(A<<16|l&65535)>>>0,d[g+B]=A>>>16,d[g+B+1]=A&65535,g+=2;f&&(l=(D.apixels[a]^e)&p,l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,l=C[l],l=R(l,x),a++,d[g+B]=l)}return a}function Cj(a,g,b){var d=Ma,e=gc,l=mc;if(Eb){if(g+B&2){var p=0,p=0,p=ya[a],p=h(p);a+=4;d[g+B]=p;g++}if(g>=b)return a;var x=b+B&2;for(x&&b--;g<b;){var f=0,p=ya[a],p=h(p);a+=4;f=p;p=ya[a];p=h(p);a+=4;f=(f<<16|p&65535)>>>
0;d[g+B]=f>>>16;d[g+B+1]=f&65535;g+=2}x&&(p=ya[a],p=h(p),a+=4,d[g+B]=p)}else if(Fb){var l=Ya?Ac:zc,A=Ya?yc:xc;if(g+B&2){var p=D.apixels[a],v=l[p];A[p]&&(v+=ib[gb]);p=C[v^e];a+=4;d[g+B]=p;g++}if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)p=D.apixels[a],v=l[p],A[p]&&(v+=ib[gb]),v^=e,p=C[v],a+=4,f=p,p=D.apixels[a],v=l[p],A[p]&&(v+=ib[gb]),v^=e,p=C[v],a+=4,f=(f<<16|p&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(p=D.apixels[a],v=l[p],A[p]&&(v+=ib[gb]),v^=e,p=C[v],a+=4,d[g+B]=p)}else if(Gb){g+B&2&&(p=
(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a+=4,d[g+B]=p,g++);if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a+=4,f=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a+=4,f=(f<<16|p&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a+=4,d[g+B]=p)}else{g+B&
2&&(p=(D.apixels[a]^e)&l,p=C[p],a+=4,d[g+B]=p,g++);if(g>=b)return a;for((x=b+B&2)&&b--;g<b;)p=(D.apixels[a]^e)&l,p=C[p],a+=4,f=p,p=(D.apixels[a]^e)&l,p=C[p],a+=4,f=(f<<16|p&65535)>>>0,d[g+B]=f>>>16,d[g+B+1]=f&65535,g+=2;x&&(p=(D.apixels[a]^e)&l,p=C[p],a+=4,d[g+B]=p)}return a}function wj(a,g,b){var d=Ma,e=gc,l=mc;if(Eb){if(g+B&2){var p=0,p=0,p=ya[a],p=h(p),x,f,A;a++;x=p;p=ya[a];p=h(p);a++;f=p;p=ya[a];p=h(p);a++;A=p;p=ya[a];p=h(p);x=R(x,f);f=R(A,p);p=R(x,f);a++;d[g+B]=p;g++}if(g>=b)return a;var v=b+
B&2;for(v&&b--;g<b;){var m=0,p=ya[a],p=h(p);a++;x=p;p=ya[a];p=h(p);a++;f=p;p=ya[a];p=h(p);a++;A=p;p=ya[a];p=h(p);x=R(x,f);f=R(A,p);p=R(x,f);a++;m=p;p=ya[a];p=h(p);a++;x=p;p=ya[a];p=h(p);a++;f=p;p=ya[a];p=h(p);a++;A=p;p=ya[a];p=h(p);x=R(x,f);f=R(A,p);p=R(x,f);a++;m=(m<<16|p&65535)>>>0;d[g+B]=m>>>16;d[g+B+1]=m&65535;g+=2}v&&(p=ya[a],p=h(p),a++,x=p,p=ya[a],p=h(p),a++,f=p,p=ya[a],p=h(p),a++,A=p,p=ya[a],p=h(p),x=R(x,f),f=R(A,p),p=R(x,f),a++,d[g+B]=p)}else if(Fb){var l=Ya?Ac:zc,q=Ya?yc:xc;if(g+B&2){var p=
D.apixels[a],r=l[p];q[p]&&(r+=ib[gb]);p=C[r^e];a++;x=p;p=D.apixels[a];r=l[p];q[p]&&(r+=ib[gb]);r^=e;p=C[r];a++;f=p;p=D.apixels[a];r=l[p];q[p]&&(r+=ib[gb]);r^=e;p=C[r];a++;A=p;p=D.apixels[a];r=l[p];q[p]&&(r+=ib[gb]);r^=e;p=C[r];x=R(x,f);f=R(A,p);p=R(x,f);a++;d[g+B]=p;g++}if(g>=b)return a;for((v=b+B&2)&&b--;g<b;)p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,x=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,f=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,A=p,p=D.apixels[a],
r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],x=R(x,f),f=R(A,p),p=R(x,f),a++,m=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,x=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,f=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,A=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],x=R(x,f),f=R(A,p),p=R(x,f),a++,m=(m<<16|p&65535)>>>0,d[g+B]=m>>>16,d[g+B+1]=m&65535,g+=2;v&&(p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,x=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,
p=C[r],a++,f=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],a++,A=p,p=D.apixels[a],r=l[p],q[p]&&(r+=ib[gb]),r^=e,p=C[r],x=R(x,f),f=R(A,p),p=R(x,f),a++,d[g+B]=p)}else if(Gb){g+B&2&&(p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,f=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,32<=p&&64>
p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,d[g+B]=p,g++);if(g>=b)return a;for((v=b+B&2)&&b--;g<b;)p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,f=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):
p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,m=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,f=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,m=(m<<16|p&65535)>>>0,d[g+B]=m>>>16,d[g+B+1]=m&65535,g+=2;v&&
(p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,f=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,32<=p&&64>p?(p=S.color_regs_aga[p-32]>>>1&8355711,p=h(p)):p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,d[g+B]=p)}else{g+B&2&&(p=(D.apixels[a]^e)&l,p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,p=C[p],a++,f=p,p=(D.apixels[a]^
e)&l,p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,d[g+B]=p,g++);if(g>=b)return a;for((v=b+B&2)&&b--;g<b;)p=(D.apixels[a]^e)&l,p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,p=C[p],a++,f=p,p=(D.apixels[a]^e)&l,p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,m=p,p=(D.apixels[a]^e)&l,p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,p=C[p],a++,f=p,p=(D.apixels[a]^e)&l,p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,m=(m<<16|p&65535)>>>0,d[g+B]=
m>>>16,d[g+B+1]=m&65535,g+=2;v&&(p=(D.apixels[a]^e)&l,p=C[p],a++,x=p,p=(D.apixels[a]^e)&l,p=C[p],a++,f=p,p=(D.apixels[a]^e)&l,p=C[p],a++,A=p,p=(D.apixels[a]^e)&l,p=C[p],x=R(x,f),f=R(A,p),p=R(x,f),a++,d[g+B]=p)}return a}function Ui(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,x=x=0,e=D.apixels[a],x=ya[a],x=h(x);a++;aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Fb)for(var l=Ya?Ac:zc,f=Ya?yc:xc;g<b;){var e=x=D.apixels[a],A=l[x];f[x]&&(A+=ib[gb]);A^=p;x=C[A];a++;aa[g+da].data&&
(e=r(g+0,1,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Gb)for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=32<=x&&64>x?h(S.color_regs_aga[x-32]>>>1&8355711):C[x],a++,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;else for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],a++,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;return a}function fj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=0,f=0,e=f=0,x=D.apixels[a],f=ya[a],f=h(f);a++;var A=f=e=f;aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]);
aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]);d[g+B]=f;g++;d[g+B]=A;g++}else if(Fb)for(var l=Ya?Ac:zc,v=Ya?yc:xc;g<b;)x=f=D.apixels[a],e=l[f],v[f]&&(e+=ib[gb]),e^=p,f=C[e],a++,A=f=e=f,aa[g+da].data&&(e=r(g,1,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,1,x,1))&&(A=C[e]),d[g+B]=f,g++,d[g+B]=A,g++;else if(Gb)for(;g<b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,f=32<=f&&64>f?h(S.color_regs_aga[f-32]>>>1&8355711):C[f],a++,A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),
d[g+B]=f,g++,d[g+B]=A,g++;else for(;g<b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,f=C[f],a++,A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),d[g+B]=f,g++,d[g+B]=A,g++;return a}function $i(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=0,f=0,e=f=0,x=D.apixels[a],f=ya[a],f=h(f);a++;var A=f=e=f,v=e,m=e;aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]);aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]);aa[g+da+2].data&&(e=r(g+2,0,x,1))&&(v=C[e]);aa[g+da+3].data&&(e=r(g+3,0,
x,1))&&(m=C[e]);d[g+B]=f;g++;d[g+B]=A;g++;d[g+B]=v;g++;d[g+B]=m;g++}else if(Fb)for(var l=Ya?Ac:zc,q=Ya?yc:xc;g<b;)x=f=D.apixels[a],A=l[f],q[f]&&(A+=ib[gb]),A^=p,f=C[A],a++,m=v=A=f=e=f,aa[g+da].data&&(e=r(g,1,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,1,x,1))&&(A=C[e]),aa[g+da+2].data&&(e=r(g+2,1,x,1))&&(v=C[e]),aa[g+da+3].data&&(e=r(g+3,1,x,1))&&(m=C[e]),d[g+B]=f,g++,d[g+B]=A,g++,d[g+B]=v,g++,d[g+B]=m,g++;else if(Gb)for(;g<b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,f=32<=f&&64>f?h(S.color_regs_aga[f-32]>>>
1&8355711):C[f],a++,m=v=A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),aa[g+da+2].data&&(e=r(g+2,0,x,1))&&(v=C[e]),aa[g+da+3].data&&(e=r(g+3,0,x,1))&&(m=C[e]),d[g+B]=f,g++,d[g+B]=A,g++,d[g+B]=v,g++,d[g+B]=m,g++;else for(;g<b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,f=C[f],a++,m=v=A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),aa[g+da+2].data&&(e=r(g+2,0,x,1))&&(v=C[e]),aa[g+da+3].data&&(e=r(g+3,0,x,1))&&(m=C[e]),
d[g+B]=f,g++,d[g+B]=A,g++,d[g+B]=v,g++,d[g+B]=m,g++;return a}function rj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,x=x=0,e=D.apixels[a],x=ya[a],x=h(x);a+=2;aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Fb)for(var l=Ya?Ac:zc,f=Ya?yc:xc;g<b;){var e=x=D.apixels[a],A=l[x];f[x]&&(A+=ib[gb]);A^=p;x=C[A];a+=2;aa[g+da].data&&(e=r(g+0,1,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Gb)for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=32<=x&&64>x?h(S.color_regs_aga[x-32]>>>1&8355711):C[x],
a+=2,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;else for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],a+=2,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;return a}function lj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,f=x=0,x=ya[a],x=h(x);a++;f=x;e=D.apixels[a];x=ya[a];x=h(x);x=R(x,f);a++;f=x;aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Fb)for(var l=Ya?Ac:zc,A=Ya?yc:xc;g<b;){var x=D.apixels[a],v=l[x];A[x]&&(v+=ib[gb]);v^=p;x=C[v];a++;f=x;e=x=
D.apixels[a];v=l[x];A[x]&&(v+=ib[gb]);v^=p;x=C[v];x=R(x,f);a++;f=x;aa[g+da].data&&(e=r(g+0,1,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Gb)for(;g<b;)x=(D.apixels[a]^p)&l,32<=x&&64>x?(A=S.color_regs_aga[x-32]>>>1&8355711,x=h(A)):x=C[x],a++,f=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,32<=x&&64>x?(A=S.color_regs_aga[x-32]>>>1&8355711,x=h(A)):x=C[x],x=R(x,f),a++,f=x,aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;else for(;g<b;)x=(D.apixels[a]^p)&l,x=C[x],a++,f=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],
x=R(x,f),a++,f=x,aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;return a}function Dj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,x=x=0,e=D.apixels[a],x=ya[a],x=h(x);a+=4;aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Fb)for(var l=Ya?Ac:zc,f=Ya?yc:xc;g<b;){var e=x=D.apixels[a],A=l[x];f[x]&&(A+=ib[gb]);A^=p;x=C[A];a+=4;aa[g+da].data&&(e=r(g+0,1,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Gb)for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=32<=x&&64>x?h(S.color_regs_aga[x-
32]>>>1&8355711):C[x],a+=4,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;else for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],a+=4,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;return a}function xj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,f=x=0,x=ya[a],x=h(x),A,v;a++;f=x;x=ya[a];x=h(x);a++;A=x;x=ya[a];x=h(x);a++;v=x;e=D.apixels[a];x=ya[a];x=h(x);f=R(f,A);A=R(v,x);x=R(f,A);a++;f=x;aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Fb)for(var l=Ya?
Ac:zc,m=Ya?yc:xc;g<b;){var x=D.apixels[a],q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];a++;f=x;x=D.apixels[a];q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];a++;A=x;x=D.apixels[a];q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];a++;v=x;e=x=D.apixels[a];q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];f=R(f,A);A=R(v,x);x=R(f,A);a++;f=x;aa[g+da].data&&(e=r(g+0,1,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Gb)for(;g<b;)x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],a++,f=x,x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=
S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],a++,A=x,x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],a++,v=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],f=R(f,A),A=R(v,x),x=R(f,A),a++,f=x,aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;else for(;g<b;)x=(D.apixels[a]^p)&l,x=C[x],a++,f=x,x=(D.apixels[a]^p)&l,x=C[x],a++,A=x,x=(D.apixels[a]^p)&l,x=C[x],a++,v=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,
x=C[x],f=R(f,A),A=R(v,x),x=R(f,A),a++,f=x,aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;return a}function ek(a,g,b){var d=Ma;if(Eb)for(;g<b;){var e=0,e=e=0,e=ya[a],e=fb[e];a++;d[g+B]=e;g++}else if(Fb)for(var p=Ya?Wc:Vc;g<b;)e=D.apixels[a],e=C[p[e]],a++,d[g+B]=e,g++;else if(Gb)for(;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,d[g+B]=e,g++;else for(;g<b;)e=D.apixels[a],e=C[e],a++,d[g+B]=e,g++;return a}function mk(a,g,b){var d=Ma;if(Eb)for(;g<b;){var e=0,e=e=0,e=
ya[a],e=fb[e];a++;d[g+B]=e;g++;d[g+B]=e;g++}else if(Fb)for(var p=Ya?Wc:Vc;g<b;)e=D.apixels[a],e=C[p[e]],a++,d[g+B]=e,g++,d[g+B]=e,g++;else if(Gb)for(;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,d[g+B]=e,g++,d[g+B]=e,g++;else for(;g<b;)e=D.apixels[a],e=C[e],a++,d[g+B]=e,g++,d[g+B]=e,g++;return a}function ik(a,g,b){var d=Ma;if(Eb)for(;g<b;){var e=0,e=e=0,e=ya[a],e=fb[e];a++;d[g+B]=e;g++;d[g+B]=e;g++;d[g+B]=e;g++;d[g+B]=e;g++}else if(Fb)for(var p=Ya?Wc:Vc;g<b;)e=D.apixels[a],
e=C[p[e]],a++,d[g+B]=e,g++,d[g+B]=e,g++,d[g+B]=e,g++,d[g+B]=e,g++;else if(Gb)for(;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,d[g+B]=e,g++,d[g+B]=e,g++,d[g+B]=e,g++,d[g+B]=e,g++;else for(;g<b;)e=D.apixels[a],e=C[e],a++,d[g+B]=e,g++,d[g+B]=e,g++,d[g+B]=e,g++,d[g+B]=e,g++;return a}function uk(a,g,b){var d=Ma;if(Eb)for(;g<b;){var e=0,e=e=0,e=ya[a],e=fb[e];a+=2;d[g+B]=e;g++}else if(Fb)for(var p=Ya?Wc:Vc;g<b;)e=D.apixels[a],e=C[p[e]],a+=2,d[g+B]=e,g++;else if(Gb)for(;g<b;)e=
D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a+=2,d[g+B]=e,g++;else for(;g<b;)e=D.apixels[a],e=C[e],a+=2,d[g+B]=e,g++;return a}function qk(a,g,b){var d=Ma;if(Eb)for(;g<b;){var e=0,p=e=0,e=ya[a],e=fb[e];a++;p=e;e=ya[a];e=fb[e];e=Fa(e,p);a++;p=e;d[g+B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=D.apixels[a],e=C[l[e]],a++,p=e,e=D.apixels[a],e=C[l[e]],e=Fa(e,p),a++,p=e,d[g+B]=p,g++;else if(Gb)for(;g<b;)e=D.apixels[a],e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],a++,p=e,e=D.apixels[a],
e=31>=e?C[e]:fb[S.color_regs_ecs[e-32]>>>1&1911],e=Fa(e,p),a++,p=e,d[g+B]=p,g++;else for(;g<b;)e=D.apixels[a],e=C[e],a++,p=e,e=D.apixels[a],e=C[e],e=Fa(e,p),a++,p=e,d[g+B]=p,g++;return a}function fk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a++;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a++,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],
p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else for(;g<b;)e=p=D.apixels[a],p=C[p],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;return a}function nk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a++;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+B]=p;g++;d[g+B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a++,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++,
d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++;else for(;g<b;)e=p=D.apixels[a],p=C[p],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++;return a}function jk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a++;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+B]=p;g++;d[g+B]=p;g++;d[g+B]=p;g++;d[g+B]=p;g++}else if(Fb)for(var l=
Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a++,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++;else for(;g<b;)e=p=D.apixels[a],p=C[p],a++,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++,d[g+B]=p,g++;return a}function vk(a,g,b){var d=Ma,e=0;
if(Eb)for(;g<b;){var p=e=0,p=p=0,p=ya[a],p=fb[p],e=D.apixels[a];a+=2;aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]);d[g+B]=p;g++}else if(Fb)for(var l=Ya?Wc:Vc;g<b;)e=p=D.apixels[a],p=C[l[p]],a+=2,aa[g+da].data&&(e=r(g,1,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else if(Gb)for(;g<b;)e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a+=2,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;else for(;g<b;)e=p=D.apixels[a],p=C[p],a+=2,aa[g+da].data&&(e=r(g,0,e,0))&&(p=e=C[e]),d[g+B]=p,g++;return a}
function rk(a,g,b){var d=Ma,e=0;if(Eb)for(;g<b;){var p=e=0,l=p=0,p=ya[a],p=fb[p];a++;l=p;p=ya[a];p=fb[p];e=D.apixels[a];p=Fa(p,l);a++;l=p;aa[g+da].data&&(e=r(g,0,e,0))&&(l=e=C[e]);d[g+B]=l;g++}else if(Fb)for(var x=Ya?Wc:Vc;g<b;)p=D.apixels[a],p=C[x[p]],a++,l=p,e=p=D.apixels[a],p=C[x[p]],p=Fa(p,l),a++,l=p,aa[g+da].data&&(e=r(g,1,e,0))&&(l=e=C[e]),d[g+B]=l,g++;else if(Gb)for(;g<b;)p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-32]>>>1&1911],a++,l=p,e=p=D.apixels[a],p=31>=p?C[p]:fb[S.color_regs_ecs[p-
32]>>>1&1911],p=Fa(p,l),a++,l=p,aa[g+da].data&&(e=r(g,0,e,0))&&(l=e=C[e]),d[g+B]=l,g++;else for(;g<b;)p=D.apixels[a],p=C[p],a++,l=p,e=p=D.apixels[a],p=C[p],p=Fa(p,l),a++,l=p,aa[g+da].data&&(e=r(g,0,e,0))&&(l=e=C[e]),d[g+B]=l,g++;return a}function Yi(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function jj(a,g,b){for(var d=Ma,e=0;g<b;){e=0;a++;var p=e=C[0],l=e;aa[g+da].data&&(e=r(g,0,0,1))&&(p=C[e]);aa[g+da+1].data&&(e=r(g+1,0,0,1))&&
(l=C[e]);d[g+B]=p;g++;d[g+B]=l;g++}return a}function dj(a,g,b){for(var d=Ma,e=0;g<b;){e=0;a++;var p=e=C[0],l=e,x=e,f=e;aa[g+da].data&&(e=r(g,0,0,1))&&(p=C[e]);aa[g+da+1].data&&(e=r(g+1,0,0,1))&&(l=C[e]);aa[g+da+2].data&&(e=r(g+2,0,0,1))&&(x=C[e]);aa[g+da+3].data&&(e=r(g+3,0,0,1))&&(f=C[e]);d[g+B]=p;g++;d[g+B]=l;g++;d[g+B]=x;g++;d[g+B]=f;g++}return a}function vj(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function pj(a,g,b){for(var d=
Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function Hj(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function Bj(a,g,b){for(var d=Ma,e=0;g<b;){var p=0;a++;p=C[0];aa[g+da].data&&(e=r(g+0,0,0,1))&&(p=C[e]);d[g+B]=p;g++}return a}function Wi(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,l=l=0,l=ya[a],l=h(l);a++;d[g+B]=l;g++}else if(Fb)for(var p=Ya?Ac:zc,x=Ya?yc:xc;g<b;){var l=D.apixels[a],
f=p[l];x[l]&&(f+=ib[gb]);f^=e;l=C[f];a++;d[g+B]=l;g++}else if(Gb)for(;g<b;)l=(D.apixels[a]^e)&p,l=32<=l&&64>l?h(S.color_regs_aga[l-32]>>>1&8355711):C[l],a++,d[g+B]=l,g++;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,d[g+B]=l,g++;return a}function hj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,l=l=0,l=ya[a],l=h(l);a++;d[g+B]=l;g++;d[g+B]=l;g++}else if(Fb)for(var p=Ya?Ac:zc,x=Ya?yc:xc;g<b;){var l=D.apixels[a],f=p[l];x[l]&&(f+=ib[gb]);f^=e;l=C[f];a++;d[g+B]=l;g++;d[g+B]=l;g++}else if(Gb)for(;g<
b;)l=(D.apixels[a]^e)&p,l=32<=l&&64>l?h(S.color_regs_aga[l-32]>>>1&8355711):C[l],a++,d[g+B]=l,g++,d[g+B]=l,g++;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,d[g+B]=l,g++,d[g+B]=l,g++;return a}function bj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,l=l=0,l=ya[a],l=h(l);a++;d[g+B]=l;g++;d[g+B]=l;g++;d[g+B]=l;g++;d[g+B]=l;g++}else if(Fb)for(var p=Ya?Ac:zc,x=Ya?yc:xc;g<b;){var l=D.apixels[a],f=p[l];x[l]&&(f+=ib[gb]);f^=e;l=C[f];a++;d[g+B]=l;g++;d[g+B]=l;g++;d[g+B]=l;g++;d[g+B]=l;g++}else if(Gb)for(;g<
b;)l=(D.apixels[a]^e)&p,l=32<=l&&64>l?h(S.color_regs_aga[l-32]>>>1&8355711):C[l],a++,d[g+B]=l,g++,d[g+B]=l,g++,d[g+B]=l,g++,d[g+B]=l,g++;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,d[g+B]=l,g++,d[g+B]=l,g++,d[g+B]=l,g++,d[g+B]=l,g++;return a}function tj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,l=l=0,l=ya[a],l=h(l);a+=2;d[g+B]=l;g++}else if(Fb)for(var p=Ya?Ac:zc,x=Ya?yc:xc;g<b;){var l=D.apixels[a],f=p[l];x[l]&&(f+=ib[gb]);f^=e;l=C[f];a+=2;d[g+B]=l;g++}else if(Gb)for(;g<b;)l=(D.apixels[a]^
e)&p,l=32<=l&&64>l?h(S.color_regs_aga[l-32]>>>1&8355711):C[l],a+=2,d[g+B]=l,g++;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a+=2,d[g+B]=l,g++;return a}function nj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,x=l=0,l=ya[a],l=h(l);a++;x=l;l=ya[a];l=h(l);l=Fa(l,x);a++;x=l;d[g+B]=x;g++}else if(Fb)for(var p=Ya?Ac:zc,f=Ya?yc:xc;g<b;){var l=D.apixels[a],A=p[l];f[l]&&(A+=ib[gb]);A^=e;l=C[A];a++;x=l;l=D.apixels[a];A=p[l];f[l]&&(A+=ib[gb]);A^=e;l=C[A];l=Fa(l,x);a++;x=l;d[g+B]=x;g++}else if(Gb)for(;g<b;)l=
(D.apixels[a]^e)&p,32<=l&&64>l?(f=S.color_regs_aga[l-32]>>>1&8355711,l=h(f)):l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(f=S.color_regs_aga[l-32]>>>1&8355711,l=h(f)):l=C[l],l=Fa(l,x),a++,x=l,d[g+B]=x,g++;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,l=C[l],l=Fa(l,x),a++,x=l,d[g+B]=x,g++;return a}function Fj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,l=l=0,l=ya[a],l=h(l);a+=4;d[g+B]=l;g++}else if(Fb)for(var p=Ya?Ac:zc,x=Ya?yc:xc;g<b;){var l=D.apixels[a],f=p[l];
x[l]&&(f+=ib[gb]);f^=e;l=C[f];a+=4;d[g+B]=l;g++}else if(Gb)for(;g<b;)l=(D.apixels[a]^e)&p,l=32<=l&&64>l?h(S.color_regs_aga[l-32]>>>1&8355711):C[l],a+=4,d[g+B]=l,g++;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a+=4,d[g+B]=l,g++;return a}function zj(a,g,b){var d=Ma,e=gc,p=mc;if(Eb)for(;g<b;){var l=0,x=l=0,l=ya[a],l=h(l),f,A;a++;x=l;l=ya[a];l=h(l);a++;f=l;l=ya[a];l=h(l);a++;A=l;l=ya[a];l=h(l);x=Fa(x,f);f=Fa(A,l);l=Fa(x,f);a++;x=l;d[g+B]=x;g++}else if(Fb)for(var p=Ya?Ac:zc,v=Ya?yc:xc;g<b;){var l=D.apixels[a],
m=p[l];v[l]&&(m+=ib[gb]);m^=e;l=C[m];a++;x=l;l=D.apixels[a];m=p[l];v[l]&&(m+=ib[gb]);m^=e;l=C[m];a++;f=l;l=D.apixels[a];m=p[l];v[l]&&(m+=ib[gb]);m^=e;l=C[m];a++;A=l;l=D.apixels[a];m=p[l];v[l]&&(m+=ib[gb]);m^=e;l=C[m];x=Fa(x,f);f=Fa(A,l);l=Fa(x,f);a++;x=l;d[g+B]=x;g++}else if(Gb)for(;g<b;)l=(D.apixels[a]^e)&p,32<=l&&64>l?(v=S.color_regs_aga[l-32]>>>1&8355711,l=h(v)):l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(v=S.color_regs_aga[l-32]>>>1&8355711,l=h(v)):l=C[l],a++,f=l,l=(D.apixels[a]^e)&p,32<=
l&&64>l?(v=S.color_regs_aga[l-32]>>>1&8355711,l=h(v)):l=C[l],a++,A=l,l=(D.apixels[a]^e)&p,32<=l&&64>l?(v=S.color_regs_aga[l-32]>>>1&8355711,l=h(v)):l=C[l],x=Fa(x,f),f=Fa(A,l),l=Fa(x,f),a++,x=l,d[g+B]=x,g++;else for(;g<b;)l=(D.apixels[a]^e)&p,l=C[l],a++,x=l,l=(D.apixels[a]^e)&p,l=C[l],a++,f=l,l=(D.apixels[a]^e)&p,l=C[l],a++,A=l,l=(D.apixels[a]^e)&p,l=C[l],x=Fa(x,f),f=Fa(A,l),l=Fa(x,f),a++,x=l,d[g+B]=x,g++;return a}function Xi(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,x=x=0,e=D.apixels[a],
x=ya[a],x=h(x);a++;aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Fb)for(var l=Ya?Ac:zc,f=Ya?yc:xc;g<b;){var e=x=D.apixels[a],A=l[x];f[x]&&(A+=ib[gb]);A^=p;x=C[A];a++;aa[g+da].data&&(e=r(g+0,1,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Gb)for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=32<=x&&64>x?h(S.color_regs_aga[x-32]>>>1&8355711):C[x],a++,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;else for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],a++,aa[g+da].data&&(e=r(g+0,0,e,
1))&&(x=C[e]),d[g+B]=x,g++;return a}function ij(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=0,f=0,e=f=0,x=D.apixels[a],f=ya[a],f=h(f);a++;var A=f=e=f;aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]);aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]);d[g+B]=f;g++;d[g+B]=A;g++}else if(Fb)for(var l=Ya?Ac:zc,v=Ya?yc:xc;g<b;)x=f=D.apixels[a],e=l[f],v[f]&&(e+=ib[gb]),e^=p,f=C[e],a++,A=f=e=f,aa[g+da].data&&(e=r(g,1,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,1,x,1))&&(A=C[e]),d[g+B]=f,g++,d[g+B]=A,g++;else if(Gb)for(;g<
b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,f=32<=f&&64>f?h(S.color_regs_aga[f-32]>>>1&8355711):C[f],a++,A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),d[g+B]=f,g++,d[g+B]=A,g++;else for(;g<b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,f=C[f],a++,A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),d[g+B]=f,g++,d[g+B]=A,g++;return a}function cj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=0,f=0,e=f=0,x=D.apixels[a],f=
ya[a],f=h(f);a++;var A=f=e=f,v=e,m=e;aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]);aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]);aa[g+da+2].data&&(e=r(g+2,0,x,1))&&(v=C[e]);aa[g+da+3].data&&(e=r(g+3,0,x,1))&&(m=C[e]);d[g+B]=f;g++;d[g+B]=A;g++;d[g+B]=v;g++;d[g+B]=m;g++}else if(Fb)for(var l=Ya?Ac:zc,q=Ya?yc:xc;g<b;)x=f=D.apixels[a],A=l[f],q[f]&&(A+=ib[gb]),A^=p,f=C[A],a++,m=v=A=f=e=f,aa[g+da].data&&(e=r(g,1,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,1,x,1))&&(A=C[e]),aa[g+da+2].data&&(e=r(g+2,1,x,1))&&(v=C[e]),
aa[g+da+3].data&&(e=r(g+3,1,x,1))&&(m=C[e]),d[g+B]=f,g++,d[g+B]=A,g++,d[g+B]=v,g++,d[g+B]=m,g++;else if(Gb)for(;g<b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,f=32<=f&&64>f?h(S.color_regs_aga[f-32]>>>1&8355711):C[f],a++,m=v=A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),aa[g+da+2].data&&(e=r(g+2,0,x,1))&&(v=C[e]),aa[g+da+3].data&&(e=r(g+3,0,x,1))&&(m=C[e]),d[g+B]=f,g++,d[g+B]=A,g++,d[g+B]=v,g++,d[g+B]=m,g++;else for(;g<b;)x=D.apixels[a],f=(D.apixels[a]^p)&l,
f=C[f],a++,m=v=A=f=e=f,aa[g+da].data&&(e=r(g,0,x,1))&&(f=C[e]),aa[g+da+1].data&&(e=r(g+1,0,x,1))&&(A=C[e]),aa[g+da+2].data&&(e=r(g+2,0,x,1))&&(v=C[e]),aa[g+da+3].data&&(e=r(g+3,0,x,1))&&(m=C[e]),d[g+B]=f,g++,d[g+B]=A,g++,d[g+B]=v,g++,d[g+B]=m,g++;return a}function uj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,x=x=0,e=D.apixels[a],x=ya[a],x=h(x);a+=2;aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Fb)for(var l=Ya?Ac:zc,f=Ya?yc:xc;g<b;){var e=x=D.apixels[a],A=l[x];f[x]&&
(A+=ib[gb]);A^=p;x=C[A];a+=2;aa[g+da].data&&(e=r(g+0,1,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Gb)for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=32<=x&&64>x?h(S.color_regs_aga[x-32]>>>1&8355711):C[x],a+=2,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;else for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],a+=2,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;return a}function oj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,f=x=0,x=ya[a],x=h(x);a++;f=x;e=D.apixels[a];x=ya[a];
x=h(x);x=Fa(x,f);a++;f=x;aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Fb)for(var l=Ya?Ac:zc,A=Ya?yc:xc;g<b;){var x=D.apixels[a],v=l[x];A[x]&&(v+=ib[gb]);v^=p;x=C[v];a++;f=x;e=x=D.apixels[a];v=l[x];A[x]&&(v+=ib[gb]);v^=p;x=C[v];x=Fa(x,f);a++;f=x;aa[g+da].data&&(e=r(g+0,1,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Gb)for(;g<b;)x=(D.apixels[a]^p)&l,32<=x&&64>x?(A=S.color_regs_aga[x-32]>>>1&8355711,x=h(A)):x=C[x],a++,f=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,32<=x&&64>x?(A=S.color_regs_aga[x-
32]>>>1&8355711,x=h(A)):x=C[x],x=Fa(x,f),a++,f=x,aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;else for(;g<b;)x=(D.apixels[a]^p)&l,x=C[x],a++,f=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],x=Fa(x,f),a++,f=x,aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;return a}function Gj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,x=x=0,e=D.apixels[a],x=ya[a],x=h(x);a+=4;aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Fb)for(var l=Ya?Ac:zc,f=Ya?yc:xc;g<b;){var e=x=D.apixels[a],
A=l[x];f[x]&&(A+=ib[gb]);A^=p;x=C[A];a+=4;aa[g+da].data&&(e=r(g+0,1,e,1))&&(x=C[e]);d[g+B]=x;g++}else if(Gb)for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=32<=x&&64>x?h(S.color_regs_aga[x-32]>>>1&8355711):C[x],a+=4,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;else for(;g<b;)e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],a+=4,aa[g+da].data&&(e=r(g+0,0,e,1))&&(x=C[e]),d[g+B]=x,g++;return a}function Aj(a,g,b){var d=Ma,e=0,p=gc,l=mc;if(Eb)for(;g<b;){var x=e=0,f=x=0,x=ya[a],x=h(x),A,v;a++;f=x;x=
ya[a];x=h(x);a++;A=x;x=ya[a];x=h(x);a++;v=x;e=D.apixels[a];x=ya[a];x=h(x);f=Fa(f,A);A=Fa(v,x);x=Fa(f,A);a++;f=x;aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Fb)for(var l=Ya?Ac:zc,m=Ya?yc:xc;g<b;){var x=D.apixels[a],q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];a++;f=x;x=D.apixels[a];q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];a++;A=x;x=D.apixels[a];q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];a++;v=x;e=x=D.apixels[a];q=l[x];m[x]&&(q+=ib[gb]);q^=p;x=C[q];f=Fa(f,A);A=Fa(v,x);x=Fa(f,A);a++;f=x;aa[g+da].data&&
(e=r(g+0,1,e,1))&&(f=C[e]);d[g+B]=f;g++}else if(Gb)for(;g<b;)x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],a++,f=x,x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],a++,A=x,x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],a++,v=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,32<=x&&64>x?(m=S.color_regs_aga[x-32]>>>1&8355711,x=h(m)):x=C[x],f=Fa(f,A),A=Fa(v,x),x=Fa(f,A),a++,f=x,aa[g+da].data&&(e=r(g+
0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;else for(;g<b;)x=(D.apixels[a]^p)&l,x=C[x],a++,f=x,x=(D.apixels[a]^p)&l,x=C[x],a++,A=x,x=(D.apixels[a]^p)&l,x=C[x],a++,v=x,e=D.apixels[a],x=(D.apixels[a]^p)&l,x=C[x],f=Fa(f,A),A=Fa(v,x),x=Fa(f,A),a++,f=x,aa[g+da].data&&(e=r(g+0,0,e,1))&&(f=C[e]),d[g+B]=f,g++;return a}var Zb=0,we=!1,$h=!1,Mc=0,pe=0,Jh=0,Gc=0,hi=0,yh=0,zh=0,fi=new Int32Array(3),gi=0,hg=!1,Pb=!1,ib=[0,2,4,8,16,32,64,128],Jg=null,qh=null,rh=null,Vc=null,Wc=null,xc=null,yc=null,zc=null,Ac=null,Kg=null,
oi=null,ra=new function(){this.maxblocklines=0;this.drawbuffer=new G;this.tempbuffer=new G;this.outbuffer=this.inbuffer=null;this.ychange=this.xchange=this.gfx_vresolution_reserved=this.gfx_resolution_reserved=0};SAER_Playfield_gfxvidinfo=ra;for(var ci=Array(1760),ub=0;1760>ub;ub++)ci[ub]=new bb;var aa=null,da=0,Af=0,Bf=0,ic=new Uint32Array(4096),nh=new Uint32Array(256),mh=new Uint32Array(256),lh=new Uint32Array(256),dg=0,th=0,fg=0,vh=0,eg=0,uh=0,S=new J,bi=new J,C=null,fb=null,D=new function(){this.apixelsBuffer=
new ArrayBuffer(3520);this.apixels=new Uint8Array(this.apixelsBuffer);this.apixels_l=new Uint32Array(this.apixelsBuffer)},If=null,Ye=null,Ze=null,Jf=0,yd=new Uint16Array(4178240),$c=new function(){this.bytes=new Uint8Array(4178240)},ya=new Uint32Array(3520),Kk=new Uint8Array(1760);SAEF_memset(Kk,0,255,1760);new Uint8Array(1760);for(var Ma=null,B=0,Ad=null,Ug=null,Hf=0,zd=null,wh=null,Pg=new ArrayBuffer(7040),fc=new Uint8Array(1189),re=Array(1188),ub=0;ub<re.length;ub++)re[ub]=new Uint32Array(400);
for(var He=0,Ge=0,Wb=0,vd=0,xe=0,Ue=0,oe=0,Be=0,Wd=0,Rd=0,Ch=0,Xd=0,Dh=0,Eh=0,Xe=0,Id=0,hf=0,Sg=0,Gb=!1,Eb=!1,Fb=!1,Ya=!1,gb=0,Ce=0,Df=!1,Mg=!1,di=!1,zf=0,ei=0,xh=0,gc=0,mc=0,oh=0,Cf=0,cg=[16,16],rd=0,Tg=0,Kd=0,Bh=0,qe=0,Ih=0,bf=Array(768),ub=0;768>ub;ub++)bf[ub]=new Uint32Array(3);this.alloc_colors_rgb=function(a,g,b,d,e,p,l,x,f,A,h,v,m){for(var r=a+g+b+l,q=0;256>q;q++){var Rb=0,Rb=SAEV_config.video.blackerThanBlack?Math.floor(15*q/16)+15:q,Rb=Rb+256;h[q]=ua(bf[Rb][0],a,d)|(f&(1<<l)-1)<<x>>>0;v[q]=
ua(bf[Rb][1],g,e)|(f&(1<<l)-1)<<x>>>0;m[q]=ua(bf[Rb][2],b,p)|(f&(1<<l)-1)<<x>>>0;A&&(16>=r?(h[q]=SAEF_bswap16(h[q]),v[q]=SAEF_bswap16(v[q]),m[q]=SAEF_bswap16(m[q])):(h[q]=SAEF_bswap32(h[q]),v[q]=SAEF_bswap32(v[q]),m[q]=SAEF_bswap32(m[q])));16>=r&&(h[q]=65537*h[q]>>>0,v[q]=65537*v[q]>>>0,m[q]=65537*m[q]>>>0)}};this.alloc_colors64k=function(a,g,b,d,e,p,l,x,f,A){var h=a+g+b+l,v=.128*SAEV_config.video.luminance,m=(SAEV_config.video.contrast+1E3)/1E3,q=(1E3-SAEV_config.video.gamma)/1E3,r=Array(3);r[0]=
q+(1E3-SAEV_config.video.gammaCh[0])/1E3;r[1]=q+(1E3-SAEV_config.video.gammaCh[1])/1E3;r[2]=q+(1E3-SAEV_config.video.gammaCh[2])/1E3;for(q=0;768>q;q++)for(var Rb=0;3>Rb;Rb++){var X;X=q-256;var oa=r[Rb];X+=v;X*=m;0>=X?X=0:(X=Math.pow(255,1-oa)*Math.pow(X,oa),0>X&&(X=0));X>>>=0;0==SAEV_config.video.luminance&&0==SAEV_config.video.contrast&&0==SAEV_config.video.gamma&&(X=q&255);255<X&&(X=255);bf[q][Rb]=X}for(v=0;4096>v;v++)m=v>>8<<4|v>>8,r=(v>>4&15)<<4|v>>4&15,q=(v&15)<<4|v&15,m=bf[m+256][0],r=bf[r+
256][1],q=bf[q+256][2],ic[v]=kb(m,a,d)|kb(r,g,e)|kb(q,b,p)|(f&(1<<l)-1)<<x>>>0,A&&(ic[v]=16>=h?SAEF_bswap16(ic[v]):SAEF_bswap32(ic[v])),16>=h&&(ic[v]=(65537*ic[v]|ic[v])>>>0);this.alloc_colors_rgb(a,g,b,d,e,p,l,x,f,A,nh,mh,lh);dg=d;fg=e;eg=p;th=(1<<a)-1<<dg>>>0;vh=(1<<g)-1<<fg>>>0;uh=(1<<b)-1<<eg>>>0};this.isnativevidbuf=function(){return null===ra.outbuffer?!1:ra.outbuffer===ra.drawbuffer?!0:ra.outbuffer.nativepositioning};this.check_custom_limits=function(){var a=SAEV_config.video.gf[0],g=a.gfx_filter_left_border>>
2-SAEV_config.video.hresolution,b=a.gfx_filter_right_border>>2-SAEV_config.video.hresolution,d=a.gfx_filter_top_border,a=a.gfx_filter_bottom_border;g>xe&&(xe=g);b>g&&b<Ue&&(Ue=b);d>oe&&(oe=d);a>d&&a<Be&&(Be=a);wa()};this.set_custom_limits=function(a,g,b,d){var e=xe,p=Ue,l=oe,x=Be;0>=a||0>b?(xe=0,Ue=3E4):(xe=Wb+b,Ue=xe+a);0>=g||0>d?(oe=0,Be=3E4):(oe=Xe+d,Be=oe+g);if(e!=xe||p!=Ue||l!=oe||x!=Be)qe=2;this.check_custom_limits()};this.store_custom_limits=function(a,g,b,d){};var Ob=null,Zc=null,wc=0,Nc=
0,de=0,ze=0,ff=0,ph=!1,ye=0,me=0,cd=0,ce=0,ee=0,ne=0,Ig=0,sh=0,ac=function(a,g,b){},bc=function(a,g,b){},kd=function(a,g,b){},ai=function(a,g,b){},Lg=function(a,g,b){},Gd=0,Ra=0,Ng=null,Ef=0,rb=0,Og=!1;SAER_Playfield_init_row_map=$a;var Ib=0,jb=0,Jb=[1911,240,15,4080,3855];SAER_Playfield_isvsync_chipset=xb;SAER_Playfield_isvsync=function(){var a;SAEV_Playfield_picasso_on?(a=SAEV_config.video.apmode[1],a=SAEV_Playfield_picasso_on&&a.gfx_vsync?0==a.gfx_vsyncmode?1:0<=SAEV_config.cpu.speed?-1:-2:0):
a=xb();return a};var V=0,ia=0,ha=0,Tb=0,ld=0,Te=!1,Zf=!1,ge=0,$b=0,jf=0,Jd=0,ae=0,nd=0,je=0,Nd=0,$f=0,sf=!1,Bg=0,wf=!1,xf=!1,ag=!1,af=0,Zd=0,e=0,cf=0,be=0,Fd=0,bg=0,pc=0,rc=null,Ed=null,M=null,Q=null,oc=null,Ha=new Uint8Array(256);new Uint16Array(256);for(var ba=227,La=227,ga=312,Ja=312,Ka=312,Yc=0,v=0,Hc=511,Y=26,Xa=0,hb=8,Qa=!0,Na=50,Va=0,ob=0,Wa=0,ab=0,Se=0,jc=0,g=0,p=null,x=0,l=!1,Rb=0,kc=0,nc=0,Wf=0,Wh=!1,Jc=312,sg=227,tg=0,ug=0,vg=0,Xf=0,Vh=0,Yf=0,vi=0,Lk=0,Mk=0,xk=0,yk=0,Kh=0,Cg=0,fe=0,Qc=
Array(8),ub=0;8>ub;ub++)Qc[ub]=new sc;for(var Gi=0,ui=!1,Ag=new Uint32Array(4),tf=25,he=new Uint16Array(8),ih=new Uint16Array(8),Qe=Array(8),ub=0;8>ub;ub++)Qe[ub]=new Uint16Array(4);for(var Re=Array(8),ub=0;8>ub;ub++)Re[ub]=new Uint16Array(4);for(var ch=0,bh=0,nf=0,Th=0,Zk=0,Cc=0,og=!1,dh=!1,ti=!1,Kf=0,Lf=0,zk=0,Ak=0,kg=0,lg=0,Od=Array(2),ub=0;ub<Od.length;ub++){Od[ub]=Array(592);for(var id=0;id<Od[ub].length;id++){Od[ub][id]=Array(8);for(var Nk=0;Nk<Od[ub][id].length;Nk++)Od[ub][id][Nk]=0}}for(var Yb=
Array(8),qc=Array(8),ub=0;8>ub;ub++)Yb[ub]=0,qc[ub]=0;for(var Sf=0,Kb=new J,Cb=0,Qf=0,rf=0,dd=0,Uh=0,Me=0,Ck=0,Bd=0,mg=0,qi=0,Yg=0,wi=0,wg=0,uf=0,xg,yg=0,wd=0,cl=0,xi=0,Sh=-1,fh=0,gh=0,mf=0,ig=0,ni=0,Ud=0,vc=0,ah=0,Gk=0,wk=0,xd=0,Md=0,eh=0,$e=0,of=0,Vg=0,We=0,jg=0,pi=0,Ie=0,Je=0,Fh=0,Sk=0,Tk=0,Uk=0,kf=0,lf=0,Gh=0,Hh=0,Vk=0,Wk=0,Xk=0,Yk=0,li=0,mi=0,Yd=0,Hk=0,Dg=0,Eg=0,Ee=0,Ve=Array(2),ub=0;ub<Ve.length;ub++)for(Ve[ub]=Array(130570),id=0;id<Ve[ub].length;id++)Ve[ub][id]=new K;for(var Rg=Array(2),ub=
0;ub<Rg.length;ub++)for(Rg[ub]=Array(303616),id=0;id<Rg[ub].length;id++)Rg[ub][id]=new E;for(var gf=Array(2),ub=0;ub<gf.length;ub++)for(gf[ub]=Array(1189),id=0;id<gf[ub].length;id++)gf[ub][id]=new pa;for(var Gf=Array(2),ub=0;ub<Gf.length;ub++)for(Gf[ub]=Array(1188),id=0;id<Gf[ub].length;id++)Gf[ub][id]=new J;for(var sd=Array(1189),ub=0;1189>ub;ub++)sd[ub]=new m;var Ff=0,Ok=0,ki=1,Sd=null,gg=null,Uc=null,Pk=null,Fe=null,Rk=null,Qg=null,Qk=null,Hd=0,ii=0,De=0,Ah=0,ji=0,$k=0,Oc=0,sa=new m,Cd=0,hl=0,
Zg=!1,ie=0,Pe=0,Ek=0,Oe=0,Ri=!1,$g=0,Vf=0,rg=!1,Fg=!0,vb=0,qg=0,Dd=0,Dk=20;this.get_maxhpos=function(){return ba};this.get_maxhpos_short=function(){return La};this.get_maxvpos=function(){return ga};this.get_maxvpos_nom=function(){return Ja};this.get_maxvpos_display=function(){return Ka};this.get_vpos=function(){return V};this.get_vblank_hz=function(){return Na};this.get_beamcon0=function(){return nc};this.set_line_cyclebased=function(){wd=2};this.get_slowdowndata=function(){return[sa.plfleft,sa.plfright-
(16<<uc),jh[uc][Ea(Cb)][ma(Cb)],kh[uc][Ea(Cb)][ma(Cb)]]};this.set_bitplane_maybe_start_hpos=function(a){wd=2;Vf=a};this.copper_cant_read=function(a,g){return a+1>=ba?1:a==ba-3&&ba&1&&0<=g?-1:this.is_bitplane_dma(a)};this.notice_new_xcolors_ext=function(){Aa()};var uc=0,Nf=0,Mf=0,Bk=0,Lh=[];this.isvga=function(){return nc&128?2E4<=ob?!0:!1:!1};this.ispal=function(){return nc&128?0==SAEV_config.chipset.ntsc:287<=Ka};var Mh=0,Wg=0,ri=0,dl=0,Of=0,Nh=0,fl=0,al=[8,8,8,0,16,8,8,0,32,16,8,0],el=[3,2,1,0,
4,3,2,0,5,4,3,0],gl=[3,2,1,0,3,3,2,0,3,3,3,0],Rf=null,kh=null,jh=null,il=null,kl=[[2,1,2,1,2,1,2,1],[4,2,3,1,4,2,3,1],[8,4,6,2,7,3,5,1]],bl=0,Si=0,ud=new Uint32Array(8),gd=0,Le=0,Ph=new Uint16Array(8),Uf=new Uint16Array(8),Tf=new Uint16Array(8),Ld=Array(2),Qh=new Uint32Array(8),Rh=new Uint32Array(8),te=new Uint32Array(8),ue=new Uint32Array(8),Xg=new Uint32Array(8),se=new Uint32Array(8),td=0,si=0,Ne=0,pg=0,ng=0,qf=0,md=new Int32Array(2),pf=new Int32Array(2),ve=new Int32Array(2),Td=0,Pf=new Int32Array(2),
Fk=!1,hd=0;this.is_bitplane_dma=function(a){return a<pi||0==Dd||4==vb||8<=vb&&a>=sa.plfright||a>=bl?0:il[a-Si&Of]};var Ke,jl,Oh;this.decide_fetch=function(a){if(a>Md){if(0!=Dd)a:{var g=uc,b=SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN);if(!(0!=Kd||8<=vb)){var d=Md;for(Si=Md-Cd;;d++){if(d==a){a>=ba&&Qd(d,g);break a}if(3==Dd)break;Dd=2;if(Vd(d,b,g))break a}if(3==vb&&!wd&&b&&(Cd&Of)==(Nh&Of)&&!cl&&Ne==ng){var e=Ba();vc>=Md-4&&vc<e&&(e=vc);var e=e+4,p=d-Cd&Wg,p=(e-p+Mh-1&~Wg)+p,l=p+Mh,l=(a<p?a:a<l?p:l)-d;
if(l>=ri){var l=l&~Of,x=d+l;0>sa.plfleft&&Ic(Qf);var f=d,A=l>>3-td;dc(g);ed(f,g);switch(g){case 0:if(gd&15)for(f=0;f<Ne;f++)Rc(f,A,1,b);else for(f=0;f<Ne;f++)Rc(f,A,0,b);break;case 1:if(gd&15)for(f=0;f<Ne;f++)Xc(f,A,1,b);else for(f=0;f<Ne;f++)Xc(f,A,0,b);break;case 2:if(gd&15)for(f=0;f<Ne;f++)eb(f,A,1,b);else for(f=0;f<Ne;f++)eb(f,A,0,b)}gd+=16*A;Le+=gd>>5;gd&=31;Td+=16*A;b&&0<Ne&&(Dd=3);0>sa.plfleft&&(sa.plfleft=d);d<=vc&&x>vc&&(vb=5,Pe=vc+4);d<=vc+4&&x>vc+4&&(vb=6,Pe=260,rg=!0);d<=Ba()&&x>Ba()&&
4>vb&&(vb=6);d<=e&&x>p&&(vb=7);if(d<=p&&x>=p+Nh){var h;cb();kc&16384?e=(Yg>>8^V)&1?h=Lf:h=Kf:(e=Kf,h=Lf);switch(qi){case 8:Yb[7]+=h,qc[7]+=h;case 7:Yb[6]+=e,qc[6]+=e;case 6:Yb[5]+=h,qc[5]+=h;case 5:Yb[4]+=e,qc[4]+=e;case 4:Yb[3]+=h,qc[3]+=h;case 3:Yb[2]+=e,qc[2]+=e;case 2:Yb[1]+=h,qc[1]+=h;case 1:Yb[0]+=e,qc[0]+=e}}d+=l;Cd+=l}}for(;d<a;d++)if(3==Dd&&(dc(g),ed(d,g)),Dd=2,Vd(d,b,g))break a;a>=ba?Qd(d,g):dc(g)}}else dh&&(fd(a,uc),og=!1);0<Ke&&a>=Ke&&cc(a);Md=a}};this.decide_fetch_safe=function(a){if(SAEV_Blitter_dangerous)for(;a>
Md;)this.decide_fetch(Md+1),SAER.blitter.decide_blitter(Md+1);else this.decide_fetch(a),SAER.blitter.decide_blitter(a)};this.decide_line=function(a){var g=0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS);V==fh&&(0<V||0==V&&!SAEV_config.chipset.agnusDIP)&&(We=1,wd=2);if(V==gh||ad()||0==V&&SAEV_config.chipset.agnusDIP)We=0,wd=2;if(!(a<=xd)){var b=0!=SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN),d=1==We;g?xd<Ud&&a>=Ud&&(rg=!1):xd<Ud&&a>=Ud&&(rg=!1,-4<Ud&&(Ri=!1));if(0==Dd){var e=!1,p=8,l;
l=xd;l<Vf&&(l=Vf);24>l&&(l=24);Vf+4>l&&(l=Vf+4);l&1&&l++;g?(xd<Ud&&a>=Ud&&3!=vb&&(vb=2,e=!0,ie=Ud+4),(e&&a>=ie||xd<ie&&a>=ie)&&2==vb&&(vb=3,l=ie)):(20>xd&&20<=a&&(Ri||(vb=1),Ri=!0),b&&d&&xd<Ud&&a>=Ud&&(1==vb&&(vb=2,e=!0,ie=Ud+4),Ri=!1),b&&d&&(e&&a>=ie||xd<ie&&a>=ie)&&2==vb&&(vb=3,l=ie));if(d&&b&&(e=!1,g?(e=3==vb&&(24<=a||Ca()),$g&&vc<l&&(e=!1)):(e=3==vb,!e&&xd<vc&&l>vc&&l==(Vf+4+1&-2)&&(l=vc+4,e=!0,p=5)),e)){b=l;0>wk&&(wk=V);if(Dc()&&0<Gc&&!Bg)for(d=0;8>d;d++)if(Od[ld][V][d]=qc[d],!ld&&Cb&4&&(Yb[d]=
Od[1-ld][V][d]),!(Cb&4)||0>Gc)Od[1-ld][V][d]=Od[ld][V][d]=0;Dd=2;qg=1;pi=b;if(ti){dc(uc);for(d=b-sa.plfright<<1+td;16<=d;)Vb(16,uc),d-=16;d&&Vb(d,uc);Si=b;qd(Md);fd(b,uc)}else 0>Md&&(Md=0),Gi=b,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||Gi--,Cd=0,qd(Md),dh&&b>Md?(fd(b,uc),dh=!1):bd(),Si=b,ti=!0;Md=b;va(b);g&&(xd<l&&l>=vc&&4>=l-vc&&(Pe=vc+4,p=5),xd<Ba()&&l>Ba()&&(Pe=Ba()+4,p=5),$g&&(p=6,$g=0));8!=p&&(vb=p,va(l));xd=a;Fi(a);return}g?(Ud!=vc&&xd<vc&&a>=vc&&vc<=ba-4&&(rg=!0,4!=vb&&5>
vb&&(vb=5,Pe=vc+4)),xd<Ba()&&a>=Ba()&&(vb=6)):b&&d&&xd<vc&&a>=vc&&vc<=ba-4&&4!=vb&&(rg=!0)}a>eh&&53>eh&&Fi(a);xd=a}};this.compute_vsynctime_ext=function(){A()};var Gg=0;this.hsync_handler=function(){var a;a=V+1;var b=ia+1;a>=Hc&&(a=0);a=a==ga+Tb||a==ga+Tb+1||592<=b?!0:!1;SAER.events.current_hpos();SAER.copper.sync_copper_with_cpu(ba,0);SAEV_Copper_enabled_thisline&&3==SAER_Copper_cop_state.state&&258==(SAER_Copper_cop_state.i1&510)&&(Sh=SAER_Memory_chipGet16_indirect(SAER_Copper_cop_state.ip));ef();
if(0<=sa.plfleft){if(SAEV_config.chipset.colLevel>SAEC_Config_Chipset_ColLevel_Sprite_Sprite){var b=Fe[$b].nr_sprites,l=Fe[$b].first_sprite_entry,f=oc[Hk>>12],A=Bd,h=2*sa.plfleft<<A,m=d(sa.diwlastword),q=d(sa.diwfirstword);if(0==Dg)Yd|=510;else for(var r=0;r<b;r++){var Rb=Sd[l+r],t=Rb.pos,y=Rb.max,F=t>>Cc,O=y>>Cc;O>m&&(y=m<<Cc);O>2*sa.plfright&&(y=2*sa.plfright<<Cc);F<q&&(t=q<<Cc);for(F<2*sa.plfleft&&(t=2*sa.plfleft<<Cc);t<y;t++)if(F=yd[Rb.first_pixel+t-Rb.pos]&f,O=!0,0!=F)for(var B=(t<<A>>Cc)-h,
F=M[F&255]|M[F>>8]<<2,F=F<<1,z=re[$b],C=1;0<=C;C--){var kc=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?8:6;Cb&1024&&(O=!0);for(var D=C;O&&D<kc;D+=2){var H=0;D<sa.nr_planes&&(H=z[50*D+(B>>5)]>>>31-(B&31)&1);Dg&1<<D&&H!=(Eg>>D&1)&&(O=!1)}O&&(Yd|=F<<4*C)}}}if(SAEV_config.chipset.colLevel>SAEC_Config_Chipset_ColLevel_Sprite_Playfield)if(b=Bd,l=2*sa.plfleft<<b,m=d(sa.diwlastword),h=d(sa.diwfirstword),A=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?8:6,0==Dg)Yd|=1;else if(!(Yd&1)){f=!1;
q=2*sa.plfleft;q<h&&(q=h);h=2*sa.plfright;h>m&&(h=m);for(m=re[$b];q<h&&!f;q+=32){r=(q<<b)-l>>5;Rb=4294967295;for(y=0;y<A;y++)t=Eg>>y&1,F=4294967295,Dg>>y&1&&(y<sa.nr_planes?(F=m[50*y+r],F=(F^(t&1)-1>>>0)>>>0):F=(t&1)-1>>>0),Rb&=F;Rb&&(f=!0)}f&&(Yd|=1)}}pb($b,Jd,Oc);V==tf&&(pc=0);if(Dc()&&0<Gc&&!(Tb&&V>=Ja-1)){$b++;Bg=1;b=Array(8);l=Array(8);for(f=0;8>f;f++)b[f]=Yb[f],l[f]=qc[f],Od[Tb][V][f]&&Od[1-Tb][V][f]&&(A=Od[Tb][V][f]-Od[1-Tb][V][f],Tb?Cb&4&&(Yb[f]=Od[Tb][V][f]-A):Yb[f]=Cb&4?Od[Tb][V][f]:Yb[f]-
A);yf();qg=vb=0;f=Fe[$b-1];for(A=f.first_color_change;A<f.last_color_change;A++)h=Uc[A],m=h.regno,q=h.linepos,4096>m&&9>q&&!(nc&128)&&0<=jf?(r=Fe[$b-1],Rb=r.last_color_change,r.last_color_change++,r.nr_color_changes++,Uc[Rb].linepos=q+ba+1,Uc[Rb].regno=m,Uc[Rb].value=h.value,Uc[Rb+1].regno=-1):(m=Uc[Hd],m.linepos=h.linepos,m.regno=h.regno,m.value=h.value,Hd++);Uc[Hd].regno=-1;ef();pb($b,0,Oc);for(f=Bg=0;8>f;f++)Yb[f]=b[f],qc[f]=l[f]}b=Ea(Cb);l=0!=Gc;b>yh&&(yh=b);0<b&&(hi=0);!zh&&l&&(zh=l);SAER.devices.hsync(a);
SAEV_Events_hsync_counter++;Cg+=2048;65535<Cg&&(Cg-=65536);fe+=2048;4294967295<fe&&(fe-=4294967296);ge=Bb()?ge^1:0;V++;ia++;V>=Hc&&(V=0);a&&(V=0,SAEV_Events_vsync_counter++);Zh();a&&(0<SAEV_Events_bogusframe&&SAEV_Events_bogusframe--,0<SAEV_command?(Kd=0,yf()):(0<Xh&&Xh--,SAER.devices.vsync_pre(),wf||(b=SAEF_now(),mb(Tb,ae,Cb,dd),wf=!0,SAEV_Events_frameskiptime+=SAEF_now()-b),b=SAER.events.framewait(),SAEV_Playfield_picasso_on||(!SAEV_Playfield_frame_rendered&&g&&(SAEV_Playfield_frame_rendered=SAER.video.render_screen(!1)),
SAEV_Playfield_frame_rendered&&!SAEV_Playfield_frame_shown&&(SAEV_Playfield_frame_shown=SAER.video.show_screen_maybe(0<=xb()))),SAER.events.fpscounter(b),SAEV_Playfield_frame_rendered=SAEV_Playfield_frame_shown=wf=!1,g=0<jc?g^1:1),SAEF_setSpcFlags(SAEC_spcflag_BRK));SAEV_Copper_last_hpos=0;xf=!xf;b=!(Cb&2)||Cb&2&&SAEV_config.chipset.genlock&&(!SAEV_config.chipset.ntsc||xf);l=!(Cb&2)||Cb&2&&SAEV_config.chipset.genlock&&ag;SAER.cia.hsync_post(b);b&&(nc&384?tg<(ba&-2)&&vi<ba&&SAER.cia.b_tod_handler(tg):
SAER.cia.b_tod_handler(18));SAEV_config.chipset.cia.tod!=SAEC_Config_Chipset_CIA_TOD_VSync?Gg<ba?(SAER.cia.a_tod_inc(Gg),b=Na*(2*ga+(Gc?1:0))*(2*ba+(Bb()?1:0))/(4*(SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_60Hz?60:50))>>>0,Gg+=b):Gg-=ba:SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_VSync&&l&&(nc&640?V==Xf&&Lk<=ga&&SAER.cia.a_tod_inc(Tb?tg:tg+Mk):V==(SAEV_config.chipset.ntsc?6:5)&&SAER.cia.a_tod_inc(Tb?132:18));!SAEV_config.chipset.blitter.cycle_exact&&SAEV_Blitter_bltstate!=
SAEC_Blitter_bltstate_DONE&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN)&&1==We&&SAER.blitter.blitter_slowdown(sa.plfleft,sa.plfright-(16<<uc),jh[uc][Ea(Cb)][ma(Cb)],kh[uc][Ea(Cb)][ma(Cb)]);if(a){Cb&8&&!pc&&(Fd=V-1,bg=ba,pc=1);V=0;SAER.disk.vsync();Cb&4&&(Tb=Tb?0:1);Cb&2&&SAEV_config.chipset.genlock&&(ag=Tb?1:0);Zf!=Te?(3>Zd&&Zd++,3<=Zd&&(e=0)):(!(Cb&4)&&0<Zd&&3>Zd&&!Gc&&(ae=1),e=3,Zd=0);Zf=Te;ld=Tb;3<=Zd?(je=Pa(!0))&&(qe=2):3<=e&&(je=Pa(!1))&&(qe=2);if(nd){if(!Tb&&0>nd||Tb&&0<nd)Nd++,ae=1,3<=Nd&&(Nd=
3,0==sf?sf=!0:ae=0),Cb&4&&(ae=0);nd=0}else Nd=0,sf=!1;SAER.devices.vsync_post();Wh||(nc&944)!=(Wf&944)?Lc(!1):0<ia&&1<Math.abs(ia-ha)&&4>$f?Lc(!0):(je||p!=X()||ae)&&oa();$f=ae=0;SAER.copper.COPJMP(1,1);L();ia=0}SAEV_config.chipset.agnusDIP?1==V&&SAER.custom.send_interrupt(SAEC_Custom_INTF_VERTB,1*SAEC_Events_CYCLE_UNIT):0==V&&SAER.custom.send_interrupt(SAEC_Custom_INTF_VERTB,1*SAEC_Events_CYCLE_UNIT);if(V+1==ga+Tb||V+1==ga+Tb+1)Te=0!=Tb;SAER.events.events_dmal_hsync();0>SAEV_config.cpu.speed?SAER.events.framewait2_maximum(V+
1==ga+Tb):V+1<ga+Tb&&(V==1*Ka/3>>>0||V==2*Ka/3>>>0)&&SAER.events.framewait2_normal();a=V;592<=a&&(a%=592);Jd=0;Dc()&&0<Gc?a*=2:!Gc&&0>=x&&SAEV_config.video.vresolution&&1<SAEV_config.video.pscanlines?(a*=2,SAEV_Events_timeframes&1?(a++,Jd=3==SAEV_config.video.pscanlines?8:6):Jd=3==SAEV_config.video.pscanlines?7:5):(0>=x||0<Gc)&&SAEV_config.video.vresolution&&SAEV_config.video.iscanlines?(a*=2,Gc?ld?Jd=2==SAEV_config.video.iscanlines?7:5:(a++,Jd=2==SAEV_config.video.iscanlines?8:6):Jd=SAEV_config.video.vresolution>
SAEC_Config_Video_VResolution_NonDouble&&1==SAEV_config.video.pscanlines?4:1):SAEV_config.video.vresolution&&(0>=x||0<Gc)&&(a*=2,Gc?ld?Jd=2:(a++,Jd=3):Jd=SAEV_config.video.vresolution>SAEC_Config_Video_VResolution_NonDouble&&1==SAEV_config.video.pscanlines?4:1);jf=$b;$b=a;yf();Gi=255;SAER_Copper_cop_state.hpos=0;SAER.copper.compute_spcflag_copper(ba);0<Ub(Cb)&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN)&&(0==Fh&&(Fh=Cb),V>Je&&(Je=V),V>=Y&&0==Ie?Ie=V>Y?V-1:V:V>=ga+(Tb?1:0)-1&&(Je=ga+(Tb?1:0)));0==xi&&
(V>=Ie&&V<=Je&&(of>lf&&(lf=of,lf>2*v-56+1-1<<Zb&&(lf=2*v-56+1-1<<Zb)),$e<kf&&(kf=$e,kf<2*Yc-56+1-1<<Zb&&(kf=2*Yc-56+1-1<<Zb))),1==We&&(a=8<<uc,Ud+a<Gh+a&&(Gh=Ud+a),vc+2*a>Hh+2*a&&(Hh=vc+2*a)),(fh<mf||mf==Y&&V>Y)&&fh<V>>1&&(mf=fh<Y?Y:fh),gh>ig&&gh>mf&&gh>ga>>1&&(ig=gh));0<xi&&xi--;V+1==ga+Tb&&-2>=xb()&&!wf&&0==SAEV_config.video.apmode[0].gfx_vflip&&(a=SAEF_now(),mb(Tb,ae,Cb,dd),wf=!0,g&&(SAEV_Playfield_frame_rendered=SAER.video.render_screen(!0)),SAEV_Events_frameskiptime+=SAEF_now()-a)};this.DENISEID=
function(){return 0<=SAEV_config.chipset.deniseRev?SAEV_config.chipset.deniseRev:SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000?64760:248:65532};this.VPOSR=function(){var a=0,g=(nc&8192?0:0<pc)?Fd:F()?cf:V,b=(nc&8192?0:0<pc)?bg:F()?be:SAER.events.current_hpos(),d=Tb;g+1!=ga+Tb||b!=ba-1&&b!=ba-2||Cb&4&&Fg&&(d=d?0:1);b+(Fg?3:0)>=ba+(Fg?1:0)&&(g++,g>=ga+Tb&&(g=0));g=g>>8&7;0<=SAEV_config.chipset.agnusRev?a|=SAEV_config.chipset.agnusRev<<8:
(a|=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?8960:0,a|=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?8192:0,SAEV_config.chipset.ntsc&&(a|=4096));SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(g&=1);g=g|(d?32768:0)|a;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(g|=ge?128:0);ec();return g};this.VPOSW=function(a){var g=V;Tb!=(a&32768?1:0)&&(nd=(Tb=a&32768?1:0)?1:-1);SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(ge=a&128?1:0,Bb()||
(ge=0));nd||(V&=255,a&=7,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(a&=1),V|=a<<8,V!=g&&$f++,V<g&&(V=g))};this.VHPOSW=function(a){var g=V;V&=65280;V|=a>>8;V!=g&&$f++;V<g?V=g:V<Y&&g<Y&&(V=g)};var Yh=0;this.VHPOSR=function(){var a=(nc&8192?0:0<pc)?Fd:F()?cf:V,g=(nc&8192?0:0<pc)?bg:F()?be:SAER.events.current_hpos();Fg&&(g+=3);g>=ba&&(g-=ba,g>=(Fg?1:0)&&(a++,a>=ga+Tb&&(a=0)));Fg&&(g+=1,g>=ba&&(g-=ba));a=a<<8&65535;ec()&&(g=Yh%ba,Yh++,65535<Yh&&(Yh=0));return a|g};this.REFPTR=function(a){Cg=
a;fe=a&65024|(a&510)>>1;a&1&&(fe=(fe|65536)>>>0);a&2&&(fe=(fe|131073)>>>0);a&4&&(fe=(fe|258)>>>0)};this.BEAMCON0=function(a){a!=Wf&&(Wf=a,a&-33&&SAEF_warn("playfield.BEAMCON0() write 0x%04x",a));O()};this.HTOTAL=function(a){sg!=a&&(sg=a&255,H())};this.HSSTOP=function(a){tg!=a&&(tg=a&255,H())};this.HBSTRT=function(a){ug!=a&&(ug=a&255,H())};this.HBSTOP=function(a){vg!=a&&(vg=a&255,H())};this.VTOTAL=function(a){Jc!=a&&(Jc=a&2047,H())};this.VSSTOP=function(a){Xf!=a&&(Xf=a&2047,H())};this.VBSTRT=function(a){if(Vh<
a||Vh>(a&2047)+1)Vh=a&2047,H()};this.VBSTOP=function(a){if(Yf<a||Yf>(a&2047)+1)Yf=a&2047,H()};this.HSSTRT=function(a){vi!=a&&(vi=a&255,H())};this.VSSTRT=function(a){Lk!=a&&(Lk=a&2047,H())};this.HCENTER=function(a){Mk!=a&&(Mk=a&255,H())};this.dcheck_is_blit_dangerous=function(){SAER.blitter.check_is_blit_dangerous(Yb,mg,50<<Bd)};this.BPLxPTH=function(a,g,b){this.decide_line(a);this.decide_fetch_safe(a);SAEV_Copper_access&&this.is_bitplane_dma(a+1)==b+1?wd=2:(Yb[b]=(Yb[b]&65535|g<<16)>>>0,qc[b]=(qc[b]&
65535|g<<16)>>>0,this.dcheck_is_blit_dangerous())};this.BPLxPTL=function(a,g,b){this.decide_line(a);this.decide_fetch_safe(a);SAEV_Copper_access&&this.is_bitplane_dma(a+1)==b+1?wd=2:(Yb[b]=(Yb[b]&4294901760|g&65534)>>>0,qc[b]=(qc[b]&4294901760|g&65534)>>>0,this.dcheck_is_blit_dangerous())};this.BPLCON0=function(a,g){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(g&=-177):g&=-242;g&=-129;Cb!=g&&(wd=2,Ia(a),this.decide_line(a),this.decide_fetch_safe(a),
F()||(cf=V,be=a),Cb=g,Nb(a),0>sa.plfleft&&Hg(a,g,!0))};this.BPLCON1=function(a,g){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(g&=255);Qf!=g&&(wd=2,this.decide_line(a),this.decide_fetch_safe(a),Fk=!0,Qf=g,od(a))};this.BPLCON2=function(a,g){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(g&=127);(rf&16383)!=(g&16383)&&(this.decide_line(a),rf=g,Tc(a,260,rf))};this.BPLCON3=function(a,g){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(g=g&63|3072);dd!=g&&(this.decide_line(a),
Pd(a),dd=g,Th=le(Cb,dd),Tc(a,262,g))};this.BPLCON4=function(a,g){Uh!=g&&(this.decide_line(a),Uh=g,Tc(a,268,g))};this.BPL1MOD=function(a,g){g&=-2;Kf!=(g&32768?g-65536:g)&&(this.decide_line(a),this.decide_fetch_safe(a));this.is_bitplane_dma(a+1)&1?(zk=g&32768?g-65536:g,kg=a+1):(Kf=g&32768?g-65536:g,kg=0)};this.BPL2MOD=function(a,g){g&=-2;Lf!=(g&32768?g-65536:g)&&(this.decide_line(a),this.decide_fetch_safe(a));this.is_bitplane_dma(a+1)&2?(Ak=g&32768?g-65536:g,lg=a+1):(Lf=g&32768?g-65536:g,lg=0)};this.BPLxDAT=
function(a,g,b){0==g&&8<=a&&(this.decide_line(a),this.decide_fetch_safe(a));dc(uc);Tf[g]=b;Xg[g]=0;se[g]=b;0==g&&8<=a&&(dh=og=!0,0>sa.plfleft&&bd(),ed(a,uc))};this.DIWSTRT=function(a,g){if(Yg!=g||uf)Ia(a),this.decide_line(a),uf=0,Yg=g,O()};this.DIWSTOP=function(a,g){if(wi!=g||uf)Ia(a),this.decide_line(a),uf=0,wi=g,O()};this.DIWHIGH=function(a,g){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(g&=-6169);g&=-49345;uf&&wg==g||(this.decide_line(a),uf=1,wg=g,O())};this.DDFSTRT=function(a,g){g&=
254;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(g&=252);this.decide_line(a);wd=2;a==xg-4&&2==vb&&ie==a+4&&(vb=1,ie=ba);xg=g;O();0!=Dd&&va(a);212<yg&&4==(xg&4)&&SAEF_warn("playfield.DDFSTRT() very strange DDF values (%x %x)",xg,yg)};this.DDFSTOP=function(a,g){g&=254;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(g&=252);this.decide_line(a);this.decide_fetch_safe(a);wd=2;a==g-4?5==vb&&Pe==a+4&&(vb=3,Pe=260,Ek=a):a==yg-4&&3==vb&&(vb=5,Pe=a+4);yg=g;O();0!=Dd&&va(a);212<
yg&&4==(xg&4)&&SAEF_warn("playfield.DDFSTOP() very strange DDF values (%x %x)",xg,yg)};this.FMODE=function(a,g){g&=49167;kc!=g&&(wd=2,Rb=g,hc(),Nb(a))};this.FNULL=function(a){};this.SPRxDATA=function(a,g,b){Pd(a,!0);Bi(g,b,a)};this.SPRxDATB=function(a,g,b){Pd(a,!0);Ci(g,b,a)};this.SPRxCTL=function(a,g,b){Pd(a);zi(g,b,a)};this.SPRxPOS=function(a,g,b){var d=Qc[b],e;Pd(a);e=d.vstart;Ai(g,b,a);a>=21+4*b-4&&a<=21+4*b-1&&e!=V&&(d.ptxvpos2=V,d.ptxhpos2=a+4)};this.SPRxPTH=function(a,g,b){Pd(a);a-1!=Qc[b].ptxhpos&&
(Qc[b].pt=(g<<16|Qc[b].pt&65535)>>>0)};this.SPRxPTL=function(a,g,b){Pd(a);a-1!=Qc[b].ptxhpos&&(Qc[b].pt=(Qc[b].pt&4294901760|g&65534)>>>0)};this.CLXCON=function(a){Hk=a;Dg=a>>6&63;Eg=a&63};this.CLXCON2=function(a){Dg|=a&192;Eg|=(a&3)<<6;Eg&=4294967295};this.CLXDAT=function(){var a=Yd|32768;Yd=0;return a};this.COLOR_READ=function(a){if(!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&rf&256))return 65535;var g=32*(dd>>13&7)+a,b=Kb.color_regs_aga[g]>>16&255,d=Kb.color_regs_aga[g]>>8&255,g=Kb.color_regs_aga[g]&
255;dd&512?b=(b&15)<<8|(d&15)<<4|(g&15)<<0:(b=b>>4<<8|d>>4<<4|g>>4<<0,Ha[a]&&(b|=32768));return b};this.COLOR_WRITE=function(a,g,b){if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA){if(!(rf&256)){b=32*(dd>>13&7)+b;var d=(g&3840)>>8,e=(g&240)>>4,p=(g&15)>>0,l=Kb.color_regs_aga[b]>>16&255,x=Kb.color_regs_aga[b]>>8&255,f=Kb.color_regs_aga[b]&255;dd&512?(l=l&240|d,x=x&240|e,f=f&240|p):(l=d+(d<<4),x=e+(e<<4),f=p+(p<<4),Ha[b]=g>>15);g=(l<<16|x<<8|f|(Ha[b]?2147483648:0))>>>0;g!=Kb.color_regs_aga[b]&&
(0==b&&Di(),Sc(a,b,g),De=-1,Kb.color_regs_aga[b]=g,Kb.acolors[b]=N(g))}}else g&=36863,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||(g&=4095),Ha[b]=g>>15,Kb.color_regs_ecs[b]!=g&&(0==b&&Di(),Sc(a,b,g),De=-1,Kb.color_regs_ecs[b]=g,Kb.acolors[b]=N(g))};var Xh=0;this.setup=function(){if(SAEV_AutoConf_boot_rom_type){var a=SAER.autoconf.here();SAER.autoconf.org(SAEV_AutoConf_base+65392);SAER.autoconf.calltrap(SAER.autoconf.define_trap(Ik,0,"mousehack_helper_old"));SAER.autoconf.dw(SAEC_AutoConf_RTS);
SAER.autoconf.org(SAEV_AutoConf_base+65440);SAER.autoconf.calltrap(SAER.autoconf.define_trap(Jk,0,"timehack_helper"));SAER.autoconf.dw(SAEC_AutoConf_RTS);SAER.autoconf.org(a)}if(null===rc){rc=new Uint32Array(256);Ed=new Uint32Array(256);M=new Uint32Array(256);for(a=0;256>a;a++)rc[a]=(a>>7&1)<<0|(a>>6&1)<<2|(a>>5&1)<<4|(a>>4&1)<<6|(a>>3&1)<<8|(a>>2&1)<<10|(a>>1&1)<<12|(a>>0&1)<<14,Ed[a]=2*rc[a],M[a]=(a&15?1:0)|(a&240?2:0);Q=new Uint32Array(16);oc=new Uint32Array(16);for(a=0;16>a;a++)oc[a]=(a&1?15:
3)|(a&2?240:48)|(a&4?3840:768)|(a&8?61440:12288),Q[a]=((3==(a&3)?1:0)|(5==(a&5)?2:0)|(9==(a&9)?4:0)|(6==(a&6)?8:0)|(10==(a&10)?16:0)|(12==(a&12)?32:0))<<9}Za();var g,b,d,e,p,l,x,f;if(null===Rf)for(Rf=Array(3),kh=Array(3),jh=Array(3),Lh=Array(3),a=0;2>=a;a++)for(Rf[a]=Array(3),kh[a]=Array(3),jh[a]=Array(3),Lh[a]=Array(3),g=0;2>=g;g++)for(Rf[a][g]=Array(9),kh[a][g]=Array(9),jh[a][g]=Array(9),Lh[a][g]=Array(9),l=gl[4*a+g],p=1<<el[4*a+g],f=kl[l-1],l=1<<l,d=0;8>=d;d++){Rf[a][g][d]=Array(32);for(b=x=0;32>
b;b++)Rf[a][g][d][b]=-1;if(d<=l)for(b=0;b<p;b++)b<l&&d>=f[b&7]?e=f[b&7]:(e=0,x++),Rf[a][g][d][b]=e;kh[a][g][d]=x;jh[a][g][d]=p;b=d;b>l&&(b=0);7!=b||0!=a||0!=g||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(b=4);Lh[a][g][d]=b}Aa();return SAEE_None};this.custom_reset=function(a,g){var b;SAER.events.reset();SAER.filesys.reset();SAER.memory.reset(a);SAER.serial.reset();SAER.memory.map_dump();SAEV_Events_vsync_counter=SAEV_Events_hsync_counter=bh=pc=0;Sb();SAER.blitter.reset();if(a)if(we)for(b=
d=0;256>b;b++)Kb.color_regs_aga[b]=d,Kb.acolors[b]=N(d);else{var d=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)||SAEV_config.chipset.deniseNoEHB?4095:0;for(b=0;32>b;b++)Kb.color_regs_ecs[b]=d,Kb.acolors[b]=N(d)}for(b=Yd=0;b<Qc.length;b++)Qc[b].clr();SAER.custom.reset();SAER.copper.clr_copcon();SAER.disk.DSKLEN(0,0);Cb=0;Uh=17;dd=3072;jg=uf=wg=0;Cg=65535;this.FMODE(0,0);this.CLXCON(0);this.CLXCON2(0);yb(0);nf=Qb(kc);nc=Wf=SAEV_config.chipset.ntsc?
0:32;SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE;SAEV_Blitter_interrupt=!0;Tb=ld=0;sf=!1;SAEF_memset(ih,0,0,8);SAEF_memset(he,0,0,8);SAER.devices.reset(a);SAEF_clrSpcFlags(~(SAEC_spcflag_BRK|SAEC_spcflag_MODE_CHANGE));ia=ha=V=0;SAER.input.reset();gg=Sd=Xh=0;Ve[0][0].first_pixel=0;Ve[1][0].first_pixel=2089120;Ve[0][1].first_pixel=0;Ve[1][1].first_pixel=2089120;SAEF_memset(yd,0,0,4178240);SAEF_memset($c.bytes,0,0,4178240);ve[0]=0;ve[1]=0;SAER_Copper_cop_state.state=0;SAER_Copper_cop_state.movedelay=
0;SAER_Copper_cop_state.strobe=0;SAER_Copper_cop_state.ignore_next=!1;We=0;SAER.events.clr_dmal();Lc(!1);Fd=-1;e=Zd=nd=0;SAER.audio.reset();SAEV_Custom_adkcon=0;SAER.audio.update_adkmasks();L();Za();yf();SAEV_Events_bogusframe=1;Th=le(Cb,dd);nf=Qb(kc);yb(0);a&&SAER.rtc.hardreset();Sh=-1;Yh=Gg=0;Fg=SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020;Dk=20};this.custom_prepare=function(){Zh()}};var SAEC_Video_DEF_AMIGA_WIDTH=360,SAEC_Video_DEF_AMIGA_HEIGHT=284,SAEC_Video_MAX_AMIGA_WIDTH=376,SAEC_Video_MAX_AMIGA_HEIGHT=288,SAEC_Video_MIN_UAE_WIDTH=160,SAEC_Video_MAX_UAE_WIDTH=3072,SAEC_Video_MIN_UAE_HEIGHT=128,SAEC_Video_MAX_UAE_HEIGHT=2048;
function SAEO_Video(){function a(a,b,d){this.width=a;this.width_allocated=a+7&-8;this.height_allocated=this.height=b;this.pixbytes=d;this.rowbytes=this.width_allocated*this.pixbytes;this.data=new ArrayBuffer(this.width_allocated*this.height_allocated*this.pixbytes)}function f(a,b,d){this.width=a;this.width_allocated=a+7&-8;this.height_allocated=this.height=b;this.pixbytes=d;this.rowbytes=this.width_allocated*this.pixbytes;this.data=new ArrayBuffer(this.width_allocated*this.height_allocated*this.pixbytes);
this.imageData=null}function d(){this.div=this.surface=this.texture=this.ctx=this.canvas=null;this.fullscreen=this.shown=!1}function J(){this.bottom=this.right=this.top=this.left=0}function h(a,b){var d,f;"vertex"==b?(d=a.createShader(a.VERTEX_SHADER),f="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}"):
"fragment"==b&&(d=a.createShader(a.FRAGMENT_SHADER),f="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {gl_FragColor = texture2D(u_image, v_texCoord);}");a.shaderSource(d,f);a.compileShader(d);return a.getShaderParameter(d,a.COMPILE_STATUS)?d:SAEE_Video_ComphileShader}function N(a,b,f,h){a=new d;b=document.getElementById(SAEV_config.video.id);a.canvas="CANVAS"==b.nodeName?b:document.createElement("canvas");a.canvas.width=f;a.canvas.height=h;a.canvas.style.backgroundColor=
sprintf("#%06X",SAEV_config.video.backgroundColor);if(SAEV_config.video.api==SAEC_Config_Video_API_WebGL)try{Oa.antialias=SAEV_config.video.antialias,Oa.alpha=5<=SAEV_config.video.colorMode,a.ctx=a.canvas.getContext("webgl",Oa)||a.canvas.getContext("experimental-webgl",Oa)}catch(m){throw SAEE_Video_RequiresWegGl;}else if(SAEV_config.video.api==SAEC_Config_Video_API_Canvas)try{a.ctx=a.canvas.getContext("2d")}catch(q){throw SAEE_Video_RequiresCanvas;}SAEF_info("sae.video() %s mode, %dx%d pixels, %d bpp",
SAEV_config.video.api==SAEC_Config_Video_API_WebGL?"WebGL":"Canvas",f,h,2==SAEV_config.video.colorMode?16:32);a.canvas.oncontextmenu=function(){return!1};SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse&&(a.canvas.onmousedown=function(a){SAER.input.mouse.mousedown(a)},a.canvas.onmouseup=function(a){SAER.input.mouse.mouseup(a)},a.canvas.onmouseover=function(a){SAER.input.mouse.mouseover(a)},a.canvas.onmouseout=function(a){SAER.input.mouse.mouseout(a)},a.canvas.onmousemove=function(a){SAER.input.mouse.mousemove(a)});
return a}function I(a,b){if(1!=b||a.shown)0==b&&a.shown&&(null!==a.div&&(a.div.removeChild(a.canvas),a.canvas=null),a.shown=!1);else{var d=document.getElementById(SAEV_config.video.id);"DIV"==d.nodeName?(a.div=d,a.div.style.width=String(ea.native_width)+"px",a.div.style.height=String(ea.native_height)+"px",a.div.appendChild(a.canvas)):(a.div=null,a.canvas.style.width=String(ea.native_width)+"px",a.canvas.style.height=String(ea.native_height)+"px");a.shown=!0}}function E(){this.primary=!1;this.ddguid=
0;this.fullname=this.monitorid=this.monitorname=this.adapterkey=this.adapterid=this.adaptername="";this.rect=new J}function K(a){return a.video.apmode[0].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLSCREEN?1:a.video.apmode[0].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?-1:0}function m(a,b){var d=q.length,f=0>b?a.video.apmode[0].gfx_display-1:b;if(0<=b&&f>=d)return null;f>=d&&(f=0);0>f&&(f=0);return q[f]}function pa(a){var d=K(SAEV_config);!a&&0<d||(a=b,a.left=(screen.width>>
1)-(ea.native_width>>1),0>a.left&&(a.left=0),a.top=(screen.height>>1)-(ea.native_height>>1),0>a.top&&(a.top=0),a.right=a.left+ea.native_width,a.bottom=a.top+ea.native_height,SAEF_log("video.updatewinrect() GetWindowRect %dx%d %dx%d %d",b.left,b.top,b.right,b.bottom,d),0==d&&(SAEV_config.video.size_win.x=b.left,SAEV_config.video.size_win.y=b.top))}function ja(){var a=0;remembered_vblank=-1;0==r&&(r=SAEV_config.video.apmode[0].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?1:-1);0==R&&(R=
SAEV_config.video.apmode[1].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?1:-1);Ua=null;SAER_Playfield_gfxvidinfo.drawbuffer.clr();for(SAER_Playfield_gfxvidinfo.tempbuffer.clr();;){kb();ea.native_depth=0;ea.flags&2&&(a=m(SAEV_config,-1).rect,ea.native_width=a.right-a.left,ea.native_height=a.bottom-a.top);b:{var b=ea.flags&1,a=ea.flags&2,d=!0,q=void 0,y=void 0,E=void 0,K=void 0,ja=m(SAEV_config,-1),E=0;a&&!d&&(d=!0);wa=null;y=q=0;d&&(E=0);if(b)E=ea.native_width,K=ea.native_height,b=ja.rect,
q=0<=b.left?b.left:b.left+(b.right-b.left-E),y=0<=b.top?b.top:b.top+(b.bottom-b.top-K);else{for(b=new J;;){b.left=0;b.top=0;b.right=b.left+0+ea.current_width+0;b.bottom=b.top+0+ea.current_height+0+E;break}a&&(b=ja.rect.clone(),ea.native_width=b.right-b.left,ea.native_height=b.bottom-b.top);d&&(q=b.left,y=b.top);E=ea.native_width;K=ea.native_height}try{T=N(q,y,E,K)}catch(Z){G();a=Z;break b}null===wa&&(wa=T);I(T,1);pa(!0);a=SAEE_None}if(a==SAEE_None){b:for(a=3;;){d=ea.current_depth+7&-8;q=ea.native_width;
y=ea.native_height;ja=0!=(ea.flags&1);b=0!=(ea.flags&512);T.surface=null;if(b||ja)b&&(T.surface=new f(q,y,4),T.surface.imageData=T.ctx.createImageData(q,y),ea.pitch=T.surface.rowbytes),SAEF_log("video.set_ddraw_2() %dx%d@%d-bytes",q,y,d);if(0>=a--)break b;break}a=SAEE_None}if(a!=SAEE_None)return G(),a;ea.native_depth=ea.current_depth;SAEV_config.video.hresolution>SAER_Playfield_gfxvidinfo.gfx_resolution_reserved&&(SAER_Playfield_gfxvidinfo.gfx_resolution_reserved=SAEV_config.video.hresolution);SAEV_config.video.vresolution>
SAER_Playfield_gfxvidinfo.gfx_vresolution_reserved&&(SAER_Playfield_gfxvidinfo.gfx_vresolution_reserved=SAEV_config.video.vresolution);ea.amiga_width=ea.current_width;ea.amiga_height=ea.current_height;SAER_Playfield_gfxvidinfo.drawbuffer.pixbytes=ea.current_depth>>3;SAER_Playfield_gfxvidinfo.drawbuffer.bufmem=null;SAER_Playfield_gfxvidinfo.drawbuffer.linemem=null;SAER_Playfield_gfxvidinfo.drawbuffer.rowbytes=ea.pitch;SAER_Playfield_gfxvidinfo.maxblocklines=0;break}null===Fa&&(Fa=new ArrayBuffer(4*
SAEC_Video_MAX_UAE_WIDTH));SAER_Playfield_gfxvidinfo.drawbuffer.emergmem=Fa;SAER_Playfield_gfxvidinfo.drawbuffer.realbufmem=null;SAER_Playfield_gfxvidinfo.drawbuffer.bufmem=null;SAER_Playfield_gfxvidinfo.drawbuffer.bufmem_allocated=null;SAER_Playfield_gfxvidinfo.drawbuffer.bufmem_lockable=!1;SAER_Playfield_gfxvidinfo.outbuffer=SAER_Playfield_gfxvidinfo.drawbuffer;SAER_Playfield_gfxvidinfo.inbuffer=SAER_Playfield_gfxvidinfo.drawbuffer;d=SAER_Playfield_gfxvidinfo.drawbuffer;b=ea.flags;q=ea.native_width;
y=ea.native_height;ja=ea.current_depth;d.pixbytes=ja+7>>3;d.width_allocated=q+7&-8;d.height_allocated=y;b&2048?b&2048&&(b=d.width_allocated,E=d.height_allocated,K=4*b*E*d.pixbytes,d.rowbytes=2*b*d.pixbytes,d.realbufmem=new ArrayBuffer(K),d.bufmem=d.realbufmem,d.bufmem_pos=E/2*d.rowbytes+b/2*d.pixbytes,d.bufmemend=d.realbufmem,d.bufmemend_pos=K-d.rowbytes,d.bufmem_allocated=d.bufmem,d.bufmem_lockable=!0,SAEF_log("video.allocsoftbuffer() Allocated %s temp buffer (%d*%d*%d)","draw",q,y,ja)):d===SAER_Playfield_gfxvidinfo.drawbuffer&&
(d.bufmem=null,d.bufmemend=null,d.realbufmem=null,d.bufmem_allocated=null,d.bufmem_lockable=!0,SAEF_log("video.allocsoftbuffer() Reserved %s temp buffer (%d*%d*%d)","draw",q,y,ja));SAER_Playfield_init_row_map();d=SAEC_LITTLE_ENDIAN;ea.flags&1024?16==ea.current_depth?(Lb=5,t=6,tb=5,Da=0,sb=11,Sa=5,qa=ka=ta=0,d=!1):(Da=tb=t=Lb=8,sb=24,Sa=16,ta=8,ka=0,qa=SAEV_config.video.alpha):ea.flags&512&&(Da=tb=t=Lb=8,sb=24,Sa=16,ta=8,ka=0,qa=SAEV_config.video.alpha);SAER.playfield.alloc_colors64k(Lb,t,tb,sb,Sa,
ta,Da,ka,qa,d);SAER.playfield.notice_new_xcolors_ext();nb=$a=-1;if(ea.flags&1024){a=T.ctx;d=ea.native_width;q=ea.native_height;SAEF_log("video.setupWebGL() %dx%d",d,q);ja=h(a,"vertex");ja===SAEE_Video_ComphileShader?a=SAEE_Video_ComphileShader:(b=h(a,"fragment"),b===SAEE_Video_ComphileShader?a=SAEE_Video_ComphileShader:(y=a.createProgram(),a.attachShader(y,ja),a.attachShader(y,b),a.linkProgram(y),a.getProgramParameter(y,a.LINK_STATUS)?(a.useProgram(y),a.program=y,ja=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,
ja),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),a.STATIC_DRAW),ja=a.getAttribLocation(y,"a_texCoord"),a.enableVertexAttribArray(ja),a.vertexAttribPointer(ja,2,a.FLOAT,!1,0,0),ja=a.createTexture(),a.bindTexture(a.TEXTURE_2D,ja),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),
ja=a.getUniformLocation(y,"u_resolution"),a.uniform2f(ja,d,q),ja=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,ja),y=a.getAttribLocation(y,"a_position"),a.enableVertexAttribArray(y),a.vertexAttribPointer(y,2,a.FLOAT,!1,0,0),a.viewport(0,0,d,q),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT),Oa.alpha||a.colorMask(!0,!0,!0,!1),a=SAEE_None):a=SAEE_Video_LinkShader));if(a!=SAEE_None)return G(),a;pa(!0)}return a}function G(){if(null!==T){I(T,0);var a=T;SAEV_config.video.api==
SAEC_Config_Video_API_WebGL?a.texture=null:SAEV_config.video.api==SAEC_Config_Video_API_Canvas&&(a.surface=null);a.canvas=null;T==wa&&(wa=null);T=null}}function bb(a){SAER.config.fixup_prefs_dimensions_ext(a);0!=K(a)?a.video.size=a.video.size_fs.clone():a.video.size=a.video.size_win.clone()}function kb(){ea.fullfill=0;var a=512;0<K(SAEV_config)?a|=1:0>K(SAEV_config)&&(a|=2);null!==Ua&&(a|=2048,15>ea.current_depth&&(ea.current_depth=16));SAEV_config.video.api==SAEC_Config_Video_API_WebGL&&(a=(a|1024)&
-513);ea.flags=a;a&2048&&(ea.fullfill=1);a&2&&(a=m(SAEV_config,-1).rect,ea.current_width=a.right-a.left,ea.current_height=a.bottom-a.top);ea.native_width=ea.current_width;ea.native_height=ea.current_height}function ua(a){bb(SAEV_config);kb();bb(SAEV_config);ea.current_width=SAEV_config.video.size.width;ea.current_height=SAEV_config.video.size.height;SAEV_config.video.apmode[0].gfx_vsync&&(ea.vsync=1+SAEV_config.video.apmode[0].gfx_vsyncmode);ea.current_depth=5>SAEV_config.video.colorMode?16:32;ea.amiga_width=
ea.current_width;ea.amiga_height=ea.current_height;a=ja();if(a!=SAEE_None)return a;for(var b=0;b<SAEC_GUI_LED_MAX;b++)SAER.gui.flicker_led(b,-1,-1);SAER.gui.led(SAEC_GUI_LED_POWER,SAER.gui.data.powerled,SAER.gui.data.powerled_brightness);SAER.gui.fps(0,0,0);for(b=0;4>b;b++)SAEV_config.floppy.drive[b].type!=SAEC_Config_Floppy_Type_None&&SAER.gui.led(SAEC_GUI_LED_DF0+b,0,-1);return a}function y(){SAER_Playfield_gfxvidinfo.drawbuffer.clr();SAER_Playfield_gfxvidinfo.tempbuffer.clr();G()}for(var Oa={alpha:!1,
depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1},T=null,wa=null,b=new J,q=Array(1),Z=0;1>Z;Z++)q[Z]=new E;var ea=new function(){this.native_height=this.native_width=this.flags=0;this.native_depth;this.freq=this.vsync=this.fullfill=this.initdone=this.amiga_height=this.amiga_width=this.current_depth=this.current_height=this.current_width=this.pitch=0},Ua=null,r=0,R=0,Fa=null,Lb=0,t=0,tb=0,Da=0,sb=0,Sa=0,ta=0,ka=0,qa=0;this.updatedisplayarea=
function(){};this.obtain=function(){if(!SAEV_config.video.enabled)return SAEE_None;var a=document.getElementById(SAEV_config.video.id);if(null===a||"DIV"!=a.nodeName&&"CANVAS"!=a.nodeName)return SAEE_Video_ElementNotFound;SAEV_config.video.api!=SAEC_Config_Video_API_WebGL||SAEC_info.video.webGL||(SAEF_warn("video.obtain() 'WebGL' is not available. Falling back to 'Canvas'..."),SAEV_config.video.api=SAEC_Config_Video_API_Canvas,SAEV_config.video.colorMode=5);if(SAEV_config.video.api==SAEC_Config_Video_API_Canvas&&
!SAEC_info.video.canvas)return SAEE_Video_RequiresCanvas;SAEV_config.video.api==SAEC_Config_Video_API_Canvas&&5!=SAEV_config.video.colorMode&&(SAEV_config.video.colorMode=5);a=q[0];a.monitorname="Default";a.rect.right=screen.availWidth;a.rect.bottom=screen.availHeight;return SAEE_None};this.setup=function(a){if(!SAEV_config.video.enabled)return SAEE_None;$a=nb=-1;Ga=0;fa=!1;Ua=null;return ua(a)};this.cleanup=function(){y()};var nb=-1,$a=-1,Ga=0;this.target_graphics_buffer_update=function(){var b,
d;d=SAER_Playfield_gfxvidinfo.drawbuffer.tempbufferinuse?SAER_Playfield_gfxvidinfo.tempbuffer:SAER_Playfield_gfxvidinfo.drawbuffer;SAER_Playfield_gfxvidinfo.outbuffer=d;b=d.outwidth;d=d.outheight;if(nb==b&&$a==d&&0==Ga)return!1;if(!b||!d)return nb=b,$a=d,Ga=!1;ea.flags&1024?T.texture=new a(b,d,SAER_Playfield_gfxvidinfo.drawbuffer.pixbytes):ea.flags&512&&(T.surface=new f(b,d,4),T.surface.imageData=T.ctx.createImageData(b,d));nb=b;$a=d;Ga=!1;SAEF_log("video.target_graphics_buffer_update() Buffer size (%d*%d) %s",
b,d,"Native");return!0};this.toggle_fullscreen_real=function(a){y();var b=SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0].gfx_fullscreen,d=SAEV_Playfield_picasso_on?R:r;0>a?b==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?b=SAEC_Config_Video_AP_Fullscreen_FULLSCREEN:b==SAEC_Config_Video_AP_Fullscreen_WINDOW?b=SAEC_Config_Video_AP_Fullscreen_FULLSCREEN:b==SAEC_Config_Video_AP_Fullscreen_FULLSCREEN&&(b=0<d?SAEC_Config_Video_AP_Fullscreen_FULLWINDOW:SAEC_Config_Video_AP_Fullscreen_WINDOW):0==a?
b=b==SAEC_Config_Video_AP_Fullscreen_FULLSCREEN?SAEC_Config_Video_AP_Fullscreen_WINDOW:SAEC_Config_Video_AP_Fullscreen_FULLSCREEN:1==a?b=b==SAEC_Config_Video_AP_Fullscreen_FULLSCREEN?SAEC_Config_Video_AP_Fullscreen_FULLWINDOW:SAEC_Config_Video_AP_Fullscreen_FULLSCREEN:2==a&&(b=b==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?SAEC_Config_Video_AP_Fullscreen_WINDOW:SAEC_Config_Video_AP_Fullscreen_FULLWINDOW);SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0].gfx_fullscreen=b;bb(SAEV_config);ua()};
this.hideCursor=function(a){null!==T&&T.shown&&(T.canvas.style.cursor=a?"none":"auto")};this.flush_line=function(a,b){};this.flush_block=function(a,b,d){};this.flush_screen=function(a,b,d){};var fa=!1;this.render_screen=function(a){if(!SAEV_config.video.enabled)return fa=!0;fa=!1;if(ea.flags&1024){a=T.ctx;var b=T.texture,d=b.width,f=b.height;2==SAER_Playfield_gfxvidinfo.drawbuffer.pixbytes?a.texImage2D(a.TEXTURE_2D,0,a.RGB,b.width,b.height,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,new Uint16Array(b.data)):a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,b.width,b.height,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(b.data));a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,d,0,0,f,0,f,d,0,d,f]),a.STATIC_DRAW);a.drawArrays(a.TRIANGLES,0,6);fa=!0}else ea.flags&512&&(a=T.surface,a.imageData.data.set(new Uint8ClampedArray(a.data)),T.ctx.putImageData(a.imageData,0,0),fa=!0);return fa};this.show_screen=function(a){fa=!1};this.show_screen_maybe=function(a){var b=SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0];return b.gfx_vflip&&0!=b.gfx_vsyncmode&&
b.gfx_vsync||!a?!1:(this.show_screen(0),!0)};this.lockscr=function(a,b){var d=!1;if(!SAEV_config.video.enabled||null===wa)return d;ea.flags&1024?(a.bufmem=T.texture.data,a.bufmem_pos=0,a.rowbytes=T.texture.rowbytes,SAER_Playfield_init_row_map(),d=null!==a.bufmem):ea.flags&512&&(a=SAER_Playfield_gfxvidinfo.outbuffer,a.bufmem=T.surface.data,a.bufmem_pos=0,a.rowbytes=T.surface.rowbytes,SAER_Playfield_init_row_map(),d=null!==a.bufmem);return d};this.unlockscr=function(a){SAEV_config.video.enabled&&(ea.flags&
1024?a.bufmem=null:ea.flags&512&&(a.bufmem=null))}}var SAEC_GUI_LED_POWER=0,SAEC_GUI_LED_DF0=1,SAEC_GUI_LED_DF1=2,SAEC_GUI_LED_DF2=3,SAEC_GUI_LED_DF3=4,SAEC_GUI_LED_HD=5,SAEC_GUI_LED_FPS=7,SAEC_GUI_LED_CPU=8,SAEC_GUI_LED_MAX=11;
function SAEO_GUI(){function a(){this.drive_side=0;this.drive_motor=[!1,!1,!1,!1];this.drive_track=[0,0,0,0];this.drive_writing=[!1,!1,!1,!1];this.drive_disabled=[!1,!1,!1,!1];this.df=["","","",""];this.crc32=[0,0,0,0];this.powerled=!1;this.sndbuf_status=this.sndbuf=this.idle=this.fps_color=this.fps=this.cpu_halted=this.md=this.cd=this.hd=this.powerled_brightness=0}var f=this.data=null;this.setup=function(){this.data=new a;this.data.cd=-1;this.data.hd=-1;this.data.md=-1;f=Array(SAEC_GUI_LED_MAX);
SAEF_memset(f,0,0,SAEC_GUI_LED_MAX);return SAEE_None};this.flicker_led2=function(a,J,h){if(a==SAEC_GUI_LED_HD)if(J=this.data.hd,0>h)0>J?this.led(a,-1,-1):this.led(a,0,-1);else if(0==h&&0>J)a==SAEC_GUI_LED_HD&&(this.data.hd=0),f[a]=0,this.led(a,0,-1);else{if(0==h&&(f[a]--,0<f[a]))return;a==SAEC_GUI_LED_HD&&(this.data.hd=h);f[a]=6;J!=h&&this.led(a,h,-1)}};this.flicker_led=function(a,f,h){0>a?this.flicker_led2(SAEC_GUI_LED_HD,0,0):this.flicker_led2(a,f,h)};this.fps=function(a,f,h){this.data.fps=a;this.data.idle=
f;this.data.fps_color=h;this.led(SAEC_GUI_LED_FPS,0,-1);this.led(SAEC_GUI_LED_CPU,0,-1)};this.led=function(a,f,h){h=0;a>=SAEC_GUI_LED_DF0&&a<=SAEC_GUI_LED_DF3?(this.data.drive_writing[a-1]&&(h=1),SAEV_config.hook.led.df(a-1,this.data.drive_disabled[a-1],this.data.drive_track[a-1],this.data.drive_side,f?h?2:1:0)):a==SAEC_GUI_LED_POWER?SAEV_config.hook.led.power(f):a==SAEC_GUI_LED_HD?(1<f&&(h=1),SAEV_config.hook.led.hd(f?h?2:1:0)):a==SAEC_GUI_LED_FPS?SAEV_config.hook.led.fps(this.data.fps,SAER.paused):
a==SAEC_GUI_LED_CPU&&SAEV_config.hook.led.cpu(this.data.idle,SAER.paused)};this.led_string=function(a,f,h){h=-1;var N=0;a>=SAEC_GUI_LED_DF0&&a<=SAEC_GUI_LED_DF3?(h=6+(a-SAEC_GUI_LED_DF0),drive_text[h]=this.data.drive_disabled[a-1]?"":sprintf("%02d",this.data.drive_track[a-1]),this.data.drive_writing[a-1]&&(N=1),SAEV_config.hook.led.df(a-1,this.data.drive_disabled[a-1],this.data.drive_track[a-1],this.data.drive_side,f?N?2:1:0)):a==SAEC_GUI_LED_POWER?(drive_text[3]="Power",SAEV_config.hook.led.power(f)):
a==SAEC_GUI_LED_HD?(drive_text[4]="HD",1<f&&(N=1),SAEV_config.hook.led.hd(f?N?2:1:0)):a==SAEC_GUI_LED_FPS?(a=this.data.fps,h=2,drive_text[h]=sprintf("FPS: %.1f",a),0<this.data.cpu_halted&&(drive_text[h]=sprintf("HALT%d",this.data.cpu_halted)),SAER.paused&&(drive_text[h]="PAUSED"),SAEV_config.hook.led.fps(this.data.fps,SAER.paused)):a==SAEC_GUI_LED_CPU&&(h=1,drive_text[h]="",drive_text[h]=0>this.data.cpu_halted?"STOP":sprintf("%s: %.0f%%","CPU",this.data.idle),SAEV_config.hook.led.cpu(this.data.idle,
SAER.paused))}};var SAEV_Audio_vsynctimebase_orig=0,SAER_Audio_deactivate=null;
function SAEO_Audio(){function a(a,b){var d=a-b;d>ka.frames>>1?d=ka.frames-a+b:d<-ka.frames>>1&&(d=ka.frames-b+a);return d}function f(b){var d=Ga||ka.wait||0==za.currrent?za.frames:za.average.set(za.currrent);za.currrent=0;var f=qa.buffer,h=d,m=a(ka.writeoffset,ka.readoffset+h);if(0>m){for(var q=0;q<SAEV_config.audio.channels;q++)for(var r=0;r<h;r++)f[q][r]=0;h-=-m}if(0<h)if(ka.readoffset+h>ka.frames){if(m=ka.frames-ka.readoffset)for(q=0;q<SAEV_config.audio.channels;q++)f[q].set(ka.buffer[q].subarray(ka.readoffset,
ka.readoffset+m));if(h-m)for(q=0;q<SAEV_config.audio.channels;q++)f[q].set(ka.buffer[q].subarray(0,h-m),m);ka.readoffset=h-m}else{for(q=0;q<SAEV_config.audio.channels;q++)f[q].set(ka.buffer[q].subarray(ka.readoffset,ka.readoffset+h));ka.readoffset+=h}else 0>h&&SAEF_warn("audio.cacheread() empty %d",h);f=qa.buffer;if($a)for(d=0;d<SAEV_config.audio.channels;d++)for(h=b.outputBuffer.getChannelData(d),q=0;q<b.outputBuffer.length;q++)h[q]=0;else for(m=d/b.outputBuffer.length,d=0;d<SAEV_config.audio.channels;d++)for(h=
b.outputBuffer.getChannelData(d),r=q=0;q<b.outputBuffer.length;q++,r+=m)h[q]=f[d][r>>>0]*na}function d(){ta.connected&&(ta.processor.disconnect(ta.context.destination),ta.processor.onaudioprocess=function(a){},ta.connected=!1)}function J(){ta.context=null;try{ta.context=new (window.AudioContext||window.webkitAudioContext),ta.processor=ta.context.createScriptProcessor(za.frames,SAEV_config.audio.channels,SAEV_config.audio.channels)}catch(a){return ta.context&&ta.context.close().then(function(){}),
!1}U=SAEV_config.audio.freq==SAEC_Config_Audio_Freq_Auto?ta.context.sampleRate:SAEV_config.audio.freq;if(null===ka.buffer){ka.frames=16*za.frames;ka.buffer=Array(2);for(var b=0;b<ka.buffer.length;b++)ka.buffer[b]=new Int16Array(ka.frames)}if(null===qa.buffer)for(qa.frames=4*za.frames,qa.buffer=Array(2),b=0;b<qa.buffer.length;b++)qa.buffer[b]=new Int16Array(qa.frames);ta.connected||(ta.processor.onaudioprocess=f,ta.processor.connect(ta.context.destination),ta.connected=!0);fa=!0;SAEF_info("sae.audio() %d channels, frequency %d/%d Hz, %d frames",
SAEV_config.audio.channels,U,ta.context.sampleRate,za.frames);return!0}function h(){fa&&(SAEF_log("audio.close_sound() initialised..."),d(),ta.context.close&&ta.context.close().then(function(){ta.context=null;SAEF_log("audio.close_sound() ...done")}),fa=Ga=!1)}function N(){this.enabled=!1;this.evtime=0;this.pbufldl=this.dsr=this.dr=this.intreq2=this.dmaenstore=!1;this.drhpos=0;this.dat_written=!1;this.ptx=this.sample_accum_time=this.sample_accum=this.dat2=this.dat=this.wlen=this.len=this.vol=this.per=
this.state=this.last_sample=this.current_sample=this.pt=this.lc=0;this.dmaofftime_active=this.ptx_tofetch=this.ptx_written=!1;this.clr=function(){this.enabled=!1;this.evtime=0;this.pbufldl=this.dsr=this.dr=this.intreq2=this.dmaenstore=!1;this.drhpos=0;this.dat_written=!1;this.ptx=this.sample_accum_time=this.sample_accum=this.dat=this.dat2=this.wlen=this.len=this.vol=this.per=this.state=this.last_sample=this.current_sample=this.lc=this.pt=0;this.dmaofftime_active=this.ptx_tofetch=this.ptx_written=
!1}}function I(){this.rc5=this.rc4=this.rc3=this.rc2=this.rc1=0;this.clr=function(){this.rc5=this.rc4=this.rc3=this.rc2=this.rc1=0}}function E(a,b){var d,f;switch(Ca){case 1:b.rc1=ma*a+(1-ma)*b.rc1+1E-10;b.rc2=cb*b.rc1+(1-cb)*b.rc2;d=b.rc2;b.rc3=va*d+(1-va)*b.rc3;b.rc4=va*b.rc3+(1-va)*b.rc4;b.rc5=va*b.rc4+(1-va)*b.rc5;f=b.rc5;break;case 2:d=a;b.rc2=va*d+(1-va)*b.rc2+1E-10;b.rc3=va*b.rc2+(1-va)*b.rc3;b.rc4=va*b.rc3+(1-va)*b.rc4;f=b.rc4;break;default:return a}d=Ba?~~f:~~d;32767<d?d=32767:-32768>d&&
(d=-32768);return d}function K(){if(za.pointer>=za.frames&&(za.pointer=0,!Ga&&fa)){var b=za.buffer,d=za.frames,f=a(ka.writeoffset,ka.readoffset);if(f>ka.frames>>2)SAEF_warn("audio.cachewrite() full %d",f+d);else if(ka.writeoffset+d>ka.frames){if(f=ka.frames-ka.writeoffset)for(var h=0;h<SAEV_config.audio.channels;h++)ka.buffer[h].set(b[h].subarray(0,f),ka.writeoffset);if(d-f)for(h=0;h<SAEV_config.audio.channels;h++)ka.buffer[h].set(b[h].subarray(f,f+(d-f)));ka.writeoffset=d-f}else{for(h=0;h<SAEV_config.audio.channels;h++)ka.buffer[h].set(b[h].subarray(0,
d),ka.writeoffset);ka.writeoffset+=d}ka.wait=!1}}function m(a){Dc?Qb[sc]=a:za.buffer[1][za.pointer]=a}function pa(a){if(Dc){Ub[sc]=a;var b=Qb[sc];sc=sc+1&hc;b=~~((b*W+Ub[sc]*Sb)/32);a=~~((a*W+Qb[sc]*Sb)/32);za.buffer[1][za.pointer]=a;za.buffer[0][za.pointer]=b}else za.buffer[0][za.pointer]=a}function ja(a){for(var b=0;4>b;b++){var d=L[b];d.sample_accum+=(d.enabled?d.current_sample*d.vol:0)*a;d.sample_accum_time+=a}}function G(a,b,d){for(var f=0;f<d;b++,f++)a[f]=L[b].sample_accum_time?Math.floor(L[b].sample_accum/
L[b].sample_accum_time):0,L[b].sample_accum=0,L[b].sample_accum_time=0}function bb(){var a=L[0].enabled?L[0].current_sample*L[0].vol:0,b=L[2].enabled?L[2].current_sample*L[2].vol:0,d=L[3].enabled?L[3].current_sample*L[3].vol:0,a=a+(L[1].enabled?L[1].current_sample*L[1].vol:0),a=a+b+d;SAEV_config.audio.filter&&(a=E(a,Ia[0]));za.buffer[0][za.pointer++]=a;za.currrent++;K()}function kb(){G(Ea,0,4);var a=Ea[0]+Ea[3]+Ea[1]+Ea[2];SAEV_config.audio.filter&&(a=E(a,Ia[0]));za.buffer[0][za.pointer++]=a;za.currrent++;
K()}function ua(){var a,b,d,f,h,m,q,r,y;L[0].enabled?(a=L[0].current_sample*L[0].vol,h=L[0].last_sample*L[0].vol):a=h=0;L[1].enabled?(b=L[1].current_sample*L[1].vol,m=L[1].last_sample*L[1].vol):b=m=0;L[2].enabled?(d=L[2].current_sample*L[2].vol,q=L[2].last_sample*L[2].vol):d=q=0;L[3].enabled?(f=L[3].current_sample*L[3].vol,r=L[3].last_sample*L[3].vol):f=r=0;y=L[0].per;y=~~((L[0].evtime%y<<8)/y);a=a*(256-y)+h*y>>8;y=L[1].per;y=~~((L[1].evtime%y<<8)/y);a+=b*(256-y)+m*y>>8;y=L[2].per;y=~~((L[2].evtime%
y<<8)/y);a+=d*(256-y)+q*y>>8;y=L[3].per;y=~~((L[3].evtime%y<<8)/y);a+=f*(256-y)+r*y>>8;SAEV_config.audio.filter&&(a=E(a,Ia[0]));za.buffer[0][za.pointer++]=a;za.currrent++;K()}function y(){var a,b,d,f,h,m,q,r;L[0].enabled?(a=L[0].current_sample*L[0].vol,h=L[0].last_sample*L[0].vol):a=h=0;L[1].enabled?(b=L[1].current_sample*L[1].vol,m=L[1].last_sample*L[1].vol):b=m=0;L[2].enabled?(d=L[2].current_sample*L[2].vol,q=L[2].last_sample*L[2].vol):d=q=0;L[3].enabled?(f=L[3].current_sample*L[3].vol,r=L[3].last_sample*
L[3].vol):f=r=0;var y,t,z,G=3*db;y=L[0];z=y.per-y.evtime;t=~~((z<<12)/G);if(y.evtime<db||z>=G)t=4096;a=a*t+h*(4096-t)>>12;y=L[1];z=y.per-y.evtime;t=~~((z<<12)/G);if(y.evtime<db||z>=G)t=4096;b=b*t+m*(4096-t)>>12;y=L[2];z=y.per-y.evtime;t=~~((z<<12)/G);if(y.evtime<db||z>=G)t=4096;d=d*t+q*(4096-t)>>12;y=L[3];z=y.per-y.evtime;t=~~((z<<12)/G);if(y.evtime<db||z>=G)t=4096;a+=f*t+r*(4096-t)>>12;a+=b+d;SAEV_config.audio.filter&&(a=E(a,Ia[0]));za.buffer[0][za.pointer++]=a;za.currrent++;K()}function Oa(){var a=
L[0].enabled?L[0].current_sample*L[0].vol:0,b=L[1].enabled?L[1].current_sample*L[1].vol:0,d=L[2].enabled?L[2].current_sample*L[2].vol:0,f=L[3].enabled?L[3].current_sample*L[3].vol:0,b=b+d,d=a+f<<1,f=b<<1;SAEV_config.audio.filter&&(d=E(d,Ia[0]),f=E(f,Ia[1]));m(d);pa(f);za.pointer++;za.currrent++;K()}function T(){G(Ea,0,4);var a=Ea[0]+Ea[3],b=Ea[1]+Ea[2],a=a<<1,b=b<<1;SAEV_config.audio.filter&&(a=E(a,Ia[0]),b=E(b,Ia[1]));m(a);pa(b);za.pointer++;za.currrent++;K()}function wa(){var a,b,d,f,h,q,r,y,t;
L[0].enabled?(a=L[0].current_sample*L[0].vol,h=L[0].last_sample*L[0].vol):a=h=0;L[1].enabled?(b=L[1].current_sample*L[1].vol,q=L[1].last_sample*L[1].vol):b=q=0;L[2].enabled?(d=L[2].current_sample*L[2].vol,r=L[2].last_sample*L[2].vol):d=r=0;L[3].enabled?(f=L[3].current_sample*L[3].vol,y=L[3].last_sample*L[3].vol):f=y=0;t=L[0].per;t=~~((L[0].evtime%t<<8)/t);a=a*(256-t)+h*t>>8;t=L[1].per;t=~~((L[1].evtime%t<<8)/t);b=b*(256-t)+q*t>>8;t=L[2].per;t=~~((L[2].evtime%t<<8)/t);b+=d*(256-t)+r*t>>8;t=L[3].per;
t=~~((L[3].evtime%t<<8)/t);d=a+(f*(256-t)+y*t>>8);d<<=1;f=b<<1;SAEV_config.audio.filter&&(d=E(d,Ia[0]),f=E(f,Ia[1]));m(d);pa(f);za.pointer++;za.currrent++;K()}function b(){var a,b,d,f,h,q,r,y;L[0].enabled?(a=L[0].current_sample*L[0].vol,h=L[0].last_sample*L[0].vol):a=h=0;L[1].enabled?(b=L[1].current_sample*L[1].vol,q=L[1].last_sample*L[1].vol):b=q=0;L[2].enabled?(d=L[2].current_sample*L[2].vol,r=L[2].last_sample*L[2].vol):d=r=0;L[3].enabled?(f=L[3].current_sample*L[3].vol,y=L[3].last_sample*L[3].vol):
f=y=0;var t,z,G,I=3*db;t=L[0];G=t.per-t.evtime;z=~~((G<<12)/I);if(t.evtime<db||G>=I)z=4096;a=a*z+h*(4096-z)>>12;t=L[1];G=t.per-t.evtime;z=~~((G<<12)/I);if(t.evtime<db||G>=I)z=4096;b=b*z+q*(4096-z)>>12;t=L[2];G=t.per-t.evtime;z=~~((G<<12)/I);if(t.evtime<db||G>=I)z=4096;d=d*z+r*(4096-z)>>12;t=L[3];G=t.per-t.evtime;z=~~((G<<12)/I);if(t.evtime<db||G>=I)z=4096;b+=d;a+=f*z+y*(4096-z)>>12;d=a<<1;f=b<<1;SAEV_config.audio.filter&&(d=E(d,Ia[0]),f=E(f,Ia[1]));m(d);pa(f);za.pointer++;za.currrent++;K()}function q(a){a=
L[a];a.state=0;a.evtime=Xb;a.intreq2=0;a.dmaenstore=!1;a.dmaofftime_active=!1}function Z(){var a=Xb;SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!1;SAER_Events_eventtab[SAEC_Events_EV_AUDIO].oldcycles=SAEV_Events_currcycle;for(var b=0;4>b;b++){var d=L[b];d.evtime!=Xb&&a>d.evtime&&(a=d.evtime,SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!0)}SAER_Events_eventtab[SAEC_Events_EV_AUDIO].evtime=SAEV_Events_currcycle+a}function ea(){Za=SAEV_Events_currcycle;xb=db;for(var a=0;4>a;a++)q(a);Z();SAER.events.schedule()}
function Ua(){for(var a=pb=0;a<za.buffer.length;a++)SAEF_memset(za.buffer[a],0,0,za.frames);za.pointer=0;za.currrent=0;ea()}function r(){var a=!1;0==pb&&(ea(),a=ka.wait=!0);pb=200*SAER.playfield.get_maxvpos_nom();return a}function R(a,b){SAER.custom.INTREQ_0(SAEC_Custom_INTF_SETCLR|128<<a)}function Fa(a,b){var d=L[a];b&128&&(b-=256);d.last_sample=d.current_sample;d.current_sample=b}function Lb(a){a=L[a];a.drhpos=SAER.events.current_hpos();a.dr=!0;1==a.wlen&&(a.dsr=!0)}function t(a,b){var d=L[a],f=
SAEV_Custom_adkcon&1<<a,h=SAEV_Custom_adkcon&16<<a;if(f||b&&h){if(!(3<=a)){var m=L[a+1];b&&h?m.per=0==d.dat?65536*SAEC_Events_CYCLE_UNIT:4<d.dat?d.dat*SAEC_Events_CYCLE_UNIT:4*SAEC_Events_CYCLE_UNIT:f&&(m.vol=d.dat,m.vol&=127,64<m.vol&&(m.vol=64))}}else d.dat2=d.dat}function tb(a){var b=L[a];b.evtime=b.per;b.evtime<SAEC_Events_CYCLE_UNIT&&SAEF_error("audio.LOADPER%d bug %d",a,b.evtime)}function Da(a,b){var d=L[a],f=0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN)&&0!=(SAEV_Custom_dmacon&1<<a),h=d.dmaenstore,
m=SAEV_Custom_adkcon&1<<a,y=SAEV_Custom_adkcon&16<<a,m=!m&&!y||m,z=SAER.events.current_hpos();d.dmaenstore=f;if(SAEV_config.audio.mode==SAEC_Config_Audio_Mode_Off)q(a);else switch(r(),2!=d.state&&3!=d.state||!Aa||(!f&&h&&(d.dmaofftime_active=!0),d.dmaofftime_active&&!h&&f&&(Fa(a,d.dat2&255),q(a))),d.state){case 0:f?(d.evtime=Xb,d.state=1,d.dr=!0,d.drhpos=z,d.wlen=d.len,d.ptx_written=!1,2<d.wlen&&(d.ptx_tofetch=!0),d.dsr=!0):d.dat_written&&0==(SAEV_Custom_intreq&128<<a)?(d.state=2,R(a,0),t(a,!1),Aa&&
d.per<10*SAEC_Events_CYCLE_UNIT?(Fa(a,d.dat2&255),q(a)):(d.pbufldl=!0,Da(a,!1))):q(a);break;case 1:d.evtime=Xb;if(!f){q(a);break}if(!d.dat_written)break;R(a,10);Lb(a);1!=d.wlen&&(d.wlen=d.wlen-1>>>0&65535);d.state=5;break;case 5:d.evtime=Xb;if(!f){q(a);break}if(!d.dat_written)break;d.ptx_written&&(d.ptx_written=0,d.lc=d.ptx);t(a,!1);m&&Lb(a);d.state=2;tb(a);d.pbufldl=!0;d.intreq2=0;Da(a,!1);break;case 2:d.pbufldl&&(Fa(a,d.dat2>>8&255),tb(a),d.pbufldl=!1);if(!b)break;y&&t(a,!0);f?(y&&Lb(a),d.intreq2&&
y&&R(a,21)):y&&R(a,22);d.pbufldl=!0;d.state=3;Da(a,!1);break;case 3:d.pbufldl&&(Fa(a,d.dat2&255),tb(a),d.pbufldl=!1);if(!b)break;if(f)t(a,!1),d.intreq2&&m&&R(a,31),m&&Lb(a);else{if(0!=(SAEV_Custom_intreq&128<<a)){q(a);break}t(a,!1);m&&R(a,32)}d.intreq2=0;d.pbufldl=!0;d.state=2;Da(a,!1)}}function sb(a,b){var d=L[a];4>a&&(Da(a,b),d.dat_written=!1)}function Sa(a,b){var d;if(b>=a>>1)return 1;d=2*Math.PI*b/a;d=2*Math.tan(d/2);return 1/(1+1/d)}var ta={context:null,processor:null,connected:!1},ka={frames:0,
buffer:null,readoffset:0,writeoffset:0,wait:!1},qa={frames:0,buffer:null},nb=0,$a=!1,Ga=!1,fa=!1,U=0;this.update_sound=function(a){fa&&(db=nb=a*SAEC_Events_CYCLE_UNIT*1/U,SAEF_log("audio.update_sound() freq %f Hz, scaled sample eventtime %f cycles",U,db*SAEC_Events_CYCLE_UNIT_INV))};for(var na=1/32768,Xb=SAEC_Events_CYCLE_MAX,wb=SAEC_Events_CYCLE_MAX,L=Array(4),mb=0;4>mb;mb++)L[mb]=new N;for(var pb=0,zb=function(){},Pa=null,db=0,Za=0,xb=0,za={frames:0,buffer:null,pointer:0,currrent:0,average:new SAEO_MAvg(10)},
Ea=new Int16Array(4),Qb=new Int16Array(1024),Ub=new Int16Array(1024),sc=0,Dc=0,hc=0,Sb=0,W=0,Aa=!1,z=0,Ca=0,Ba=0,Ia=Array(4),mb=0;4>mb;mb++)Ia[mb]=new I;var ma=0,cb=0,va=0;this.led_filter_audio=function(){Ba=0;if(0<z||SAER.gui.data.powerled&&0<=z)Ba=1};SAER_Audio_deactivate=Ua;this.getpt=function(a,b){var d=L[a],f=d.pt;d.pt+=2;b&&(d.pt=d.lc);d.ptx_tofetch=!1;return f};this.dmal=function(){for(var a=0,b=0;4>b;b++){var d=L[b];d.dr&&(a|=1<<2*b);d.dsr&&(a|=1<<2*b+1);d.dr=d.dsr=!1}return a};this.state_machine=
function(){this.update();for(var a=0;4>a;a++){var b=L[a];Da(a,!1);b.dat_written=!1}Z();SAER.events.schedule()};this.obtain=function(){var a;a=SAEV_config.audio.mode>=SAEC_Config_Audio_Mode_On&&!SAEC_info.audio.webAudio?SAEE_Audio_RequiresWebAudio:SAEE_None;return a};this.setup=function(){Aa=SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020||SAEV_config.cpu.speed!=SAEC_Config_CPU_Speed_Original;U=SAEC_Config_Audio_Freq_44100;za.frames=SAEV_config.audio.bufferFrames;za.buffer=Array(2);for(var a=0;a<
za.buffer.length;a++)za.buffer[a]=new Int16Array(za.frames);za.pointer=0;za.currrent=0;if(SAEV_config.audio.mode>=SAEC_Config_Audio_Mode_On&&(a=fa?!0:J(),!a))return SAEE_Audio_RequiresWebAudio;xb=db;Za=SAEV_Events_currcycle;a=3*SAEV_config.audio.stereoSeparation>>1;15<=a&&(a=16);Sb=16-a;W=16+a;var d=SAEV_config.audio.stereoDelay;hc=0<d?(1<<d)-1:0;if(Dc=16>a||0<hc)SAEF_log("audio.setup() mixing enabled"),sc=0,SAEF_memset(Qb,0,0,1024);z=-1;Ca=0;SAEV_config.audio.filter&&(SAEV_config.audio.filter==SAEC_Config_Audio_Filter_On&&
(z=1),SAEV_config.audio.filter==SAEC_Config_Audio_Filter_Emul&&(z=0),SAEV_config.audio.filterType==SAEC_Config_Audio_FilterType_A500?Ca=1:SAEV_config.audio.filterType==SAEC_Config_Audio_FilterType_A1200&&(Ca=2));ma=Sa(U,6200);cb=Sa(U,2E4);va=Sa(U,7E3);this.led_filter_audio();switch(SAEV_config.audio.interpol){case SAEC_Config_Audio_Interpol_None:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:zb=bb;break;case SAEC_Config_Audio_Channels_Stereo:zb=Oa}break;case SAEC_Config_Audio_Interpol_Anti:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:zb=
kb;break;case SAEC_Config_Audio_Channels_Stereo:zb=T}break;case SAEC_Config_Audio_Interpol_RH:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:zb=ua;break;case SAEC_Config_Audio_Channels_Stereo:zb=wa}break;case SAEC_Config_Audio_Interpol_Crux:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:zb=y;break;case SAEC_Config_Audio_Channels_Stereo:zb=b}}Pa=null;SAEV_config.audio.interpol==SAEC_Config_Audio_Interpol_Anti&&(Pa=ja);SAEV_config.audio.mode==SAEC_Config_Audio_Mode_Off?
(SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!1,SAER.events.schedule()):r();return SAEE_None};this.cleanup=function(){h()};this.reset=function(){$a=Ga=!1;ka.readoffset=0;ka.writeoffset=0;ka.wait=!0;za.average.clr();for(var a=0;a<Ia.length;a++)Ia[a].clr();for(a=0;4>a;a++){var b=L[a];b.clr();b.per=wb-1;b.vol=0;b.evtime=Xb}Za=SAEV_Events_currcycle;xb=db;Z();SAER.events.schedule();Hb=-1};this.pauseResume=function(a){a?!Ga&&fa&&(SAEF_log("audio.pause_sound()"),Ga=!0):Ga&&fa&&(SAEF_log("audio.resume_sound()"),
Ga=!1,ka.wait=!0)};this.mute=function(a){$a=a};var Hb=-1;this.update_adkmasks=function(){var a=SAEV_Custom_adkcon|SAEV_Custom_adkcon>>4;L[0].enabled=0==(a&1);L[1].enabled=0==(a&3);L[2].enabled=0==(a&7);L[3].enabled=0==(a&15);(Hb&255)!=(SAEV_Custom_adkcon&255)&&(r(),Hb=SAEV_Custom_adkcon)};this.update=function(){var a=0;if(SAEV_config.audio.mode==SAEC_Config_Audio_Mode_Off||0==pb)Za=SAEV_Events_currcycle;else{for(a=SAEV_Events_currcycle-Za;0<a;){var b=a+1,d,f;for(f=0;4>f;f++)L[f].evtime!=Xb&&b>L[f].evtime&&
(b=L[f].evtime);d=Math.round(xb);SAEV_config.audio.mode>SAEC_Config_Audio_Mode_Off_Emul&&b>d&&(b=d);b>a&&(b=a);xb-=b;SAEV_config.audio.mode>SAEC_Config_Audio_Mode_Off_Emul&&null!==Pa&&Pa(Math.floor(b*SAEC_Events_CYCLE_UNIT_INV));for(f=0;4>f;f++)L[f].evtime!=Xb&&(L[f].evtime-=b);a-=b;SAEV_config.audio.mode>SAEC_Config_Audio_Mode_Off_Emul&&d==b&&(xb+=db,zb());for(f=0;4>f;f++)0==L[f].evtime&&(sb(f,!0),0==L[f].evtime&&(SAEF_error("audio.update() evtime == 0 (channel %d)",f),L[f].evtime=Xb))}Za=SAEV_Events_currcycle-
a}};this.handler=function(){this.update();Z()};this.hsync=function(){0<pb&&(pb--,0==pb&&Ua());this.update()};this.vsync=function(){};this.AUDxDAT=function(a,b){var d=L[a],f=0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN)&&0!=(SAEV_Custom_dmacon&1<<a);d.dat=b;d.dat_written=!0;2==d.state||3==d.state?f&&(1==d.wlen?(d.wlen=d.len,d.intreq2=!0):d.wlen=d.wlen-1>>>0&65535):(r(),this.update(),sb(a,!1),Z(),SAER.events.schedule());d.dat_written=!1};this.AUDxLCH=function(a,b){var d=L[a];r();this.update();b&=SAEV_config.chipset.mask==
SAEC_Config_Chipset_Mask_OCS?7:31;Aa&&(d.ptx_tofetch&&1==d.state||d.ptx_written)?(d.ptx=d.lc,d.ptx_written=!0):d.lc=(b<<16|d.lc&65535)>>>0};this.AUDxLCL=function(a,b){var d=L[a];r();this.update();Aa&&(d.ptx_tofetch&&1==d.state||d.ptx_written)?(d.ptx=d.lc,d.ptx_written=!0):d.lc=(d.lc&4294901760|b&65534)>>>0};this.AUDxPER=function(a,b){var d=L[a];r();this.update();var f=b*SAEC_Events_CYCLE_UNIT;0==f&&(f=wb-1);f<4*SAEC_Events_CYCLE_UNIT&&(f=4*SAEC_Events_CYCLE_UNIT);f<60*SAEC_Events_CYCLE_UNIT&&d.dmaenstore&&
(f=60*SAEC_Events_CYCLE_UNIT);d.per==wb-1&&f!=wb-1&&(d.evtime=SAEC_Events_CYCLE_UNIT,SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&(Z(),SAER.events.schedule()));d.per=f};this.AUDxLEN=function(a,b){r();this.update();L[a].len=b};this.AUDxVOL=function(a,b){b&=127;64<b&&(b=64);r();this.update();L[a].vol=b}};var SAEV_CIA_bank=null;
function SAEO_CIA(){function a(a){SAER.custom.INTREQ_0(SAEC_Custom_INTF_SETCLR|a)}function f(b){na|=64;na|=32;SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V?a(8):a(8192)}function d(){fa&U&&!(fa&128)&&(fa|=128,fa|=64,fa|=32,a(8))}function J(){na&Xb&&!(na&128)&&(na|=128,f(0))}function h(){var a=(SAEV_Events_currcycle-SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles+ed)/Ga>>>0;Ub=sc=Dc=hc=0;if(1==(wb&33)){var b=a,b=b>zb?b-zb:0;SAEF_assert(xb+1>=b);Ub=b}1==(L&97)&&(b=a,b=b>Pa?
b-Pa:0,SAEF_assert(za+1>=b),sc=b);1==(mb&33)&&(b=a,b=b>db?b-db:0,SAEF_assert(Ea+1>=b),Dc=b);1==(pb&97)&&(b=a,b=b>Za?b-Za:0,SAEF_assert(Qb+1>=b),hc=b)}function N(){var a,b=SAEV_Events_currcycle-SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles+ed;a=b/Ga>>>0;var f=0,h=0,m=0,q=0,r=0,y=0,A=0;ed=b%Ga;if(1==(wb&33)){var b=!0,t=a;0<zb&&(t>zb?(t-=zb,zb=0):(zb-=t,b=!1));b&&(SAEF_assert(xb+1>=t),xb+1==t&&(64==(wb&72)&&0<qb&&0==--qb&&(m=1),f=1,65!=(L&97)&&97!=(L&97)||0!=za--||(h=1)),xb-=t)}1==(L&97)&&(b=!0,
t=a,0<Pa&&(t>Pa?(t-=Pa,Pa=0):(Pa-=t,b=!1)),b&&(SAEF_assert(za+1>=t),za+1==t&&(h=1),za-=t));1==(mb&33)&&(b=!0,t=a,0<db&&(t>db?(t-=db,db=0):(db-=t,b=!1)),b&&(SAEF_assert(Ea+1>=t),Ea+1==t&&(64==(mb&72)&&0<tc&&0==--tc&&(y=1),q=1,65!=(pb&97)&&97!=(pb&97)||0!=Qb--||(r=1)),Ea-=t));1==(pb&97)&&(b=!0,t=a,0<Za&&(t>Za?(t-=Za,Za=0):(Za-=t,b=!1)),b&&(SAEF_assert(Qb+1>=t),Qb+1==t&&(r=1),Qb-=t));f&&(fa|=1,A=1,xb=Bc,wb&8&&(wb&=-2));h&&(fa|=2,A=1,za=yb,L&8&&(L&=-2));m&&(fa|=8,A=1);q&&(na|=1,A|=2,Ea=cc,mb&8&&(mb&=
-2));r&&(na|=2,A|=2,Qb=Nb,pb&8&&(pb&=-2));y&&(na|=8,A|=2);a=A;a&1&&d();a&2&&J()}function I(){var a=-1,b=-1,d=-1,f=-1,h=Ga-ed;SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles=SAEV_Events_currcycle;1==(wb&33)&&(a=h+Ga*(xb+zb));1==(L&97)&&(b=h+Ga*(za+Pa));1==(mb&33)&&(d=h+Ga*(Ea+db));1==(pb&97)&&(f=h+Ga*(Qb+Za));SAER_Events_eventtab[SAEC_Events_EV_CIA].active=-1!=a||-1!=b||-1!=d||-1!=f;SAER_Events_eventtab[SAEC_Events_EV_CIA].active&&(h=SAEC_Events_CYCLE_MAX,-1!=a&&(h=a),-1!=b&&b<h&&(h=b),-1!=d&&d<
h&&(h=d),-1!=f&&f<h&&(h=f),SAER_Events_eventtab[SAEC_Events_EV_CIA].evtime=SAEV_Events_currcycle+h);SAER.events.schedule()}function E(a,b,d,f){return a==b?!0:!SAEV_config.chipset.cia.todBug||!d||a&4095?!1:(a-1>>>0&16773120)==b}function K(a,b){return SAER.cpu.pc_in_rom()||0!=W||0!=Ba?E(W,Ba,a,1)?(b&&(na|=4,J()),!0):!1:!1}function m(a){E(Sb,Ca,a,0)&&(fa|=4,d())}function pa(){var a={};SAEF_gettimeofday(a,null);Fc=1E6*a.tv_sec+a.tv_usec;Vd=Qd=Sb;ad=0}function ja(){Vb=Pc;Xc=64*SAER.playfield.get_maxvpos();
fa|=8;d()}function G(a){Tc=3;ca&&(W++,W&=16777215,K(!0,a))}function bb(a){2==Tc&&G(!0)}function kb(){if(1==Tc&&ca){var a=SAER.events.current_hpos(),a=a-jd;0<=a||0>SAEV_config.cpu.speed?G(!0):(Tc=2,SAER.events.event2_newevent_xx(-1,-a,0,bb))}}function ua(a){var b=SAEV_Events_currcycle,d=(b-Bb)*SAEC_Events_CYCLE_UNIT_INV>>>0;a?la+=d:Ta+=d;Bb=b}function y(a){Sb++;Sb&=16777215;m(!0)}function Oa(){var a=xa,a=a|~Ab,a=a&2?0:1;a!=va&&(ua(va),va=a,Hb=-1)}function T(){var a=xa;Oa();SAEV_config.chipset.cia.overlay&&
(a&1)!=cb&&((cb=a&1)?SAER.memory.mapOverlay(!1):SAER.memory.mapOverlay(!0))}function wa(a,b,d){switch(a){case 0:return b&d|d^255;case 1:return(b&d|d^255)&7;default:return 0}}function b(a){if(SAEV_config.chipset.cia.type6526){for(var b=0,d=0;4>d;d++){var f=a%10,b=16*b;4294967295<b&&(b-=4294967296);b+=f;4294967295<b&&(b-=4294967296);a=a/10>>>0}return b}return a}function q(a){for(var b=0,d=0;4>d;d++){var f=a/16>>>0,b=10*b;4294967295<b&&(b-=4294967296);b+=f;4294967295<b&&(b-=4294967296);a=a/16>>>0}return b}
function Z(a){Sb=SAEV_config.chipset.cia.type6526?q(a):a}function ea(a){Ca=SAEV_config.chipset.cia.type6526?q(a):a}function Ua(a){W=SAEV_config.chipset.cia.type6526?q(a):a}function r(a){Ba=SAEV_config.chipset.cia.type6526?q(a):a}function R(a){a&=15;h();switch(a){case 0:a=SAER.disk.status_ciaa()&60;var d=0;SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse?(SAER.input.mouse.button[0]||(d|=64),Ab&64&&(d=d&-65|xa&64)):SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Joy0?(SAER.input.joystick[0].button[0]||
(d|=64),Ab&64&&(d=d&-65|xa&64)):d|=64;SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Joy1?(SAER.input.joystick[1].button[0]||(d|=128),Ab&128&&(d=d&-129|xa&128)):d|=128;a|=d;return a|=(xa|Ab^3)&3;case 1:return a=wa(0,Mb,lc),L&2&&(d=0,L&4&&(d=L&1),a=a&-129|(d?128:0)),wb&2&&(d=0,wb&4&&(d=wb&1),a&=-65,a|=d?64:0),a;case 2:return Ab;case 3:return lc;case 4:return xb-Ub&255;case 5:return xb-Ub>>>8&255;case 6:return za-sc&255;case 7:return za-sc>>>8&255;case 8:return Ia?(Ia=0,b(Aa)&255):b(Sb)&255;case 9:return Ia?
b(Aa)>>>8&255:b(Sb)>>>8&255;case 10:if(SAEV_config.chipset.cia.type6526)return Ia?b(Aa)>>>16&255:b(Sb)>>>16&255;Ia||(L&128||(Ia=1),Aa=Sb);return b(Aa)>>>16&255;case 11:if(SAEV_config.chipset.cia.type6526)return Ia||(L&128||(Ia=1),Aa=Sb),Ia?b(Aa)>>>24:b(Sb)>>>24;break;case 12:return Vb;case 13:return a=fa&-97,fa=0,a;case 14:return wb;case 15:return L}return 0}function Fa(a){a&=15;h();switch(a){case 0:return a=0,SAEV_config.serial.enabled&&(a=SAER.serial.readstatus(dc)),a|=wa(1,Ic,dc);case 1:a=Kc;a=
SAER.disk.status_ciab(a);if(pb&2){var d=0;pb&4&&(d=pb&1);a=a&-129|(d?128:0)}mb&2&&(d=0,mb&4&&(d=mb&1),a&=-65,a|=d?64:0);return a;case 2:return dc;case 3:return od;case 4:return Ea-Dc&255;case 5:return Ea-Dc>>>8&255;case 6:return Qb-hc&255;case 7:return Qb-hc>>>8&255;case 8:return kb(),ma?(ma=0,b(z)&255):b(W)&255;case 9:return kb(),ma?b(z)>>>8&255:b(W)>>>8&255;case 10:kb();if(SAEV_config.chipset.cia.type6526)return ma?b(z)>>>16&255:b(W)>>>16&255;ma||(pb&128||(ma=1),z=W);return b(z)>>>16&255;case 11:if(SAEV_config.chipset.cia.type6526)return ma||
(pb&128||(ma=1),z=W),ma?b(z)>>>24:b(W)>>>24;break;case 12:return qd;case 13:return a=na&-97,na=0,a;case 14:return mb;case 15:return pb}return 0}function Lb(a,f){var h=a&15;!SAEV_config.chipset.cia.overlay&&cb&&(SAER.memory.mapOverlay(!0),cb=0);switch(h){case 0:xa=xa&-196|f&195;T();0<SAEV_config.memory.amaxRom.size&&SAER.disk.amax_bfe001_write(f,Ab);break;case 1:Mb=f;break;case 2:Ab=f;T();break;case 3:lc=f;break;case 4:N();Bc=Bc&65280|f;I();break;case 5:N();Bc=Bc&255|f<<8;0==(wb&1)&&(xb=Bc);wb&8&&
(xb=Bc,wb|=1,zb=3);I();break;case 6:N();yb=yb&65280|f;I();break;case 7:N();yb=yb&255|f<<8;0==(L&1)&&(za=yb);L&8&&(za=yb,L|=1,Pa=3);I();break;case 8:L&128?ea((b(Ca)&4294967040|f)>>>0):(Z((b(Sb)&4294967040|f)>>>0),lb=1,m(!1));break;case 9:L&128?ea((b(Ca)&4294902015|f<<8)>>>0):Z((b(Sb)&4294902015|f<<8)>>>0);break;case 10:L&128?ea((b(Ca)&4278255615|f<<16)>>>0):(Z((b(Sb)&4278255615|f<<16)>>>0),SAEV_config.chipset.cia.type6526||(lb=0));break;case 11:SAEV_config.chipset.cia.type6526&&(L&128?ea((b(Ca)&16777215|
f<<24)>>>0):(Z((b(Sb)&16777215|f<<24)>>>0),lb=0));break;case 12:N();Vb=f;65==(wb&65)&&0==qb&&(qb=16);I();break;case 13:U=f&128?U|f&127:U&~f;d();break;case 14:N();f&=127;f&1&&!(wb&1)&&(zb=2);0==(f&64)&&0!=(wb&64)&&(Xc=0);wb=f;wb&16&&(wb&=-17,xb=Bc);I();break;case 15:N(),f&1&&!(L&1)&&(Pa=2),L=f,L&16&&(L&=-17,za=yb),I()}}function t(a,d){switch(a&15){case 0:Ic=d;SAEV_config.serial.enabled&&SAER.serial.writestatus(Ic,dc);break;case 1:Kc=d;SAER.disk.select(d);break;case 2:dc=d;SAEV_config.serial.enabled&&
SAER.serial.writestatus(Ic,dc);break;case 3:od=d;break;case 4:N();cc=cc&65280|d;I();break;case 5:N();cc=cc&255|d<<8;0==(mb&1)&&(Ea=cc);mb&8&&(Ea=cc,mb|=1,db=3);I();break;case 6:N();Nb=Nb&65280|d;I();break;case 7:N();Nb=Nb&255|d<<8;0==(pb&1)&&(Qb=Nb);pb&8&&(Qb=Nb,pb|=1,Za=3);I();break;case 8:kb();pb&128?r((b(Ba)&4294967040|d)>>>0):(Ua((b(W)&4294967040|d)>>>0),ca=1,K(!1,!0));break;case 9:kb();pb&128?r((b(Ba)&4294902015|d<<8)>>>0):Ua((b(W)&4294902015|d<<8)>>>0);break;case 10:kb();pb&128?r((b(Ba)&4278255615|
d<<16)>>>0):(Ua((b(W)&4278255615|d<<16)>>>0),SAEV_config.chipset.cia.type6526||(ca=0));break;case 11:SAEV_config.chipset.cia.type6526&&(kb(),pb&128?r((b(Ba)&16777215|d<<24)>>>0):(Ua((b(W)&16777215|d<<24)>>>0),ca=0));break;case 12:N();qd=d;0==(mb&64)&&(tc=0);65==(mb&65)&&0==tc&&(tc=16);I();break;case 13:Xb=d&128?Xb|d&127:Xb&~d;J();break;case 14:N();d&=127;d&1&&!(mb&1)&&(db=2);mb=d;mb&16&&(mb&=-17,Ea=cc);I();break;case 15:N(),d&1&&!(pb&1)&&(Za=2),pb=d,pb&16&&(pb&=-17,Qb=Nb),I()}}function tb(){return SAEV_config.chipset.ide||
SAEV_config.chipset.pcmcia||SAEV_config.chipset.mbdmac}function Da(a){a&=61440;return 57344==a||53248==a}function sb(a){return SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia?Da(a):!0}function Sa(a){return!Da(a)&&0<=SAEV_config.chipset.fatGaryRev}function ta(a){var b=(SAEV_Events_currcycle-SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles)%Ga;a=4*Ga/10>>>0;b>=a?(b=Ga-b,b+=a):b=b?Ga+a-b:a-b;b&&SAER.events.do_cycles(b)}function ka(b,d){SAER.events.do_cycles(6*SAEC_Events_CYCLE_UNIT>>1);if(eb){var f=
eb;eb=0;f&1&&a(8);f&2&&a(8192)}}function qa(a){var b=(a&3840)>>8,d=65535;if(Sa(a))return SAER.memory.dummyGet(a,2,!1,0);if(!sb(a))return d;switch(a>>12&3){case 0:tb()||(ta(3),d=Fa(b)<<8|R(b),ka(3,d));break;case 1:ta(2);d=Fa(b)<<8|255;ka(2,d);break;case 2:ta(1);d=65280|R(b);ka(1,d);break;case 3:SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible&&(ta(0),d=SAER_CPU_regs.irc,ka(0,d))}return d}function nb(a){return(qa(a)<<16|qa(a+2))>>>0}function $a(a,b){var d=(a&3840)>>8;Sa(a)?
SAER.memory.dummyPut(a,2,0):!sb(a)||tb()&&0==(a&12288)||(ta((0==(a&8192)?1:0)|(0==(a&4096)?2:0)),0==(a&8192)&&t(d,b>>8),0==(a&4096)&&Lb(d,b&255),ka((0==(a&8192)?1:0)|(0==(a&4096)?2:0),b))}var Ga=10*SAEC_Events_CYCLE_UNIT>>1,fa=0,U=0,na=0,Xb=0,wb=0,L=0,mb=0,pb=0,zb=0,Pa=0,db=0,Za=0,xb=0,za=0,Ea=0,Qb=0,Ub=0,sc=0,Dc=0,hc=0,Sb=0,W=0,Aa=0,z=0,Ca=0,Ba=0,Ia=0,ma=0,cb=!1,va=!1,Hb=0,la=0,Ta=0,Bb=0,Ic=0,Bc=0,yb=0,cc=0,Nb=0,lb=0,ca=0,xa=0,Mb=0,Ab=0,lc=0,Vb=0,qb=0,Kc=0,dc=0,od=0,qd=0,tc=0,ed=0,Rc=0,Xc=0,Pc=0,
eb=0;this.rethink=function(){fa&64&&(fa|=64,fa|=32,a(8));na&64&&f(0)};this.handler=function(){N();I()};this.diskindex=function(){na|=16;J()};var Fc=0,Qd=0,Vd=0,fd=0,bd=0,ad=0,Sc=0,pd=0,jd=0,Tc=0;this.b_tod_handler=function(a){ca&&(jd=a+70,Tc=1,E(W+1&16777215,Ba,!0,1)&&(Tc=2,SAER.events.event2_newevent_xx(-1,jd,0,bb)))};this.hsync_post=function(a){1==Tc&&G(!1);Tc=0;if(SAEV_config.chipset.cia.todHack&&lb)a:{var b,d=!1;if(0!=fd)if(0>fd)fd=156E3;else if(1<fd)fd--,1==fd&&(SAEF_log("cia.do_tod_hack() enabled"),
pa());else if(SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_VSync?(b=Math.floor(SAER.playfield.get_vblank_hz()+.5),59<=b&&61>=b&&(b=60),49<=b&&51>=b&&(b=50)):b=SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_50Hz?50:60,!(0>=b)){if(b!=pd||(Sb&4095)!=(Vd&4095))SAEF_log("cia.do_tod_hack() reset"),pa(),pd=b,d=!0;if(a||SAEV_config.chipset.cia.tod!=SAEC_Config_Chipset_CIA_TOD_VSync){if(0<bd){bd--;if(0<bd)break a;bd=50}a={};SAEF_gettimeofday(a,null);var f=1E6/b>>>0;1E6*a.tv_sec+a.tv_usec-
Fc>=f&&(Fc+=f,ad+=1E6-f*b,Fc+=ad/b>>>0,ad%=b,d=!0);d&&(Sb++,Vd=Sb&=16777215,m(!1))}}}if(0==(SAEV_Events_hsync_counter&15)&&(SAER.input.keyboard.keysAvail()||3>Rc)&&!Xc){switch(Rc){case 0:Pc=0;Rc++;break;case 1:Pc=4;Rc++;break;case 2:Pc=2;Rc++;break;case 3:Pc=~SAER.input.keyboard.nextKey()&255}ja()}};this.vsync=function(){0<Sc&&Sc--;0>SAEV_RTC_delayed_write?SAEV_RTC_delayed_write=50:0<SAEV_RTC_delayed_write&&(SAEV_RTC_delayed_write--,0==SAEV_RTC_delayed_write&&SAER.rtc.write());ua(va);var a=la&&!Ta?
255:Ta&&!la?0:Ta?~~(255*la/(la+Ta)):255;0>a?a=0:255<a&&(a=255);Ta=la=0;SAER.gui.data.powerled_brightness=a;Hb!=SAER.gui.data.powerled_brightness&&(SAER.gui.data.powerled=127<SAER.gui.data.powerled_brightness,SAER.gui.led(SAEC_GUI_LED_POWER,SAER.gui.data.powerled,SAER.gui.data.powerled_brightness),SAER.audio.led_filter_audio());Hb=a;Bb=SAEV_Events_currcycle;this.handler();0<Xc&&(Xc-=SAER.playfield.get_maxvpos(),0>=Xc&&(Xc=0,ja()))};this.a_tod_inc=function(a){SAEV_config.chipset.cia.todHack&&1==fd||
lb&&SAER.events.event2_newevent_xx(-1,a+70,0,y)};this.reset=function(){fd=Qd=Fc=0;SAEV_config.chipset.cia.todHack&&(fd=156E3);Tc=Sc=Xc=0;cb=!0;fa=na=U=Xb=lb=ca=Sb=W=Ab=xa=Ia=ma=Rc=0;wb=L=mb=pb=4;Bc=yb=cc=Nb=xb=za=Ea=Qb=65535;Ca=Ba=0;Ic=140;Ub=sc=Dc=hc=qd=tc=Vb=qb=ed=dc=0;I();SAER.disk.select_set(Kc);SAER.memory.mapOverlay(!1);Oa();SAEV_config.serial.enabled&&SAER.serial.dtr_off()};this.dump=function(){SAEF_log("cia.dump() A: CRA %02x CRB %02x ICR %02x IM %02x TA %04x (%04x) TB %04x (%04x)",wb,L,fa,
U,xb,Bc,za,yb);SAEF_log("cia.dump() TOD %06x (%06x) ALARM %06x %c%c CYC=%08X",Sb,Aa,Ca,Ia?"L":" ",lb?" ":"S",SAEV_Events_currcycle);SAEF_log("cia.dump() B: CRA %02x CRB %02x ICR %02x IM %02x TA %04x (%04x) TB %04x (%04x)",mb,pb,na,Xb,Ea,cc,Qb,Nb);SAEF_log("cia.dump() TOD %06x (%06x) ALARM %06x %c%c CLK=%d",W,z,Ba,ma?"L":" ",ca?" ":"S",ed/SAEC_Events_CYCLE_UNIT)};SAEV_CIA_bank=new SAEO_Memory_addrbank(nb,qa,function(a){var b=(a&3840)>>8,d=255;if(Sa(a))return SAER.memory.dummyGet(a,1,!1,0);if(!sb(a))return d;
switch(a>>12&3){case 0:tb()||(ta(3),d=a&1?R(b):Fa(b),ka(3,d));break;case 1:ta(2);d=SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible?a&1?SAER_CPU_regs.irc&255:Fa(b):a&1?255:Fa(b);ka(2,d);break;case 2:ta(1);d=SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible?a&1?R(b):SAER_CPU_regs.irc>>8:a&1?R(b):255;ka(1,d);break;case 3:SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible&&(ta(0),d=a&1?SAER_CPU_regs.irc&255:SAER_CPU_regs.irc>>
8,ka(0,d))}return d},function(a,b){$a(a,b>>>16);$a(a+2,b&65535)},$a,function(a,b){var d=(a&3840)>>8;Sa(a)?SAER.memory.dummyPut(a,1,0):!sb(a)||tb()&&0==(a&12288)||(ta((0==(a&8192)?1:0)|(0==(a&4096)?2:0)),0==(a&8192)&&t(d,b),0==(a&4096)&&Lb(d,b),ka((0==(a&8192)?1:0)|(0==(a&4096)?2:0),b))},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"CIA",function(a){return SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst32(a):nb(a)},function(a){return SAEV_config.cpu.model>=
SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst16(a):qa(a)},SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_CIA,null,16129,12566528)};var SAEC_Disk_Create_Mode_Normal=1,SAEC_Disk_Create_Mode_Custom=2,SAEC_Disk_Create_Type_35_DD=1,SAEC_Disk_Create_Type_35_HD=2,SAEC_Disk_Create_Type_35_DD_PC=3,SAEC_Disk_Create_Type_35_HD_PC=4,SAEC_Disk_Create_Type_525_SD=5;
function SAEO_DiskInfo(){this.diskname="";this.hd=!1;this.crc32=0;this.bootblock=new Uint8Array(1024);this.bootblockChecksumValid=this.bootblockChecksum=!1;this.bootblockType=0;this.unreadable=!1;this.clr=function(){this.diskname="";this.hd=!1;this.crc32=0;SAEF_memset(this.bootblock,0,0,1024);this.bootblockChecksum=0;this.bootblockChecksumValid=!1;this.bootblockType=0;this.unreadable=!1}}
function SAEO_Disk(){function a(){return SAEV_config.chipset.ntsc?6399:6334}function f(){return SAEV_config.chipset.ntsc?415:350}function d(){this.sync=this.track=this.bitlen=this.offs=this.len=0;this.type=5;this.revolutions=0}function J(a){this.num=a;this.pcdecodedfile=this.writediskfile=this.diskfile=null;this.filetype=-1;this.trackdata=Array(166);this.writetrackdata=Array(166);for(a=0;166>a;a++)this.trackdata[a]=new d,this.writetrackdata[a]=new d;this.cyl=this.buffered_side=this.buffered_cyl=0;
this.motoroff=!1;this.motordelay=0;this.forcedwrprot=this.wrprot=this.state=!1;this.bigmfmbuf=new Uint16Array(32768);this.tracktiming=new Uint16Array(32768);this.hard_num_cyls=this.num_heads=this.num_secs=this.write_num_tracks=this.num_tracks=this.trackspeed=this.prevtracklen=this.revolutions=this.tracklen=this.indexoffset=this.mfmpos=this.skipoffset=this.revolution_check=this.multi_revolution=0;this.dskchange=this.dskeject=!1;this.dskchange_time=0;this.dskready=this.dskchange_request=!1;this.steplimitcycle=
this.steplimit=this.writtento=this.dskready_down_time=this.dskready_up_time=0;this.indexhack=!1;this.drive_id=this.idbit=this.drive_id_scnt=this.ddhd=this.indexhackmode=0;this.newfile=null;this.floppybitcounter=this.useturbo=this.crc32=0;this.amax=!1;this.lastrev=this.lastdataacesstrack=0;this.track_access_done=!1}function h(){Tc&2&&(bd=0,Pd=!1)}function N(a){for(var b=0;16>b;b++)!df||a&32768||bd++,df=a&32768?1:0,a=a<<1&65535;bd&=Sc-1;h()}function I(a){this.num=a;this.zf=null;this.track=0;this.dat16=
this.dat8=this.dat=null;this.nr_index=this.index_pos=this.dat_idx=this.revs=this.datsz=0;this.index_off=new Uint32Array(5);this.clocked_zeros=this.clock_centre=this.clock=this.flux=this.pll_mode=this.latency=0;this.clr=function(){this.zf=null;this.track=0;this.dat=this.dat8=this.dat16=null;this.nr_index=this.index_pos=this.dat_idx=this.revs=this.datsz=0;this.index_off=new Uint32Array(5);this.clocked_zeros=this.clock_centre=this.clock=this.flux=this.pll_mode=this.latency=0}}function E(a,b){var d=Ec[b],
f=new Uint8Array(16);f[0]=0;var h=Ec[b];h.revs&&h.clr();SAEF_ZFile_fread(f,0,f.length,1,a);if(0!=SAEF_CompareArray(f,SAEF_String2Array("SCP"),3))return SAEF_warn("disk.scp_open() header missing"),!1;if(0==f[5])return SAEF_warn("disk.scp_open() invalid revolution count (%d)",f[5]),!1;if(0!=f[9]&&16!=f[9])return SAEF_warn("disk.scp_open() unsupported bit cell time width (%d)",f[9]),!1;d.zf=a;d.revs=Math.min(f[5],5);eb[b].num_tracks=f[7]+1;SAEF_log("disk.scp_open() ok, %d tracks",eb[b].num_tracks);return!0}
function K(a){for(var b;a.flux<Math.truncate(a.clock/2);){a:{b=a;for(var d=0;;){if(b.dat_idx>=b.index_pos){d=b.nr_index++%b.revs;b.index_pos=b.index_off[d];b.dat_idx=d?b.index_off[d-1]:0;b=-1;break a}var f=SAEF_be16toh(b.dat16[b.dat_idx++]);if(0==f)d+=65536,4294967295<d&&(d-=4294967296);else{d+=f;4294967295<d&&(d-=4294967296);break}}for(b=25*d;4294967295<b;)b-=4294967296;b=b&2147483648?b-4294967296:b}if(-1==b)return-1;a.flux+=b;a.clocked_zeros=0}a.latency+=a.clock;a.flux-=a.clock;if(a.flux>=Math.truncate(a.clock/
2))return a.clocked_zeros++,0;0!=a.pll_mode?(1<=a.clocked_zeros&&3>=a.clocked_zeros?(b=Math.truncate(a.flux/(a.clocked_zeros+1)),a.clock+=Math.truncate(b/10)):a.clock+=Math.truncate((a.clock_centre-a.clock)/10),a.clock=Math.max(Math.truncate(90*a.clock_centre/100),Math.min(Math.truncate(110*a.clock_centre/100),a.clock))):a.clock=a.clock_centre;b=2==a.pll_mode?Math.truncate(a.flux/2):0;a.latency+=a.flux-b;a.flux=b;return 1}function m(a,b,d){var f=Ec[b],h,m,q;for(m=f.latency=h=0;-1!=(q=K(f));m++)0==
(m&15)&&(a[m>>4]=0),q&&(a[m>>4]|=32768>>(m&15)),7==(m&7)&&(d[m>>3]=f.latency-h,h=f.latency);m&7&&(d[m>>3]=Math.floor(8*(f.latency-h)/(m&7)));a=Math.floor(h/(m>>3));for(f=0;f<m+7>>3;f++)d[f]=Math.floor(1E3*d[f]/a);eb[b].tracklen=m}function pa(){var a=SAEV_config.floppy.speed;10>=a&&(a=100);return Math.floor(100*(SAEV_config.chipset.ntsc?1812:1829)/a)}function ja(b){b=Math.truncate(pa()*b.tracklen/(2*a()*b.ddhd*8));0>=b&&(b=1);return b}function G(a){switch(SAEV_config.floppy.drive[a.num].type){case SAEC_Config_Floppy_Type_35_HD:a.drive_id=
null===a.diskfile||1>=a.ddhd?4294967295:2863311530;break;default:a.drive_id=4294967295;break;case SAEC_Config_Floppy_Type_525_SD:a.drive_id=1431655765;break;case SAEC_Config_Floppy_Type_None:case SAEC_Config_Floppy_Type_35_DD_PC:case SAEC_Config_Floppy_Type_35_HD_PC:a.drive_id=0}}function bb(a){switch(a.filetype){case 5:var b=Ec[a.num];b.revs&&b.clr()}a.filetype=-1;SAEF_ZFile_fclose(a.diskfile);a.diskfile=null;a.writediskfile=null;a.pcdecodedfile=null}function kb(a,b){var d=eb[a],f=3==cb&&d.state&&
!((z|Ca)&1<<a),h=SAER.gui.data;if(b||d.state!=h.drive_motor[a]||d.cyl!=h.drive_track[a]||W!=h.drive_side||d.crc32!=h.crc32[a]||f!=h.drive_writing[a]||h.df[a]!=SAEV_config.floppy.drive[a].file.name)h.df[a]=SAEV_config.floppy.drive[a].file.name,h.crc32[a]=d.crc32,h.drive_motor[a]=d.state,h.drive_track[a]=d.cyl,h.drive_side=Ba&1<<a?0:W,h.drive_writing[a]=f,SAER.gui.led(a+SAEC_GUI_LED_DF0,(h.drive_motor[a]?1:0)|(h.drive_writing[a]?2:0),-1)}function ua(a){a.prevtracklen&&(a.mfmpos=Math.floor(a.mfmpos*
Math.floor(1E3*a.tracklen/a.prevtracklen)/1E3),a.mfmpos>=a.tracklen&&(a.mfmpos=a.tracklen-1));a.mfmpos%=a.tracklen;a.prevtracklen=a.tracklen}function y(b){b.tracklen=2*a()*b.ddhd*8;b.revolutions=1;b.trackspeed=pa();b.buffered_side=-1;b.skipoffset=-1;b.tracktiming[0]=0;SAEF_memset(b.bigmfmbuf,0,43690,2*a()*b.ddhd>>1);ua(b)}function Oa(a,b){var d=new Uint8Array(12);SAEF_ZFile_fseek(a.diskfile,0,SEEK_SET);SAEF_ZFile_fread(d,0,1,8,a.diskfile);if(0!=SAEF_CompareArray(d,SAEF_String2Array("UAE-1ADF"),8))return 0;
SAEF_ZFile_fread(d,0,1,4,a.diskfile);a.num_tracks=256*d[2]+d[3];for(var f=12+12*a.num_tracks,h=0;h<a.num_tracks;h++){var m=a.trackdata[h];SAEF_ZFile_fread(d,0,12,1,a.diskfile);m.type=d[3];m.revolutions=d[2]+1;m.len=65536*d[5]+256*d[6]+d[7];m.bitlen=65536*d[9]+256*d[10]+d[11];m.offs=f;2E4<m.len&&b&&(a.ddhd=2);m.track=h;f+=m.len}return 1}function T(a){var b=a.lastIndexOf(".");if(-1!=b&&b+1!=a.length){a=a.substring(b+1);a=a.toLowerCase();if("adf"==a||"adz"==a||"st"==a||"ima"==a||"img"==a)return SAEF_log("disk.isrecognizedext() extention '%s' found",
a),!0;SAEF_log("disk.isrecognizedext() unknow extention '%s'",a)}else SAEF_log("disk.isrecognizedext() no extention");return!1}function wa(a,b,d,f,h){var m=new Uint8Array(12),q=null;bb(a);var q=!1,r=0,q=b.floppy.readOnly?!0:!1,t=SAEF_ZFile_fopen_file(f);null!==t?(r=!1!==f.crc32?f.crc32:SAEF_ZFile_crc32(t),q=[!0,q,r,t]):q=[!1,!1,0,null];a.wrprot=q[1];a.crc32=q[2];a.diskfile=q[3];a.forcedwrprot=f.prot;a.forcedwrprot&&(a.wrprot=!0);a.ddhd=1;a.num_heads=2;a.num_secs=0;a.hard_num_cyls=b.floppy.drive[d].type==
SAEC_Config_Floppy_Type_525_SD?40:80;a.tracktiming[0]=0;a.useturbo=0;a.indexoffset=0;h||(a.dskeject=!1);a.motoroff||(a.dskready_up_time=5616+(Math.decimalRandom()&511),a.dskready_down_time=0);if(null===a.diskfile)return y(a),0;h||(a.newfile=f.clone());SAEF_memset(m,0,0,m.length);b=0;null!==a.diskfile&&(SAEF_ZFile_fread(m,0,1,8,a.diskfile),SAEF_ZFile_fseek(a.diskfile,0,SEEK_END),b=SAEF_ZFile_ftell(a.diskfile),SAEF_ZFile_fseek(a.diskfile,0,SEEK_SET));q=0;T(f.name)&&(q=1);!q&&a.diskfile&&T(SAEF_ZFile_getname(a.diskfile))&&
(q=1);!q&&SAEV_config.floppy.drive[d].type>=SAEC_Config_Floppy_Type_35_DD_PC&&(q=1);if(0==SAEF_CompareArray(m,SAEF_String2Array("SCP"),3)){a.wrprot=!0;if(!E(a.diskfile,a.num))return SAEF_ZFile_fclose(a.diskfile),a.diskfile=null,0;a.filetype=5}else if(0==SAEF_CompareArray(m,SAEF_String2Array("UAE-1ADF"),8))Oa(a,a.ddhd),a.filetype=2,a.num_secs=11,1<a.ddhd&&(a.num_secs=22);else if(0==SAEF_CompareArray(m,SAEF_String2Array("UAE--ADF"),8))for(f=648,a.wrprot=!0,a.filetype=1,a.num_tracks=160,a.num_secs=11,
SAEF_ZFile_fseek(a.diskfile,8,SEEK_SET),d=0;160>d;d++)q=a.trackdata[d],SAEF_ZFile_fread(m,0,4,1,a.diskfile),q.sync=256*m[0]+m[1],q.len=256*m[2]+m[3],q.offs=f,q.revolutions=1,0==q.sync?(q.type=0,q.bitlen=0):(q.type=2,q.bitlen=8*q.len),f+=q.len;else if(!q||327680!=b&&163840!=b&&368640!=b&&184320!=b&&1228800!=b&&737280!=b&&1474560!=b&&819200!=b&&1638400!=b&&1720320!=b&&746496!=b&&1492992!=b&&829440!=b&&1658880!=b&&1741824!=b&&755712!=b&&1511424!=b&&839680!=b&&1679360!=b&&1763328!=b&&368640!=b&&737280!=
b&&409600!=b&&819200!=b&&373248!=b&&746496!=b&&414720!=b&&829440!=b&&377856!=b&&755712!=b&&419840!=b&&839680!=b)if(262144!=b&&524288!=b||17!=m[0]||17!=m[1]&&20!=m[1]){m=0;a.filetype=0;a.num_tracks=0;if(901631<b){for(d=80;83>=d;d++){if(b==22528*d){a.num_secs=22;a.num_tracks=b/11264;a.ddhd=2;break}if(b==11264*d){a.num_secs=11;a.num_tracks=b/5632;break}if(b==12288*d){a.num_secs=12;a.num_tracks=b/6144;m=1;break}if(b==24576*d){a.num_secs=24;a.num_tracks=b/12288;a.ddhd=2;m=1;break}}0==a.num_tracks&&(a.num_secs=
22,a.num_tracks=Math.floor(b/11264),a.ddhd=2)}else a.num_secs=11,a.num_tracks=Math.floor(b/5632);if(!m&&166<a.num_tracks)return SAEF_warn("disk.drive_insert() Your diskfile is too big, %d bytes!",b),SAEF_ZFile_fclose(a.diskfile),a.diskfile=null,0;for(d=0;d<a.num_tracks;d++)q=a.trackdata[d],q.type=m?4:0,q.len=512*a.num_secs,q.bitlen=0,q.offs=512*d*a.num_secs,q.revolutions=1}else for(a.filetype=262144==b?8:9,a.num_tracks=1760/(a.num_secs=11),d=0;d<a.num_tracks;d++)q=a.trackdata[d],q.type=0,q.len=512*
a.num_secs,q.bitlen=0,q.offs=512*d*a.num_secs-(8==a.filetype?512:263168),q.track=d,q.revolutions=1;else{a.num_secs=9;a.ddhd=1;for(m=2;0<m;m--)if(b==368640*m||b==373248*m||b==377856*m){a.num_secs=9;a.ddhd=1;break}else if(b==737280*m||b==746496*m||b==755712*m){a.num_secs=18;a.ddhd=2;break}else if(b==409600*m||b==414720*m||b==419840*m){a.num_secs=10;a.ddhd=1;break}else if(b==819200*m||b==829440*m||b==839680*m){a.num_secs=20;a.ddhd=2;break}else if(b==860160*m||b==870912*m||b==881664*m){a.num_secs=21;
a.ddhd=2;break}else if(b==184320*m){a.num_secs=9;a.ddhd=1;break}else if(b==163840*m){a.num_secs=8;a.ddhd=1;break}else if(b==614400*m){a.num_secs=15;a.ddhd=1;break}a.num_tracks=Math.floor(b/(512*a.num_secs));a.filetype=7;q=a.trackdata[0];for(d=0;d<a.num_tracks;d++)q.type=3,q.len=512*a.num_secs,q.bitlen=0,q.offs=512*d*a.num_secs,1==m&&(q++,q.type=5,q.len=512*a.num_secs),q.revolutions=1,q++;a.num_heads=m;1==m&&(a.num_tracks*=2)}G(a);Lb(a,!0);a.mfmpos=((Math.decimalRandom()&65535)<<16|Math.decimalRandom()&
65535)>>>0;a.mfmpos%=a.tracklen;a.prevtracklen=0;h||kb(a.num,!1);return 1}function b(a){bb(a);a.dskeject=!1;a.dskchange=!0;a.ddhd=1;a.dskchange_time=0;a.dskready=0;a.dskready_up_time=0;a.dskready_down_time=0;a.crc32=0;G(a)}function q(a){return SAEV_config.floppy.readOnly||a.wrprot||a.forcedwrprot||null===a.diskfile}function Z(a){for(a=(Math.decimalRandom()>>>4&7)+1;0<a--;)lb<<=1,lb|=Math.decimalRandom()&4096?1:0,lb&=65535,Nb++,Nb&=15}function ea(a){return null===a.diskfile&&0<=a.dskchange_time}function Ua(a,
b){a.motoroff&&!b&&(a.dskready_up_time=5616+(Math.decimalRandom()&511),Z(a));!a.motoroff&&b&&(a.drive_id_scnt=0,a.dskready_down_time=7488+(Math.decimalRandom()&511),SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010&&SAEV_config.cpu.speed==SAEC_Config_CPU_Speed_Original&&(a.motordelay=1,SAER.events.event2_newevent_xx(-1,30*SAEC_Events_CYCLE_UNIT,a.num,function(a){eb[a].motordelay=0})));a.motoroff=b;a.motoroff?(a.dskready=0,a.dskready_up_time=0):a.dskready_down_time=0}function r(a,b,d,f,h,m,q){0!=
q&&(0==d.track&&(8==b?(SAEF_memset(h,m,0,512<q?512:q),0==f&&(h.set(SAEF_String2Array("KICK"),m),q-=512)):9==b&&(SAEF_memset(h,m,0,512<q?512:q),0==f?(h.set(SAEF_String2Array("KICKSUP0"),m),q-=1024):512==f&&(q-=512))),b=d.offs+f,0<=b&&0<q&&(SAEF_ZFile_fseek(a,b,SEEK_SET),SAEF_ZFile_fread(h,m,1,q,a)))}function R(a,b,d){for(var f=0;d--;){var h=a[b]&21845,f=~((f<<16|h)>>>0)&1431655765,f=(f<<1&f>>>1)>>>0&65535;a[b++]=h|f;f=h}}function Fa(a,b,d,f){var h,m=0;for(h=0;h<f;h++){var q=d,r=a[m++],r=Db[r>>4]<<
8|Db[r&15];b[q]=r|(r&320?0:128);b[d]|=b[d-1]&1||b[d]&16384?0:32768;d++}return d}function Lb(b,d){var h=2*b.cyl+W,q=b.trackdata[h];if(null===b.diskfile||h>=b.num_tracks)y(b);else if(d||b.buffered_cyl!=b.cyl||b.buffered_side!=W){b.indexoffset=0;b.multi_revolution=0;b.tracktiming[0]=0;b.skipoffset=-1;b.revolutions=1;var t=b.lastdataacesstrack==2*b.cyl+W;cb||t||(b.track_access_done=!1);if(b.writediskfile&&0<b.writetrackdata[h].bitlen){var z=b.writetrackdata[h];b.tracklen=z.bitlen;b.revolutions=z.revolutions;
h=z.bitlen+7>>>3;t=new Uint8Array(h);r(b.writediskfile,b.filetype,z,0,t,0,h);h=b.tracklen+15>>4;for(z=q=0;q<h;q++,z+=2)b.bigmfmbuf[q]=t[z]<<8|t[z+1]}else if(5==b.filetype){var q=b.bigmfmbuf,t=b.tracktiming,z=b.num,F=Ec[z],E=new Uint8Array(4),H=new ArrayBuffer(12),G=new Uint8Array(H),I=new Uint32Array(H),J=new Uint32Array(5),K;eb[z].multi_revolution=1;eb[z].skipoffset=-1;F.dat16=null;F.dat8=null;F.dat=null;F.datsz=0;SAEF_ZFile_fseek(F.zf,16+4*h,SEEK_SET);SAEF_ZFile_fread(G,0,H.byteLength,1,F.zf);K=
SAEF_le32toh(I[0]);SAEF_ZFile_fseek(F.zf,K,SEEK_SET);SAEF_ZFile_fread(E,0,E.length,1,F.zf);if(0!=SAEF_CompareArray(E,SAEF_String2Array("TRK"),3))SAEF_warn("disk.scp_loadtrack() track header not found");else if(E[3]!=h)SAEF_warn("disk.scp_loadtrack() track error (%d != %d)",E[3],h);else{for(E=0;E<F.revs;E++)SAEF_ZFile_fread(G,0,H.byteLength,1,F.zf),J[E]=K+SAEF_le32toh(I[2]),F.index_off[E]=SAEF_le32toh(I[1]),F.datsz+=F.index_off[E];F.dat=new ArrayBuffer(2*F.datsz);F.dat8=new Uint8Array(F.dat);F.dat16=
new Uint16Array(F.dat);for(E=F.datsz=0;E<F.revs;E++)SAEF_ZFile_fseek(F.zf,J[E],SEEK_SET),SAEF_ZFile_fread(F.dat8,2*F.datsz,2*F.index_off[E],1,F.zf),F.datsz+=F.index_off[E],F.index_off[E]=F.datsz;F.track=h;F.pll_mode=2;F.dat_idx=0;F.index_pos=F.index_off[0];F.clock=F.clock_centre=2E3;F.nr_index=0;F.flux=0;F.clocked_zeros=0;m(q,z,t)}}else if(3==q.type){q=2*b.cyl+W;h=new Uint8Array(1E3);t=b.trackdata[q];z=b.bigmfmbuf;H=F=0;z[F++]=37460;SAEF_memset(h,0,78,40);SAEF_memset(h,40,0,12);h[52]=194;h[53]=194;
h[54]=194;h[55]=252;SAEF_memset(h,56,78,40);H=Fa(h,z,F,96);z[F+52]=21028;z[F+53]=21028;z[F+54]=21028;for(q=0;q<b.num_secs;q++)F=H,SAEF_memset(h,0,0,12),h[12]=161,h[13]=161,h[14]=161,h[15]=254,h[16]=b.cyl,h[17]=W,h[18]=1+q,h[19]=2,H=SAEF_crc16(h,12,8),h[20]=H>>8,h[21]=H&255,SAEF_memset(h,22,78,22),SAEF_memset(h,44,0,12),h[56]=161,h[57]=161,h[58]=161,h[59]=251,r(b.diskfile,b.filetype,t,512*q,h,60,512),H=SAEF_crc16(h,56,516),h[572]=H>>8,h[573]=H&255,H=Math.floor(6154/b.num_secs)-574/b.ddhd,0<H&&SAEF_memset(h,
574,78,H),H=Fa(h,z,F,574+76/b.ddhd),z[F+12]=17545,z[F+13]=17545,z[F+14]=17545,z[F+56]=17545,z[F+57]=17545,z[F+58]=17545;for(;6250>H;)b.bigmfmbuf[H++]=37460;b.skipoffset=0;b.tracklen=16*H}else if(0==q.type)for(h=2*b.cyl+W,q=f(),t=544*b.num_secs+f(),z=b.trackdata[h],SAEF_memset(b.bigmfmbuf,0,43690,t),b.skipoffset=2*Math.floor(8*f()/3),b.tracklen=16*t,F=E=0;F<b.num_secs;F++){H=new Uint8Array(544);G=new Uint16Array(545);J=I=0;H[0]=H[1]=0;H[2]=H[3]=161;H[4]=255;H[5]=h;H[6]=F;H[7]=b.num_secs-F;for(K=8;24>
K;K++)H[K]=0;r(b.diskfile,b.filetype,z,512*F,H,32,512);G[0]=E?10922:43690;G[1]=43690;G[2]=G[3]=17545;var E=(H[4]<<24|H[5]<<16|H[6]<<8|H[7])>>>0,L=E>>>1,E=E&1431655765,L=L&1431655765;G[4]=L>>>16;G[5]=L&65535;G[6]=E>>>16;G[7]=E&65535;for(K=8;48>K;K++)G[K]=43690;for(K=0;512>K;K+=4)E=(H[K+32]<<24|H[K+33]<<16|H[K+34]<<8|H[K+35])>>>0,L=E>>>1,E&=1431655765,L&=1431655765,G[(K>>1)+32]=L>>>16,G[(K>>1)+33]=L&65535,G[(K>>1)+288]=E>>>16,G[(K>>1)+289]=E&65535;for(K=4;24>K;K+=2)I=(I^(G[K]<<16|G[K+1])>>>0)>>>0;E=
L=I;L>>>=1;G[24]=L>>>16;G[25]=L&65535;G[26]=E>>>16;G[27]=E&65535;for(K=32;544>K;K+=2)J=(J^(G[K]<<16|G[K+1])>>>0)>>>0;E=L=J;L>>>=1;G[28]=L>>>16;G[29]=L&65535;G[30]=E>>>16;G[31]=E&65535;G[544]=0;R(G,4,541);for(K=0;544>K;K++)b.bigmfmbuf[q%t]=G[K],q++;E=G[K-1]&1;b.bigmfmbuf[q%t]=G[K]}else if(4==q.type)for(h=2*b.cyl+W,q=f(),t=520*b.num_secs+f(),z=b.trackdata[h],SAEF_memset(b.bigmfmbuf,0,43690,t),b.skipoffset=2*Math.floor(8*f()/3),b.tracklen=16*t,F=0;F<b.num_secs;F++){H=new Uint8Array(520);G=new Uint16Array(520);
H[0]=h;H[1]=F;H[2]=0;H[3]=0;r(b.diskfile,b.filetype,z,512*F,H,4,512);G[0]=43690;G[1]=17545;G[2]=17545;G[3]=10922;for(I=0;512>I;I+=4)J=(H[I+4]<<24|H[I+5]<<16|H[I+6]<<8|H[I+7])>>>0,K=J>>>1,J&=1431655765,K&=1431655765,G[I+8+0]=K>>>16,G[I+8+1]=K&65535,G[I+8+2]=J>>>16,G[I+8+3]=J&65535;R(G,8,512);I=8;for(J=G[I++]&32767;520>I;)J^=G[I++];H[2]=J>>8;H[3]=J;J=(H[0]<<24|H[1]<<16|H[2]<<8|H[3])>>>0;K=J>>>1;J&=1431655765;K&=1431655765;G[4]=K>>>16;G[5]=K&65535;G[6]=J>>>16;G[7]=J&65535;R(G,4,4);for(I=0;520>I;I++)b.bigmfmbuf[q%
t]=G[I],q++}else if(5!=q.type)for(z=b.writetrackdata[h],F=1==q.type?0:1,b.tracklen=q.bitlen+16*F,b.bigmfmbuf[0]=q.sync,h=z.bitlen+7>>>3,t=new Uint8Array(h),r(b.diskfile,b.filetype,q,0,t,0,h),h=b.tracklen+15>>4,q=F,z=0;q<h;q++,z+=2)b.bigmfmbuf[q]=t[z]<<8|t[z+1];b.buffered_side=W;b.buffered_cyl=b.cyl;0==b.tracklen&&(b.tracklen=2*a()*b.ddhd*8,SAEF_memset(b.bigmfmbuf,0,0,2*a()*b.ddhd>>1));b.trackspeed=ja(b);ua(b)}}function t(a,b,d){return(a[b]<<d|a[b+1]>>16-d)&65535}function tb(a,b,d){return((t(a,b,d)<<
16|t(a,b+1,d))&1431655765)>>>0}function Da(b,d,f,h,m,q,r,y){var z=0,E=0,z=a()*h,G=h=0,K=0,I=0,J=0,L=new Uint8Array(544),N=I=0,ja=2*z-540,pa=new Uint32Array(4),R=0,T=!1;SAEF_memset(r,0,0,22);for(SAEF_memcpy(b,z,b,0,z);E<f;){for(;17545!=t(b,N,R);){if(N>=ja)return SAEF_log("disk.decode_buffer() sync not found (1)"),1;R++;16==R&&(R=0,N++)}for(;17545==t(b,N,R);){if(N>=ja)return SAEF_log("disk.decode_buffer() sync not found (2)"),1;N++}h=tb(b,N,R);var G=tb(b,N+2,R),N=N+4,I=(h<<1|G)>>>0,U=(I&65280)>>8;if(U+
1>f){if(SAEF_log("disk.decode_buffer() weird sector number %d (id $%08x, offset %d)",U,I,N),2==m)return 2}else{T=!1;K=(h^G)>>>0;for(z=0;4>z;z++)h=tb(b,N,R),G=tb(b,N+8,R),N+=2,(J=(h<<1|G)>>>0)&&!y&&(T=!0),pa[z]=J,K=(K^(h^G)>>>0)>>>0;if(T&&(SAEF_log("disk.decode_buffer() sector %d header: %08X %08X %08X %08X",U,pa[0],pa[1],pa[2],pa[3]),2==m))return 6;N+=8;h=tb(b,N,R);G=tb(b,N+2,R);N+=4;if((h<<1|G)>>>0!=K){if(SAEF_log("disk.decode_buffer() sector %d, header checksum error (%08X != %08X) ",U,(h<<1|G)>>>
0,K),2==m)return 3}else if((I&16711680)>>>16!=2*d+W){if(SAEF_log("disk.decode_buffer() mismatched track (%d <> %d) on sector %d header (%08X)",(I&16711680)>>>16,2*d+W,U,I),2==m)return 3}else{h=tb(b,N,R);G=tb(b,N+2,R);N+=4;K=(h<<1|G)>>>0;I=32;for(z=0;128>z;z++)h=tb(b,N,R),G=tb(b,N+256,R),N+=2,J=(h<<1|G)>>>0,L[I++]=J>>>24,L[I++]=J>>>16&255,L[I++]=J>>>8&255,L[I++]=J&255,K=(K^(h^G)>>>0)>>>0;if(K){if(SAEF_log("disk.decode_buffer() sector %d, data checksum error",U),2==m)return 4}else N+=256,r[U]=1,E++,
Ia.set(L.subarray(32,544),512*U)}}}if(2==m&&(0==E||0>E))return 5;0==E?SAEF_log("disk.decode_buffer() unsupported format"):0>E&&SAEF_log("disk.decode_buffer() sector labels ignored");q.value=f;return 0}function sb(a,b,d,f){var h=new Uint8Array(12);b.revolutions=1;b.bitlen=d;b.type=f;h[0]=0;h[1]=0;h[2]=0;h[3]=b.type;h[4]=b.len>>>24;h[5]=b.len>>>16&255;h[6]=b.len>>>8&255;h[7]=b.len&255;h[8]=b.bitlen>>>24;h[9]=b.bitlen>>>16&255;h[10]=b.bitlen>>>8&255;h[11]=b.bitlen&255;SAEF_ZFile_fseek(a,12+12*b.track,
SEEK_SET);SAEF_ZFile_fwrite(h,0,h.length,1,a);b.len>Math.floor((d+7)/8)&&(d=new Uint8Array(b.len),SAEF_memset(d,0,0,b.len),SAEF_ZFile_fseek(a,b.offs,SEEK_SET),SAEF_ZFile_fwrite(d,0,1,b.len,a))}function Sa(a){var b={value:0},d=new Uint8Array(22);if(Da(a.bigmfmbuf,a.cyl,a.num_secs,a.ddhd,a.filetype,b,d,!1)||!b.value)return 2;2==a.filetype&&sb(a.diskfile,a.trackdata[2*a.cyl+W],4096*b.value,0);for(d=0;d<b.value;d++)SAEF_ZFile_fseek(a.diskfile,a.trackdata[2*a.cyl+W].offs+512*d,SEEK_SET),SAEF_ZFile_fwrite(Ia,
512*d,1,512,a.diskfile);return 0}function ta(a,b,d,f){var h=Math.floor((f+7)/8);h>d.len&&(SAEF_warn("disk.drive_write_ext2() image file's track %d is too small (%d < %d)",d.track,d.len,h),h=d.len);sb(b,d,f,1);for(f=0;f<d.len>>1;f++)Qd[f]=a[f];SAEF_ZFile_fseek(b,d.offs,SEEK_SET);SAEF_ZFile_fwrite(Qd,0,1,h,b);return 1}function ka(a,b,d){a=t(a,b,d);b=0;a&=21845;for(d=0;8>d;d++)b>>=1,a&1&&(b|=128),a>>=2;return b}function qa(b){var d=-1,f=2*b.cyl+W;if(q(b)||5==b.trackdata[f].type)b.buffered_side=2;else{b.writediskfile&&
ta(b.bigmfmbuf,b.writediskfile,b.writetrackdata[f],ma?8*Hb:b.tracklen);switch(b.filetype){case 0:Sa(b)&&(SAEV_config.floppy.autoEXT2?hc(b,SAEV_config.floppy.autoEXT2):Rc||(Rc=!0,alert("Disk in DF"+b.num+" does use a non-standard floppy disk format.\nYou may need to use a custom floppy disk image file instead of a standard one\nor enable 'Auto convert to EXT2' in the floppy-page.\n\nThis message will not appear again.")));return;case 2:ma||(d=Sa(b));d&&(SAEF_warn("disk.drive_write_data() not an amigados track %d (error %d), writing as raw track",
2*b.cyl+W,d),ta(b.bigmfmbuf,b.diskfile,b.trackdata[2*b.cyl+W],ma?8*Hb:b.tracklen));return;case 7:a:{var d=b.diskfile,f=b.num_secs,h=a()*b.ddhd,m=b.bigmfmbuf,r=0,y=2*h-518,z=0,E=0,G=0,K=-1,I=new Uint8Array(24),J=new Uint8Array(516),L=0,N=0,L=0;SAEF_memset(I,0,0,24);SAEF_memcpy(m,h,m,0,h);J[0]=J[1]=J[2]=161;for(J[3]=251;E<f;){for(N=0;17545!=t(m,r,G);){N++;if(r>=y){d=-1;break a}G++;16==G&&(G=0,r++);0<=K&&43<=N/16&&(K=-1)}for(N=0;17545==t(m,r,G);){N++;if(r>=y){d=-1;break a}r++}if(!(3>N))if(L=ka(m,r++,
G),254==L){var h=new Uint8Array(8),ja,R,pa;ja=ka(m,r++,G);R=ka(m,r++,G);K=ka(m,r++,G);pa=ka(m,r++,G);N=ka(m,r++,G)<<8|ka(m,r++,G);h[0]=h[1]=h[2]=161;h[3]=L;h[4]=ja;h[5]=R;h[6]=K;h[7]=pa;for(L=0;28>L;L++)ka(m,r++,G);if(SAEF_crc16(h,0,8)!=N||ja!=b.cyl||R!=W||2!=pa||1>K||K>b.num_secs||K>=I.length){SAEF_warn("disk.drive_write_pcdos() track %d, corrupted sector header",2*b.cyl+W);d=-1;break a}K--}else if(251!=L&&250!=L)SAEF_warn("disk.drive_write_pcdos() track %d: unknown address mark %02X",2*b.cyl+W,
L);else if(!(0>K)){for(L=0;512>L;L++)J[L+4]=ka(m,r++,G);N=ka(m,r++,G)<<8|ka(m,r++,G);SAEF_crc16(J,0,516)!=N?SAEF_warn("disk.drive_write_pcdos() track %d, sector %d data checksum error",2*b.cyl+W,K+1):(E++,I[K]||(z++,I[K]=1,SAEF_ZFile_fseek(d,b.trackdata[2*b.cyl+W].offs+512*K,SEEK_SET),SAEF_ZFile_fwrite(J,4,1,512,d)),K=-1)}}z!=b.num_secs&&SAEF_warn("disk.drive_write_pcdos() track %d, %d corrupted sectors ignored",2*b.cyl+W,b.num_secs-z);d=z}0>d&&SAEF_log("disk.drive_write_data() not a PC formatted track %d (error %d)",
2*b.cyl+W,d)}b.tracktiming[0]=0}}function nb(a,b){if(!(0<a.dskchange_time)){for(var d=0;4>d;d++)eb[d].num!=a.num&&0<eb[d].dskchange_time&&eb[d].dskchange_time+1>=b&&(b=eb[d].dskchange_time+1);a.dskchange_time=b}}function $a(a,b,d){var f=eb[a];d?wa(f,SAEV_config,a,b,!1):(f.dskeject=!1,f.newfile=b.clone(),0==b.size?SAER.disk.eject(a):!ea(f)||0<f.dskchange_time?f.dskeject=!0:nb(f,312))}function Ga(a){z=SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V?a>>3&3:a>>3&15;W=1-(a>>2&1);
Aa=a>>1&1}function fa(a){var b=2*a.cyl+W;return b>=a.num_tracks||2==a.filetype&&0==a.trackdata[b].bitlen&&0!=a.trackdata[b].type||5==a.trackdata[b].type?!0:!1}function U(){SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKBLK);la=va=cb=ma=0}function na(a){if(!a.revolution_check&&(a.trackspeed=ja(a),a.revolution_check=2,a.multi_revolution))switch(a.filetype){case 5:m(a.bigmfmbuf,a.num,a.tracktiming)}}function Xb(){lc||(lc=2,SAER.cia.diskindex())}function wb(){Ab=0<SAEV_config.floppy.randomBitsMax?
(Math.decimalRandom()>>>4)%(SAEV_config.floppy.randomBitsMax-SAEV_config.floppy.randomBitsMin+1)+SAEV_config.floppy.randomBitsMin:0}function L(a,b){if(3>cb){var d=a.tracktiming[b>>3],f=Math.floor(ja(a)*d/1E3);700>f||3E3<f?50>++Xc&&SAEF_warn("disk.updatetrackspeed() corrupted trackspeed value %d %d (%d/%d)",d,f,b,a.tracklen):a.trackspeed=f}}function mb(){if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_DSKEN)&&15==Nb&&cc&&2==cb&&0<=va){if(0<va){if(1==va&&1==Hb)return U(),0;if(100<SAEV_config.floppy.speed&&yb[0]&&
yb[1]&&yb[2])for(;yb[0];){var a=SAER.disk.DSKDATR();SAER_Memory_chipPut16_indirect(Bb,a);Bb+=2}if(0<SAER.disk.fifostatus())return SAEF_warn("disk.doreaddma() fifo overflow detected, retrying..."),-1;SAER.disk.DSKDAT(lb);va--}return 1}return 0}function pb(a){xa=SAEV_Events_currcycle+11*SAEC_Events_CYCLE_UNIT;0!=cb&&(a||(cc=1),SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN));SAEV_Custom_adkcon&1024&&(Nb=15)}function zb(){for(var b=0;3>b;b++)yb[b]=!1;for(b=Ic=0;4>b;b++){var d=eb[b];
if(!((z|Ca)&1<<b)){var f=d.trackdata[2*d.cyl+W];3==cb&&(lb=0,d.tracklen=ma?14336:a()*d.ddhd*16,d.trackspeed=pa(),d.skipoffset=-1,ua(d));2==f.type&&(lb=Nb=d.mfmpos=0)}d.floppybitcounter=0}cc=SAEV_Custom_adkcon&1024?0:1;lb==ca&&pb(!0)}function Pa(a,b,d,f){for(var h=0,m=0;512>m;m+=4)h+=(a[b+m]<<24|a[b+m+1]<<16|a[b+m+2]<<8|a[b+m+3])>>>0,4294967295<h&&(h-=4294967296);h=-h;0>h&&(h+=4294967296);null!==d&&(d[f]=h>>>24,d[f+1]=h>>>16&255,d[f+2]=h>>>8&255,d[f+3]=h&255);return h}function db(a,b){var d={};SAEF_gettimeofday(d,
null);var f={days:0,mins:0,ticks:0};SAEF_timeval_to_amiga(d,f,50);f.days==qd&&f.mins==tc&&f.ticks==ed&&(f.ticks++,3E3<=f.ticks&&(f.ticks=0,f.mins++,1440<=f.mins&&f.days++));qd=f.days;tc=f.mins;ed=f.ticks;a[b+0]=f.days>>>24;a[b+1]=f.days>>>16&255;a[b+2]=f.days>>>8&255;a[b+3]=f.days&255;a[b+4]=f.mins>>>24;a[b+5]=f.mins>>>16&255;a[b+6]=f.mins>>>8&255;a[b+7]=f.mins&255;a[b+8]=f.ticks>>>24;a[b+9]=f.ticks>>>16&255;a[b+10]=f.ticks>>>8&255;a[b+11]=f.ticks&255}function Za(a,b,d){SAEF_ZFile_fseek(a,d,SEEK_SET);
SAEF_ZFile_fwrite(b,0,512,1,a)}function xb(a){a=a.toUpperCase();for(var b=a.length,d=0;d<a.length;d++)b*=13,b+=a.charCodeAt(d),b&=2047;return b%72}function za(a,b){for(var d=b.block;255!=a[d];){if(0==a[d])return a[d]=1,b.block=d;d++}for(d=0;255!=a[d];){if(0==a[d])return a[d]=1,b.block=d;d++}return-1}function Ea(a,b,d){a[b+0]=d>>>24;a[b+1]=d>>>16&255;a[b+2]=d>>>8&255;a[b+3]=d&255}function Qb(a,b,d,f,h,m,q){var r=new Uint8Array(512),t=new Uint8Array(512),y=za(m,q),z=za(m,q),E=1;SAEF_ZFile_fseek(h,0,
SEEK_END);var G=SAEF_ZFile_ftell(h);SAEF_ZFile_fseek(h,0,SEEK_SET);var K=Math.floor((G+488-1)/488);SAEF_memset(b,0,0,512);Ea(b,0,2);Ea(b,4,y);Ea(b,8,72<K?72:K);Ea(b,16,z);Ea(b,324,G);db(b,420);b[432]=f.length;b.set(SAEF_String2Array(f),433);Ea(b,500,d);Ea(b,508,4294967293);for(f=d=0;0<G;)K=z,z=f,72==d&&(d=0,f=za(m,q),73<E?(Ea(t,8,72),Ea(t,504,f),Ea(t,4,z),Pa(t,0,t,20),Za(a,t,512*z)):Ea(b,504,f),SAEF_memset(t,0,0,512),Ea(t,0,16),Ea(t,500,y),Ea(t,508,4294967293)),SAEF_memset(r,0,0,512),Ea(r,0,8),Ea(r,
4,y),Ea(r,8,E++),Ea(r,12,488<G?488:G),SAEF_ZFile_fread(r,24,488<G?488:G,1,h),G-=488,z=0,0<G&&(z=za(m,q)),Ea(r,16,z),Pa(r,0,r,20),Za(a,r,512*K),73>=E?Ea(b,308-4*d,K):Ea(t,308-4*d,K),d++;72<E&&(Ea(t,8,d),Pa(t,0,t,20),Za(a,t,512*f));Pa(b,0,b,20);Za(a,b,512*y);return y}function Ub(a,b,d){d?a.set(b?yf:ef):(a[0]=68,a[1]=79,a[2]=83,a[3]=b?1:0)}function sc(a,b,d,f){d=0<d.length?d:"empty";a[3]=2;a[15]=72;a[312]=a[313]=a[314]=a[315]=255;a[318]=b+1>>8&255;a[319]=b+1&255;a[432]=d.length;a.set(SAEF_String2Array(d),
433);a[511]=1;db(a,420);SAEF_memcpy(a,472,a,420,12);SAEF_memcpy(a,484,a,420,12);Pa(a,0,a,20);SAEF_memset(a,516,255,2*b>>3);f==SAEC_Disk_Create_Type_35_DD?a[626]=63:a[732]=63;Pa(a,512,a,512)}function Dc(b,d,f,h,m,q,r){var t=null,y=1,z,E,G=!1,K=2*(d==SAEC_Disk_Create_Mode_Custom?83:80),I=901120,J=11;if(f==SAEC_Disk_Create_Type_35_DD_PC||f==SAEC_Disk_Create_Type_35_HD_PC)I=737280,J=9;E=2*a();f==SAEC_Disk_Create_Type_35_HD||f==SAEC_Disk_Create_Type_35_HD_PC?(I<<=1,E<<=1,y=2):f==SAEC_Disk_Create_Type_525_SD&&
(I>>=1,K>>=1);null!==r&&(z=SAEF_ZFile_ftell(r),SAEF_ZFile_fseek(r,0,SEEK_SET));b=SAEF_ZFile_fopen_empty(null,b,I);t=new Uint8Array(32768);if(null!==b){G=1024*J;SAEF_memset(t,0,0,32768);if(d==SAEC_Disk_Create_Mode_Normal)for(E=0;E<I;E+=G)SAEF_memset(t,0,0,G),f<=SAEC_Disk_Create_Type_35_HD&&(0==E?Ub(t,m,q):E==I>>1&&sc(t,I/1024,h,f)),SAEF_ZFile_fwrite(t,0,G,1,b);else{J=new Uint8Array(4);I=new Uint8Array(12);d=new Uint8Array(12);G=E;SAEF_ZFile_fwrite(SAEF_String2Array("UAE-1ADF"),0,8,1,b);J[0]=0;J[1]=
0;J[2]=0;J[3]=K;SAEF_ZFile_fwrite(J,0,4,1,b);I[0]=0;I[1]=0;I[2]=0;I[3]=1;I[4]=0;I[5]=0;I[6]=G>>8;I[7]=G&255;I[8]=0;I[9]=0;I[10]=0;I[11]=0;d.set(I);d[3]=0;d[9]=8*G>>16&255;d[10]=8*G>>8&255;d[11]=8*G&255;J=m||q||0<h.length;for(E=0;E<K;E++){var L=new Uint8Array(12);J||null!==r?L.set(d):L.set(I);SAEF_ZFile_fwrite(L,0,L.length,1,b)}for(E=0;E<K;E++)SAEF_memset(t,0,0,32768),null!==r?SAEF_ZFile_fread(t,0,11*y,512,r):J&&(0==E?Ub(t,m,q):80==E&&sc(t,880*y,h,f)),SAEF_ZFile_fwrite(t,0,G,1,b)}G=!0}null!==r&&SAEF_ZFile_fseek(r,
z,SEEK_SET);return G?b:null}function hc(a,b){if(0!=a.filetype)return!1;var d=SAEV_config.floppy.drive[a.num].file,f=2==a.ddhd,h=d.name;if(0==h.length)return!1;var m=null;if(1==b){if(m=Dc(h,SAEC_Disk_Create_Mode_Custom,f?SAEC_Disk_Create_Type_35_HD:SAEC_Disk_Create_Type_35_DD,"",!1,!1,a.diskfile),null===m)return!1}else if(2==b){var q=SAEF_ZFile_fopen_load_zfile(a.diskfile);if(null===q)return!1;SAEF_ZFile_fclose(a.diskfile);a.diskfile=null;m=Dc(h,SAEC_Disk_Create_Mode_Custom,f?SAEC_Disk_Create_Type_35_HD:
SAEC_Disk_Create_Type_35_DD,"",!1,!1,q);if(null===m)return SAEF_ZFile_fclose(q),!1}else return!1;SAEF_ZFile_fclose(a.diskfile);a.diskfile=m;a.filetype=2;Oa(a,a.ddhd);qa(a);Lb(a,!0);SAEF_log("disk.convert_adf_to_ext2() converted '%s' to ADF-EXT2",d.name);return!0}for(var Sb=140*SAEC_Events_CYCLE_UNIT,W=0,Aa=0,z=15,Ca=0,Ba=0,Ia=new Uint8Array(11968),ma=0,cb=0,va=0,Hb=0,la=0,Ta=0,Bb=0,Ic=!1,Bc=new Uint16Array(3),yb=new Int8Array(3),cc=0,Nb=0,lb=0,ca=0,xa=0,Mb=0,Ab=0,lc=0,Vb=0,qb=0,Kc=!1,dc=!1,od=0,qd=
0,tc=0,ed=0,Rc=!1,Xc=0,Pc=["","","",""],eb=Array(4),Fc=0;4>Fc;Fc++)eb[Fc]=new J(Fc);var Qd=new Uint16Array(32768),Vd=[3,2,4,5,7,6,0,1],fd=[14,12,2,10,15,13,1,0,7,6,5,4,8,9,11,3],bd=0,ad=null,Sc=0,pd=0,jd=0,Tc=0,le=0,ke=0,df=0,Pd=!1;this.amax_bfe001_write=function(a,b){var d=b&a;d&4&&!(le&4)&&(jd=(jd<<1|1)&255);pd=-1;24!=(d&24)&&(pd=0,d&16||(pd=1));le=d;h()};for(var Ec=Array(4),Fc=0;4>Fc;Fc++)Ec[Fc]=new I(-1);var Db=[42,41,36,37,18,17,20,21,74,73,68,69,82,81,84,85];this.insert=function(a,b){$a(a,b,
!1)};this.insert_force=function(a,b){$a(a,b,!0)};this.eject=function(a){b(eb[a]);SAEV_config.floppy.drive[a].file.clr();eb[a].newfile=null;Pc[a]="";kb(a,!0)};this.vsync=function(){for(var a=0;4>a;a++){var d=eb[a];d.dskeject&&(b(d),nb(d,31200))}for(a=0;4>a;a++)SAEV_config.floppy.drive[a].type>SAEC_Config_Floppy_Type_None&&(d=SAEV_config.floppy.drive[a].file,0==eb[a].dskchange_time&&d.name!==Pc[a]&&(this.insert_force(a,d),Pc[a]=d.name))};this.select_set=function(a){Vb=a;qb=a&1;Ga(a)};this.select=function(a){var b=
SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V,d,f=z;Ga(a);var m=a&1;if(dc)for(d=0;4>d;d++){var q=eb[d];if(q.amax){var q=Vb,r=d;Tc=a;ke=1<<r+3;if(!(Tc&ke)&&q&ke){Pd=!0;for(var q=255,t=r=0;16>t;t++)bd&1<<t&&(r|=1<<fd[t]);if(0>pd)jd=q;else{q=ad[2*r+pd];for(t=val=0;8>t;t++)q&1<<Vd[t]&&(val|=1<<t);jd=val}}h()}}if(!b&&(Vb&128)!=(a&128))for(d=0;4>d;d++)1<eb[d].indexhackmode&&!((z|Ca)&1<<d)&&(eb[d].indexhack=!0);if(qb!=m&&(qb=m))for(d=0;4>d;d++)(f|Ca)&1<<d||(m=eb[d],q=Aa,ea(m)||(m.dskchange=
!1),m.steplimit&&SAEV_Events_currcycle-m.steplimitcycle<Sb?SAEF_log("disk.drive_step() ignored df%d, cycle %d",m.num,Math.floor((SAEV_Events_currcycle-m.steplimitcycle)*SAEC_Events_CYCLE_UNIT_INV)):(r=m,SAEV_config.cpu.speed==SAEC_Config_CPU_Speed_Original&&(r.steplimit=4,r.steplimitcycle=SAEV_Events_currcycle),q?m.cyl&&m.cyl--:(q=m.hard_num_cyls,m.cyl<q+3&&m.cyl++,m.cyl>=q&&SAEF_warn("disk.drive_step() program tried to step over track %d",q)),Z(m)),1<eb[d].indexhackmode&&a&128&&(eb[d].indexhack=
!0));if(b)for(d=0;2>d;d++)q=eb[d],b=32<<d,z&1<<d||Ca&1<<d||(!(Vb&b)&&a&b?Ua(q,1):Vb&b&&!(a&b)&&Ua(q,0));else for(d=0;4>d;d++)q=eb[d],!((z|Ca)&1<<d)&&f&1<<d&&(q.drive_id_scnt++,q.drive_id_scnt&=31,q.idbit=q.drive_id&1<<31-q.drive_id_scnt?1:0,Ca&1<<d||(0==(Vb&128)||0==(a&128)?Ua(q,0):Vb&128&&Ua(q,1)),SAEV_config.chipset.df0idhw||0!=d||(q.idbit=0));for(d=0;4>d;d++)eb[d].state=!(z&1<<d)|!eb[d].motoroff,kb(d,!1);Vb=a};this.status_ciaa=function(){var a=60;if(SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V){for(var b=
0;2>b;b++){var d=eb[b];(z>>3|Ca)&1<<b||(d.dskchange&&(a&=-33),0==d.cyl&&(a&=-17))}return a}for(b=0;4>b;b++)d=eb[b],d.amax?Pd&&(jd&128||(a&=-33)):(z|Ca)&1<<b?(z|Ca)&1<<b||d.idbit&&(a&=-33):(d.motoroff?(SAEV_config.chipset.df0idhw||0<b?d.idbit&&SAEV_config.floppy.drive[b].type!=SAEC_Config_Floppy_Type_35_DD_ESCOM&&(a&=-33):d.dskready&&(a&=-33),!SAEV_config.chipset.df0idhw&&0==b&&d.motordelay&&(a&=-33)):d.dskready&&!d.indexhack&&SAEV_config.floppy.drive[b].type!=SAEC_Config_Floppy_Type_35_DD_ESCOM&&
(a&=-33),0==d.cyl&&(a&=-17),q(d)&&(a&=-9),d.dskchange&&SAEV_config.floppy.drive[b].type!=SAEC_Config_Floppy_Type_525_SD&&(a&=-5));return a};this.status_ciab=function(a){if(SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V){a|=128;for(var b=0;2>b;b++){var d=eb[b];(z>>3|Ca)&1<<b||q(d)&&(a&=-129)}}return a};this.handler=function(a){var b=a&255;a>>>=8;SAER.events.current_hpos();SAER.events.event2_remevent(SAEC_Events_EV2_DISK);this.update(a);cb||(b&4&&na(eb[0]),b&8&&na(eb[1]),b&16&&
na(eb[2]),b&32&&na(eb[3]));b&2&&SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN);b&1&&Xb()};this.fifostatus=function(){return yb[0]&&yb[1]&&yb[2]?1:yb[0]||yb[1]||yb[2]?0:-1};this.DSKBYTR=function(a){this.update(a);a=Ta;Ta&=32767;lb==ca&&0<xa-SAEV_Events_currcycle&&(a|=4096);0!=cb&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_DSKEN)&&(a|=16384);la&16384&&(a|=8192);for(var b=0;4>b;b++){var d=eb[b];d.motoroff||(z|Ca)&1<<b||(d.lastdataacesstrack=2*d.cyl+W,d.track_access_done=!0)}return a};this.hsync=
function(){for(var a=0;4>a;a++){var b=eb[a];b.steplimit&&b.steplimit--;b.revolution_check&&b.revolution_check--;0<b.dskready_down_time&&b.dskready_down_time--;0<b.dskready_up_time&&!ea(b)&&(b.dskready_up_time--,0!=b.dskready_up_time||b.motoroff||(b.dskready=!0));0<b.dskchange_time&&(b.dskchange_time--,0==b.dskchange_time&&(wa(b,SAEV_config,a,b.newfile,!1),kb(a,!1)))}lc&&lc--;od?(od--,od||U()):(this.update(SAER.playfield.get_maxhpos()),Kc&&(Kc=!1))};this.update=function(a){var b;if(0>Mb)Mb=-Mb;else if(b=
(a<<8)-Mb,!(0>=b)){Mb+=b;Mb>=SAER.playfield.get_maxhpos()<<8&&(Mb%=256);for(a=0;4>a;a++){var d=eb[a];!d.motoroff&&d.tracklen&&d.trackspeed&&(d.floppybitcounter+=b,(z|Ca)&1<<a?(d.mfmpos+=Math.floor(d.floppybitcounter/d.trackspeed),d.mfmpos%=d.tracklen,d.floppybitcounter%=d.trackspeed):(d.diskfile&&Lb(d,!1),d.mfmpos%=d.tracklen))}var f=!1;for(a=0;4>a;a++)if(d=eb[a],!d.motoroff&&d.trackspeed&&!((z|Ca)&1<<a)){if(3==cb&&cc){for(var f=d,h=d.floppybitcounter,m=void 0,q=[0,0,0,0],m=0;4>m;m++){var r=eb[m];
q[m]=0;r.motoroff||(z|Ca)&1<<m||(q[m]=1)}for(;h>=f.trackspeed;){for(m=0;4>m;m++)q[m]&&(eb[m].mfmpos++,eb[m].mfmpos%=f.tracklen);if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_DSKEN)&&3==cb&&0<va&&Ic&&(Nb++,Nb&=15,!Nb)){if(100<SAEV_config.floppy.speed&&!yb[0]&&!yb[1]&&!yb[2])for(;!yb[2];){var t=SAER_Memory_chipGet16_indirect(Bb);SAER.disk.DSKDAT(t);Bb+=2}if(0<=SAER.disk.fifostatus()){t=SAER.disk.DSKDATR();for(m=0;4>m;m++)r=eb[m],q[m]&&(r.bigmfmbuf[r.mfmpos>>4]=t,r.bigmfmbuf[(r.mfmpos>>4)+1]=21845,r.writtento=
1),dc&&N(t);va--;if(0>=va)for(U(),m=0;4>m;m++)f=eb[m],f.writtento=0,f.motoroff||(z|Ca)&1<<m||qa(f)}}h-=f.trackspeed}}else a:for(f=d,h=d.floppybitcounter;h>=f.trackspeed;){f.tracktiming[0]&&L(f,f.mfmpos);lb<<=1;lb&=65535;ea(f)||(fa(f)?m=lb|(Math.decimalRandom()&4096?1:0):(m=f.mfmpos,m=lb|(f.bigmfmbuf[m>>4]&1<<15-(m&15)?1:0)),lb=m);if(0>mb()){lb>>=1;break a}f.mfmpos++;f.mfmpos%=f.tracklen;f.mfmpos==f.indexoffset&&(f.indexhack=!1,Xb());0==f.mfmpos&&(na(f),f.tracktiming[0]&&L(f,f.mfmpos));if(f.mfmpos==
f.skipoffset)for(wb(),m=Ab;0<m--;)f.mfmpos++,f.mfmpos%=f.tracklen,f.mfmpos==f.indexoffset&&(f.indexhack=!1,Xb()),0==f.mfmpos&&(na(f),f.tracktiming[0]&&L(f,f.mfmpos));7==(Nb&7)&&(Ta=lb&255,Ta|=32768);lb==ca&&pb(!1);Nb++;Nb&=15;h-=f.trackspeed}d.floppybitcounter%=d.trackspeed;f=!0}if(!f&&2==cb)for(a=b;a>=pa();)lb<<=1,lb&=65535,mb(),7==(Nb&7)&&(Ta=lb&255,Ta|=32768),Nb++,Nb&=15,a-=pa();0!=cb&&cc&&0==Hb&&0==va&&U();a=Mb;b=SAER.playfield.get_maxhpos()<<8;for(f=d=0;4>f;f++)if(h=eb[f],!h.motoroff&&h.trackspeed&&
!((z|Ca)&1<<f)){m=h.mfmpos;h.tracktiming[0]&&L(h,m);q=0;r=lb;for(t=a;t<SAER.playfield.get_maxhpos()<<8;){h.tracktiming[0]&&L(h,m);t+=h.trackspeed;if(3!=cb||3==cb&&!cc)r=r<<1>>>0,ea(h)||(r=fa(h)?(r|(Math.decimalRandom()&4096?1:0))>>>0:(r|(h.bigmfmbuf[m>>4]&1<<15-(m&15)?1:0))>>>0),2!=cb&&(r&65535)==ca&&0!=ca&&(q|=2);m++;m%=h.tracklen;cb||(0==m&&(q|=4<<h.num),m==h.indexoffset&&(q|=1));if(3!=cb&&m==h.skipoffset){wb();for(var y=Ab;0<y--;)m++,m%=h.tracklen,cb||(0==m&&(q|=4<<h.num),m==h.indexoffset&&(q|=
1))}if(q)break}h.tracktiming[0]&&L(h,h.mfmpos);q&&t<b&&(b=t,d=q)}d&&b>>8<SAER.playfield.get_maxhpos()&&SAER.events.event2_newevent(SAEC_Events_EV2_DISK,b-a>>8,b>>8<<8|d)}};this.update_adkcon=function(a,b){var d=SAEV_Custom_adkcon,f=SAEV_Custom_adkcon;(b&32768?f|b&32767:f&~b)&1024&&!(d&1024)&&(Nb=0)};this.DSKLEN=function(a,b){var d,f=la,h=0,m;this.update(b);la=a;Hb=va=la&16383;if(a&32768&&f&32768){if(2==cb){SAEF_warn("disk.DSKLEN() read DMA length rewrite %d -> %d ($%04x), PC=$%x",f&16383,a&16383,
a,SAER_CPU_getPC());return}cb=2;zb()}if(!(a&32768)&&0!=cb){if(3==cb)for(SAEF_warn("disk.DSKLEN() write DMA aborted, %d words left, PC=$%x",va,SAER_CPU_getPC()),d=0;4>d;d++)m=eb[d],m.writtento&&qa(m);cb=0}if(0!=cb)if(0==va&&cc)U();else{if(a&16384&&f&16384){if(0==va)return;if(1==va){U();return}if(3==cb){SAEF_warn("disk.DSKLEN() write DMA length rewrite %d -> %d, PC=$%x",f&16383,a&16383,SAER_CPU_getPC());return}cb=3;zb()}for(d=0;4>d;d++)f=eb[d],f.motoroff||z&1<<d||2!=cb||(f.lastdataacesstrack=2*f.cyl+
W,f.track_access_done=!0);for(d=m=0;4>d&&(f=eb[d],f.writtento=0,f.motoroff||(m|=1<<d,0!=(z&1<<d)));d++);4==d&&(dc||SAEF_log("disk.DSKLEN() %s DMA started, drvmask=$%x motormask=$%x PC=$%08x",3==cb?"write":"read",z^15,m,SAER_CPU_getPC()),h=1);for(d=0;4>d;d++)kb(d,!1);if(2==cb||3==cb){for(d=0;4>d&&(f=eb[d],z&1<<d||0==f.filetype||8==f.filetype||9==f.filetype);d++);if(!(4>d)){for(d=m=0;4>d;d++)if(f=eb[d],!(f.motoroff||!f.useturbo&&0<SAEV_config.floppy.speed||z&1<<d)){var q=f.mfmpos&-16;Lb(f,!1);if(2==
cb){if(SAEV_Custom_adkcon&1024){for(m=0;m<f.tracklen;m+=16)if(q+=16,q%=f.tracklen,f.bigmfmbuf[q>>4]==ca){q+=16;q%=f.tracklen;break}if(m>=f.tracklen)return}for(;0<va--;)SAER_Memory_chipPut16_indirect(Bb,f.bigmfmbuf[q>>4]),Bb+=2,q+=16,q%=f.tracklen;f.mfmpos=q;SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN);m=2}else if(3==cb){for(m=0;m<va;m++){var r=SAER_Memory_chipGet16_indirect(Bb+2*m);f.bigmfmbuf[q>>4]=r;dc&&N(r);q+=16;q%=f.tracklen}f.mfmpos=q;qa(f);m=2}}if(!m&&h){for(d=-1;0<va--;){if(3==
cb){if(r=SAER_Memory_chipGet16_indirect(Bb),dc&&(N(r),r))for(m=0;16>m;m++)r&1<<m&&d++}else SAER_Memory_chipPut16_indirect(Bb,0);Bb+=2}0==d?m=1:(SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN),m=2)}m&&(od=m,cb=0)}}}};this.DSKSYNC=function(a,b){b!=ca&&(this.update(a),ca=b)};this.DSKDAT=function(a){yb[2]?SAEF_warn("disk.DSKDAT() FIFO overflow!"):(yb[2]=yb[1],Bc[2]=Bc[1],yb[1]=yb[0],Bc[1]=Bc[0],yb[0]=3==cb?2:1,Bc[0]=a,Ic=1)};this.DSKDATR=function(){var a,b=0;for(a=2;0<=a;a--)if(yb[a]){yb[a]=
0;b=Bc[a];break}0>a?SAEF_warn("disk.DSKDATR() FIFO underflow!"):0<cb&&3>cb&&0>=va&&0>this.fifostatus()&&U();return b};this.DSKPTH=function(a){a&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31;Bb=(a<<16|Bb&65535)>>>0};this.DSKPTL=function(a){Bb=(Bb&4294901760|a)>>>0};this.dmal=function(){var a=0;cb&&(3==cb?(a=3*(yb[0]?1:0)+12*(yb[1]?1:0)+48*(yb[2]?1:0),a^=63,2==va&&(a&=-49),1==va&&(a&=-61)):a=16*(yb[0]?1:0)+4*(yb[1]?1:0)+1*(yb[2]?1:0));return a};this.getpt=function(){var a=Bb;Bb+=2;return a};
this.setup=function(){for(var a=3;0<=a;a--){var b=eb[a];G(b);wa(b,SAEV_config,a,SAEV_config.floppy.drive[a].file,!1)||this.eject(a)}ea(eb[0])&&SAEF_log("disk.setup() No disk in drive DF0.");0!=SAEV_config.memory.amaxRom.size&&(df=le=pd=bd=0,jd=255,ad=null,ke=0,a=SAEF_ZFile_fopen_file(SAEV_config.memory.amaxRom),null!==a?(SAEF_ZFile_fseek(a,0,SEEK_END),Sc=SAEF_ZFile_ftell(a),SAEF_ZFile_fseek(a,0,SEEK_SET)):(SAEF_log("disk.amax_init() failed to load rom"),Sc=262144),ad=new Uint8Array(Sc),null!==a&&
(SAEF_ZFile_fread(ad,0,Sc,1,a),SAEF_ZFile_fclose(a)),SAEF_log("disk.amax_init() loaded %d bytes (%dK ROM)",Sc,Sc>>10))};this.cleanup=function(){for(var a=0;4>a;a++)bb(eb[a])};this.reset=function(){Ca=cb=Mb=0;for(var a=3;0<=a;a--){var b=a,d=eb[b];d.amax=!1;bb(d);d.motoroff=!0;d.idbit=0;d.drive_id=0;d.drive_id_scnt=0;d.lastdataacesstrack=-1;Ca&=~(1<<b);if(SAEV_config.floppy.drive[b].type<=SAEC_Config_Floppy_Type_None||SAEV_config.floppy.drive[b].type>=SAEC_Config_Floppy_Type_35_DD_PC)Ca|=1<<b;Ba&=~(1<<
b);SAEV_config.floppy.drive[b].type>=SAEC_Config_Floppy_Type_35_DD_PC&&(Ba|=1<<b);var f=b,h=SAER.gui.data;h.df[f]="";h.crc32[f]=0;h.drive_disabled[f]=!1;SAEV_config.floppy.drive[f].type<=SAEC_Config_Floppy_Type_None&&(h.drive_disabled[f]=!0);d.indexhackmode=0;0==b&&SAEV_config.floppy.drive[b].type==SAEC_Config_Floppy_Type_35_DD&&(d.indexhackmode=1);d.dskchange_time=0;d.dskchange_request=!1;d.dskchange=!1;d.dskready_down_time=0;d.dskready_up_time=0;d.buffered_cyl=-1;d.buffered_side=-1;SAER.gui.led(b+
SAEC_GUI_LED_DF0,0,-1);G(d);d.newfile=null;wa(d,SAEV_config,b,SAEV_config.floppy.drive[b].file,!1)||SAER.disk.eject(b)}Kc=!0;a:if(dc=!1,0<SAEV_config.memory.amaxRom.data.length){dc=!0;for(a=0;4>a;a++)if(eb[a].amax)break a;for(a=0;4>a;a++)if(1<<a&Ca){eb[a].amax=!0;SAEF_log("disk.setamax() using DF%d",a);break a}SAEF_warn("disk.setamax() no drive available. (disable an drive to make it working)")}od=0;Rc=!1;Xc=0;Pc=["","","",""]};var ef=[68,79,83,0,192,32,15,25,0,0,3,112,67,250,0,24,78,174,255,160,
74,128,103,10,32,64,32,104,0,22,112,0,78,117,112,255,96,250,100,111,115,46,108,105,98,114,97,114,121],yf=[68,79,83,1,227,61,14,114,0,0,3,112,67,250,0,62,112,37,78,174,253,216,74,128,103,12,34,64,8,233,0,6,0,34,78,174,254,98,67,250,0,24,78,174,255,160,74,128,103,10,32,64,32,104,0,22,112,0,78,117,112,255,78,117,100,111,115,46,108,105,98,114,97,114,121,0,101,120,112,97,110,115,105,111,110,46,108,105,98,114,97,114,121,0,0,0];this.examine=function(a,d){var f;var h=SAEV_config;f=eb[d];var m,q,r,t=f.dskchange_time;
q={value:0};var y=new Uint8Array(22),z,E=0,G=0;a.clr();a.unreadable=!0;E=f.cyl;r=W;W=f.cyl=0;if(wa(f,h,d,h.floppy.drive[d].file,!0)&&null!==f.diskfile){a.crc32=f.crc32;a.unreadable=!1;Da(f.bigmfmbuf,f.cyl,11,f.ddhd,f.filetype,q,y,!0);a.hd=2==f.ddhd;f.cyl=E;W=r;if(0==y[0]||0==y[1])G=2;if(2!=G){for(z=h=r=0;1024>z;z+=4)a.bootblock[z]=Ia[z],a.bootblock[z+1]=Ia[z+1],a.bootblock[z+2]=Ia[z+2],a.bootblock[z+3]=Ia[z+3],E=(Ia[z]<<24|Ia[z+1]<<16|Ia[z+2]<<8|Ia[z+3])>>>0,0==z?m=E:4==z&&(r=E,E=0),q=h+E,4294967295<
q&&(q-=4294967296),q<h&&(h++,4294967295<h&&(h-=4294967296)),h+=E,4294967295<h&&(h-=4294967296);1263092555==m&&(G=10);10!=G&&(a.bootblockChecksum=r,(h^4294967295)>>>0!=r&&(G=3),3!=G&&(a.bootblockChecksumValid=!0,Ia[4]=Ia[5]=Ia[6]=Ia[7]=0,2925406252==SAEF_crc32(Ia,0,49)&&(a.bootblockType=1),G=1146049280==m?10:1146049281==m||1146049282==m||1146049283==m?11:1146049284==m||1146049285==m||1146049286==m||1146049287==m?12:4,E=SAEF_crc32(Ia,8,84),10<=G&&3780692555==E&&(a.bootblockType=2)));m=eb[d];E=m.cyl;
m.cyl=40;m.buffered_cyl=-1;Lb(m,!0);Da(m.bigmfmbuf,m.cyl,11,m.ddhd,m.filetype,{value:0},y,!0);m.cyl=E;m.buffered_cyl=-1;if(y[0]&&!Pa(Ia,0,null,0)&&0==Ia[0]&&0==Ia[1]&&0==Ia[2]&&2==Ia[3]&&0==Ia[508]&&0==Ia[509]&&0==Ia[510]&&1==Ia[511]){y=Ia[432];m=433;for(E="";0<=--y;)E+=String.fromCharCode(Ia[m++]);a.diskname=E}}bb(f);1<t&&(b(f),SAEV_config.floppy.drive[d].file.clr(),f.dskchange_time=t,SAER.disk.insert(d,f.newfile));f=G}else f.cyl=E,W=r,f=1;return 1!=f?SAEE_None:SAEE_Internal};this.EXE2ADF=function(a){var b=
SAEF_ZFile_getname(a),d="",d=b.lastIndexOf(".");-1!=d?(d=b.substr(0,d),d+=".ADF"):d=b+".ADF";var f=SAEF_ZFile_fopen_empty(a,d,901120);if(null===f)return null;var h;h=f;var m=new Uint8Array(512),q=new Uint8Array(512),r=new Uint8Array(1768),t={block:880};SAEF_ZFile_fseek(a,0,SEEK_END);var y=SAEF_ZFile_ftell(a),y=Math.floor((y+488-1)/488);if(1760<7+y+Math.floor((y+72-1)/72))h=0;else{r[880]=1;r[881]=1;r[0]=1;r[1]=1;r[1760]=-1;y=za(r,t);SAEF_memset(q,0,0,512);Ea(q,0,2);Ea(q,4,y);db(q,420);q[432]=1;q.set(SAEF_String2Array("s"),
433);Ea(q,500,880);Ea(q,508,2);var z=SAEF_ZFile_fopen_empty(a,"runme.adf",9);SAEF_ZFile_fwrite(SAEF_String2Array("runme.exe"),0,9,1,z);var E=Qb(h,m,y,"startup-sequence",z,r,t);SAEF_ZFile_fclose(z);Ea(q,24+4*xb("startup-sequence"),E);Pa(q,0,q,20);Za(h,q,512*y);E=Qb(h,m,880,"runme.exe",a,r,t);q=SAEF_ZFile_getfilename(a);30<q.length&&(q=q.substr(0,30));dn2=q;0==dn2.length&&(dn2="empty");SAEF_memset(m,0,0,512);m[3]=2;m[15]=72;m[312]=m[313]=m[314]=m[315]=255;m[318]=3;m[319]=113;m[432]=dn2.length;m.set(SAEF_String2Array(dn2),
433);m[511]=1;db(m,420);SAEF_memcpy(m,472,m,420,12);SAEF_memcpy(m,484,m,420,12);Ea(m,24+4*xb("runme.exe"),E);Ea(m,24+4*xb("s"),y);Pa(m,0,m,20);Za(h,m,450560);SAEF_memset(m,0,0,512);for(q=0;;){for(y=t=0;32>y&&255!=r[2+32*q+y];y++)r[2+32*q+y]||(t|=1<<y);t>>>=0;m[4*q+4]=t>>>24;m[4*q+5]=t>>>16&255;m[4*q+6]=t>>>8&255;m[4*q+7]=t&255;if(255==r[2+32*q+y])break;q++}Pa(m,0,m,0);Za(h,m,451072);SAEF_memset(m,0,0,512);m.set(ef);Za(h,m,0);h=1}h?(SAEF_ZFile_fseek(f,0,SEEK_SET),SAEF_ZFile_fclose(a),SAEF_log("disk.EXE2ADF() converted '%s' to '%s'",
b,d)):(SAEF_ZFile_fclose(f),f=null,alert(sprintf("Can't convert '%s' to ADF. (too big)",b)));return f};this.create=function(a,b,d,f,h,m,q){b=Dc(b,d,f,h,m,q,null);if(null!==b){switch(f){case SAEC_Disk_Create_Type_35_DD:SAEV_config.floppy.drive[a].type=SAEC_Config_Floppy_Type_35_DD;break;case SAEC_Disk_Create_Type_35_HD:SAEV_config.floppy.drive[a].type=SAEC_Config_Floppy_Type_35_HD;break;case SAEC_Disk_Create_Type_35_DD_PC:SAEV_config.floppy.drive[a].type=SAEC_Config_Floppy_Type_35_DD_PC;break;case SAEC_Disk_Create_Type_35_HD_PC:SAEV_config.floppy.drive[a].type=
SAEC_Config_Floppy_Type_35_HD_PC;break;case SAEC_Disk_Create_Type_525_SD:SAEV_config.floppy.drive[a].type=SAEC_Config_Floppy_Type_525_SD}f=SAEF_ZFile_getdata(b,0,-1);a=SAEV_config.floppy.drive[a].file;a.name=SAEF_ZFile_getname(b);a.data=SAEF_Array2String(f);a.size=SAEF_ZFile_size(b);a.prot=!1;SAEF_ZFile_fclose(b);return!0}return!1}};var SAEV_RTC_bank=null,SAEV_RTC_delayed_write=0;
function SAEO_RTC(){function a(a){this.tm_sec=a.getSeconds();this.tm_min=a.getMinutes();this.tm_hour=a.getHours();this.tm_mday=a.getDate();this.tm_mon=a.getMonth();this.tm_year=a.getFullYear()-1900;this.tm_wday=a.getDay();this.tm_yday=0;this.tm_isdst=!1}function f(a){return 32768<=(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(a,2,!1,0):d(a)<<8|d(a+1)}function d(d){if(32768<=(d&65535)&&0<=SAEV_config.chipset.fatGaryRev)return SAER.memory.dummyGet(d,1,!1,0);d&=63;if(2==(d&3)||0==
(d&3)||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_None)return SAER.memory.dummyGet(d,1,!1,0);var f;f=new Date;SAEV_config.chipset.rtc.adjust&&f.setTime(f.valueOf()+1E3*SAEV_config.chipset.rtc.adjust);f=new a(f);a:{d>>=2;var h=0;if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000)switch(d){case 0:h=f.tm_sec%10;break;case 1:h=f.tm_sec/10>>>0;break;case 2:h=f.tm_min%10;break;case 3:h=f.tm_min/10>>>0;break;case 4:h=
f.tm_hour%10;break;case 5:E&4?h=f.tm_hour/10>>>0:(h=f.tm_hour%12/10>>>0,h|=12<=f.tm_hour?4:0);break;case 6:h=f.tm_mday%10;break;case 7:h=f.tm_mday/10>>>0;break;case 8:h=(f.tm_mon+1)%10;break;case 9:h=(f.tm_mon+1)/10>>>0;break;case 10:h=f.tm_year%10;break;case 11:h=f.tm_year/10>>>0&15;break;case 12:h=f.tm_wday;break;case 13:h=N;break;case 14:h=I;break;case 15:h=E}else if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A){var J=N&3;if(2<=J&&13>d){f=K[d]>>(2==J?0:4)&15;break a}if(1==J&&13>d){f=
h=m[d];break a}switch(d){case 0:h=f.tm_sec%10;break;case 1:h=f.tm_sec/10>>>0;break;case 2:h=f.tm_min%10;break;case 3:h=f.tm_min/10>>>0;break;case 4:h=f.tm_hour%10;break;case 5:m[10]&1?h=f.tm_hour/10>>>0:(h=f.tm_hour%12/10>>>0,h|=12<=f.tm_hour?2:0);break;case 6:h=f.tm_wday;break;case 7:h=f.tm_mday%10;break;case 8:h=f.tm_mday/10>>>0;break;case 9:h=(f.tm_mon+1)%10;break;case 10:h=(f.tm_mon+1)/10>>>0;break;case 11:h=f.tm_year%100%10;break;case 12:h=f.tm_year%100/10>>>0;break;case 13:h=N;break;case 14:h=
0;break;case 15:h=0}}f=h}return f}function J(a,d){32768<=(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(a,2,d):(h(a,d>>8),h(a+1,d&255))}function h(a,d){if(32768<=(a&65535)&&0<=SAEV_config.chipset.fatGaryRev)SAER.memory.dummyPut(a,1,d);else if(a&=63,1==(a&1)&&SAEV_config.chipset.rtc.type!=SAEC_Config_RTC_Type_None){a>>=2;d&=15;if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000)switch(a){case 13:N=d&9;
break;case 14:I=d;break;case 15:E=d}else if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A){var f=N&3;if(2<=f&&13>a){var h=K[a];K[a]&=2==f?240:15;K[a]|=d<<(2==f?0:4);K[a]!=h&&(SAEV_RTC_delayed_write=-1);return}if(1==f&&13>a){h=m[a];m[a]=d;m[0]=m[1]=m[9]=m[12]=0;m[3]&=-9;m[5]&=-13;m[6]&=-9;m[8]&=-13;m[10]&=-15;m[11]&=-13;m[a]!=h&&(SAEV_RTC_delayed_write=-1);return}switch(a){case 13:N=d;break;case 14:I=d;break;case 15:E=d}}SAEV_RTC_delayed_write=-1}}var N=0,I=0,E=0,K=null,m=null;this.write=
function(){};this.hardreset=function(){switch(SAEV_config.chipset.rtc.type){case SAEC_Config_RTC_Type_None:type="none";break;case SAEC_Config_RTC_Type_MSM6242B:type="MSM6242B";break;case SAEC_Config_RTC_Type_RF5C01A:type="RF5C01A";break;case SAEC_Config_RTC_Type_MSM6242B_A2000:type="MSM6242B A2000"}SAEF_log("rtc.hardreset() type '%s'",type);SAEV_RTC_delayed_write=0;if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000)N=1,
I=0,E=4,m=K=null;else if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A){N=8;E=I=0;K=new Uint8Array(16);m=new Uint8Array(16);for(var a=0;16>a;a++)K[a]=m[a]=0;m[10]=1}SAEV_RTC_bank.name="Battery backed up clock ("+type+")"};SAEV_RTC_bank=new SAEO_Memory_addrbank(function(a){return 32768<=(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(a,4,!1,0):(f(a)<<16|f(a+2))>>>0},f,d,function(a,d){32768<=(a&65535)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(a,4,d):(J(a,
d>>>16),J(a+2,d&65535))},J,h,SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Battery backed up clock (none)",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO,null,63,14155776)};var SAEC_CPU_halt_BUS_ERROR_DOUBLE_FAULT=1,SAEC_CPU_halt_DOUBLE_FAULT=2,SAEC_CPU_halt_OPCODE_FETCH_FROM_NON_EXISTING_ADDRESS=3,SAEC_CPU_halt_AUTOCONFIG_CONFLICT=7;
function SAEO_M68K(){function a(a){SAEV_spcflags=0;SAEF_setSpcFlags(SAEC_spcflag_CHECK);this.halted=0;J=!1;SAER.gui.data.cpu_halted=0;SAER.gui.led(SAEC_GUI_LED_CPU,0,-1);h=d=!1;SAER.cpu.reset(a)}function f(a){this.stopped=!1;SAEF_clrSpcFlags(SAEC_spcflag_STOP);for(SAEF_assert(8>a&&0<=a);;){SAER_CPU_exception(a+24);SAER_CPU_regs.intmask=a;if(!SAEV_config.cpu.compatible)break;a=SAER.custom.intlev();if(0>=a||SAER_CPU_regs.intmask>=a)break}SAER.m68k.doint()}var d=!1;this.halted=0;var J=this.stopped=!1,
h=!1;this.setup=function(){return SAER.cpu.setup()};this.dump=function(){SAER.cpu.dump()};this.cpureset=function(){d=SAEV_config.cpu.resetDelay;SAEF_setSpcFlags(SAEC_spcflag_CHECK);if(SAEV_config.cpu.compatible&&SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68020)SAER.playfield.custom_reset(!1,!1);else{var a=SAER_CPU_getPC()+2,f=SAER_Memory_getBank(a);if(f.check(a,2)){SAEF_log("cpu.cpureset() PC=%x (%s)...",a-2,f.name);var h=SAER_Memory_get16(a);SAER.playfield.custom_reset(!1,!1);if(f===SAER_Memory_getBank(a))return;
if(20176==(h&-8)){f=SAER_CPU_regs.a[h&7];524288>f&&(f+=16252928);SAEF_log("cpu.cpureset() reset/jmp combination at %08x emulated -> %x",a,f);SAER.cpu.setPC_normal(f-2);return}}SAEF_log("cpu.cpureset() PC=%x (%s), invalid memory -> %x.",a,f.name,16252930);SAER.playfield.custom_reset(!1,!1);SAER.cpu.setPC_normal(16252928)}};this.cpu_halt=function(a){this.halted||(SAEF_log("CPU halted: reason = %d PC=%08x",a,SAER_CPU_getPC()),this.halted=a,SAER.gui.data.cpu_halted=a,SAER.gui.led(SAEC_GUI_LED_CPU,0,-1),
0<=a&&(SAER_CPU_regs.intmask=7,SAER_Audio_deactivate()),SAEF_setSpcFlags(SAEC_spcflag_CHECK))};var N=!1,I=!0;this.is_keyboardreset=function(){return N};this.is_hardreset=function(){return I};this.m68k_pause=function(){if(SAEV_command==SAEC_command_Pause)SAEV_command=0,SAER.paused||(SAEF_log("->pause"),SAER.paused=!0,SAER.pause_program(1));else if(SAEV_command==SAEC_command_Resume)SAEV_command=0,SAER.paused&&(SAEF_log("->resume"),SAER.pause_program(0),h=SAER.paused=!1);else if(SAEV_command==-SAEC_command_Quit||
SAEV_command==-SAEC_command_Reset||SAEV_command==-SAEC_command_KeyboardReset||SAEV_command==-SAEC_command_HardReset)SAEF_log("->stop"),SAER.paused=!1;SAER.paused?setTimeout(function(){SAER.m68k.m68k_pause()},500):setTimeout(function(){SAER.m68k.m68k_cycle(0,0)},0)};this.m68k_cycle=function(d,f){try{if(0<SAEV_command){N=SAEV_command==SAEC_command_KeyboardReset;I=0!=((SAEV_command==SAEC_command_HardReset?1:0)|d);if(SAEV_command==SAEC_command_Quit){this.m68k_gone();return}if(SAEV_command==SAEC_command_Pause){this.m68k_pause();
return}SAEV_Events_currcycle=SAEV_Events_vsync_counter=SAEV_Events_hsync_counter=d=SAEV_command=0;SAER_Events_eventtab[SAEC_Events_EV_HSYNC].oldcycles=0;SAER.playfield.custom_reset(I,N);a(I);I&&(SAER.memory.clear(),SAEF_log("m68k.m68k_cycle() hardreset, memory cleared."));0==SAEV_config.audio.mode&&(SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!1);SAER.cpu.setPC_normal(SAER_CPU_regs.pc);"function"===typeof SAEV_config.hook.event.reseted&&SAEV_config.hook.event.reseted(I);I=!1}f&&(SAER.playfield.custom_prepare(),
f=0);SAEF_clrSpcFlags(SAEC_spcflag_MODE_CHANGE);this.halted&&this.cpu_halt(this.halted);!1!==h&&(SAEV_Events_reflowtime=SAEF_now()-h);SAER_CPU_run_func();h=SAEF_now();setTimeout(function(){SAER.m68k.m68k_cycle(d,f)},0)}catch(m){if(this.m68k_gone(),m instanceof SAEO_Error)"function"===typeof SAEV_config.hook.log.error?SAEV_config.hook.log.error(m.err,m.msg):alert(m.msg);else throw m;}};this.m68k_go=function(a){SAER.events.reset_frame_rate_hack();SAER.running=!0;setTimeout(function(){SAER.m68k.m68k_cycle(1,
1)},0)};this.m68k_gone=function(){SAER.running=!1;SAER.leave_program()};this.m68k_setstopped=function(){this.stopped=!0;0==(SAEV_spcflags&SAEC_spcflag_DOTRACE)?SAEF_setSpcFlags(SAEC_spcflag_STOP):this.m68k_resumestopped()};this.m68k_resumestopped=function(){this.stopped&&(this.stopped=!1,SAER_CPU_fill_prefetch(),SAEF_clrSpcFlags(SAEC_spcflag_STOP))};this.doint=function(){SAEV_config.cpu.compatible&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?SAEF_setSpcFlags(SAEC_spcflag_INT):SAEF_setSpcFlags(SAEC_spcflag_DOINT)};
this.doint_trace=function(a){SAEV_config.cpu.compatible&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?SAEF_setSpcFlags(SAEC_spcflag_INT):SAEF_setSpcFlags(SAEC_spcflag_DOINT);a?SAEF_setSpcFlags(SAEC_spcflag_TRACE):SAEF_clrSpcFlags(SAEC_spcflag_TRACE)};this.do_specialties=function(a){if(SAEV_spcflags&SAEC_spcflag_MODE_CHANGE)return!0;if(SAEV_spcflags&SAEC_spcflag_CHECK){if(this.halted){SAEF_clrSpcFlags(SAEC_spcflag_CHECK);var h;a:{for(;SAER.m68k.halted;)if(h=SAER.playfield.get_vpos(),0==h&&J&&
(J=!1,SAEF_sleep(8)),h&&(J=!0),SAER.events.do_cycles(8*SAEC_Events_CYCLE_UNIT),SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle(),SAEV_spcflags&&SAEV_spcflags&(SAEC_spcflag_BRK|SAEC_spcflag_MODE_CHANGE)){h=!0;break a}h=!1}if(h)return!0}if(d){h=60;for(var m=-1;0<h&&0==SAEV_command;)SAER.events.do_cycles(8*SAEC_Events_CYCLE_UNIT),SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle(),SAEV_Events_timeframes!=m&&(m=SAEV_Events_timeframes,h--);d=!1}SAEF_clrSpcFlags(SAEC_spcflag_CHECK)}for(SAEV_spcflags&
SAEC_spcflag_COPPER&&SAER.copper.cycle();SAEV_spcflags&SAEC_spcflag_BLTNASTY&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&0<a&&!SAEV_config.chipset.blitter.cycle_exact;){h=SAER.blitter.blitnasty();if(0>h)break;else 0<h?(a-=h*SAEC_Events_CYCLE_UNIT*2,a<SAEC_Events_CYCLE_UNIT&&(a=0)):h=4;SAER.events.do_cycles(h*SAEC_Events_CYCLE_UNIT);SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle()}SAEV_spcflags&SAEC_spcflag_DOTRACE&&SAER_CPU_exception(9);for(a=!0;SAEV_spcflags&SAEC_spcflag_STOP&&!(SAEV_spcflags&
SAEC_spcflag_BRK);)if(a||SAER.events.do_cycles(4*SAEC_Events_CYCLE_UNIT),a=!1,SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle(),SAEV_spcflags&(SAEC_spcflag_INT|SAEC_spcflag_DOINT)&&(h=SAER.custom.intlev(),SAEF_clrSpcFlags(SAEC_spcflag_INT|SAEC_spcflag_DOINT),0<h&&h>SAER_CPU_regs.intmask&&f(h)),SAEV_spcflags&SAEC_spcflag_MODE_CHANGE)return this.m68k_resumestopped(),!0;if(SAEV_spcflags&SAEC_spcflag_TRACE)if(SAER_CPU_regs.t0&&SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020){if(SAER.cpu.setPC_normal(SAER_CPU_getPC()),
SAER_CPU_fill_prefetch(),a=SAER_Memory_get16(SAER_CPU_regs.pc),20083==a||20084==a||20085==a||20087==a||20086==a||20096==(a&65472)||20160==(a&65472)||24832==(a&65280)||24576==(a&61440)&&ccTab[a>>8&15]()||20560==(a&61680)&&!ccTab[a>>8&15]()&&SAER_CPU_regs.d[a&7]&1)SAEF_clrSpcFlags(SAEC_spcflag_TRACE),SAEF_setSpcFlags(SAEC_spcflag_DOTRACE)}else SAER_CPU_regs.t1&&(SAEF_clrSpcFlags(SAEC_spcflag_TRACE),SAEF_setSpcFlags(SAEC_spcflag_DOTRACE));SAEV_spcflags&SAEC_spcflag_INT&&(h=SAER.custom.intlev(),SAEF_clrSpcFlags(SAEC_spcflag_INT|
SAEC_spcflag_DOINT),0<h&&(h>SAER_CPU_regs.intmask||7==h)&&f(h));SAEV_spcflags&SAEC_spcflag_DOINT&&(SAEF_clrSpcFlags(SAEC_spcflag_DOINT),SAEF_setSpcFlags(SAEC_spcflag_INT));return SAEV_spcflags&SAEC_spcflag_BRK?(SAEF_clrSpcFlags(SAEC_spcflag_BRK),!0):!1}};var SAER_CPU_regs=null,SAER_CPU_setPC=null,SAER_CPU_getPC=null,SAER_CPU_exception=null,SAER_CPU_run_func=null,SAER_CPU_fill_prefetch=null,SAEV_CPU_cycles=0;
function SAEO_CPU(){function a(a){this.num=a}function f(){this.tag=this.data=0;this.valid=!1}function d(){this.data=new Uint32Array(4);this.valid=[!1,!1,!1,!1];this.tag=0}function J(a){e.prefetch020addr=4294967295;e.cacheholdingaddr020=4294967295;a=SAEV_config.cpu.compatible;if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020){if(e.cacr&8){for(var b=0;64>b;b++)ae[b].valid=!1;e.cacr&=-9}e.cacr&4&&(ae[e.caar>>>2&63].valid=!1,e.cacr&=-5)}else if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030){if(e.cacr&
8){if(a)for(b=0;16>b;b++)je[b].valid[0]=!1,je[b].valid[1]=!1,je[b].valid[2]=!1,je[b].valid[3]=!1;e.cacr&=-9}e.cacr&4&&(je[e.caar>>>4&15].valid[e.caar>>>2&3]=0,e.cacr&=-5);if(e.cacr&2048){if(a)for(b=0;16>b;b++)Nd[b].valid[0]=!1,Nd[b].valid[1]=!1,Nd[b].valid[2]=!1,Nd[b].valid[3]=!1;e.cacr&=-2049}e.cacr&1024&&(Nd[e.caar>>>4&15].valid[e.caar>>>2&3]=0,e.cacr&=-1025)}}function h(a){a=(a&-4)>>>0;if(e.cacheholdingaddr020!=a){var b=(a&4294967040|(e.s?1:0))>>>0,d=ae[a>>>2&63];if(d.valid&&d.tag==b)e.cacheholdingaddr020=
a,e.cacheholdingdata020=d.data;else{var l=SAER_Memory_banks[a>>>16].getInst32(a);e.cacr&2||(d.tag=b,d.valid=0!=(e.cacr&1),d.data=l);e.cacheholdingaddr020=a;e.cacheholdingdata020=l}}}function N(a,b,d){b=(b&-4)>>>0;d.tag=(b&4294967040|(e.s?1:0))>>>0;d.lws=b>>>2&3;return a[b>>>4&15]}function I(a,b,d,e){a.tag!=d&&(a.valid[0]=a.valid[1]=a.valid[2]=a.valid[3]=!1);a.tag=d;a.valid[e]=!0;a.data[e]=b}function E(a){a=(a&-4)>>>0;if(e.cacheholdingaddr020!=a){var b={},d=N(je,a,b);if(d.valid[b.lws]&&d.tag==b.tag)e.cacheholdingaddr020=
a,e.cacheholdingdata020=d.data[b.lws];else{var l=SAER_Memory_banks[a>>>16].getInst32(a);1==(e.cacr&3)&&I(d,l,b.tag,b.lws);17!=(e.cacr&17)||0!=b.lws||d.valid[1]||d.valid[2]||d.valid[3]||SAER_Memory_banktype[a>>>16]!=SAEC_Memory_banktype_FAST32||(d.data[1]=SAER_Memory_banks[a+4>>>16].getInst32(a+4),d.data[2]=SAER_Memory_banks[a+8>>>16].getInst32(a+8),d.data[3]=SAER_Memory_banks[a+12>>>16].getInst32(a+12),d.valid[1]=d.valid[2]=d.valid[3]=!0);e.cacheholdingaddr020=a;e.cacheholdingdata020=l}}}function K(a,
b){var d=a&3,l,f;f={};var h=N(Nd,a,f);a=(a&-4)>>>0;if(h.valid[f.lws]&&h.tag==f.tag){if(l=h.data[f.lws],0<SAEV_AutoConf_boot_rom_type){var m=SAER_Memory_get32(a);m!=l&&(SAEF_warn("cpu.read_dcache030x() data cache mismatch %d %d %08x %08x != %08x %08x %d PC=%08x",b,d,a,m,l,f.tag,f.lws,q()),l=m)}}else l=SAER_Memory_get32(a),I(h,l,f.tag,f.lws);if(0==b)return l>>>8*(3-d)&255;if(1==b&&2>=d)return l>>>=8*(2-d),l&65535;if(2==b&&0==d)return 4352!=(e.cacr&4352)||0!=f.lws||h.valid[1]||h.valid[2]||h.valid[3]||
SAER_Memory_banktype[a>>16]!=SAEC_Memory_banktype_FAST32||(h.data[1]=SAER_Memory_get32(a+4),h.data[2]=SAER_Memory_get32(a+8),h.data[3]=SAER_Memory_get32(a+12),h.valid[1]=h.valid[2]=h.valid[3]=!0),l>>>0;a+=4;h={};m=N(Nd,a,h);m.valid[h.lws]&&m.tag==h.tag?(f=m.data[h.lws],0<SAEV_AutoConf_boot_rom_type&&(m=SAER_Memory_get32(a),m!=f&&(SAEF_warn("cpu.read_dcache030x() data cache mismatch %d %d %08x %08x != %08x %08x %d PC=%08x",b,d,a,m,f,h.tag,h.lws,q()),f=m))):(f=SAER_Memory_get32(a),I(m,f,h.tag,h.lws));
if(1==b&&3==d)return(l<<8|f>>>24)&65535;if(2==b&&1==d)return(l<<8|f>>>24)>>>0;if(2==b&&2==d)return(l<<16|f>>>16)>>>0;if(2==b&&3==d)return(l<<24|f>>>8)>>>0;SAEF_warn("cpu.read_dcache030x() weirdness!?");return 0}function m(a,b){return e.cacr&256&&0!=SAER_Memory_cachable[a>>>16]?K(a,b):2==b?SAER_Memory_get32(a):1==b?SAER_Memory_get16(a):SAER_Memory_get8(a)}function pa(a){return m(a,2)}function ja(a){return m(a,1)}function G(a){return m(a,0)}function bb(a,b,d){if(e.cacr&256&&0!=SAER_Memory_cachable[a>>>
16]){var l=a&3,f=0!=(e.cacr&8192),h={},m=N(Nd,a,h);if(2==d&&0==l&&f)I(m,b,h.tag,h.lws);else{var q=m.tag==h.tag&&m.valid[h.lws];if(q||f)2==d?q?(m.data[h.lws]&=~(4294967295>>>8*l),m.data[h.lws]|=b>>>8*l):m.valid[h.lws]=!1:1==d?q?(m.data[h.lws]&=~(4294901760>>>8*l),m.data[h.lws]|=b<<16>>>8*l):m.valid[h.lws]=!1:0==d&&(q?(m.data[h.lws]&=~(4278190080>>>8*l),m.data[h.lws]|=b<<24>>>8*l):m.valid[h.lws]=!1);0==d||1==d&&2>=l||2==d&&0==l||(h={},m=N(Nd,a+4,h),!(q=m.tag==h.tag&&m.valid[h.lws])&&!f)||(2==d?q?(m.data[h.lws]&=
4294967295>>>8*l,m.data[h.lws]|=b<<8*(4-l)):m.valid[h.lws]=!1:1==d&&(q?(m.data[h.lws]&=16777215,m.data[h.lws]|=b<<24):m.valid[h.lws]=!1))}}2==d?SAER_Memory_put32(a,b):1==d?SAER_Memory_put16(a,b):SAER_Memory_put8(a,b)}function kb(a,b){bb(a,b,2)}function ua(a,b){bb(a,b,1)}function y(a,b){bb(a,b,0)}function Oa(a){a=q()+a;var b;a&2?(b=e.prefetch020[0]&65535,e.prefetch020[0]=e.prefetch020[1],h(a+2+4),e.prefetch020[1]=e.cacheholdingdata020,e.db=e.prefetch020[0]>>>16):(b=e.prefetch020[0]>>>16,e.db=e.prefetch020[0]);
return b}function T(a){a=q()+a;var b;a&2?(b=e.prefetch020[0]&65535,e.prefetch020[0]=e.prefetch020[1],E(a+2+4),e.prefetch020[1]=e.cacheholdingdata020):b=e.prefetch020[0]>>>16;return b}function wa(){if(SAEV_config.cpu.compatible)if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030){var a=(q()&-4)>>>0;E(a);e.prefetch020[0]=e.cacheholdingdata020;E(a+4);e.prefetch020[1]=e.cacheholdingdata020;e.irc=T(0)}else SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020?(a=(q()&-4)>>>0,h(a),e.prefetch020[0]=e.cacheholdingdata020,
h(a+4),e.prefetch020[1]=e.cacheholdingdata020,e.irc=Oa(0)):SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010&&(a=q(),e.ir=SAER_Memory_banks[a>>>16].getInst16(a),e.irc=SAER_Memory_banks[a+2>>>16].getInst16(a+2))}function b(a){e.instruction_pc=e.pc=a;e.pc_p=e.pc_oldp=a}function q(){return e.pc+(e.pc_p-e.pc_oldp)}function Z(){b(q())}function ea(){return e.pc+pc}function Ua(a){e.instruction_pc=e.pc=a;pc=2;wa()}function r(){e.pc+=pc;pc=2;e.ir=tb(2)}function R(){e.pc+=pc;pc=2;e.irc=Oa(0)}function Fa(){e.pc+=
pc;pc=2;e.irc=T(0)}function Lb(){var a=SAER_Memory_banks[e.pc_p>>>16].getInst16(e.pc_p);e.pc_p+=2;return a}function t(){var a=SAER_Memory_banks[e.pc_p>>>16].getInst32(e.pc_p);e.pc_p+=4;return a}function tb(a){var b=e.irc;e.irc=e.db=SAER_Memory_banks[e.pc+a>>>16].getInst16(e.pc+a);return b}function Da(){var a=pc;pc+=2;return tb(a+2)}function sb(){var a=pc;pc+=4;a+=2;return(tb(a)<<16|tb(a+2))>>>0}function Sa(a){a=SAER_Memory_get8(a);e.db=a<<8|a;return a}function ta(a){a=SAER_Memory_get16(a);return e.db=
a}function ka(a){return(ta(a)<<16|ta(a+2))>>>0}function qa(a,b){e.db=b<<8|b;SAER_Memory_put8(a,b)}function nb(a,b){e.db=b;SAER_Memory_put16(a,b)}function $a(a,b){nb(a,b>>>16);nb(a+2,b&65535)}function Ga(){var a=pc;pc+=2;return Oa(a)}function fa(){var a=pc;pc+=4;return(Oa(a)<<16|Oa(a+2))>>>0}function U(){var a=pc;pc+=2;return T(a)}function na(){var a=pc;pc+=4;return(T(a)<<16|T(a+2))>>>0}function Xb(){return(e.x?1:0)<<4|(e.n?1:0)<<3|(e.z?1:0)<<2|(e.v?1:0)<<1|(e.c?1:0)}function wb(a){e.x=1==(a>>4&1);
e.n=1==(a>>3&1);e.z=1==(a>>2&1);e.v=1==(a>>1&1);e.c=1==(a&1)}function L(){return(e.t1?1:0)<<15|(e.t0?1:0)<<14|(e.s?1:0)<<13|(e.m?1:0)<<12|e.intmask<<8|(e.x?1:0)<<4|(e.n?1:0)<<3|(e.z?1:0)<<2|(e.v?1:0)<<1|(e.c?1:0)}function mb(a){var b=e.m,d=e.s;e.x=1==(a>>4&1);e.n=1==(a>>3&1);e.z=1==(a>>2&1);e.v=1==(a>>1&1);e.c=1==(a&1);var l=1==(a>>15&1),f=1==(a>>14&1),h=1==(a>>13&1),m=1==(a>>12&1);a=a>>8&7;if(e.t1!=l||e.t0!=f||e.s!=h||e.m!=m||e.intmask!=a)e.t1=l,e.t0=f,e.s=h,e.m=m,e.intmask=a,SAEV_config.cpu.model>=
SAEC_Config_CPU_Model_68020?d!=e.s?d?(b?e.msp=e.a[7]:e.isp=e.a[7],e.a[7]=e.usp):(e.usp=e.a[7],e.a[7]=e.m?e.msp:e.isp):d&&b!=e.m&&(b?(e.msp=e.a[7],e.a[7]=e.isp):(e.isp=e.a[7],e.a[7]=e.msp)):(e.t0=e.m=0,d!=e.s&&(d?(e.isp=e.a[7],e.a[7]=e.usp):(e.usp=e.a[7],e.a[7]=e.isp))),SAER.m68k.doint_trace(e.t1||e.t0)}function pb(a){return 2==a||3==a||4==a||8==a||10==a||11==a?e.instruction_pc:q()}function zb(a){var d,f=e.s,l=a,h=!0,m=24<=a&&32>a;m&&SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010&&(l=Ha(16777201|
a-24<<1));var q=L();e.s||(e.usp=e.a[7],e.a[7]=SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?e.m?e.msp:e.isp:e.isp,e.s=!0);if(e.a[7]&1&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020)2==a||3==a?SAER.m68k.cpu_halt(SAEC_CPU_halt_DOUBLE_FAULT):db(e.ir,e.a[7],!0,!1,!0,4294967295,!1);else if((2==a||3==a)&&0>Jd)SAER.m68k.cpu_halt(SAEC_CPU_halt_DOUBLE_FAULT);else{if(SAEV_config.cpu.model>SAEC_Config_CPU_Model_68000)if(d=pb(a),2==a||3==a){f=(f?4:0)|($b?2:1);f|=ge?0:64;f|=32;for(m=0;36>m;m++)Ta(0);
Bb(Zf);Ta(0);Ta(0);Ta(0);Ta(f);Ta(45056+4*l);SAEF_log("cpu.exception() %d (%x) at %x -> %x!",a,e.instruction_pc,d,SAER_Memory_get32(e.vbr+4*l))}else 5==a||6==a||7==a||9==a?(Bb(e.instruction_pc),Ta(8192+4*l)):e.m&&m?(Ta(4*l),Bb(d),Ta(q),e.s=!0,e.msp=e.a[7],e.m=!1,e.a[7]=e.isp,Ta(4096+4*l)):Ta(4*l);else{if(!(SAEV_config.cpu.model>SAEC_Config_CPU_Model_68000)){if(24<=a&&31>=a)d=48;else if(32<=a&&47>=a)d=34;else switch(a){case 2:d=50;break;case 3:d=50;break;case 4:d=34;break;case 5:d=38;break;case 6:d=
40;break;case 7:d=34;break;case 8:d=34;break;case 9:d=34;break;case 10:d=34;break;case 11:d=34;break;default:d=4}d=d*SAEC_Events_CYCLE_UNIT>>1;d=0==cf||SAEV_config.cpu.speed==SAEC_Config_CPU_Speed_Maximum?d:Math.floor(d*cf/8192);SAER.events.do_cycles(d)}d=pb(a);if(2==a||3==a)h=(f?4:0)|($b?2:1),h|=ge?0:16,h|=jf?8:0,h|=ld&-32,Jd=-1,Bb(Te),Ta(q),Ta(ld),Bb(Zf),Ta(h),SAEF_log("cpu.exception() %d (%x) at %x -> %x!",a,Zf,d,SAER_Memory_get32(e.vbr+4*l)),h=!1}h&&(Bb(d),Ta(q));l=La(e.vbr+4*l);Jd=0;l&1?2==a||
3==a?SAER.m68k.cpu_halt(SAEC_CPU_halt_DOUBLE_FAULT):db(e.ir,l,!0,!1,!0,4294967295,!1):(b(l),wa(),SAEF_clrSpcFlags(SAEC_spcflag_TRACE|SAEC_spcflag_DOTRACE),e.t1&&!e.t0&&(5==a||6==a||7==a||32<=a&&47>=a)&&SAEF_setSpcFlags(SAEC_spcflag_DOTRACE),e.t1=e.t0=e.m=!1)}}function Pa(a){2!=a&&3!=a&&4!=a&&8!=a&&10!=a&&11!=a&&M();zb(a);return[0,0,0]}function db(a,b,d,l,f,h,m){SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?Te=4294967295==h?e.instruction_pc:h:4294967295==h?(Te=q(),m&&(Te+=2)):Te=h;Zf=b;ld=a;ge=
d;$b=l;jf=f;zb(3)}function Za(a,b){db(a,b,0,1,!1,4294967295,!0);return[0,0,0]}function xb(a){return(a&(SAEV_config.cpu.addressSpace24?16777215:4294967295))>>>0}function za(a){var b=q(),d=16252928==(xb(b)&4294443008)>>>0,l=(xb(b)&4294901760)>>>0==SAEV_AutoConf_base&&SAEV_AutoConf_boot_rom_type;if(SAEV_Memory_cloantoRom&&28928==(a&61696))return e.d[a>>9&7]=lb(a&255),SAER.cpu.incPC_normal(2),wa(),!0;20091==a&&d&&0==SAER_Memory_get32(16)&&SAEF_fatal(SAEE_CPU_Requires68020,"The selected kickstart-rom does require a 68020 and 32bit address-space");
if(65293==a&&l)return SAEF_log("cpu.illegal() STOP replacement, pc %08x",b),m68k_setstopped(),!0;if(40960==(a&61440)&&l)return SAEF_log("cpu.illegal() Trap %03X at %08X, call...",a&4095,b),SAER.cpu.incPC_normal(2),SAER.autoconf.m68k_handle_trap(a&4095),wa(),!0;if(61440==(a&61440))return 20>++bg&&SAEF_log("cpu.illegal() B-Trap %04X at %08X -> %08X (VBR %08X)",a,b,SAER_Memory_get32(e.vbr+44),e.vbr),Pa(11),!1;if(40960==(a&61440))return 20>++bg&&SAEF_log("cpu.illegal() A-Trap %04X at %08X -> %08X (VBR %08X)",
a,b,SAER_Memory_get32(e.vbr+40),e.vbr),Pa(10),!1;20>++bg&&SAEF_log("cpu.illegal() op %04x, pc %08x -> %08x",a,b,SAER_Memory_get32(e.vbr+16));Pa(4);return!1}function Ea(a){M();return za(a)?[4,0,0]:[0,0,0]}function Qb(){SAEF_warn("cpu.bus_error() PC %08x",q());try{zb(2)}catch(b){if(b instanceof a)SAER.m68k.cpu_halt(SAEC_CPU_halt_BUS_ERROR_DOUBLE_FAULT);else throw b;}}function Ub(){for(var b=!1;!b;)try{for(;!b;)e.instruction_pc=q(),e.opcode=e.ir,SAER.events.do_cycles(Fd),SAEV_CPU_cycles=Fd=v[e.opcode].f(v[e.opcode].p)[0]*
be,SAEV_spcflags&&SAER.m68k.do_specialties(Fd)&&(b=!0)}catch(d){if(d instanceof a)Qb(),SAEV_spcflags&&SAER.m68k.do_specialties(Fd)&&(b=!0);else throw d;}}function sc(){for(var b=!1;!b;)try{for(;!b;)e.instruction_pc=q(),e.opcode=e.irc,SAER.events.do_cycles(Fd),SAEV_CPU_cycles=Fd=v[e.opcode].f(v[e.opcode].p)[0]*be,SAEV_spcflags&&SAER.m68k.do_specialties(Fd)&&(b=!0)}catch(d){if(d instanceof a)Qb(),SAEV_spcflags&&SAER.m68k.do_specialties(Fd)&&(b=!0);else throw d;}}function Dc(){for(var b=!1;!b;)try{for(;!b;)e.instruction_pc=
q(),e.opcode=Lb(),SAER.events.do_cycles(Fd),SAEV_CPU_cycles=Fd=v[e.opcode].f(v[e.opcode].p)[0]*be,SAEV_spcflags&&SAER.m68k.do_specialties(Fd)&&(b=!0)}catch(d){if(d instanceof a)Qb(),SAEV_spcflags&&SAER.m68k.do_specialties(Fd)&&(b=!0);else throw d;}}function hc(a,b){var d=(a&65535)*(b&65535),e=(a>>>16&65535)*(b&65535),f=(a&65535)*(b>>>16&65535),h=(a>>>16&65535)*(b>>>16&65535),m=d+((e<<16&4294901760)>>>0);4294967295<m&&(m-=4294967296);m<d&&h++;d=m;m=d+((f<<16&4294901760)>>>0);4294967295<m&&(m-=4294967296);
m<d&&h++;h+=(e>>>16&65535)+(f>>>16&65535);4294967295<h&&(h-=4294967296);return[m,h]}function Sb(a,b,d){var e,f=0,h=!1;if(d<=a)return[1,0,0];for(e=0;32>e;e++)if(h=0!=(a&2147483648),a=a<<1>>>0,b&2147483648&&a++,b=b<<1>>>0,f=f<<1>>>0,h||d<=a)f=(f|1)>>>0,a-=d;return[0,f,a]}function W(a){switch(a){case 0:return"SFC";case 1:return"DFC";case 2048:return"USP";case 2049:return"VBR";case 2:return"CACR";case 2050:return"CAAR";case 2051:return"MSP";case 2052:return"ISP";case 3:return"TC";case 4:return"ITT0";
case 5:return"ITT1";case 6:return"DTT0";case 7:return"DTT1";case 2053:return"MMUSR";case 2054:return"URP";case 2055:return"SRP"}return"???"}function Aa(a){switch(a){case 0:return 68010<=Wa;case 1:return 68010<=Wa;case 2048:return 68010<=Wa;case 2049:return 68010<=Wa;case 2:return 68020<=Wa;case 2050:return 68020==Wa||68030==Wa;case 2051:return 68020<=Wa;case 2052:return 68020<=Wa}return!1}function z(a){return ab.memory[a]<<8|ab.memory[a+1]}function Ca(a){return(ab.memory[a]<<24|ab.memory[a+1]<<16|
ab.memory[a+2]<<8|ab.memory[a+3])>>>0}function Ba(){var a=z(ab.pc+ab.io);ab.io+=2;return a}function Ia(){var a=Ca(ab.pc+ab.io);ab.io+=4;return a}function ma(a){switch(a){case 0:return"s";case 1:return"b";case 2:return"w";case 4:return"l";default:return"?"}}function cb(a,b,d){var l="",f=b>>12&7,h=b&32768?e.a[f]:e.d[f],m=b>>9&3;0==(b&2048)&&(h=ca(h&65535));m&&(h=(h<<m&4294967295)>>>0);if(b&256){var q=0;b&128&&(a=0);b&64&&(h=0);32==(b&48)&&(a=xa(a,ca(Ba())));48==(b&48)&&(a=xa(a,Ia()));2==(b&3)&&(q=ca(Ba()));
3==(b&3)&&(q=Ia());0==(b&4)&&(a=xa(a,h));b&3&&(a=Ca(a));b&4&&(a=xa(a,h));xa(a,q)}else xa(xa(a,lb(b&255)),h);return l=-1!=d?l+sprintf("(%d,a%d,%s%d.%s*%d)",yb(b&255),d,b&32768?"a":"d",f,b&2048?"l":"w",1<<m):l+sprintf("(%d,pc,%s%d.%s*%d)",yb(b&255),b&32768?"a":"d",f,b&2048?"l":"w",1<<m)}function va(a,b){var d=a>>3;if(7==d)switch(a&7){case 0:return d=Ba(),sprintf(10==config_da.radix?"(%d)":"("+ab.fmt16+")",d);case 1:return d=Ia(),sprintf(10==config_da.radix?"(%d)":"("+ab.fmt32+")",d);case 2:var l=ab.pc+
ab.io,d=ca(Ba());return config_da.reloc?sprintf(ab.fmt32,xa(l,d)):sprintf(10==config_da.radix?"%d(pc)":ab.fmt32+"(pc)",Nb(d));case 3:return l=ab.pc+ab.io,d=Ba(),cb(l,d,-1);case 4:switch(b){case 1:return d=Ba()&255,sprintf(10==config_da.radix?"#%d":"#"+ab.fmt8,yb(d));case 2:return d=Ba(),sprintf(10==config_da.radix?"#%d":"#"+ab.fmt16,cc(d));case 4:return d=Ia(),sprintf(10==config_da.radix?"#%d":"#"+ab.fmt32,Nb(d))}}else switch(l=a&7,d){case 0:return sprintf("d%d",l);case 1:return sprintf("a%d",l);
case 2:return sprintf("(a%d)",l);case 3:return sprintf("(a%d)+",l);case 4:return sprintf("-(a%d)",l);case 5:return d=ca(Ba()),sprintf(10==config_da.radix?"%d(a%d)":ab.fmt32+"(a%d)",d,l);case 6:return d=Ba(),cb(e.a[l],d,l)}return"???"}function Hb(a,b,d,l){switch(b){case 1:return sprintf("d%d",d);case 2:return sprintf("a%d",d);case 3:return sprintf("-(a%d)",d);case 4:return sprintf("(a%d)+",d);case 5:return a=Nb(ca(Ba())),sprintf("%d(A%d)",a,d);case 6:return sprintf(10==config_da.radix?"#%d":"#"+ab.fmt8,
d);case 7:return a=1==d?Ba():Ia(),sprintf(10==config_da.radix?"#%d":1==d?"#"+ab.fmt16:"#"+ab.fmt32,a);case 8:return b=ab.pc+ab.io,a=0==d?Nb(ca(Ba())):255==d?Nb(Ia()):Nb(lb(d)),config_da.reloc?sprintf("<"+ab.fmt32+">",b+a):sprintf("<%d>",a);case 10:return va(d,l);case 11:return"ccr";case 12:return"sr";case 13:return"usp";case 20:return d=a&2048?e.d[a>>6&7]:a>>6&31,a=a&32?e.d[a&7]&31:a&31,0==a&&(a=32),sprintf("{%d:%d}",d,a);case 21:var f=[0,0,0,0,0,0,0,0];b=[0,0,0,0,0,0,0,0];var h;l="";for(h=0;16>h;h++)a&
1<<(d?15-h:h)&&(8>h?f[h]=1:b[h-8]=1);a=f.indexOf(1);d=f.lastIndexOf(1);-1!=a&&(l+="d"+a,d!=a&&(l+="-d"+d));a=b.indexOf(1);d=b.lastIndexOf(1);-1!=a&&(l.length&&(l+="/"),l+="a"+a,d!=a&&(l+="-a"+d));return l;case 22:return b=a>>12&7,l=W(a&4095),l=l.toLowerCase(),d?a&32768?l+",a"+b:l+",d"+b:a&32768?"a"+b+","+l:"d"+b+","+l;case 23:return d=a>>12&7,Se=a&2048?"muls":"mulu",a&1024?"d"+(a&7)+"-d"+d:"d"+d;case 24:return d=a>>12&7,Se=a&2048?"divs":"divu",a&1024?"d"+(a&7)+":d"+d:"d"+d;case 25:return"FIXME"}}
function la(a){var b=a.mn,b=b.toLowerCase();if("illegal"==b)return b;Se=null;var d="";if(a.d){var e=0==a.d.ext?!1:1==a.d.ext?Ba():Ia();a.d.z?d+="."+ma(a.d.z):a.d.z2&&(d+="."+ma(a.d.z2));a.d.sm&&a.d.dm?(d=d+" "+Hb(e,a.d.sm,a.d.s,a.d.z),d+=",",d+=Hb(e,a.d.dm,a.d.d,a.d.z)):a.d.dm&&(d+=" ",d+=Hb(e,a.d.dm,a.d.d,a.d.z))}return null!==Se?Se+d:b+d}function Ta(a){e.a[7]-=2;Ja(e.a[7],a)}function Bb(a){e.a[7]-=4;Ka(e.a[7],a)}function Ic(){var a=ba(e.a[7]);e.a[7]+=2;return a}function Bc(){var a=La(e.a[7]);e.a[7]+=
4;return a}function yb(a){return a&128?a-256:a}function cc(a){return a&32768?a-65536:a}function Nb(a){return a&2147483648?a-4294967296:a}function lb(a){return a&128?(4294967040|a)>>>0:a}function ca(a){return a&32768?(4294901760|a)>>>0:a}function xa(a,b){var d=a+b;return 4294967295<d?d-4294967296:d}function Mb(a,b,d,l,f){a=0!=(a&l);b=0!=(b&l);l=0!=(d&l);e.v=a&&b&&!l||!a&&!b&&l;e.c=a&&b||!l&&b||a&&!l;e.x=e.c;e.n=l;f?0!=d&&(e.z=!1):e.z=0==d}function Ab(a,b,d,l,f){a=0!=(a&l);b=0!=(b&l);l=0!=(d&l);e.v=
!a&&b&&!l||a&&!b&&l;e.c=a&&!b||l&&!b||a&&l;e.x=e.c;e.n=l;f?0!=d&&(e.z=!1):e.z=0==d}function lc(a,b,d,l){a=0!=(a&l);b=0!=(b&l);l=0!=(d&l);e.v=!a&&b&&!l||a&&!b&&l;e.c=a&&!b||l&&!b||a&&l;e.n=l;e.z=0==d}function Vb(a,b,d,l){a=0!=(a&d);d=0!=(b&d);e.v=a&&d;e.c=a||d;e.x=e.c;e.n=d;l?0!=b&&(e.z=!1):e.z=0==b}function qb(a,b){e.n=0!=(a&b);e.z=0==a;e.v=e.c=!1}function Kc(a){var b=e.d[a.Rx];e.d[a.Rx]=e.d[a.Ry];e.d[a.Ry]=b;M();return a.cyc}function dc(a){var b=e.a[a.Rx];e.a[a.Rx]=e.a[a.Ry];e.a[a.Ry]=b;M();return a.cyc}
function od(a){var b=e.d[a.Rx];e.d[a.Rx]=e.a[a.Ry];e.a[a.Ry]=b;M();return a.cyc}function qd(a){e.a[a.An]=Y[a.ea](4);M();return a.cyc}function tc(a){var b=Y[a.ea](4);Bb(b);M();return a.cyc}function ed(a){var b=ca(Q());Bb(e.a[a.An]);e.a[a.An]=e.a[7];e.a[7]=xa(e.a[7],b);M();return a.cyc}function Rc(a){var b=oc();Bb(e.a[a.An]);e.a[a.An]=e.a[7];e.a[7]=xa(e.a[7],b);M();return a.cyc}function Xc(a){e.a[7]=e.a[a.An];e.a[a.An]=Bc();M();return a.cyc}function Pc(a){var b=Xa[a.sea]();hb[a.dea](b);qb(b,a.zm);M();
return a.cyc}function eb(a){var b=Qa[a.sea]();Na[a.dea](b);qb(b,a.zm);M();return a.cyc}function Fc(a){var b=Va[a.sea]();ob[a.dea](b);qb(b,a.zm);M();return a.cyc}function Qd(a){var b=Qa[a.ea]();e.a[a.An]=ca(b);M();return a.cyc}function Vd(a){var b=Va[a.ea]();e.a[a.An]=b;M();return a.cyc}function fd(a){var b=lb(a.data);e.d[a.Dn]=b;qb(b,a.zm);M();return a.cyc}function bd(a){var b=Q(),d=4==a.ea>>3,l,f=a.ea&7,h=Y[d?16|f:a.ea](2),m,q=d?15:0,v=0;if(d){for(l=m=0;16>l;l++)b&1<<l&&(m+=2);h-=m;68020<=Wa&&(e.a[f]-=
m)}for(l=0;16>l;l++)b&1<<(l^q)&&(8>l?Ja(h,e.d[l]&65535):Ja(h,e.a[l&7]&65535),h+=2,v++);d&&68020>Wa&&(e.a[f]-=m);M();return[a.cyc[0]+4*v,a.cyc[1],v]}function ad(a){var b=Q(),d=4==a.ea>>3,l,f=a.ea&7,h=Y[d?16|f:a.ea](4),m,q=d?15:0,v=0;if(d){for(l=m=0;16>l;l++)b&1<<l&&(m+=4);h-=m;68020<=Wa&&(e.a[f]-=m)}for(l=0;16>l;l++)b&1<<(l^q)&&(8>l?Ka(h,e.d[l]):Ka(h,e.a[l&7]),h+=4,v++);d&&68020>Wa&&(e.a[f]-=m);M();return[a.cyc[0]+8*v,a.cyc[1],2*v]}function Sc(a){for(var b=Q(),d=3==a.ea>>3,l=a.ea&7,f=Y[d?16|l:a.ea](2),
h=0,m=0;16>m;m++)b&1<<m&&(8>m?e.d[m]=ca(ba(f)):e.a[m&7]=ca(ba(f)),f+=2,h++);d&&(e.a[l]=f);M();return[a.cyc[0]+4*h,a.cyc[1]+h,0]}function pd(a){for(var b=Q(),d=3==a.ea>>3,l=a.ea&7,f=Y[d?16|l:a.ea](4),h=0,m=0;16>m;m++)b&1<<m&&(8>m?e.d[m]=La(f):e.a[m&7]=La(f),f+=4,h++);d&&(e.a[l]=f);M();return[a.cyc[0]+8*h,a.cyc[1]+2*h,0]}function jd(a){var b=Q(),d=e.d[a.Dn]&65535,b=xa(e.a[a.An],ca(b));ga(b,d>>8);ga(b+2,d&255);M();return a.cyc}function Tc(a){var b=Q(),d=e.d[a.Dn],b=xa(e.a[a.An],ca(b));ga(b,d>>>24);ga(b+
2,d>>>16&255);ga(b+4,d>>>8&255);ga(b+6,d&255);M();return a.cyc}function le(a){var b=Q(),b=xa(e.a[a.An],ca(b)),b=Ha(b)<<8|ga(b+2);e.d[a.Dn]=e.d[a.Dn]&4294901760|b;M();return a.cyc}function ke(a){var b=Q(),b=xa(e.a[a.An],ca(b)),b=(Ha(b)<<24|Ha(b+2)<<16|Ha(b+4)<<8|ga(b+6))>>>0;e.d[a.Dn]=b;M();return a.cyc}function df(a){var b=Va[a.ea](),d=e.d[a.Dn],l=b+d;4294967295<l&&(l-=4294967296);e.d[a.Dn]=l;Mb(b,d,l,2147483648,!1);M();return a.cyc}function Pd(a){var b=Y[a.ea](4),d=e.d[a.Dn],l=La(b),f=d+l;4294967295<
f&&(f-=4294967296);Ka(b,f);Mb(d,l,f,2147483648,!1);M();return a.cyc}function Ec(a){var b=Qa[a.ea](),d=e.d[a.Dn]&65535,l=b+d;65535<l&&(l-=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|l;Mb(b,d,l,32768,!1);M();return a.cyc}function Db(a){var b=Y[a.ea](2),d=e.d[a.Dn]&65535,l=ba(b),f=d+l;65535<f&&(f-=65536);Ja(b,f);Mb(d,l,f,32768,!1);M();return a.cyc}function ef(a){var b=Xa[a.ea](),d=e.d[a.Dn]&255,l=b+d;255<l&&(l-=256);e.d[a.Dn]=e.d[a.Dn]&4294967040|l;Mb(b,d,l,128,!1);M();return a.cyc}function yf(a){var b=Y[a.ea](1),
d=e.d[a.Dn]&255,l=Ha(b),f=d+l;255<f&&(f-=256);ga(b,f);Mb(d,l,f,128,!1);M();return a.cyc}function A(a){var b=Va[a.ea](),d=e.d[a.Dn],l=d-b;0>l&&(l+=4294967296);e.d[a.Dn]=l;Ab(b,d,l,2147483648,!1);M();return a.cyc}function X(a){var b=Y[a.ea](4),d=e.d[a.Dn],l=La(b),f=l-d;0>f&&(f+=4294967296);Ka(b,f);Ab(d,l,f,2147483648,!1);M();return a.cyc}function oa(a){var b=Qa[a.ea](),d=e.d[a.Dn]&65535,l=d-b;0>l&&(l+=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|l;Ab(b,d,l,32768,!1);M();return a.cyc}function Lc(a){var b=Y[a.ea](2),
d=e.d[a.Dn]&65535,l=ba(b),f=l-d;0>f&&(f+=65536);Ja(b,f);Ab(d,l,f,32768,!1);M();return a.cyc}function Zh(a){var b=Xa[a.ea](),d=e.d[a.Dn]&255,l=d-b;0>l&&(l+=256);e.d[a.Dn]=e.d[a.Dn]&4294967040|l;Ab(b,d,l,128,!1);M();return a.cyc}function O(a){var b=Y[a.ea](1),d=e.d[a.Dn]&255,l=Ha(b),f=l-d;0>f&&(f+=256);ga(b,f);Ab(d,l,f,128,!1);M();return a.cyc}function F(a){var b=Va[a.ea](),d=e.d[a.Dn],l=d-b;0>l&&(l+=4294967296);lc(b,d,l,2147483648);M();return a.cyc}function ec(a){var b=Qa[a.ea](),d=e.d[a.Dn]&65535,
l=d-b;0>l&&(l+=65536);lc(b,d,l,32768);M();return a.cyc}function H(a){var b=Xa[a.ea](),d=e.d[a.Dn]&255,l=d-b;0>l&&(l+=256);lc(b,d,l,128);M();return a.cyc}function Hg(a){ob[a.ea](0);e.z=!0;e.n=e.v=e.c=!1;M();return a.cyc}function hh(a){Na[a.ea](0);e.z=!0;e.n=e.v=e.c=!1;M();return a.cyc}function zg(a){hb[a.ea](0);e.z=!0;e.n=e.v=e.c=!1;M();return a.cyc}function yi(a){var b=e.d[a.Dn],d=0-b;0>d&&(d+=4294967296);e.d[a.Dn]=d;Vb(b,d,2147483648,!1);M();return a.cyc}function zi(a){var b=e.d[a.Dn]&65535,d=0-
b;0>d&&(d+=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|d;Vb(b,d,32768,!1);M();return a.cyc}function Ai(a){var b=e.d[a.Dn]&255,d=0-b;0>d&&(d+=256);e.d[a.Dn]=e.d[a.Dn]&4294967040|d;Vb(b,d,128,!1);M();return a.cyc}function Bi(a){var b=Y[a.ea](4),d=La(b),e=0-d;0>e&&(e+=4294967296);Ka(b,e);Vb(d,e,2147483648,!1);M();return a.cyc}function Ci(a){var b=Y[a.ea](2),d=ba(b),e=0-d;0>e&&(e+=65536);Ja(b,e);Vb(d,e,32768,!1);M();return a.cyc}function Di(a){var b=Y[a.ea](1),d=Ha(b),e=0-d;0>e&&(e+=256);ga(b,e);Vb(d,e,128,
!1);M();return a.cyc}function Ei(a){var b=Qa[a.ea](),d=e.d[a.Dn]&65535,l=b^d;b&32768&&(b=-b+65536);d&32768&&(d=-d+65536);(b*=d)&&l&32768&&(b=-b+4294967296);e.d[a.Dn]=b;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;e.c=!1;M();return a.cyc}function vf(a){var b=Qa[a.ea]()*(e.d[a.Dn]&65535);e.d[a.Dn]=b;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;e.c=!1;M();return a.cyc}function Fi(a){var b=Q(),d=Va[a.ea](),l=b>>12&7,f=e.d[l];if(b&2048){var h=0!=((d^f)&2147483648);d&2147483648&&(d=-d+4294967296);f&2147483648&&(f=-f+
4294967296);32768>d&&32768>f?(d*=f,f=0,d&&h&&(d=-d+4294967296,f=4294967295),e.v=!1):(f=hc(d,f),d=f[0],f=f[1],h&&(f=~f>>>0,d&&(d=-d+4294967296),0==d&&(f++,4294967295<f&&(f-=4294967296))),e.v=0==(b&1024)&&(0!=f||0!=(d&2147483648))&&(4294967295!=(f&4294967295)||2147483648!=(d&2147483648)))}else 65536>d&&65536>f?(d*=f,f=0,e.v=!1):(f=hc(d,f),d=f[0],f=f[1]),e.v=0==(b&1024)&&0!=f;e.d[l]=d;b&1024&&(e.d[b&7]=f);e.n=0!=(f&2147483648);e.z=0==f&&0==d;e.c=!1;M();return a.cyc}function Ik(a){var b=Qa[a.ea]();e.c=
!1;if(0==b)return Pa(5);var d=e.d[a.Dn],l=d,f=(d&2147483648?1:0)^(b&32768?1:0);b&32768&&(b=-b+65536);d&2147483648&&(d=-d+4294967296);var h=d/b>>>0;(f?32768<h:32767<h)?e.v=!0:(b=d%b,h&&f&&(h=-h+65536),b&&b>>15!=l>>>31&&(b=-b+65536),e.d[a.Dn]=b<<16|h,e.v=!1,e.z=0==h,e.n=0!=(h&32768));M();return a.cyc}function Jk(a){var b=Qa[a.ea]();e.c=!1;if(0==b)return Pa(5);var d=e.d[a.Dn],l=d/b>>>0;65535<l?e.v=!0:(e.d[a.Dn]=d%b<<16|l,e.v=!1,e.z=0==l,e.n=0!=(l&32768));M();return a.cyc}function $d(a){var b=Q(),d=Va[a.ea](),
l=b>>12&7,f=b&7,h;e.c=!1;if(0==d)return Pa(5);if(b&2048){if(b&1024){h=e.d[l];var m=e.d[f],q=m,b=0!=((m^d)&2147483648);m&2147483648&&(m=~m>>>0,h&&(h=-h+4294967296),0==h&&(m++,4294967295<m&&(m-=4294967296)));d&2147483648&&(d=-d+4294967296);m=Sb(m,h,d);h=m[1];d=m[2];if(m[0]||b?2147483648<h:2147483647<h)return e.v=!0,M(),a.cyc}else{q=m=e.d[l];b=0!=((m^d)&2147483648);m&2147483648&&(m=-m+4294967296);d&2147483648&&(d=-d+4294967296);h=m/d>>>0;if(b?2147483648<h:2147483647<h)return e.v=!0,M(),a.cyc;d=m%d}h&&
b&&(h=-h+4294967296);d&&(d&2147483648)!=(q&2147483648)&&(d=-d+4294967296)}else if(b&1024){m=Sb(e.d[f],e.d[l],d);if(m[0])return e.v=!0,M(),a.cyc;h=m[1];d=m[2]}else h=e.d[l]/d>>>0,d=e.d[l]%d;e.d[l]=h;f!=l&&(e.d[f]=d);e.v=!1;e.z=0==h;e.n=0!=(h&2147483648);M();return a.cyc}function Hi(a){var b=e.d[a.Ry],d=e.d[a.Rx],l=b+d+(e.x?1:0);4294967295<l&&(l-=4294967296);e.d[a.Rx]=l;Mb(b,d,l,2147483648,!0);M();return a.cyc}function Jj(a){var b=e.d[a.Ry]&65535,d=e.d[a.Rx]&65535,l=b+d+(e.x?1:0);65535<l&&(l-=65536);
e.d[a.Rx]=e.d[a.Rx]&4294901760|l;Mb(b,d,l,32768,!0);M();return a.cyc}function Ij(a){var b=e.d[a.Ry]&255,d=e.d[a.Rx]&255,l=b+d+(e.x?1:0);255<l&&(l-=256);e.d[a.Rx]=e.d[a.Rx]&4294967040|l;Mb(b,d,l,128,!0);M();return a.cyc}function Ii(a){e.a[a.Ry]-=4;var b=La(e.a[a.Ry]);e.a[a.Rx]-=4;var d=La(e.a[a.Rx]),l=b+d+(e.x?1:0);4294967295<l&&(l-=4294967296);Ka(e.a[a.Rx],l);Mb(b,d,l,2147483648,!0);M();return a.cyc}function Lj(a){e.a[a.Ry]-=2;var b=ba(e.a[a.Ry]);e.a[a.Rx]-=2;var d=ba(e.a[a.Rx]),l=b+d+(e.x?1:0);65535<
l&&(l-=65536);Ja(e.a[a.Rx],l);Mb(b,d,l,32768,!0);M();return a.cyc}function Kj(a){e.a[a.Ry]-=jc[1][a.Ry];var b=Ha(e.a[a.Ry]);e.a[a.Rx]-=jc[1][a.Rx];var d=Ha(e.a[a.Rx]),l=b+d+(e.x?1:0);255<l&&(l-=256);ga(e.a[a.Rx],l);Mb(b,d,l,128,!0);M();return a.cyc}function Ji(a){var b=e.d[a.Rx],d=e.d[a.Ry],l=d-b-(e.x?1:0);0>l&&(l+=4294967296);e.d[a.Ry]=l;Ab(b,d,l,2147483648,!0);M();return a.cyc}function Tj(a){var b=e.d[a.Rx]&65535,d=e.d[a.Ry]&65535,l=d-b-(e.x?1:0);0>l&&(l+=65536);e.d[a.Ry]=e.d[a.Ry]&4294901760|l;
Ab(b,d,l,32768,!0);M();return a.cyc}function Sj(a){var b=e.d[a.Rx]&255,d=e.d[a.Ry]&255,l=d-b-(e.x?1:0);0>l&&(l+=256);e.d[a.Ry]=e.d[a.Ry]&4294967040|l;Ab(b,d,l,128,!0);M();return a.cyc}function Ki(a){e.a[a.Rx]-=4;var b=La(e.a[a.Rx]);e.a[a.Ry]-=4;var d=La(e.a[a.Ry]),l=d-b-(e.x?1:0);0>l&&(l+=4294967296);Ka(e.a[a.Ry],l);Ab(b,d,l,2147483648,!0);M();return a.cyc}function Pj(a){e.a[a.Rx]-=2;var b=ba(e.a[a.Rx]);e.a[a.Ry]-=2;var d=ba(e.a[a.Ry]),l=d-b-(e.x?1:0);0>l&&(l+=65536);Ja(e.a[a.Ry],l);Ab(b,d,l,32768,
!0);M();return a.cyc}function Oj(a){e.a[a.Rx]-=jc[1][a.Rx];var b=Ha(e.a[a.Rx]);e.a[a.Ry]-=jc[1][a.Ry];var d=Ha(e.a[a.Ry]),l=d-b-(e.x?1:0);0>l&&(l+=256);ga(e.a[a.Ry],l);Ab(b,d,l,128,!0);M();return a.cyc}function Li(a){var b=e.d[a.Dn],d=0-b-(e.x?1:0);0>d&&(d+=4294967296);e.d[a.Dn]=d;Vb(b,d,2147483648,!0);M();return a.cyc}function Rj(a){var b=e.d[a.Dn]&65535,d=0-b-(e.x?1:0);0>d&&(d+=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|d;Vb(b,d,32768,!0);M();return a.cyc}function Qj(a){var b=e.d[a.Dn]&255,d=0-b-(e.x?
1:0);0>d&&(d+=256);e.d[a.Dn]=e.d[a.Dn]&4294967040|d;Vb(b,d,128,!0);M();return a.cyc}function Mi(a){var b=Y[a.ea](4),d=La(b),l=0-d-(e.x?1:0);0>l&&(l+=4294967296);Ka(b,l);Vb(d,l,2147483648,!0);M();return a.cyc}function Nj(a){var b=Y[a.ea](2),d=ba(b),l=0-d-(e.x?1:0);0>l&&(l+=65536);Ja(b,l);Vb(d,l,32768,!0);M();return a.cyc}function Mj(a){var b=Y[a.ea](1),d=Ha(b),l=0-d-(e.x?1:0);0>l&&(l+=256);ga(b,l);Vb(d,l,128,!0);M();return a.cyc}function Ni(a){var b=Va[a.ea]()+e.a[a.An];4294967295<b&&(b-=4294967296);
e.a[a.An]=b;M();return a.cyc}function bk(a){var b=ca(Qa[a.ea]())+e.a[a.An];4294967295<b&&(b-=4294967296);e.a[a.An]=b;M();return a.cyc}function ak(a){var b=Va[a.ea](),b=e.a[a.An]-b;0>b&&(b+=4294967296);e.a[a.An]=b;M();return a.cyc}function Oi(a){var b=ca(Qa[a.ea]()),b=e.a[a.An]-b;0>b&&(b+=4294967296);e.a[a.An]=b;M();return a.cyc}function Xj(a){var b=Va[a.ea](),d=e.a[a.An],l=d-b;0>l&&(l+=4294967296);lc(b,d,l,2147483648);M();return a.cyc}function Wj(a){var b=ca(Qa[a.ea]()),d=e.a[a.An],l=d-b;0>l&&(l+=
4294967296);lc(b,d,l,2147483648);M();return a.cyc}function Pi(a){var b=oc(),d=e.d[a.Dn],l=b+d;4294967295<l&&(l-=4294967296);e.d[a.Dn]=l;Mb(b,d,l,2147483648,!1);M();return a.cyc}function Zj(a){var b=Q(),d=e.d[a.Dn]&65535,l=b+d;65535<l&&(l-=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|l;Mb(b,d,l,32768,!1);M();return a.cyc}function Yj(a){var b=Q()&255,d=e.d[a.Dn]&255,l=b+d;255<l&&(l-=256);e.d[a.Dn]=e.d[a.Dn]&4294967040|l;Mb(b,d,l,128,!1);M();return a.cyc}function Qi(a){var b=oc(),d=Y[a.ea](4),e=La(d),f=b+e;
4294967295<f&&(f-=4294967296);Ka(d,f);Mb(b,e,f,2147483648,!1);M();return a.cyc}function Vj(a){var b=Q(),d=Y[a.ea](2),e=ba(d),f=b+e;65535<f&&(f-=65536);Ja(d,f);Mb(b,e,f,32768,!1);M();return a.cyc}function Uj(a){var b=Q()&255,d=Y[a.ea](1),e=Ha(d),f=b+e;255<f&&(f-=256);ga(d,f);Mb(b,e,f,128,!1);M();return a.cyc}function ck(a){var b=oc(),d=e.d[a.Dn],l=d-b;0>l&&(l+=4294967296);e.d[a.Dn]=l;Ab(b,d,l,2147483648,!1);M();return a.cyc}function kk(a){var b=Q(),d=e.d[a.Dn]&65535,l=d-b;0>l&&(l+=65536);e.d[a.Dn]=
e.d[a.Dn]&4294901760|l;Ab(b,d,l,32768,!1);M();return a.cyc}function gk(a){var b=Q()&255,d=e.d[a.Dn]&255,l=d-b;0>l&&(l+=256);e.d[a.Dn]=e.d[a.Dn]&4294967040|l;Ab(b,d,l,128,!1);M();return a.cyc}function sk(a){var b=oc(),d=Y[a.ea](4),e=La(d),f=e-b;0>f&&(f+=4294967296);Ka(d,f);Ab(b,e,f,2147483648,!1);M();return a.cyc}function ok(a){var b=Q(),d=Y[a.ea](2),e=ba(d),f=e-b;0>f&&(f+=65536);Ja(d,f);Ab(b,e,f,32768,!1);M();return a.cyc}function dk(a){var b=Q()&255,d=Y[a.ea](1),e=Ha(d),f=e-b;0>f&&(f+=256);ga(d,
f);Ab(b,e,f,128,!1);M();return a.cyc}function lk(a){var b=oc(),d=Va[a.ea](),e=d-b;0>e&&(e+=4294967296);lc(b,d,e,2147483648);M();return a.cyc}function hk(a){var b=Q(),d=Qa[a.ea](),e=d-b;0>e&&(e+=65536);lc(b,d,e,32768);M();return a.cyc}function tk(a){var b=Q()&255,d=Xa[a.ea](),e=d-b;0>e&&(e+=256);lc(b,d,e,128);M();return a.cyc}function pk(a){var b=a.data,d=e.d[a.Dn],l=b+d;4294967295<l&&(l-=4294967296);e.d[a.Dn]=l;Mb(b,d,l,2147483648,!1);M();return a.cyc}function Vi(a){var b=a.data+e.a[a.An];4294967295<
b&&(b-=4294967296);e.a[a.An]=b;M();return a.cyc}function gj(a){var b=Y[a.ea](4),d=a.data,e=La(b),f=d+e;4294967295<f&&(f-=4294967296);Ka(b,f);Mb(d,e,f,2147483648,!1);M();return a.cyc}function aj(a){var b=a.data,d=e.d[a.Dn]&65535,l=b+d;65535<l&&(l-=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|l;Mb(b,d,l,32768,!1);M();return a.cyc}function sj(a){var b=Y[a.ea](2),d=a.data,e=ba(b),f=d+e;65535<f&&(f-=65536);Ja(b,f);Mb(d,e,f,32768,!1);M();return a.cyc}function mj(a){var b=a.data,d=e.d[a.Dn]&255,l=b+d;255<l&&(l-=
256);e.d[a.Dn]=e.d[a.Dn]&4294967040|l;Mb(b,d,l,128,!1);M();return a.cyc}function Ej(a){var b=Y[a.ea](1),d=a.data,e=Ha(b),f=d+e;255<f&&(f-=256);ga(b,f);Mb(d,e,f,128,!1);M();return a.cyc}function yj(a){var b=a.data,d=e.d[a.Dn],l=d-b;0>l&&(l+=4294967296);e.d[a.Dn]=l;Ab(b,d,l,2147483648,!1);M();return a.cyc}function Ti(a){var b=e.a[a.An]-a.data;0>b&&(b+=4294967296);e.a[a.An]=b;M();return a.cyc}function ej(a){var b=Y[a.ea](4),d=a.data,e=La(b),f=e-d;0>f&&(f+=4294967296);Ka(b,f);Ab(d,e,f,2147483648,!1);
M();return a.cyc}function Zi(a){var b=a.data,d=e.d[a.Dn]&65535,l=d-b;0>l&&(l+=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|l;Ab(b,d,l,32768,!1);M();return a.cyc}function qj(a){var b=Y[a.ea](2),d=a.data,e=ba(b),f=e-d;0>f&&(f+=65536);Ja(b,f);Ab(d,e,f,32768,!1);M();return a.cyc}function kj(a){var b=a.data,d=e.d[a.Dn]&255,l=d-b;0>l&&(l+=256);e.d[a.Dn]=e.d[a.Dn]&4294967040|l;Ab(b,d,l,128,!1);M();return a.cyc}function Cj(a){var b=Y[a.ea](1),d=a.data,e=Ha(b),f=e-d;0>f&&(f+=256);ga(b,f);Ab(d,e,f,128,!1);M();return a.cyc}
function wj(a){var b=La(e.a[a.Ay]);e.a[a.Ay]+=4;var d=La(e.a[a.Ax]);e.a[a.Ax]+=4;var l=d-b;0>l&&(l+=4294967296);lc(b,d,l,2147483648);M();return a.cyc}function Ui(a){var b=ba(e.a[a.Ay]);e.a[a.Ay]+=2;var d=ba(e.a[a.Ax]);e.a[a.Ax]+=2;var l=d-b;0>l&&(l+=65536);lc(b,d,l,32768);M();return a.cyc}function fj(a){var b=Ha(e.a[a.Ay]);e.a[a.Ay]+=jc[1][a.Ay];var d=Ha(e.a[a.Ax]);e.a[a.Ax]+=jc[1][a.Ax];var l=d-b;0>l&&(l+=256);lc(b,d,l,128);M();return a.cyc}function $i(a){var b=e.d[a.Dn]&255,b=b&128?65280|b:b;e.d[a.Dn]=
e.d[a.Dn]&4294901760|b;qb(b,32768);M();return a.cyc}function rj(a){var b=e.d[a.Dn]&65535,b=b&32768?(4294901760|b)>>>0:b;e.d[a.Dn]=b;qb(b,2147483648);M();return a.cyc}function lj(a){var b=e.d[a.Dn]&255,b=b&128?(4294967040|b)>>>0:b;e.d[a.Dn]=b;qb(b,2147483648);M();return a.cyc}function Dj(a){var b=(Va[a.ea]()&e.d[a.Dn])>>>0;e.d[a.Dn]=b;qb(b,a.zm);M();return a.cyc}function xj(a){var b=Qa[a.ea]()&e.d[a.Dn]&65535;e.d[a.Dn]=e.d[a.Dn]&4294901760|b;qb(b,a.zm);M();return a.cyc}function ek(a){var b=Xa[a.ea]()&
e.d[a.Dn]&255;e.d[a.Dn]=e.d[a.Dn]&4294967040|b;qb(b,a.zm);M();return a.cyc}function mk(a){var b=Y[a.ea](4),d=(e.d[a.Dn]&La(b))>>>0;Ka(b,d);qb(d,a.zm);M();return a.cyc}function ik(a){var b=Y[a.ea](2),d=e.d[a.Dn]&65535&ba(b);Ja(b,d);qb(d,a.zm);M();return a.cyc}function uk(a){var b=Y[a.ea](1),d=e.d[a.Dn]&255&Ha(b);ga(b,d);qb(d,a.zm);M();return a.cyc}function qk(a){var b=(e.d[a.Dd]^e.d[a.Dn])>>>0;e.d[a.Dd]=b;qb(b,a.zm);M();return a.cyc}function fk(a){var b=e.d[a.Dd]&65535^e.d[a.Dn]&65535;e.d[a.Dd]=e.d[a.Dd]&
4294901760|b;qb(b,a.zm);M();return a.cyc}function nk(a){var b=e.d[a.Dd]&255^e.d[a.Dn]&255;e.d[a.Dd]=e.d[a.Dd]&4294967040|b;qb(b,a.zm);M();return a.cyc}function jk(a){var b=Y[a.ea](4),d=(La(b)^e.d[a.Dn])>>>0;Ka(b,d);qb(d,a.zm);M();return a.cyc}function vk(a){var b=Y[a.ea](2),d=ba(b)^e.d[a.Dn]&65535;Ja(b,d);qb(d,a.zm);M();return a.cyc}function rk(a){var b=Y[a.ea](1),d=Ha(b)^e.d[a.Dn]&255;ga(b,d);qb(d,a.zm);M();return a.cyc}function Yi(a){var b=~e.d[a.Dn]>>>0;e.d[a.Dn]=b;qb(b,a.zm);M();return a.cyc}
function jj(a){var b=~(e.d[a.Dn]&65535)&a.m;e.d[a.Dn]=e.d[a.Dn]&4294901760|b;qb(b,a.zm);M();return a.cyc}function dj(a){var b=~(e.d[a.Dn]&255)&a.m;e.d[a.Dn]=e.d[a.Dn]&4294967040|b;qb(b,a.zm);M();return a.cyc}function vj(a){var b=Y[a.ea](4),d=~La(b)>>>0;Ka(b,d);qb(d,a.zm);M();return a.cyc}function pj(a){var b=Y[a.ea](2),d=~ba(b)&a.m;Ja(b,d);qb(d,a.zm);M();return a.cyc}function Hj(a){var b=Y[a.ea](1),d=~Ha(b)&a.m;ga(b,d);qb(d,a.zm);M();return a.cyc}function Bj(a){var b=(Va[a.ea]()|e.d[a.Dn])>>>0;e.d[a.Dn]=
b;qb(b,a.zm);M();return a.cyc}function Wi(a){var b=Qa[a.ea]()|e.d[a.Dn]&65535;e.d[a.Dn]=e.d[a.Dn]&4294901760|b;qb(b,a.zm);M();return a.cyc}function hj(a){var b=Xa[a.ea]()|e.d[a.Dn]&255;e.d[a.Dn]=e.d[a.Dn]&4294967040|b;qb(b,a.zm);M();return a.cyc}function bj(a){var b=Y[a.ea](4),d=(e.d[a.Dn]|La(b))>>>0;Ka(b,d);qb(d,a.zm);M();return a.cyc}function tj(a){var b=Y[a.ea](2),d=e.d[a.Dn]&65535|ba(b);Ja(b,d);qb(d,a.zm);M();return a.cyc}function nj(a){var b=Y[a.ea](1),d=e.d[a.Dn]&255|Ha(b);ga(b,d);qb(d,a.zm);
M();return a.cyc}function Fj(a){var b=(oc()&e.d[a.Dn])>>>0;e.d[a.Dn]=b;qb(b,a.zm);M();return a.cyc}function zj(a){var b=Q()&e.d[a.Dn]&65535;e.d[a.Dn]=e.d[a.Dn]&4294901760|b;qb(b,a.zm);M();return a.cyc}function Xi(a){var b=Q()&255&e.d[a.Dn]&255;e.d[a.Dn]=e.d[a.Dn]&4294967040|b;qb(b,a.zm);M();return a.cyc}function ij(a){var b=oc(),d=Y[a.ea](4),e=La(d),b=(b&e)>>>0;Ka(d,b);qb(b,a.zm);M();return a.cyc}function cj(a){var b=Q(),d=Y[a.ea](2),e=ba(d),b=b&e;Ja(d,b);qb(b,a.zm);M();return a.cyc}function uj(a){var b=
Q()&255,d=Y[a.ea](1),e=Ha(d),b=b&e;ga(d,b);qb(b,a.zm);M();return a.cyc}function oj(a){var b=(oc()^e.d[a.Dn])>>>0;e.d[a.Dn]=b;qb(b,a.zm);M();return a.cyc}function Gj(a){var b=Q()^e.d[a.Dn]&65535;e.d[a.Dn]=e.d[a.Dn]&4294901760|b;qb(b,a.zm);M();return a.cyc}function Aj(a){var b=Q()&255^e.d[a.Dn]&255;e.d[a.Dn]=e.d[a.Dn]&4294967040|b;qb(b,a.zm);M();return a.cyc}function Zb(a){var b=oc(),d=Y[a.ea](4),e=La(d),b=(b^e)>>>0;Ka(d,b);qb(b,a.zm);M();return a.cyc}function we(a){var b=Q(),d=Y[a.ea](2),e=ba(d),b=
b^e;Ja(d,b);qb(b,a.zm);M();return a.cyc}function $h(a){var b=Q()&255,d=Y[a.ea](1),e=Ha(d),b=b^e;ga(d,b);qb(b,a.zm);M();return a.cyc}function Mc(a){var b=(oc()|e.d[a.Dn])>>>0;e.d[a.Dn]=b;qb(b,a.zm);M();return a.cyc}function pe(a){var b=Q()|e.d[a.Dn]&65535;e.d[a.Dn]=e.d[a.Dn]&4294901760|b;qb(b,a.zm);M();return a.cyc}function Jh(a){var b=Q()&255|e.d[a.Dn]&255;e.d[a.Dn]=e.d[a.Dn]&4294967040|b;qb(b,a.zm);M();return a.cyc}function Gc(a){var b=oc(),d=Y[a.ea](4),e=La(d),b=(b|e)>>>0;Ka(d,b);qb(b,a.zm);M();
return a.cyc}function hi(a){var b=Q(),d=Y[a.ea](2),e=ba(d),b=b|e;Ja(d,b);qb(b,a.zm);M();return a.cyc}function yh(a){var b=Q()&255,d=Y[a.ea](1),e=Ha(d),b=b|e;ga(d,b);qb(b,a.zm);M();return a.cyc}function zh(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;if(d){var l=~((1<<32-d)-1)>>>0;e.x=e.c=0!=(b&1<<32-d);e.v=0!=(b&2147483648)?(b&l)>>>0!=l:0!=(b&l)>>>0;b=(b<<d&4294967295)>>>0;e.d[a.Dy]=b}else e.v=e.c=!1;e.n=0!=(b&2147483648);e.z=0==b;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function fi(a){var b=e.d[a.Dy]&
65535,d=a.ir?e.d[a.cr]&63:a.cr;if(d){var l=~((1<<16-d)-1)&65535;e.x=e.c=0!=(b&1<<16-d);e.v=0!=(b&32768)?(b&l)!=l:0!=(b&l);b=(b<<d&65535)>>>0;e.d[a.Dy]=e.d[a.Dy]&4294901760|b}else e.v=e.c=!1;e.n=0!=(b&32768);e.z=0==b;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function gi(a){var b=e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:a.cr;if(d){var l=~((1<<8-d)-1)&255;e.x=e.c=0!=(b&1<<8-d);e.v=0!=(b&128)?(b&l)!=l:0!=(b&l);b=(b<<d&255)>>>0;e.d[a.Dy]=e.d[a.Dy]&4294967040|b}else e.v=e.c=!1;e.n=0!=(b&128);e.z=0==b;M();return[a.cyc[0]+
2*d,a.cyc[1],a.cyc[2]]}function hg(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;d?(e.x=e.c=0!=(b&1<<d-1),b=b>>d>>>0,e.d[a.Dy]=b):e.c=!1;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function Pb(a){var b=e.d[a.Dy]&65535,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.x=e.c=0!=(b&1<<d-1),b=ca(b),b=(b>>d&65535)>>>0,e.d[a.Dy]=e.d[a.Dy]&4294901760|b):e.c=!1;e.n=0!=(b&32768);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function ib(a){var b=e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:
a.cr;d?(e.x=e.c=0!=(b&1<<d-1),b=lb(b),b=(b>>d&255)>>>0,e.d[a.Dy]=e.d[a.Dy]&4294967040|b):e.c=!1;e.n=0!=(b&128);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function Jg(a){var b=Y[a.ea](2),d=ba(b);e.x=e.c=0!=(d&32768);e.v=e.c!=(0!=(d&16384));d=d<<1&65535;e.n=0!=(d&32768);e.z=0==d;Ja(b,d);M();return a.cyc}function qh(a){var b=Y[a.ea](2),d=ba(b);e.x=e.c=0!=(d&1);e.v=!1;d=d&32768|d>>1;e.n=0!=(d&32768);e.z=0==d;Ja(b,d);M();return a.cyc}function rh(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;
d?(e.x=e.c=0!=(b&1<<32-d),b=(b<<d&4294967295)>>>0,e.d[a.Dy]=b):e.c=!1;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function Vc(a){var b=e.d[a.Dy]&65535,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.x=e.c=0!=(b&1<<16-d),b=(b<<d&65535)>>>0,e.d[a.Dy]=e.d[a.Dy]&4294901760|b):e.c=!1;e.n=0!=(b&32768);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function Wc(a){var b=e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.x=e.c=0!=(b&1<<8-d),b=(b<<d&255)>>>0,e.d[a.Dy]=e.d[a.Dy]&4294967040|
b):e.c=!1;e.n=0!=(b&128);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function xc(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;d?(e.x=e.c=0!=(b&1<<d-1),b>>>=d,e.d[a.Dy]=b):e.c=!1;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function yc(a){var b=e.d[a.Dy]&65535,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.x=e.c=0!=(b&1<<d-1),b>>=d,e.d[a.Dy]=e.d[a.Dy]&4294901760|b):e.c=!1;e.n=0!=(b&32768);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function zc(a){var b=
e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.x=e.c=0!=(b&1<<d-1),b>>=d,e.d[a.Dy]=e.d[a.Dy]&4294967040|b):e.c=!1;e.n=0!=(b&128);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function Ac(a){var b=Y[a.ea](2),d=ba(b);e.x=e.c=0!=(d&32768);d=d<<1&65535;e.n=0!=(d&32768);e.z=0==d;e.v=!1;Ja(b,d);M();return a.cyc}function Kg(a){var b=Y[a.ea](2),d=ba(b);e.x=e.c=0!=(d&1);d>>=1;e.n=0!=(d&32768);e.z=0==d;e.v=!1;Ja(b,d);M();return a.cyc}function oi(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=
0!=(b&1<<32-d),b=((b<<d|b>>>32-d)&4294967295)>>>0,e.d[a.Dy]=b):e.c=!1;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function ra(a){var b=e.d[a.Dy]&65535,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<16-d),b=((b<<d|b>>16-d)&65535)>>>0,e.d[a.Dy]=e.d[a.Dy]&4294901760|b):e.c=!1;e.n=0!=(b&32768);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function ci(a){var b=e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<8-d),b=((b<<d|b>>8-d)&255)>>>0,e.d[a.Dy]=e.d[a.Dy]&
4294967040|b):e.c=!1;e.n=0!=(b&128);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function ub(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<d-1),b=((b<<32-d|b>>>d)&4294967295)>>>0,e.d[a.Dy]=b):e.c=!1;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function aa(a){var b=e.d[a.Dy]&65535,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<d-1),b=((b<<16-d|b>>>d)&65535)>>>0,e.d[a.Dy]=e.d[a.Dy]&4294901760|b):e.c=!1;e.n=0!=(b&32768);e.z=0==b;e.v=!1;M();return[a.cyc[0]+
2*d,a.cyc[1],a.cyc[2]]}function da(a){var b=e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<d-1),b=((b<<8-d|b>>>d)&255)>>>0,e.d[a.Dy]=e.d[a.Dy]&4294967040|b):e.c=!1;e.n=0!=(b&128);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function Af(a){var b=Y[a.ea](2),d=ba(b);e.c=0!=(d&32768);d=d<<1&65535|(e.c?1:0);e.n=0!=(d&32768);e.z=0==d;e.v=!1;Ja(b,d);M();return a.cyc}function Bf(a){var b=Y[a.ea](2),d=ba(b);e.c=0!=(d&1);d=(e.c?32768:0)|d>>1;e.n=0!=(d&32768);e.z=0==d;e.v=!1;Ja(b,d);M();
return a.cyc}function ic(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<32-d),b=(((b<<d|b>>>32-d)&4294967295)>>>0&4294967294|(e.x?1:0))>>>0,e.d[a.Dy]=b,e.x=e.c):e.c=e.x;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function nh(a){var b=e.d[a.Dy]&65535,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<16-d),b=(b<<d|b>>16-d)&65534|(e.x?1:0),e.d[a.Dy]=e.d[a.Dy]&4294901760|b,e.x=e.c):e.c=e.x;e.n=0!=(b&32768);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}
function mh(a){var b=e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<8-d),b=(b<<d|b>>8-d)&254|(e.x?1:0),e.d[a.Dy]=e.d[a.Dy]&4294967040|b,e.x=e.c):e.c=e.x;e.n=0!=(b&128);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function lh(a){var b=e.d[a.Dy],d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<d-1),b=((e.x?2147483648:0)|((b<<32-d|b>>>d)&4294967295)>>>0&2147483647)>>>0,e.d[a.Dy]=b,e.x=e.c):e.c=e.x;e.n=0!=(b&2147483648);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function dg(a){var b=
e.d[a.Dy]&65535,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<d-1),b=(e.x?32768:0)|(b<<16-d|b>>>d)&32767,e.d[a.Dy]=e.d[a.Dy]&4294901760|b,e.x=e.c):e.c=e.x;e.n=0!=(b&32768);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function th(a){var b=e.d[a.Dy]&255,d=a.ir?e.d[a.cr]&63:a.cr;d?(e.c=0!=(b&1<<d-1),b=(e.x?128:0)|(b<<8-d|b>>>d)&127,e.d[a.Dy]=e.d[a.Dy]&4294967040|b,e.x=e.c):e.c=e.x;e.n=0!=(b&128);e.z=0==b;e.v=!1;M();return[a.cyc[0]+2*d,a.cyc[1],a.cyc[2]]}function fg(a){var b=Y[a.ea](2),d=ba(b);
e.c=0!=(d&32768);d=d<<1&65535|(e.x?1:0);e.x=e.c;e.n=0!=(d&32768);e.z=0==d;e.v=!1;Ja(b,d);M();return a.cyc}function vh(a){var b=Y[a.ea](2),d=ba(b);e.c=0!=(d&1);d=(e.x?32768:0)|d>>1;e.x=e.c;e.n=0!=(d&32768);e.z=0==d;e.v=!1;Ja(b,d);M();return a.cyc}function eg(a){var b=e.d[a.Dn],b=((b&65535)<<16|b>>>16)>>>0;e.d[a.Dn]=b;e.n=0!=(b&2147483648);e.z=0==b;e.v=e.c=!1;M();return a.cyc}function uh(a){var b=e.d[a.Dd],d=1<<(e.d[a.Dn]&31)>>>0;e.z=0==(b&d);e.d[a.Dd]=(b^d)>>>0;M();return a.cyc}function S(a){var b=
Y[a.ea](1),d=e.d[a.Dn]&7,l=Ha(b),d=1<<d;e.z=0==(l&d);ga(b,l^d);M();return a.cyc}function bi(a){var b=Q()&31,d=e.d[a.Dd],b=1<<b>>>0;e.z=0==(d&b);e.d[a.Dd]=(d^b)>>>0;M();return a.cyc}function C(a){var b=Q()&7,d=Y[a.ea](1),l=Ha(d),b=1<<b;e.z=0==(l&b);ga(d,l^b);M();return a.cyc}function fb(a){var b=e.d[a.Dd],d=1<<(e.d[a.Dn]&31)>>>0;e.z=0==(b&d);e.d[a.Dd]=(b&~d)>>>0;M();return a.cyc}function D(a){var b=Y[a.ea](1),d=e.d[a.Dn]&7,l=Ha(b),d=1<<d;e.z=0==(l&d);ga(b,l&~d);M();return a.cyc}function If(a){var b=
Q()&31,d=e.d[a.Dd],b=1<<b>>>0;e.z=0==(d&b);e.d[a.Dd]=(d&~b)>>>0;M();return a.cyc}function Ye(a){var b=Q()&7,d=Y[a.ea](1),l=Ha(d),b=1<<b;e.z=0==(l&b);ga(d,l&~b);M();return a.cyc}function Ze(a){var b=e.d[a.Dd],d=1<<(e.d[a.Dn]&31)>>>0;e.z=0==(b&d);e.d[a.Dd]=(b|d)>>>0;M();return a.cyc}function Jf(a){var b=Y[a.ea](1),d=e.d[a.Dn]&7,l=Ha(b),d=1<<d;e.z=0==(l&d);ga(b,l|d);M();return a.cyc}function yd(a){var b=Q()&31,d=e.d[a.Dd],b=1<<b>>>0;e.z=0==(d&b);e.d[a.Dd]=(d|b)>>>0;M();return a.cyc}function $c(a){var b=
Q()&7,d=Y[a.ea](1),l=Ha(d),b=1<<b;e.z=0==(l&b);ga(d,l|b);M();return a.cyc}function ya(a){e.z=0==(e.d[a.Dd]&1<<(e.d[a.Dn]&31)>>>0);M();return a.cyc}function Kk(a){var b=e.d[a.Dn]&7,d=Xa[a.ea]();e.z=0==(d&1<<b);M();return a.cyc}function Ma(a){var b=Q()&31;e.z=0==(e.d[a.Dd]&1<<b>>>0);M();return a.cyc}function B(a){var b=Q()&7,d=Xa[a.ea]();e.z=0==(d&1<<b);M();return a.cyc}function Ad(a){var b=Q(),d=b&2048?e.d[b>>6&7]:b>>6&31,l=b&32?e.d[b&7]&31:b&31;0==l&&(l=32);var f,h=[0,0];if(0==a.ea>>3)f=e.d[a.ea&
7],d&=31,f=(f<<d|f>>>32-d)>>>0,h[0]=(f&(1<<32-l)-1)>>>0;else{d&2147483648&&(d-=4294967296);addr=Y[a.ea](1);d&&(addr+=Math.truncate(d/8));var h=addr,m=Math.abs(d),q=l,v=[0,0];offs=m&7;m=4294967295<<32-q>>>0;switch(offs+q+7>>3){case 1:q=Ha(h);f=q<<24+offs;v[0]=q&~(m>>>24+offs);break;case 2:q=ba(h);f=q<<16+offs;v[0]=q&~(m>>>16+offs);break;case 3:q=ba(h);f=q<<16+offs;v[0]=q&~(m>>>16+offs);q=Ha(h+2);f|=q<<8+offs;v[1]=q&~(m>>>8+offs);break;case 4:q=La(h);f=q<<offs;v[0]=q&~(m>>>offs);break;case 5:q=La(h);
f=q<<offs;v[0]=q&~(m>>>offs);q=Ha(h+4);f|=q>>8-offs;v[1]=q&~(m<<8-offs);break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.get_bitfield2() invalid mode (%d)",offs+q+7>>3)}h=[f>>>0,v];f=h[0];h=h[1]}e.n=0!=(f&2147483648);f=3==a.id?f>>32-l:f>>>32-l;e.z=0==f;e.v=!1;e.c=!1;switch(a.id){case 4:case 3:e.d[b>>12&7]=f;break;case 1:f=(f^4294967295>>>32-l)>>>0;break;case 2:f=0;break;case 5:for(v=1<<l-1>>>0;v&&!(f&v);)v>>>=1,d++;0>d&&(d+=4294967296);e.d[b>>12&7]=d;break;case 7:f=4294967295>>>32-l;break;case 6:f=
e.d[b>>12&7]&4294967295>>>32-l,e.n=0!=(f&1<<l-1),e.z=0==f}if(1==a.id||2==a.id||7==a.id||6==a.id)if(0==a.ea>>3)f=h[0]|f<<32-l,e.d[a.ea&7]=f>>>d|f<<32-d;else switch(b=addr,v=Math.abs(d),d=h,offs=(v&7)+l,offs+7>>3){case 1:d=(d[0]|f<<8-offs)>>>0&255;ga(b,d);break;case 2:l=(d[0]|f<<16-offs)>>>0&65535;Ja(b,l);break;case 3:l=(d[0]|f>>offs-16)>>>0&65535;d=(d[1]|f<<24-offs)>>>0&255;Ja(b,l);ga(b+2,d);break;case 4:l=(d[0]|f<<32-offs)>>>0;Ka(b,l);break;case 5:l=(d[0]|f>>offs-32)>>>0;d=(d[1]|f<<40-offs)>>>0&255;
Ka(b,l);ga(b+4,d);break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.put_bitfield2() invalid mode (%d)",offs+7>>3)}M();return a.cyc}function Ug(a){var b=e.d[a.Ry]&255,d=e.d[a.Rx]&255,l=(b&15)+(d&15)+(e.x?1:0),b=(b&240)+(d&240)+l;9<l&&(b+=6);144<(b&1008)?(b=b+96&255,e.x=e.c=!0):e.x=e.c=!1;b&&(e.z=!1);e.d[a.Rx]=e.d[a.Rx]&4294967040|b;M();return a.cyc}function Hf(a){e.a[a.Ry]-=jc[1][a.Ry];var b=Ha(e.a[a.Ry]);e.a[a.Rx]-=jc[1][a.Rx];var d=Ha(e.a[a.Rx]),l=(b&15)+(d&15)+(e.x?1:0),b=(b&240)+(d&240)+l;9<l&&(b+=
6);144<(b&1008)?(b=b+96&255,e.x=e.c=!0):e.x=e.c=!1;b&&(e.z=!1);ga(e.a[a.Rx],b);M();return a.cyc}function zd(a){var b=e.d[a.Rx]&255,d=e.d[a.Ry]&255,l=(d&15)-(b&15)-(e.x?1:0),f=(d&240)-(b&240)+l,h=0;l&240&&(f-=6,h=6);255<((d&255)-(b&255)-(e.x?1:0)&256)&&(f=f-96&255);e.x=e.c=255<((d&255)-(b&255)-h-(e.x?1:0)&768);f&&(e.z=!1);e.d[a.Ry]=e.d[a.Ry]&4294967040|f;M();return a.cyc}function wh(a){e.a[a.Rx]-=jc[1][a.Rx];var b=Ha(e.a[a.Rx]);e.a[a.Ry]-=jc[1][a.Ry];var d=Ha(e.a[a.Ry]),l=(d&15)-(b&15)-(e.x?1:0),f=
(d&240)-(b&240)+l,h=0;l&240&&(f-=6,h=6);255<((d&255)-(b&255)-(e.x?1:0)&256)&&(f=f-96&255);e.x=e.c=255<((d&255)-(b&255)-h-(e.x?1:0)&768);f&&(e.z=!1);ga(e.a[a.Ry],f);M();return a.cyc}function Pg(a){var b=e.d[a.Dd]&255,d=-(b&15)-(e.x?1:0);9<d&&(d-=6);b=-(b&240)+d;144<(b&496)?(b=b-96&255,e.x=e.c=!0):e.x=e.c=!1;b&&(e.z=!1);e.d[a.Dd]=e.d[a.Dd]&4294967040|b;M();return a.cyc}function fc(a){var b=Y[a.ea](1),d=Ha(b),l=-(d&15)-(e.x?1:0);9<l&&(l-=6);d=-(d&240)+l;144<(d&496)?(d=d-96&255,e.x=e.c=!0):e.x=e.c=!1;
d&&(e.z=!1);ga(b,d);M();return a.cyc}function re(a){var b=Q(),b=(e.d[a.Rx]&65535)+b;65535<b&&(b-=65536);e.d[a.Ry]=e.d[a.Ry]&4294967040|b>>4&240|b&15;M();return a.cyc}function He(a){var b=Q();e.a[a.Rx]-=jc[1][a.Rx];var d=Ha(e.a[a.Rx]);e.a[a.Rx]-=jc[1][a.Rx];var l=Ha(e.a[a.Rx]),b=((d&15)<<8|l&15)+b;65535<b&&(b-=65536);e.a[a.Ry]-=jc[1][a.Ry];ga(e.a[a.Ry],b>>4&240|b&15);M();return a.cyc}function Ge(a){var b=Q(),d=e.d[a.Rx]&65535,b=(d<<4&3840|d&15)+b;65535<b&&(b-=65536);e.d[a.Ry]=e.d[a.Ry]&4294901760|
b;M();return a.cyc}function Wb(a){var b=Q();e.a[a.Rx]-=jc[1][a.Rx];var d=Ha(e.a[a.Rx]),b=(d<<4&3840|d&15)+b;65535<b&&(b-=65536);e.a[a.Ry]-=jc[1][a.Ry];ga(e.a[a.Ry],b>>8);e.a[a.Ry]-=jc[1][a.Ry];ga(e.a[a.Ry],b&255);M();return a.cyc}function vd(a){var b=rc(),d;0==a.dp?d=Q():255==a.dp&&(d=oc());if(Hc[a.cc]()){b=0==a.dp?xa(b,ca(d)):255==a.dp?xa(b,d):xa(b,lb(a.dp));if(b&1)return Za(a.op,b);Ed(b);return a.cycTaken}M();return a.cyc}function xe(a){var b=rc(),d=Q();if(Hc[a.cc]())a=a.cycNotTakenTrue;else{var l=
(e.d[a.Dn]&65535)-1;0>l&&(l+=65536);e.d[a.Dn]=e.d[a.Dn]&4294901760|l;if(65535!=l){b=xa(b,ca(d));if(b&1)return Za(a.op,b);Ed(b);return a.cyc}a=a.cycNotTakenFalse}M();return a}function Ue(a){var b=0==a.ea>>3,d=Hc[a.cc]();if(b){var l=a.ea&7;e.d[l]=e.d[l]&4294967040|(d?255:0)}else l=Y[a.ea](1),68020>Wa&&Ha(l),ga(l,d?255:0);M();return d?b?a.cycTrue:a.cyc:b?a.cycFalse:a.cyc}function oe(a){var b,d=rc();b=0==a.dp?ca(Q()):255==a.dp?oc():lb(a.dp);d=xa(d,b);if(d&1)return Za(a.op,d);Ed(d);return a.cyc}function Be(a){var b,
d=rc();b=0==a.dp?ca(Q()):255==a.dp?oc():lb(a.dp);d=xa(d,b);if(d&1)return Za(a.op,d);Bb(rc());Ed(d);return a.cyc}function Wd(a){var b=Y[a.ea](4);if(b&1)return Za(a.op,b);Ed(b);return a.cyc}function Rd(a){var b=Y[a.ea](4);if(b&1)return Za(a.op,b);Bb(rc());Ed(b);return a.cyc}function Ch(a){M();return a.cyc}function Xd(a){var b=Bc(),d=Q(),b=xa(b,ca(d));if(b&1)return Za(a.op,b);Ed(b);return a.cyc}function Dh(a){var b=Ic()&255,d=Bc();wb(b);if(d&1)return Za(a.op,d);Ed(d);return a.cyc}function Eh(a){var b=
Bc();if(b&1)return Za(a.op,b);Ed(b);return a.cyc}function Xe(a){var b=Xa[a.ea]();qb(b,a.zm);M();return a.cyc}function Id(a){var b=Qa[a.ea]();qb(b,a.zm);M();return a.cyc}function hf(a){var b=Va[a.ea]();qb(b,a.zm);M();return a.cyc}function Sg(a){var b=Q()&255,d=Xb();wb(b&d);M();return a.cyc}function Gb(a){var b=Q()&255,d=Xb();wb(b^d);M();return a.cyc}function Eb(a){var b=Q()&255,d=Xb();wb(b|d);M();return a.cyc}function Fb(a){var b=Qa[a.ea]()&255;M();wb(b);return a.cyc}function Ya(a){var b=Xb();Na[a.ea](b);
M();return a.cyc}function gb(a){if(e.s){var b=Q(),d=L();mb(b&d);M();return a.cyc}return Pa(8)}function Ce(a){if(e.s){var b=Q(),d=L();mb(b^d);M();return a.cyc}return Pa(8)}function Df(a){if(e.s){var b=Q(),d=L();mb(b|d);M();return a.cyc}return Pa(8)}function Mg(a){if(e.s){var b=Qa[a.ea]();mb(b);M();return a.cyc}return Pa(8)}function di(a){if(e.s||68E3==Wa){var b=L();Na[a.ea](b);M();return a.cyc}return Pa(8)}function zf(a){return e.s?(e.a[a.An]=e.usp,M(),a.cyc):Pa(8)}function ei(a){return e.s?(e.usp=
e.a[a.An],M(),a.cyc):Pa(8)}function xh(a){var b=Q();if(e.s){var d=b&4095;if(Aa(d)){b=b&32768?e.a[b>>12&7]:e.d[b>>12&7];switch(d){case 0:e.sfc=b&7;break;case 1:e.dfc=b&7;break;case 2:switch(Wa){case 68020:e.cacr=b&15;break;case 68030:e.cacr=b&16159;break;default:e.cacr=0}J(!1);break;case 2048:e.usp=b;break;case 2049:e.vbr=b;break;case 2050:e.caar=b;break;case 2051:e.msp=b;e.m&&(e.a[7]=e.msp);break;case 2052:e.isp=b;e.m||(e.a[7]=e.isp);break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.movec2C() invalid register %d",
d)}M();return a.cyc}return Ea(a.op)}return Pa(8)}function gc(a){var b=Q();if(e.s){var d=b&4095;if(Aa(d)){var l=null;switch(d){case 0:l=e.sfc;break;case 1:l=e.dfc;break;case 2:switch(Wa){case 68020:l=e.cacr&3;break;case 68030:l=e.cacr&13075;break;default:l=0}break;case 2048:l=e.usp;break;case 2049:l=e.vbr;break;case 2050:l=e.caar;break;case 2051:l=1==e.m?e.a[7]:e.msp;break;case 2052:l=0==e.m?e.a[7]:e.isp;break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.movecC2() invalid register %d",d)}d=l;b&32768?
e.a[b>>12&7]=d:e.d[b>>12&7]=d;M();return a.cyc}return Ea(a.op)}return Pa(8)}function mc(a){if(e.s){var b=Q();if(b&2048)ob[a.ea](b&32768?e.a[b>>12&7]:e.d[b>>12&7]);else b&32768?e.a[b>>12&7]=Va[a.ea]():e.d[b>>12&7]=Va[a.ea]();M();return a.cyc}return Pa(8)}function oh(a){if(e.s){var b=Q();if(b&2048){var d=b&32768?e.a[b>>12&7]:e.d[b>>12&7];Na[a.ea](d&65535)}else d=Qa[a.ea](),b&32768?e.a[b>>12&7]=ca(d):e.d[b>>12&7]=e.d[b>>12&7]&4294901760|d;M();return a.cyc}return Pa(8)}function Cf(a){if(e.s){var b=Q();
if(b&2048){var d=b&32768?e.a[b>>12&7]:e.d[b>>12&7];hb[a.ea](d&255)}else d=Xa[a.ea](),b&32768?e.a[b>>12&7]=lb(d):e.d[b>>12&7]=e.d[b>>12&7]&4294967040|d;M();return a.cyc}return Pa(8)}function cg(a){M();return a.cyc}function rd(a){var b=cc(Qa[a.ea]()),d=cc(e.d[a.Dn]&65535);if(0>d)return e.n=!0,Pa(6);if(d>b)return e.n=!1,Pa(6);M();return a.cyc}function Tg(a){var b=Nb(Va[a.ea]()),d=Nb(e.d[a.Dn]);if(0>d)return e.n=!0,Pa(6);if(d>b)return e.n=!1,Pa(6);M();return a.cyc}function Kd(a){var b=Q(),d=Y[a.ea](4),
l=La(d),d=La(d+4),f;b&32768?f=e.a[b>>12&7]:(f=Nb(e.d[b>>12&7]),l=Nb(l),d=Nb(d));e.z=d==f||l==f;e.c=l<=d?f<l||f>d:f<d||f>l;if(b&2048&&e.c)return Pa(6);M();return a.cyc}function Bh(a){var b=Q(),d=Y[a.ea](2),l=ba(d),d=ba(d+2),f;b&32768?(f=ca(e.a[b>>12&7]&65535),l=ca(l),d=ca(d)):(f=cc(e.d[b>>12&7]&65535),l=cc(l),d=cc(d));e.z=d==f||l==f;e.c=l<=d?f<l||f>d:f<d||f>l;if(b&2048&&e.c)return Pa(6);M();return a.cyc}function qe(a){var b=Q(),d=Y[a.ea](1),l=Ha(d),d=Ha(d+1),f;b&32768?(f=lb(e.a[b>>12&7]&255),l=lb(l),
d=lb(d)):(f=yb(e.d[b>>12&7]&255),l=yb(l),d=yb(d));e.z=d==f||l==f;e.c=l<=d?f<l||f>d:f<d||f>l;if(b&2048&&e.c)return Pa(6);M();return a.cyc}function Ih(a){return Ea(a.op)}function bf(a){return e.s?(SAEF_log("I_RESET pc $%08x",e.instruction_pc),SAER.m68k.cpureset(),M(),a.cyc):Pa(8)}function Ob(a){if(e.s){var b=Ic(),d=Bc();if(68E3!=Wa){var l=Ic()>>12;if(0!=l&&1!=l)if(2==l)e.a[7]+=4;else if(4==l)e.a[7]+=8;else if(8==l)e.a[7]+=50;else if(9==l)e.a[7]+=12;else if(10==l)e.a[7]+=24;else if(11==l)e.a[7]+=84;
else return e.a[7]+=0,Pa(14)}mb(b);if(d&1)return Za(a.op,d);Ed(d);return a.cyc}return Pa(8)}function Zc(a){if(e.s){var b=Q();mb(b);SAER.m68k.m68k_setstopped();M();return a.cyc}return Pa(8)}function wc(a){return Pa(32+a.v)}function Nc(a){if(Hc[a.cc]())return Bb(rc()),Pa(7);M();return a.cyc}function de(a){Q();if(Hc[a.cc]())return Bb(rc()),Pa(7);M();return a.cyc}function ze(a){oc();if(Hc[a.cc]())return Bb(rc()),Pa(7);M();return a.cyc}function ff(a){if(e.v)return Pa(7);M();return a.cyc}function ph(a){var b=
Q(),d=Y[a.ea](4),l=e.d[b&7],f=La(d),h=f-l;0>h&&(h+=4294967296);lc(l,f,h,2147483648);e.z?Ka(d,e.d[b>>6&7]):e.d[b&7]=f;M();return a.cyc}function ye(a){var b=Q(),d=Y[a.ea](2),l=e.d[b&7]&65535,f=ba(d),h=f-l;0>h&&(h+=65536);lc(l,f,h,32768);e.z?Ja(d,e.d[b>>6&7]&65535):e.d[b&7]=e.d[b&7]&4294901760|f;M();return a.cyc}function me(a){var b=Q(),d=Y[a.ea](1),l=e.d[b&7]&255,f=Ha(d),h=f-l;0>h&&(h+=256);lc(l,f,h,128);e.z?ga(d,e.d[b>>6&7]&255):e.d[b&7]=e.d[b&7]&4294967040|f;M();return a.cyc}function cd(a){var b=
Q(),d=Q(),l=b>>12&7,f=d>>12&7,h=b>>6&7,m=d>>6&7,q=b&7,v=d&7,r=e.d[q],t=e.d[v],y=b&32768?La(e.a[l]):e.d[l],z=d&32768?La(e.a[f]):e.d[f],A=!1,B=y-r;0>B&&(B+=4294967296);lc(r,y,B,2147483648);e.z&&(B=z-t,0>B&&(B+=4294967296),lc(t,z,B,2147483648),A=e.z);A?(b&32768?Ka(e.a[l],e.d[h]):e.d[l]=e.d[h],d&32768?Ka(e.a[f],e.d[m]):e.d[f]=e.d[m]):(e.d[q]=y,e.d[v]=z);M();return a.cyc}function ce(a){var b=Q(),d=Q(),f=b>>12&7,h=d>>12&7,m=b>>6&7,q=d>>6&7,v=b&7,r=d&7,t=e.d[v]&65535,y=e.d[r]&65535,z=b&32768?ba(e.a[f]):
e.d[f]&65535,A=d&32768?ba(e.a[h]):e.d[h]&65535,B=!1,C=z-t;0>C&&(C+=65536);lc(t,z,C,32768);e.z&&(C=A-y,0>C&&(C+=65536),lc(y,A,C,32768),B=e.z);B?(b&32768?Ja(e.a[f],e.d[m]&65535):e.d[f]=e.d[f]&4294901760|e.d[m]&65535,d&32768?Ja(e.a[h],e.d[q]&65535):e.d[h]=e.d[h]&4294901760|e.d[q]&65535):(e.d[v]=e.d[v]&4294901760|z,e.d[r]=e.d[r]&4294901760|A);M();return a.cyc}function ee(a){var b=Xa[a.ea]();hb[a.ea](128|b);e.n=0!=(b&128);e.z=0==b;e.v=!1;e.c=!1;M();return a.cyc}function ne(a){var b=Q()&255;SAEF_warn("I_CALLM not implemented (ext %d)",
b);return Ea(a.op)}function Ig(a){SAEF_warn("I_RTM not implemented");return Ea(a.op)}function sh(a){if(e.s){rc();var b=Q(),d=Y[a.ea](4);a:switch(b>>13){case 0:case 2:case 3:var f=b>>9&1,h=null,m=af;switch(b>>10&31){case 16:h="TC";f?Ka(d,af):af=La(d);break;case 18:h="SRP";f?(Ka(d,$f),Ka(d+4,sf)):($f=La(d),sf=La(d+4));break;case 19:h="CRP";f?(Ka(d,Bg),Ka(d+4,wf)):(Bg=La(d),wf=La(d+4));break;case 24:h="MMUSR";f?Ja(d,Zd):Zd=ba(d);break;case 2:h="TT0";f?Ka(d,xf):xf=La(d);break;case 3:h="TT1",f?Ka(d,ag):
ag=La(d)}null===h?b=!0:(SAEV_config.chipset.mbdmac&1&&0<SAEV_config.memory.ramsey.lowSize&&m!=af&&SAER.memory.a3000_fakekick(0!=(af&2147483648)),b=!1);break a;case 1:b:{d=b&31;f=b>>5&3;switch(b>>10&7){case 6:sprintf("FC=%x MASK=%x EA=%08x",d,f,0);break;case 4:sprintf("FC=%x MASK=%x",d,f);break;case 1:break;default:b=!0;break b}b=!1}break a;case 4:Zd=0;b=!1;break a;default:b=!0}if(b)return Ea(a.op);M();return a.cyc}return Pa(8)}function ac(a){return Ea(a.op)}function bc(a){return Ea(a.op)}function kd(a){return Ea(a.op)}
function ai(a){return Ea(a.op)}function Lg(a){return Ea(a.op)}function Gd(a){return Ea(a.op)}function Ra(a){return Ea(a.op)}function Ng(a){return Ea(a)}function Ef(){var a=0;Hc=Array(16);Hc[a++]=function(){return!0};Hc[a++]=function(){return!1};Hc[a++]=function(){return!e.c&&!e.z};Hc[a++]=function(){return e.c||e.z};Hc[a++]=function(){return!e.c};Hc[a++]=function(){return e.c};Hc[a++]=function(){return!e.z};Hc[a++]=function(){return e.z};Hc[a++]=function(){return!e.v};Hc[a++]=function(){return e.v};
Hc[a++]=function(){return!e.n};Hc[a++]=function(){return e.n};Hc[a++]=function(){return e.n==e.v};Hc[a++]=function(){return e.n!=e.v};Hc[a++]=function(){return!e.z&&e.n==e.v};Hc[a]=function(){return e.z||e.n!=e.v}}function rb(a,b){var d=b>>12&7,d=b&32768?e.a[d]:e.d[d],f=b>>9&3;0==(b&2048)&&(d=ca(d&65535));f&&(d=(d<<f&4294967295)>>>0);b&256?(f=0,b&128&&(a=0),b&64&&(d=0),32==(b&48)&&(a=xa(a,ca(Q()))),48==(b&48)&&(a=xa(a,oc())),2==(b&3)&&(f=ca(Q())),3==(b&3)&&(f=oc()),0==(b&4)&&(a=xa(a,d)),b&3&&(a=La(a)),
b&4&&(a=xa(a,d)),d=xa(a,f)):d=xa(xa(a,lb(b&255)),d);return d}function Og(){Y=Array(64);Y[16]=function(){return e.a[0]};Y[17]=function(){return e.a[1]};Y[18]=function(){return e.a[2]};Y[19]=function(){return e.a[3]};Y[20]=function(){return e.a[4]};Y[21]=function(){return e.a[5]};Y[22]=function(){return e.a[6]};Y[23]=function(){return e.a[7]};Y[24]=function(a){var b=e.a[0];e.a[0]+=jc[a][0];return b};Y[25]=function(a){var b=e.a[1];e.a[1]+=jc[a][1];return b};Y[26]=function(a){var b=e.a[2];e.a[2]+=jc[a][2];
return b};Y[27]=function(a){var b=e.a[3];e.a[3]+=jc[a][3];return b};Y[28]=function(a){var b=e.a[4];e.a[4]+=jc[a][4];return b};Y[29]=function(a){var b=e.a[5];e.a[5]+=jc[a][5];return b};Y[30]=function(a){var b=e.a[6];e.a[6]+=jc[a][6];return b};Y[31]=function(a){var b=e.a[7];e.a[7]+=jc[a][7];return b};Y[32]=function(a){e.a[0]-=jc[a][0];return e.a[0]};Y[33]=function(a){e.a[1]-=jc[a][1];return e.a[1]};Y[34]=function(a){e.a[2]-=jc[a][2];return e.a[2]};Y[35]=function(a){e.a[3]-=jc[a][3];return e.a[3]};Y[36]=
function(a){e.a[4]-=jc[a][4];return e.a[4]};Y[37]=function(a){e.a[5]-=jc[a][5];return e.a[5]};Y[38]=function(a){e.a[6]-=jc[a][6];return e.a[6]};Y[39]=function(a){e.a[7]-=jc[a][7];return e.a[7]};Y[40]=function(){return xa(e.a[0],ca(Q()))};Y[41]=function(){return xa(e.a[1],ca(Q()))};Y[42]=function(){return xa(e.a[2],ca(Q()))};Y[43]=function(){return xa(e.a[3],ca(Q()))};Y[44]=function(){return xa(e.a[4],ca(Q()))};Y[45]=function(){return xa(e.a[5],ca(Q()))};Y[46]=function(){return xa(e.a[6],ca(Q()))};
Y[47]=function(){return xa(e.a[7],ca(Q()))};Y[48]=function(){return rb(e.a[0],Q())};Y[49]=function(){return rb(e.a[1],Q())};Y[50]=function(){return rb(e.a[2],Q())};Y[51]=function(){return rb(e.a[3],Q())};Y[52]=function(){return rb(e.a[4],Q())};Y[53]=function(){return rb(e.a[5],Q())};Y[54]=function(){return rb(e.a[6],Q())};Y[55]=function(){return rb(e.a[7],Q())};Y[56]=function(){return ca(Q())};Y[57]=function(){return oc()};Y[58]=function(){return xa(rc(),ca(Q()))};Y[59]=function(){return rb(rc(),
Q())};Y[60]=function(){SAEF_error("cpu.exEAtab() invalid EA 60 (7|4) (imm)")};Xa=Array(64);Xa[0]=function(){return e.d[0]&255};Xa[1]=function(){return e.d[1]&255};Xa[2]=function(){return e.d[2]&255};Xa[3]=function(){return e.d[3]&255};Xa[4]=function(){return e.d[4]&255};Xa[5]=function(){return e.d[5]&255};Xa[6]=function(){return e.d[6]&255};Xa[7]=function(){return e.d[7]&255};Xa[8]=function(){SAEF_error("cpu.ldEA8tab() invalid EA  8 (1|0)")};Xa[9]=function(){SAEF_error("cpu.ldEA8tab() invalid EA  9 (1|1)")};
Xa[10]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 10 (1|2)")};Xa[11]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 11 (1|3)")};Xa[12]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 12 (1|4)")};Xa[13]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 13 (1|5)")};Xa[14]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 14 (1|6)")};Xa[15]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 15 (1|7)")};Xa[16]=function(){return Ha(e.a[0])};Xa[17]=function(){return Ha(e.a[1])};Xa[18]=function(){return Ha(e.a[2])};
Xa[19]=function(){return Ha(e.a[3])};Xa[20]=function(){return Ha(e.a[4])};Xa[21]=function(){return Ha(e.a[5])};Xa[22]=function(){return Ha(e.a[6])};Xa[23]=function(){return Ha(e.a[7])};Xa[24]=function(){var a=e.a[0];e.a[0]+=1;return Ha(a)};Xa[25]=function(){var a=e.a[1];e.a[1]+=1;return Ha(a)};Xa[26]=function(){var a=e.a[2];e.a[2]+=1;return Ha(a)};Xa[27]=function(){var a=e.a[3];e.a[3]+=1;return Ha(a)};Xa[28]=function(){var a=e.a[4];e.a[4]+=1;return Ha(a)};Xa[29]=function(){var a=e.a[5];e.a[5]+=1;
return Ha(a)};Xa[30]=function(){var a=e.a[6];e.a[6]+=1;return Ha(a)};Xa[31]=function(){var a=e.a[7];e.a[7]+=2;return Ha(a)};Xa[32]=function(){--e.a[0];return Ha(e.a[0])};Xa[33]=function(){--e.a[1];return Ha(e.a[1])};Xa[34]=function(){--e.a[2];return Ha(e.a[2])};Xa[35]=function(){--e.a[3];return Ha(e.a[3])};Xa[36]=function(){--e.a[4];return Ha(e.a[4])};Xa[37]=function(){--e.a[5];return Ha(e.a[5])};Xa[38]=function(){--e.a[6];return Ha(e.a[6])};Xa[39]=function(){e.a[7]-=2;return Ha(e.a[7])};Xa[40]=function(){return Ha(xa(e.a[0],
ca(Q())))};Xa[41]=function(){return Ha(xa(e.a[1],ca(Q())))};Xa[42]=function(){return Ha(xa(e.a[2],ca(Q())))};Xa[43]=function(){return Ha(xa(e.a[3],ca(Q())))};Xa[44]=function(){return Ha(xa(e.a[4],ca(Q())))};Xa[45]=function(){return Ha(xa(e.a[5],ca(Q())))};Xa[46]=function(){return Ha(xa(e.a[6],ca(Q())))};Xa[47]=function(){return Ha(xa(e.a[7],ca(Q())))};Xa[48]=function(){return Ha(rb(e.a[0],Q()))};Xa[49]=function(){return Ha(rb(e.a[1],Q()))};Xa[50]=function(){return Ha(rb(e.a[2],Q()))};Xa[51]=function(){return Ha(rb(e.a[3],
Q()))};Xa[52]=function(){return Ha(rb(e.a[4],Q()))};Xa[53]=function(){return Ha(rb(e.a[5],Q()))};Xa[54]=function(){return Ha(rb(e.a[6],Q()))};Xa[55]=function(){return Ha(rb(e.a[7],Q()))};Xa[56]=function(){return Ha(ca(Q()))};Xa[57]=function(){return Ha(oc())};Xa[58]=function(){return Ha(xa(rc(),ca(Q())))};Xa[59]=function(){return Ha(rb(rc(),Q()))};Xa[60]=function(){return Q()&255};Qa=Array(64);Qa[0]=function(){return e.d[0]&65535};Qa[1]=function(){return e.d[1]&65535};Qa[2]=function(){return e.d[2]&
65535};Qa[3]=function(){return e.d[3]&65535};Qa[4]=function(){return e.d[4]&65535};Qa[5]=function(){return e.d[5]&65535};Qa[6]=function(){return e.d[6]&65535};Qa[7]=function(){return e.d[7]&65535};Qa[8]=function(){return e.a[0]&65535};Qa[9]=function(){return e.a[1]&65535};Qa[10]=function(){return e.a[2]&65535};Qa[11]=function(){return e.a[3]&65535};Qa[12]=function(){return e.a[4]&65535};Qa[13]=function(){return e.a[5]&65535};Qa[14]=function(){return e.a[6]&65535};Qa[15]=function(){return e.a[7]&65535};
Qa[16]=function(){return ba(e.a[0])};Qa[17]=function(){return ba(e.a[1])};Qa[18]=function(){return ba(e.a[2])};Qa[19]=function(){return ba(e.a[3])};Qa[20]=function(){return ba(e.a[4])};Qa[21]=function(){return ba(e.a[5])};Qa[22]=function(){return ba(e.a[6])};Qa[23]=function(){return ba(e.a[7])};Qa[24]=function(){var a=e.a[0];e.a[0]+=2;return ba(a)};Qa[25]=function(){var a=e.a[1];e.a[1]+=2;return ba(a)};Qa[26]=function(){var a=e.a[2];e.a[2]+=2;return ba(a)};Qa[27]=function(){var a=e.a[3];e.a[3]+=2;
return ba(a)};Qa[28]=function(){var a=e.a[4];e.a[4]+=2;return ba(a)};Qa[29]=function(){var a=e.a[5];e.a[5]+=2;return ba(a)};Qa[30]=function(){var a=e.a[6];e.a[6]+=2;return ba(a)};Qa[31]=function(){var a=e.a[7];e.a[7]+=2;return ba(a)};Qa[32]=function(){e.a[0]-=2;return ba(e.a[0])};Qa[33]=function(){e.a[1]-=2;return ba(e.a[1])};Qa[34]=function(){e.a[2]-=2;return ba(e.a[2])};Qa[35]=function(){e.a[3]-=2;return ba(e.a[3])};Qa[36]=function(){e.a[4]-=2;return ba(e.a[4])};Qa[37]=function(){e.a[5]-=2;return ba(e.a[5])};
Qa[38]=function(){e.a[6]-=2;return ba(e.a[6])};Qa[39]=function(){e.a[7]-=2;return ba(e.a[7])};Qa[40]=function(){return ba(xa(e.a[0],ca(Q())))};Qa[41]=function(){return ba(xa(e.a[1],ca(Q())))};Qa[42]=function(){return ba(xa(e.a[2],ca(Q())))};Qa[43]=function(){return ba(xa(e.a[3],ca(Q())))};Qa[44]=function(){return ba(xa(e.a[4],ca(Q())))};Qa[45]=function(){return ba(xa(e.a[5],ca(Q())))};Qa[46]=function(){return ba(xa(e.a[6],ca(Q())))};Qa[47]=function(){return ba(xa(e.a[7],ca(Q())))};Qa[48]=function(){return ba(rb(e.a[0],
Q()))};Qa[49]=function(){return ba(rb(e.a[1],Q()))};Qa[50]=function(){return ba(rb(e.a[2],Q()))};Qa[51]=function(){return ba(rb(e.a[3],Q()))};Qa[52]=function(){return ba(rb(e.a[4],Q()))};Qa[53]=function(){return ba(rb(e.a[5],Q()))};Qa[54]=function(){return ba(rb(e.a[6],Q()))};Qa[55]=function(){return ba(rb(e.a[7],Q()))};Qa[56]=function(){return ba(ca(Q()))};Qa[57]=function(){return ba(oc())};Qa[58]=function(){return ba(xa(rc(),ca(Q())))};Qa[59]=function(){return ba(rb(rc(),Q()))};Qa[60]=function(){return Q()};
Va=Array(64);Va[0]=function(){return e.d[0]};Va[1]=function(){return e.d[1]};Va[2]=function(){return e.d[2]};Va[3]=function(){return e.d[3]};Va[4]=function(){return e.d[4]};Va[5]=function(){return e.d[5]};Va[6]=function(){return e.d[6]};Va[7]=function(){return e.d[7]};Va[8]=function(){return e.a[0]};Va[9]=function(){return e.a[1]};Va[10]=function(){return e.a[2]};Va[11]=function(){return e.a[3]};Va[12]=function(){return e.a[4]};Va[13]=function(){return e.a[5]};Va[14]=function(){return e.a[6]};Va[15]=
function(){return e.a[7]};Va[16]=function(){return La(e.a[0])};Va[17]=function(){return La(e.a[1])};Va[18]=function(){return La(e.a[2])};Va[19]=function(){return La(e.a[3])};Va[20]=function(){return La(e.a[4])};Va[21]=function(){return La(e.a[5])};Va[22]=function(){return La(e.a[6])};Va[23]=function(){return La(e.a[7])};Va[24]=function(){var a=e.a[0];e.a[0]+=4;return La(a)};Va[25]=function(){var a=e.a[1];e.a[1]+=4;return La(a)};Va[26]=function(){var a=e.a[2];e.a[2]+=4;return La(a)};Va[27]=function(){var a=
e.a[3];e.a[3]+=4;return La(a)};Va[28]=function(){var a=e.a[4];e.a[4]+=4;return La(a)};Va[29]=function(){var a=e.a[5];e.a[5]+=4;return La(a)};Va[30]=function(){var a=e.a[6];e.a[6]+=4;return La(a)};Va[31]=function(){var a=e.a[7];e.a[7]+=4;return La(a)};Va[32]=function(){e.a[0]-=4;return La(e.a[0])};Va[33]=function(){e.a[1]-=4;return La(e.a[1])};Va[34]=function(){e.a[2]-=4;return La(e.a[2])};Va[35]=function(){e.a[3]-=4;return La(e.a[3])};Va[36]=function(){e.a[4]-=4;return La(e.a[4])};Va[37]=function(){e.a[5]-=
4;return La(e.a[5])};Va[38]=function(){e.a[6]-=4;return La(e.a[6])};Va[39]=function(){e.a[7]-=4;return La(e.a[7])};Va[40]=function(){return La(xa(e.a[0],ca(Q())))};Va[41]=function(){return La(xa(e.a[1],ca(Q())))};Va[42]=function(){return La(xa(e.a[2],ca(Q())))};Va[43]=function(){return La(xa(e.a[3],ca(Q())))};Va[44]=function(){return La(xa(e.a[4],ca(Q())))};Va[45]=function(){return La(xa(e.a[5],ca(Q())))};Va[46]=function(){return La(xa(e.a[6],ca(Q())))};Va[47]=function(){return La(xa(e.a[7],ca(Q())))};
Va[48]=function(){return La(rb(e.a[0],Q()))};Va[49]=function(){return La(rb(e.a[1],Q()))};Va[50]=function(){return La(rb(e.a[2],Q()))};Va[51]=function(){return La(rb(e.a[3],Q()))};Va[52]=function(){return La(rb(e.a[4],Q()))};Va[53]=function(){return La(rb(e.a[5],Q()))};Va[54]=function(){return La(rb(e.a[6],Q()))};Va[55]=function(){return La(rb(e.a[7],Q()))};Va[56]=function(){return La(ca(Q()))};Va[57]=function(){return La(oc())};Va[58]=function(){return La(xa(rc(),ca(Q())))};Va[59]=function(){return La(rb(rc(),
Q()))};Va[60]=function(){return oc()};hb=Array(64);hb[0]=function(a){e.d[0]=e.d[0]&4294967040|a};hb[1]=function(a){e.d[1]=e.d[1]&4294967040|a};hb[2]=function(a){e.d[2]=e.d[2]&4294967040|a};hb[3]=function(a){e.d[3]=e.d[3]&4294967040|a};hb[4]=function(a){e.d[4]=e.d[4]&4294967040|a};hb[5]=function(a){e.d[5]=e.d[5]&4294967040|a};hb[6]=function(a){e.d[6]=e.d[6]&4294967040|a};hb[7]=function(a){e.d[7]=e.d[7]&4294967040|a};hb[8]=function(a){SAEF_error("cpu.stEA8tab() invalid EA  8 (1|0)")};hb[9]=function(a){SAEF_error("cpu.stEA8tab() invalid EA  9 (1|1)")};
hb[10]=function(a){SAEF_error("cpu.stEA8tab() invalid EA 10 (1|2)")};hb[11]=function(a){SAEF_error("cpu.stEA8tab() invalid EA 11 (1|3)")};hb[12]=function(a){SAEF_error("cpu.stEA8tab() invalid EA 12 (1|4)")};hb[13]=function(a){SAEF_error("cpu.stEA8tab() invalid EA 13 (1|5)")};hb[14]=function(a){SAEF_error("cpu.stEA8tab() invalid EA 14 (1|6)")};hb[15]=function(a){SAEF_error("cpu.stEA8tab() invalid EA 15 (1|7)")};hb[16]=function(a){ga(e.a[0],a)};hb[17]=function(a){ga(e.a[1],a)};hb[18]=function(a){ga(e.a[2],
a)};hb[19]=function(a){ga(e.a[3],a)};hb[20]=function(a){ga(e.a[4],a)};hb[21]=function(a){ga(e.a[5],a)};hb[22]=function(a){ga(e.a[6],a)};hb[23]=function(a){ga(e.a[7],a)};hb[24]=function(a){ga(e.a[0],a);e.a[0]+=1};hb[25]=function(a){ga(e.a[1],a);e.a[1]+=1};hb[26]=function(a){ga(e.a[2],a);e.a[2]+=1};hb[27]=function(a){ga(e.a[3],a);e.a[3]+=1};hb[28]=function(a){ga(e.a[4],a);e.a[4]+=1};hb[29]=function(a){ga(e.a[5],a);e.a[5]+=1};hb[30]=function(a){ga(e.a[6],a);e.a[6]+=1};hb[31]=function(a){ga(e.a[7],a);
e.a[7]+=2};hb[32]=function(a){--e.a[0];ga(e.a[0],a)};hb[33]=function(a){--e.a[1];ga(e.a[1],a)};hb[34]=function(a){--e.a[2];ga(e.a[2],a)};hb[35]=function(a){--e.a[3];ga(e.a[3],a)};hb[36]=function(a){--e.a[4];ga(e.a[4],a)};hb[37]=function(a){--e.a[5];ga(e.a[5],a)};hb[38]=function(a){--e.a[6];ga(e.a[6],a)};hb[39]=function(a){e.a[7]-=2;ga(e.a[7],a)};hb[40]=function(a){ga(xa(e.a[0],ca(Q())),a)};hb[41]=function(a){ga(xa(e.a[1],ca(Q())),a)};hb[42]=function(a){ga(xa(e.a[2],ca(Q())),a)};hb[43]=function(a){ga(xa(e.a[3],
ca(Q())),a)};hb[44]=function(a){ga(xa(e.a[4],ca(Q())),a)};hb[45]=function(a){ga(xa(e.a[5],ca(Q())),a)};hb[46]=function(a){ga(xa(e.a[6],ca(Q())),a)};hb[47]=function(a){ga(xa(e.a[7],ca(Q())),a)};hb[48]=function(a){ga(rb(e.a[0],Q()),a)};hb[49]=function(a){ga(rb(e.a[1],Q()),a)};hb[50]=function(a){ga(rb(e.a[2],Q()),a)};hb[51]=function(a){ga(rb(e.a[3],Q()),a)};hb[52]=function(a){ga(rb(e.a[4],Q()),a)};hb[53]=function(a){ga(rb(e.a[5],Q()),a)};hb[54]=function(a){ga(rb(e.a[6],Q()),a)};hb[55]=function(a){ga(rb(e.a[7],
Q()),a)};hb[56]=function(a){ga(ca(Q()),a)};hb[57]=function(a){ga(oc(),a)};hb[58]=function(a){ga(xa(rc(),ca(Q())),a)};hb[59]=function(a){ga(rb(rc(),Q()),a)};hb[60]=function(a){SAEF_error("cpu.stEA8tab() invalid EA 60 (7|4)")};Na=Array(64);Na[0]=function(a){e.d[0]=e.d[0]&4294901760|a};Na[1]=function(a){e.d[1]=e.d[1]&4294901760|a};Na[2]=function(a){e.d[2]=e.d[2]&4294901760|a};Na[3]=function(a){e.d[3]=e.d[3]&4294901760|a};Na[4]=function(a){e.d[4]=e.d[4]&4294901760|a};Na[5]=function(a){e.d[5]=e.d[5]&4294901760|
a};Na[6]=function(a){e.d[6]=e.d[6]&4294901760|a};Na[7]=function(a){e.d[7]=e.d[7]&4294901760|a};Na[8]=function(a){e.a[0]=a};Na[9]=function(a){e.a[1]=a};Na[10]=function(a){e.a[2]=a};Na[11]=function(a){e.a[3]=a};Na[12]=function(a){e.a[4]=a};Na[13]=function(a){e.a[5]=a};Na[14]=function(a){e.a[6]=a};Na[15]=function(a){e.a[7]=a};Na[16]=function(a){Ja(e.a[0],a)};Na[17]=function(a){Ja(e.a[1],a)};Na[18]=function(a){Ja(e.a[2],a)};Na[19]=function(a){Ja(e.a[3],a)};Na[20]=function(a){Ja(e.a[4],a)};Na[21]=function(a){Ja(e.a[5],
a)};Na[22]=function(a){Ja(e.a[6],a)};Na[23]=function(a){Ja(e.a[7],a)};Na[24]=function(a){Ja(e.a[0],a);e.a[0]+=2};Na[25]=function(a){Ja(e.a[1],a);e.a[1]+=2};Na[26]=function(a){Ja(e.a[2],a);e.a[2]+=2};Na[27]=function(a){Ja(e.a[3],a);e.a[3]+=2};Na[28]=function(a){Ja(e.a[4],a);e.a[4]+=2};Na[29]=function(a){Ja(e.a[5],a);e.a[5]+=2};Na[30]=function(a){Ja(e.a[6],a);e.a[6]+=2};Na[31]=function(a){Ja(e.a[7],a);e.a[7]+=2};Na[32]=function(a){e.a[0]-=2;Ja(e.a[0],a)};Na[33]=function(a){e.a[1]-=2;Ja(e.a[1],a)};Na[34]=
function(a){e.a[2]-=2;Ja(e.a[2],a)};Na[35]=function(a){e.a[3]-=2;Ja(e.a[3],a)};Na[36]=function(a){e.a[4]-=2;Ja(e.a[4],a)};Na[37]=function(a){e.a[5]-=2;Ja(e.a[5],a)};Na[38]=function(a){e.a[6]-=2;Ja(e.a[6],a)};Na[39]=function(a){e.a[7]-=2;Ja(e.a[7],a)};Na[40]=function(a){Ja(xa(e.a[0],ca(Q())),a)};Na[41]=function(a){Ja(xa(e.a[1],ca(Q())),a)};Na[42]=function(a){Ja(xa(e.a[2],ca(Q())),a)};Na[43]=function(a){Ja(xa(e.a[3],ca(Q())),a)};Na[44]=function(a){Ja(xa(e.a[4],ca(Q())),a)};Na[45]=function(a){Ja(xa(e.a[5],
ca(Q())),a)};Na[46]=function(a){Ja(xa(e.a[6],ca(Q())),a)};Na[47]=function(a){Ja(xa(e.a[7],ca(Q())),a)};Na[48]=function(a){Ja(rb(e.a[0],Q()),a)};Na[49]=function(a){Ja(rb(e.a[1],Q()),a)};Na[50]=function(a){Ja(rb(e.a[2],Q()),a)};Na[51]=function(a){Ja(rb(e.a[3],Q()),a)};Na[52]=function(a){Ja(rb(e.a[4],Q()),a)};Na[53]=function(a){Ja(rb(e.a[5],Q()),a)};Na[54]=function(a){Ja(rb(e.a[6],Q()),a)};Na[55]=function(a){Ja(rb(e.a[7],Q()),a)};Na[56]=function(a){Ja(ca(Q()),a)};Na[57]=function(a){Ja(oc(),a)};Na[58]=
function(a){Ja(xa(rc(),ca(Q())),a)};Na[59]=function(a){Ja(rb(rc(),Q()),a)};Na[60]=function(a){SAEF_error("cpu.stEA16tab() invalid EA 60 (7|4)")};ob=Array(64);ob[0]=function(a){e.d[0]=a};ob[1]=function(a){e.d[1]=a};ob[2]=function(a){e.d[2]=a};ob[3]=function(a){e.d[3]=a};ob[4]=function(a){e.d[4]=a};ob[5]=function(a){e.d[5]=a};ob[6]=function(a){e.d[6]=a};ob[7]=function(a){e.d[7]=a};ob[8]=function(a){e.a[0]=a};ob[9]=function(a){e.a[1]=a};ob[10]=function(a){e.a[2]=a};ob[11]=function(a){e.a[3]=a};ob[12]=
function(a){e.a[4]=a};ob[13]=function(a){e.a[5]=a};ob[14]=function(a){e.a[6]=a};ob[15]=function(a){e.a[7]=a};ob[16]=function(a){Ka(e.a[0],a)};ob[17]=function(a){Ka(e.a[1],a)};ob[18]=function(a){Ka(e.a[2],a)};ob[19]=function(a){Ka(e.a[3],a)};ob[20]=function(a){Ka(e.a[4],a)};ob[21]=function(a){Ka(e.a[5],a)};ob[22]=function(a){Ka(e.a[6],a)};ob[23]=function(a){Ka(e.a[7],a)};ob[24]=function(a){Ka(e.a[0],a);e.a[0]+=4};ob[25]=function(a){Ka(e.a[1],a);e.a[1]+=4};ob[26]=function(a){Ka(e.a[2],a);e.a[2]+=4};
ob[27]=function(a){Ka(e.a[3],a);e.a[3]+=4};ob[28]=function(a){Ka(e.a[4],a);e.a[4]+=4};ob[29]=function(a){Ka(e.a[5],a);e.a[5]+=4};ob[30]=function(a){Ka(e.a[6],a);e.a[6]+=4};ob[31]=function(a){Ka(e.a[7],a);e.a[7]+=4};ob[32]=function(a){e.a[0]-=4;Ka(e.a[0],a)};ob[33]=function(a){e.a[1]-=4;Ka(e.a[1],a)};ob[34]=function(a){e.a[2]-=4;Ka(e.a[2],a)};ob[35]=function(a){e.a[3]-=4;Ka(e.a[3],a)};ob[36]=function(a){e.a[4]-=4;Ka(e.a[4],a)};ob[37]=function(a){e.a[5]-=4;Ka(e.a[5],a)};ob[38]=function(a){e.a[6]-=4;
Ka(e.a[6],a)};ob[39]=function(a){e.a[7]-=4;Ka(e.a[7],a)};ob[40]=function(a){Ka(xa(e.a[0],ca(Q())),a)};ob[41]=function(a){Ka(xa(e.a[1],ca(Q())),a)};ob[42]=function(a){Ka(xa(e.a[2],ca(Q())),a)};ob[43]=function(a){Ka(xa(e.a[3],ca(Q())),a)};ob[44]=function(a){Ka(xa(e.a[4],ca(Q())),a)};ob[45]=function(a){Ka(xa(e.a[5],ca(Q())),a)};ob[46]=function(a){Ka(xa(e.a[6],ca(Q())),a)};ob[47]=function(a){Ka(xa(e.a[7],ca(Q())),a)};ob[48]=function(a){Ka(rb(e.a[0],Q()),a)};ob[49]=function(a){Ka(rb(e.a[1],Q()),a)};ob[50]=
function(a){Ka(rb(e.a[2],Q()),a)};ob[51]=function(a){Ka(rb(e.a[3],Q()),a)};ob[52]=function(a){Ka(rb(e.a[4],Q()),a)};ob[53]=function(a){Ka(rb(e.a[5],Q()),a)};ob[54]=function(a){Ka(rb(e.a[6],Q()),a)};ob[55]=function(a){Ka(rb(e.a[7],Q()),a)};ob[56]=function(a){Ka(ca(Q()),a)};ob[57]=function(a){Ka(oc(),a)};ob[58]=function(a){Ka(xa(rc(),ca(Q())),a)};ob[59]=function(a){Ka(rb(rc(),Q()),a)};ob[60]=function(a){SAEF_error("cpu.stEA32tab() invalid EA 60 (7|4)")}}function Ib(a){var b=a>>3;if(7==b)switch(a&7){case 0:return 10;
case 1:return 11;case 2:return 8;case 3:return 9;case 4:return 12}else switch(b){case 0:return 1;case 1:return 2;case 2:return 3;case 3:return 4;case 4:return 5;case 5:return 6;case 6:return 7}SAEF_error("cpu.getEAMode() ERROR ea "+a);return-1}function jb(a,b){var d=a>>3;if(7==d){if(d=a&7,0==d&&-1!=b.indexOf(10)||1==d&&-1!=b.indexOf(11)||2==d&&-1!=b.indexOf(8)||3==d&&-1!=b.indexOf(9)||4==d&&-1!=b.indexOf(12))return!0}else if(0==d&&-1!=b.indexOf(1)||1==d&&-1!=b.indexOf(2)||2==d&&-1!=b.indexOf(3)||
3==d&&-1!=b.indexOf(4)||4==d&&-1!=b.indexOf(5)||5==d&&-1!=b.indexOf(6)||6==d&&-1!=b.indexOf(7))return!0;return!1}function Jb(a,b){var d=a>>3;if(7==d)switch(a&7){case 0:return 4==b?[12,3,0]:[8,2,0];case 1:return 4==b?[16,4,0]:[12,3,0];case 2:return 4==b?[12,3,0]:[8,2,0];case 3:return 4==b?[14,3,0]:[10,2,0];case 4:return 4==b?[8,2,0]:[4,1,0]}else switch(d){case 0:return[0,0,0];case 1:return[0,0,0];case 2:return 4==b?[8,2,0]:[4,1,0];case 3:return 4==b?[8,2,0]:[4,1,0];case 4:return 4==b?[10,2,0]:[6,1,
0];case 5:return 4==b?[12,3,0]:[8,2,0];case 6:return 4==b?[14,3,0]:[10,2,0]}}function V(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a}function ia(a,b,d){return{op:a,mn:b,p:{op:a,cyc:d}}}function ha(a,b,d,e,f,h,m){return b&&e?{ext:a,sm:b,s:d,dm:e,d:f,z:h,z2:m}:e?{ext:a,dm:e,d:f,z:h,z2:m}:{ext:a,z:h,z2:m}}function Tb(){var a,b=0;v=Array(65536);for(a=0;65536>a;a++)v[a]={op:-1,mn:"ILLEGAL",p:a,f:Ng};for(var d=0;3>d;d++)for(var e=0==d?8:1==d?9:17,f=0;8>f;f++)for(var h=0;8>h;h++)if(a=f<<9|49408|e<<3|h,
-1===v[a].op)v[a]=ia(a,"EXG",[6,1,0]),v[a].p.Rx=f,v[a].p.Ry=h,0==d?(v[a].f=Kc,v[a].d=ha(0,1,f,1,h,4,0)):1==d?(v[a].f=dc,v[a].d=ha(0,2,f,2,h,4,0)):(v[a].f=od,v[a].d=ha(0,1,f,2,h,4,0)),b++;else return SAEF_error("cpu.mkITab() op exists EXG "+a),!1;for(var h=[3,6,7,8,9,10,11],m=0;8>m;m++)for(e=0;61>e;e++)if(jb(e,h))if(a=m<<9|16832|e,-1===v[a].op){var q;switch(Ib(e)){case 3:q=[4,1,0];break;case 6:q=[8,2,0];break;case 7:q=[12,2,0];break;case 8:q=[8,2,0];break;case 9:q=[12,2,0];break;case 10:q=[8,2,0];
break;case 11:q=[12,3,0]}v[a]=ia(a,"LEA",q);v[a].p.An=m;v[a].p.ea=e;v[a].f=qd;v[a].d=ha(0,10,e,2,m,4,0);b++}else return SAEF_error("cpu.mkITab() op exists LEA "+a),!1;h=[3,6,7,8,9,10,11];for(e=0;61>e;e++)if(jb(e,h))if(a=18496|e,-1===v[a].op){switch(Ib(e)){case 3:q=[12,1,2];break;case 6:q=[16,2,2];break;case 7:q=[20,2,2];break;case 8:q=[16,2,2];break;case 9:q=[20,2,2];break;case 10:q=[16,2,2];break;case 11:q=[20,3,2]}v[a]=ia(a,"PEA",q);v[a].p.ea=e;v[a].f=tc;v[a].d=ha(0,!1,!1,10,e,4,0);b++}else return SAEF_error("cpu.mkITab() op exists PEA "+
a),!1;for(m=0;8>m;m++)if(a=20048|m,-1===v[a].op)v[a]=ia(a,"LINK",[16,2,2]),v[a].p.An=m,v[a].f=ed,v[a].d=ha(0,2,m,7,1,2,0),b++;else return SAEF_error("cpu.mkITab() op exists LINK "+a),!1;if(68020<=Wa)for(m=0;8>m;m++)if(a=18440|m,-1===v[a].op)v[a]=ia(a,"LINK",[16,2,2]),v[a].p.An=m,v[a].f=Rc,v[a].d=ha(0,2,m,7,2,4,0),b++;else return SAEF_error("cpu.mkITab() op exists LINK "+a),!1;for(m=0;8>m;m++)if(a=20056|m,-1===v[a].op)v[a]=ia(a,"UNLK",[12,3,0]),v[a].p.An=m,v[a].f=Xc,v[a].d=ha(0,!1,!1,2,m,0,0),b++;
else return SAEF_error("cpu.mkITab() op exists UNLK "+a),!1;for(var d=[[[4,1,0],null,[8,1,1],[8,1,1],[8,1,1],[12,2,1],[14,2,1],null,null,[12,2,1],[16,3,1],null],[[4,1,0],null,[8,1,1],[8,1,1],[8,1,1],[12,2,1],[14,2,1],null,null,[12,2,1],[16,3,1],null],[[8,2,0],null,[12,2,1],[12,2,1],[12,2,1],[16,3,1],[18,3,1],null,null,[16,3,1],[20,4,1],null],[[8,2,0],null,[12,2,1],[12,2,1],[12,2,1],[16,3,1],[18,3,1],null,null,[16,3,1],[20,4,1],null],[[10,2,0],null,[14,2,1],[14,2,1],[14,2,1],[18,3,1],[20,4,1],null,
null,[18,3,1],[22,4,1],null],[[12,3,0],null,[16,3,1],[16,3,1],[16,3,1],[20,4,1],[22,4,1],null,null,[20,4,1],[24,5,1],null],[[14,3,0],null,[18,3,1],[18,3,1],[18,3,1],[22,4,1],[24,4,1],null,null,[22,4,1],[26,5,1],null],[[12,3,0],null,[16,3,1],[16,3,1],[16,3,1],[20,4,1],[22,4,1],null,null,[20,4,1],[24,5,1],null],[[14,3,0],null,[18,3,1],[18,3,1],[18,3,1],[22,4,1],[24,4,1],null,null,[22,4,1],[26,5,1],null],[[12,3,0],null,[16,3,1],[16,3,1],[16,3,1],[20,4,1],[22,4,1],null,null,[20,4,1],[24,5,1],null],[[16,
4,0],null,[20,4,1],[20,4,1],[20,4,1],[24,5,1],[26,5,1],null,null,[24,5,1],[28,6,1],null],[[8,2,0],null,[12,2,1],[12,2,1],[12,2,1],[16,3,1],[18,3,1],null,null,[16,3,1],[20,4,1],null]],f=[[[4,1,0],null,[12,1,2],[12,1,2],[12,1,2],[16,2,2],[18,2,2],null,null,[16,2,2],[20,3,2],null],[[4,1,0],null,[12,1,2],[12,1,2],[12,1,2],[16,2,2],[18,2,2],null,null,[16,2,2],[20,3,2],null],[[12,3,0],null,[20,3,2],[20,3,2],[20,3,2],[24,4,2],[26,4,2],null,null,[24,4,2],[28,5,2],null],[[12,3,0],null,[20,3,2],[20,3,2],[20,
3,2],[24,4,2],[26,4,2],null,null,[24,4,2],[28,5,2],null],[[14,3,0],null,[22,3,2],[22,3,2],[22,3,2],[26,4,2],[28,4,2],null,null,[26,4,2],[30,5,2],null],[[16,4,0],null,[24,4,2],[24,4,2],[24,4,2],[28,5,2],[30,5,2],null,null,[28,5,2],[32,6,2],null],[[18,4,0],null,[26,4,2],[26,4,2],[26,4,2],[30,5,2],[32,5,2],null,null,[30,5,2],[34,6,2],null],[[16,4,0],null,[24,4,2],[24,4,2],[24,4,2],[28,5,2],[30,5,2],null,null,[28,5,2],[32,5,2],null],[[18,4,0],null,[26,4,2],[26,4,2],[26,4,2],[30,5,2],[32,5,2],null,null,
[30,5,2],[34,6,2],null],[[16,4,0],null,[24,4,2],[24,4,2],[24,4,2],[28,5,2],[30,5,2],null,null,[28,5,2],[32,6,2],null],[[20,5,0],null,[28,5,2],[28,5,2],[28,5,2],[32,6,2],[34,6,2],null,null,[32,6,2],[36,7,2],null],[[12,3,0],null,[20,3,2],[20,3,2],[20,3,2],[24,4,2],[26,4,2],null,null,[24,4,2],[28,5,2],null]],e=[1,3,4,5,6,7,10,11],r=0;3>r;r++)for(var t=0==r?1:1==r?2:4,y=0==r?1:1==r?3:2,h=0;61>h;h++)if(jb(h,e))for(m=0;61>m;m++)if(1!=t||1!=m>>3)if(a=y<<12|((h&7)<<3|h>>3)<<6|m,-1===v[a].op)v[a]=ia(a,"MOVE",
4==t?f[Ib(m)-1][Ib(h)-1]:d[Ib(m)-1][Ib(h)-1]),v[a].p.sea=m,v[a].p.dea=h,v[a].p.zm=1==t?128:2==t?32768:2147483648,v[a].f=4==t?Fc:2==t?eb:Pc,v[a].d=ha(0,10,m,10,h,t,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVE "+a),!1;d=[[4,1,0],[4,1,0],[8,2,0],[8,2,0],[10,2,0],[12,3,0],[14,3,0],[12,3,0],[14,3,0],[12,3,0],[16,4,0],[8,2,0]];f=[[4,1,0],[4,1,0],[12,3,0],[12,3,0],[14,3,0],[16,4,0],[18,4,0],[16,4,0],[18,4,0],[16,4,0],[20,5,0],[12,3,0]];for(r=1;3>r;r++)for(t=1==r?2:4,y=1==r?3:2,m=0;8>m;m++)for(e=
0;61>e;e++)if(a=y<<12|m<<9|64|e,-1===v[a].op)v[a]=ia(a,"MOVEA",4==t?f[Ib(e)-1]:d[Ib(e)-1]),v[a].p.An=m,v[a].p.ea=e,v[a].f=4==t?Vd:Qd,v[a].d=ha(0,10,e,2,m,t,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVEA "+a),!1;for(f=0;8>f;f++)for(r=0;256>r;r++)if(a=28672|f<<9|r,-1===v[a].op)v[a]=ia(a,"MOVEQ",[4,1,0]),v[a].p.Dn=f,v[a].p.data=r,v[a].p.zm=2147483648,v[a].f=fd,v[a].d=ha(0,6,r,1,f,4,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVEQ "+a),!1;for(r=0;2>r;r++)for(t=0==r?2:4,f=0;2>f;f++)for(h=
0==f?[3,5,6,7,10,11]:[3,4,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=f<<10|18560|r<<6|e,-1===v[a].op){d=Ib(e);if(0==f){switch(d){case 3:q=[8,2,0];break;case 5:q=[8,2,0];break;case 6:q=[12,3,0];break;case 7:q=[14,3,0];break;case 10:q=[12,3,0];break;case 11:q=[16,4,0]}v[a]=ia(a,"MOVEM",q);v[a].f=2==t?bd:ad;v[a].d=ha(1,21,5==d,10,e,t,0)}else{switch(d){case 3:q=[12,3,0];break;case 4:q=[12,3,0];break;case 6:q=[16,4,0];break;case 7:q=[18,4,0];break;case 8:q=[16,4,0];break;case 9:q=[20,5,0];break;case 10:q=
[16,4,0];break;case 11:q=[18,4,0]}v[a]=ia(a,"MOVEM",q);v[a].f=2==t?Sc:pd;v[a].d=ha(1,10,e,21,5==d,t,0)}v[a].p.ea=e;b++}else return SAEF_error("cpu.mkITab() op exists MOVEM "+a),!1;for(d=4;8>d;d++)for(f=0;8>f;f++)for(m=0;8>m;m++)if(a=f<<9|d<<6|8|m,-1===v[a].op)4==d?(v[a]=ia(a,"MOVEP",[16,4,0]),v[a].f=le,v[a].d=ha(0,5,m,1,f,2,0)):5==d?(v[a]=ia(a,"MOVEP",[24,6,0]),v[a].f=ke,v[a].d=ha(0,5,m,1,f,4,0)):6==d?(v[a]=ia(a,"MOVEP",[16,2,2]),v[a].f=jd,v[a].d=ha(0,1,f,5,m,2,0)):(v[a]=ia(a,"MOVEP",[24,2,4]),v[a].f=
Tc,v[a].d=ha(0,1,f,5,m,4,0)),v[a].p.Dn=f,v[a].p.An=m,b++;else return SAEF_error("cpu.mkITab() op exists MOVEP "+a),!1;h=[3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,y=0;2>y;y++)for(f=0;8>f;f++)for(e=0;61>e;e++)if(0==y||1==y&&jb(e,h))if(d=Ib(e),0!=y||2!=d||0!=r)if(a=53248|f<<9|y<<8|r<<6|e,-1===v[a].op)v[a]=ia(a,"ADD",[]),v[a].p.Dn=f,v[a].p.ea=e,v[a].p.zm=4==t?2147483648:2==t?32768:128,0==y?(v[a].p.cyc=V(4==t?1==d||12==d?[8,1,0]:[6,1,0]:[4,1,0],Jb(e,t)),v[a].f=4==t?df:2==t?Ec:ef,v[a].d=ha(0,
10,e,1,f,t,0)):(v[a].p.cyc=V(4==t?[12,1,2]:[8,1,1],Jb(e,t)),v[a].f=4==t?Pd:2==t?Db:yf,v[a].d=ha(0,1,f,10,e,t,0)),b++;else return SAEF_error("cpu.mkITab() op exists ADD "+a),!1;h=[3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,y=0;2>y;y++)for(f=0;8>f;f++)for(e=0;61>e;e++)if(0==y||1==y&&jb(e,h))if(d=Ib(e),0!=y||2!=d||0!=r)if(a=36864|f<<9|y<<8|r<<6|e,-1===v[a].op)v[a]=ia(a,"SUB",[]),v[a].p.Dn=f,v[a].p.ea=e,v[a].p.zm=4==t?2147483648:2==t?32768:128,0==y?(v[a].p.cyc=V(4==t?1==d||12==d?[8,1,0]:[6,
1,0]:[4,1,0],Jb(e,t)),v[a].f=4==t?A:2==t?oa:Zh,v[a].d=ha(0,10,e,1,f,t,0)):(v[a].p.cyc=V(4==t?[12,1,2]:[8,1,1],Jb(e,t)),v[a].f=4==t?X:2==t?Lc:O,v[a].d=ha(0,1,f,10,e,t,0)),b++;else return SAEF_error("cpu.mkITab() op exists SUB "+a),!1;for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,f=0;8>f;f++)for(e=0;61>e;e++)if(d=Ib(e),2!=d||0!=r)if(a=45056|f<<9|r<<6|e,-1===v[a].op)q=4==t?[6,1,0]:[4,1,0],1!=d&&2!=d&&(q=V(q,Jb(e,t))),v[a]=ia(a,"CMP",q),v[a].p.Dn=f,v[a].p.ea=e,v[a].f=4==t?F:2==t?ec:H,v[a].d=ha(0,10,e,1,f,t,0),
b++;else return SAEF_error("cpu.mkITab() op exists CMP "+a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=16896|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[6,1,0]:[4,1,0]:4==t?[12,1,2]:[8,1,1],1==d&&(q=V(q,Jb(e,t))),v[a]=ia(a,"CLR",q),v[a].p.ea=e,v[a].f=4==t?Hg:2==t?hh:zg,v[a].d=ha(0,!1,!1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists CLR "+a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=17408|
r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[6,1,0]:[4,1,0]:4==t?[12,1,2]:[8,1,1],v[a]=ia(a,"NEG",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?yi:2==t?zi:Ai):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?Bi:2==t?Ci:Di),v[a].d=ha(0,!1,!1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists NEG "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|49600|e,-1===v[a].op)q=54,q=1==Ib(e)?[70,1,0]:V([70,1,0],Jb(e,t)),v[a]=ia(a,"MULS",q),v[a].p.Dn=f,v[a].p.ea=e,
v[a].f=Ei,v[a].d=ha(0,10,e,1,f,2,0),b++;else return SAEF_error("cpu.mkITab() op exists MULS "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|49344|e,-1===v[a].op)q=54,q=1==Ib(e)?[q,1,0]:V([q,1,0],Jb(e,t)),v[a]=ia(a,"MULU",q),v[a].p.Dn=f,v[a].p.ea=e,v[a].f=vf,v[a].d=ha(0,10,e,1,f,2,0),b++;else return SAEF_error("cpu.mkITab() op exists MULU "+a),!1;if(68020<=Wa)for(h=[1,3,4,5,6,7,8,9,10,11,12],e=0;61>e;e++)if(jb(e,h))if(a=19456|e,-1===v[a].op)v[a]=ia(a,"MULx",
[40,0,0]),v[a].p.ea=e,v[a].f=Fi,v[a].d=ha(1,10,e,23,0,4,0),b++;else return SAEF_error("cpu.mkITab() op exists MULx "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|33216|e,-1===v[a].op)q=138,q=1==Ib(e)?[q,1,0]:V([q,1,0],Jb(e,t)),v[a]=ia(a,"DIVS",q),v[a].p.Dn=f,v[a].p.ea=e,v[a].f=Ik,v[a].d=ha(0,10,e,1,f,2,0),b++;else return SAEF_error("cpu.mkITab() op exists DIVS "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|32960|
e,-1===v[a].op)q=106,q=1==Ib(e)?[q,1,0]:V([q,1,0],Jb(e,t)),v[a]=ia(a,"DIVU",q),v[a].p.Dn=f,v[a].p.ea=e,v[a].f=Jk,v[a].d=ha(0,10,e,1,f,2,0),b++;else return SAEF_error("cpu.mkITab() op exists DIVU "+a),!1;if(68020<=Wa)for(h=[1,3,4,5,6,7,8,9,10,11,12],e=0;61>e;e++)if(jb(e,h))if(a=19520|e,-1===v[a].op)v[a]=ia(a,"DIVx",[70,0,0]),v[a].p.ea=e,v[a].f=$d,v[a].d=ha(1,10,e,24,0,4,0),b++;else return SAEF_error("cpu.mkITab() op exists DIVx "+a),!1;for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;2>e;e++)for(f=0;8>f;f++)for(h=
0;8>h;h++)if(a=f<<9|53504|r<<6|e<<3|h,-1===v[a].op)q=0==e?4==t?[8,1,0]:[4,1,0]:4==t?[30,5,2]:[18,3,1],v[a]=ia(a,"ADDX",q),v[a].p.Rx=f,v[a].p.Ry=h,0==e?(v[a].f=4==t?Hi:2==t?Jj:Ij,v[a].d=ha(0,1,h,1,f,t,0)):(v[a].f=4==t?Ii:2==t?Lj:Kj,v[a].d=ha(0,3,h,3,f,t,0)),b++;else return SAEF_error("cpu.mkITab() op exists ADDX "+a),!1;for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;2>e;e++)for(f=0;8>f;f++)for(h=0;8>h;h++)if(a=h<<9|37120|r<<6|e<<3|f,-1===v[a].op)q=0==e?4==t?[8,1,0]:[4,1,0]:4==t?[30,5,2]:[18,3,1],v[a]=ia(a,
"SUBX",q),v[a].p.Rx=f,v[a].p.Ry=h,0==e?(v[a].f=4==t?Ji:2==t?Tj:Sj,v[a].d=ha(0,1,f,1,h,t,0)):(v[a].f=4==t?Ki:2==t?Pj:Oj,v[a].d=ha(0,3,f,3,h,t,0)),b++;else return SAEF_error("cpu.mkITab() op exists SUBX "+a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=16384|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[6,1,0]:[4,1,0]:4==t?[12,1,2]:[8,1,1],v[a]=ia(a,"NEGX",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?Li:2==t?Rj:Qj):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=
4==t?Mi:2==t?Nj:Mj),v[a].d=ha(0,!1,!1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists NEGX "+a),!1;for(r=1;3>r;r++)for(t=1==r?2:4,y=1==r?3:7,m=0;8>m;m++)for(e=0;61>e;e++)if(a=53248|m<<9|y<<6|e,-1===v[a].op)q=4==t?1==d||2==d||12==d?[8,1,0]:[6,1,0]:[8,1,0],1!=d&&2!=d&&(q=V(q,Jb(e,t))),v[a]=ia(a,"ADDA",q),v[a].p.An=m,v[a].p.ea=e,v[a].f=4==t?Ni:bk,v[a].d=ha(0,10,e,2,m,t,0),b++;else return SAEF_error("cpu.mkITab() op exists ADDA "+a),!1;for(r=1;3>r;r++)for(t=1==r?2:4,y=1==r?3:7,m=0;8>m;m++)for(e=
0;61>e;e++)if(a=36864|m<<9|y<<6|e,-1===v[a].op)q=4==t?1==d||2==d||12==d?[8,1,0]:[6,1,0]:[8,1,0],1!=d&&2!=d&&(q=V(q,Jb(e,t))),v[a]=ia(a,"SUBA",q),v[a].p.An=m,v[a].p.ea=e,v[a].f=4==t?ak:Oi,v[a].d=ha(0,10,e,2,m,t,0),b++;else return SAEF_error("cpu.mkITab() op exists SUBA "+a),!1;for(r=1;3>r;r++)for(t=1==r?2:4,y=1==r?3:7,m=0;8>m;m++)for(e=0;61>e;e++)if(a=45056|m<<9|y<<6|e,-1===v[a].op)q=[6,1,0],1!=d&&2!=d&&(q=V(q,Jb(e,t))),v[a]=ia(a,"CMPA",q),v[a].p.An=m,v[a].p.ea=e,v[a].f=4==t?Xj:Wj,v[a].d=ha(0,10,e,
2,m,t,0),b++;else return SAEF_error("cpu.mkITab() op exists CMPA "+a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=1536|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[16,3,0]:[8,2,0]:4==t?[20,3,2]:[12,2,1],v[a]=ia(a,"ADDI",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?Pi:2==t?Zj:Yj):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?Qi:2==t?Vj:Uj),v[a].d=ha(0,7,4==t?2:1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists ADDI "+a),!1;h=[1,3,4,5,6,7,10,
11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=1024|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[16,3,0]:[8,2,0]:4==t?[20,3,2]:[12,2,1],v[a]=ia(a,"SUBI",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?ck:2==t?kk:gk):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?sk:2==t?ok:dk),v[a].d=ha(0,7,4==t?2:1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists SUBI "+a),!1;h=[1,3,4,5,6,7,10,11];68020<=Wa&&h.push(8,9);for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=
3072|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[14,3,0]:[8,2,0]:4==t?[12,3,0]:[8,2,0],1!=d&&(q=V(q,Jb(e,t))),v[a]=ia(a,"CMPI",q),v[a].p.ea=e,v[a].f=4==t?lk:2==t?hk:tk,v[a].d=ha(0,7,4==t?2:1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists CMPI "+a),!1;h=[1,2,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h)&&(d=Ib(e),2!=d||0!=r))if(a=20480|f<<9|r<<6|e,-1===v[a].op)q=2==d?[8,1,0]:1==d?4==t?[8,1,0]:[4,1,0]:4==t?[12,1,2]:[8,1,1],v[a]=ia(a,"ADDQ",
q),v[a].p.data=0==f?8:f,1==d?(v[a].p.Dn=e&7,v[a].f=4==t?pk:2==t?aj:mj):2==d?(v[a].p.An=e&7,v[a].f=Vi):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?gj:2==t?sj:Ej),v[a].d=ha(0,6,0==f?8:f,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists ADDQ "+a),!1;h=[1,2,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h)&&(d=Ib(e),2!=d||0!=r))if(a=f<<9|20736|r<<6|e,-1===v[a].op)q=2==d?[8,1,0]:1==d?4==t?[8,1,0]:[4,1,0]:4==t?[12,1,2]:[8,1,1],v[a]=ia(a,
"SUBQ",q),v[a].p.data=0==f?8:f,1==d?(v[a].p.Dn=e&7,v[a].f=4==t?yj:2==t?Zi:kj):2==d?(v[a].p.An=e&7,v[a].f=Ti):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?ej:2==t?qj:Cj),v[a].d=ha(0,6,0==f?8:f,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists SUBQ "+a),!1;for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,d=0;8>d;d++)for(e=0;8>e;e++)if(a=d<<9|45312|r<<6|8|e,-1===v[a].op)v[a]=ia(a,"CMPM",4==t?[20,5,0]:[12,3,0]),v[a].p.Ax=d,v[a].p.Ay=e,v[a].f=4==t?wj:2==t?Ui:fj,v[a].d=ha(0,4,e,4,d,t,0),b++;
else return SAEF_error("cpu.mkITab() op exists CMPM "+a),!1;for(r=1;3>r;r++)for(t=1==r?2:4,e=1==r?2:3,f=0;8>f;f++)if(a=18432|e<<6|f,-1===v[a].op)v[a]=ia(a,"EXT",[4,1,0]),v[a].p.Dn=f,v[a].f=4==t?rj:$i,v[a].d=ha(0,!1,!1,1,f,t,0),b++;else return SAEF_error("cpu.mkITab() op exists EXT "+a),!1;if(68020<=Wa)for(f=0;8>f;f++)if(a=18880|f,-1===v[a].op)v[a]=ia(a,"EXTB",[4,1,0]),v[a].p.Dn=f,v[a].f=lj,v[a].d=ha(0,!1,!1,1,f,4,0),b++;else return SAEF_error("cpu.mkITab() op exists EXTB "+a),!1;h=[1,3,4,5,6,7,8,
9,10,11,12];m=[3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,y=0;2>y;y++)for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,0==y?h:m))if(a=49152|f<<9|y<<8|r<<6|e,-1===v[a].op)v[a]=ia(a,"AND",[]),v[a].p.Dn=f,v[a].p.ea=e,v[a].p.zm=4==t?2147483648:2==t?32768:128,0==y?(d=Ib(e),v[a].p.cyc=V(4==t?1==d||12==d?[8,1,0]:[6,1,0]:[4,1,0],Jb(e,t)),v[a].f=4==t?Dj:2==t?xj:ek,v[a].d=ha(0,10,e,1,f,t,0)):(v[a].p.cyc=V(4==t?[12,1,2]:[8,1,1],Jb(e,t)),v[a].f=4==t?mk:2==t?ik:uk,v[a].d=ha(0,1,f,10,e,t,0)),b++;else return SAEF_error("cpu.mkITab() op exists AND "+
a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,y=0==r?4:1==r?5:6,f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=45056|f<<9|y<<6|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"EOR",4==t?[8,1,0]:[4,1,0]),v[a].p.Dn=f,v[a].p.zm=4==t?2147483648:2==t?32768:128,1==d?(v[a].p.Dd=e&7,v[a].f=4==t?qk:2==t?fk:nk):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?jk:2==t?vk:rk),v[a].d=ha(0,1,f,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists EOR "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];m=[3,
4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,y=0;2>y;y++)for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,0==y?h:m))if(a=32768|f<<9|y<<8|r<<6|e,-1===v[a].op)v[a]=ia(a,"OR",[]),v[a].p.Dn=f,v[a].p.ea=e,v[a].p.zm=4==t?2147483648:2==t?32768:128,0==y?(d=Ib(e),v[a].p.cyc=V(4==t?1==d||12==d?[8,1,0]:[6,1,0]:[4,1,0],Jb(e,t)),v[a].f=4==t?Bj:2==t?Wi:hj,v[a].d=ha(0,10,e,1,f,t,0)):(v[a].p.cyc=V(4==t?[12,1,2]:[8,1,1],Jb(e,t)),v[a].f=4==t?bj:2==t?tj:nj,v[a].d=ha(0,1,f,10,e,t,0)),b++;else return SAEF_error("cpu.mkITab() op exists OR "+
a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=17920|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[6,1,0]:[4,1,0]:4==t?[12,1,2]:[8,1,1],v[a]=ia(a,"NOT",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?Yi:2==t?jj:dj):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?vj:2==t?pj:Hj),v[a].p.m=4==t?4294967295:2==t?65535:255,v[a].p.zm=4==t?2147483648:2==t?32768:128,v[a].d=ha(0,!1,!1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists NOT "+a),!1;h=[1,3,4,5,
6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=512|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[16,3,0]:[8,2,0]:4==t?[20,3,1]:[12,2,1],v[a]=ia(a,"ANDI",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?Fj:2==t?zj:Xi):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?ij:2==t?cj:uj),v[a].p.zm=4==t?2147483648:2==t?32768:128,v[a].d=ha(0,7,4==t?2:1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists ANDI "+a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=
0;61>e;e++)if(jb(e,h))if(a=2560|r<<6|e,-1===v[a].op)d=Ib(e),q=1==d?4==t?[16,3,0]:[8,2,0]:4==t?[20,3,1]:[12,2,1],v[a]=ia(a,"EORI",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?oj:2==t?Gj:Aj):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?Zb:2==t?we:$h),v[a].p.zm=4==t?2147483648:2==t?32768:128,v[a].d=ha(0,7,4==t?2:1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists EORI "+a),!1;h=[1,3,4,5,6,7,10,11];for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=r<<6|e,-1===v[a].op)d=
Ib(e),q=1==d?4==t?[16,3,0]:[8,2,0]:4==t?[20,3,1]:[12,2,1],v[a]=ia(a,"ORI",q),1==d?(v[a].p.Dn=e&7,v[a].f=4==t?Mc:2==t?pe:Jh):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,t)),v[a].f=4==t?Gc:2==t?hi:yh),v[a].p.zm=4==t?2147483648:2==t?32768:128,v[a].d=ha(0,7,4==t?2:1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists ORI "+a),!1;for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,f=0;2>f;f++)for(d=0;2>d;d++)for(e=0;8>e;e++)for(h=0;8>h;h++)if(a=57344|e<<9|f<<8|r<<6|d<<5|h,-1===v[a].op)v[a]=ia(a,0==f?"ASR":"ASL",
4==t?[8,1,0]:[6,1,0]),v[a].p.ir=d,v[a].p.cr=0==d?0==e?8:e:e,v[a].p.Dy=h,v[a].f=0==f?4==t?hg:2==t?Pb:ib:4==t?zh:2==t?fi:gi,v[a].d=ha(0,0==d?6:1,0==d?0==e?8:e:e,1,h,t,0),b++;else return SAEF_error("cpu.mkITab() op exists ASx "+a),!1;h=[3,4,5,6,7,10,11];for(f=0;2>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<8|57536|e,-1===v[a].op)v[a]=ia(a,0==f?"ASR":"ASL",V([8,1,1],Jb(e,2))),v[a].p.ea=e,v[a].f=0==f?qh:Jg,v[a].d=ha(0,!1,!1,10,e,2,0),b++;else return SAEF_error("cpu.mkITab() op exists ASx "+a),!1;for(r=0;3>
r;r++)for(t=0==r?1:1==r?2:4,f=0;2>f;f++)for(d=0;2>d;d++)for(e=0;8>e;e++)for(h=0;8>h;h++)if(a=57344|e<<9|f<<8|r<<6|d<<5|8|h,-1===v[a].op)v[a]=ia(a,0==f?"LSR":"LSL",4==t?[8,1,0]:[6,1,0]),v[a].p.ir=d,v[a].p.cr=0==d?0==e?8:e:e,v[a].p.Dy=h,v[a].f=0==f?4==t?xc:2==t?yc:zc:4==t?rh:2==t?Vc:Wc,v[a].d=ha(0,0==d?6:1,0==d?0==e?8:e:e,1,h,t,0),b++;else return SAEF_error("cpu.mkITab() op exists LSx "+a),!1;h=[3,4,5,6,7,10,11];for(f=0;2>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<8|58048|e,-1===v[a].op)v[a]=ia(a,0==
f?"LSR":"LSL",V([8,1,1],Jb(e,2))),v[a].p.ea=e,v[a].f=0==f?Kg:Ac,v[a].d=ha(0,!1,!1,10,e,2,0),b++;else return SAEF_error("cpu.mkITab() op exists LSx "+a),!1;for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,f=0;2>f;f++)for(d=0;2>d;d++)for(e=0;8>e;e++)for(h=0;8>h;h++)if(a=57344|e<<9|f<<8|r<<6|d<<5|24|h,-1===v[a].op)v[a]=ia(a,0==f?"ROR":"ROL",4==t?[8,1,0]:[6,1,0]),v[a].p.ir=d,v[a].p.cr=0==d?0==e?8:e:e,v[a].p.Dy=h,v[a].f=0==f?4==t?ub:2==t?aa:da:4==t?oi:2==t?ra:ci,v[a].d=ha(0,0==d?6:1,0==d?0==e?8:e:e,1,h,t,0),b++;
else return SAEF_error("cpu.mkITab() op exists ROx "+a),!1;h=[3,4,5,6,7,10,11];for(f=0;2>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<8|59072|e,-1===v[a].op)v[a]=ia(a,0==f?"ROR":"ROL",V([8,1,1],Jb(e,2))),v[a].p.ea=e,v[a].f=0==f?Bf:Af,v[a].d=ha(0,!1,!1,10,e,2,0),b++;else return SAEF_error("cpu.mkITab() op exists ROx "+a),!1;for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,f=0;2>f;f++)for(d=0;2>d;d++)for(e=0;8>e;e++)for(h=0;8>h;h++)if(a=57344|e<<9|f<<8|r<<6|d<<5|16|h,-1===v[a].op)v[a]=ia(a,0==f?"ROR":"ROL",4==t?
[8,1,0]:[6,1,0]),v[a].p.ir=d,v[a].p.cr=0==d?0==e?8:e:e,v[a].p.Dy=h,v[a].f=0==f?4==t?lh:2==t?dg:th:4==t?ic:2==t?nh:mh,v[a].d=ha(0,0==d?6:1,0==d?0==e?8:e:e,1,h,t,0),b++;else return SAEF_error("cpu.mkITab() op exists ROx "+a),!1;h=[3,4,5,6,7,10,11];for(f=0;2>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<8|58560|e,-1===v[a].op)v[a]=ia(a,0==f?"ROXR":"ROXL",V([8,1,1],Jb(e,2))),v[a].p.ea=e,v[a].f=0==f?vh:fg,v[a].d=ha(0,!1,!1,10,e,2,0),b++;else return SAEF_error("cpu.mkITab() op exists ROx "+a),!1;for(f=0;8>
f;f++)if(a=18496|f,-1===v[a].op)v[a]=ia(a,"SWAP",[4,1,0]),v[a].p.Dn=f,v[a].f=eg,v[a].d=ha(0,!1,!1,1,f,2,0),b++;else return SAEF_error("cpu.mkITab() op exists SWAP "+a),!1;h=[1,3,4,5,6,7,10,11];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|320|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"BCHG",1==d?[8,1,0]:[8,1,1]),v[a].p.Dn=f,1==d?(v[a].p.Dd=e&7,v[a].f=uh):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=S),v[a].d=ha(0,1,f,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BCHG1 "+
a),!1;for(e=0;61>e;e++)if(jb(e,h))if(a=2112|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"BCHG",1==d?[12,2,0]:[12,2,1]),1==d?(v[a].p.Dd=e&7,v[a].f=bi):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=C),v[a].d=ha(0,7,1,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BCHG "+a),!1;h=[1,3,4,5,6,7,10,11];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|384|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"BCLR",1==d?[10,1,0]:[8,1,1]),v[a].p.Dn=f,1==d?(v[a].p.Dd=e&7,v[a].f=fb):(v[a].p.ea=e,v[a].p.cyc=
V(v[a].p.cyc,Jb(e,1)),v[a].f=D),v[a].d=ha(0,1,f,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BCLR "+a),!1;for(e=0;61>e;e++)if(jb(e,h))if(a=2176|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"BCLR",1==d?[14,2,0]:[12,2,1]),1==d?(v[a].p.Dd=e&7,v[a].f=If):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=Ye),v[a].d=ha(0,7,1,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BCLR "+a),!1;h=[1,3,4,5,6,7,10,11];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|448|e,-1===
v[a].op)d=Ib(e),v[a]=ia(a,"BSET",1==d?[8,1,0]:[8,1,1]),v[a].p.Dn=f,1==d?(v[a].p.Dd=e&7,v[a].f=Ze):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=Jf),v[a].d=ha(0,1,f,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BSET "+a),!1;for(e=0;61>e;e++)if(jb(e,h))if(a=2240|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"BSET",1==d?[12,2,0]:[12,2,1]),1==d?(v[a].p.Dd=e&7,v[a].f=yd):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=$c),v[a].d=ha(0,7,1,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BSET "+
a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(f=0;8>f;f++)for(e=0;61>e;e++)if(jb(e,h))if(a=f<<9|256|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"BTST",1==d?[6,1,0]:[4,1,0]),v[a].p.Dn=f,1==d?(v[a].p.Dd=e&7,v[a].f=ya):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=Kk),v[a].d=ha(0,1,f,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BTST "+a),!1;h=[1,3,4,5,6,7,8,9,10,11];for(e=0;61>e;e++)if(jb(e,h))if(a=2048|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"BTST",1==d?[12,2,0]:[8,2,0]),1==d?(v[a].p.Dd=e&7,v[a].f=
Ma):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=B),v[a].d=ha(0,7,1,10,e,1==d?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BTST "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=60096|e,-1===v[a].op)v[a]=ia(a,"BFCHG",[4,1,0]),v[a].p.id=1,v[a].p.ea=e,v[a].f=Ad,v[a].d=ha(1,10,e,20,0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFCHG "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=60608|e,-1===v[a].op)v[a]=ia(a,"BFCLR",
[4,1,0]),v[a].p.id=2,v[a].p.ea=e,v[a].f=Ad,v[a].d=ha(1,10,e,20,0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFCLR "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=60352|e,-1===v[a].op)v[a]=ia(a,"BFEXTS",[4,1,0]),v[a].p.id=3,v[a].p.ea=e,v[a].f=Ad,v[a].d=ha(1,10,e,20,0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFEXTS "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=59840|e,-1===v[a].op)v[a]=ia(a,"BFEXTU",[4,1,0]),v[a].p.id=
4,v[a].p.ea=e,v[a].f=Ad,v[a].d=ha(1,10,e,20,0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFEXTU "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=60864|e,-1===v[a].op)v[a]=ia(a,"BFFFO",[4,1,0]),v[a].p.id=5,v[a].p.ea=e,v[a].f=Ad,v[a].d=ha(1,10,e,20,0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFFFO "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,10,11],e=0;61>e;e++)if(jb(e,h))if(a=61376|e,-1===v[a].op)v[a]=ia(a,"BFINS",[4,1,0]),v[a].p.id=6,v[a].p.ea=e,v[a].f=
Ad,v[a].d=ha(1,10,e,20,0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFINS "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,10,11],e=0;61>e;e++)if(jb(e,h))if(a=61120|e,-1===v[a].op)v[a]=ia(a,"BFSET",[4,1,0]),v[a].p.id=7,v[a].p.ea=e,v[a].f=Ad,v[a].d=ha(1,10,e,20,0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFSET "+a),!1;if(68020<=Wa)for(h=[1,3,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=59584|e,-1===v[a].op)v[a]=ia(a,"BFTST",[4,1,0]),v[a].p.id=8,v[a].p.ea=e,v[a].f=Ad,v[a].d=ha(1,10,e,20,
0,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BFTST "+a),!1;for(f=0;8>f;f++)for(e=0;2>e;e++)for(h=0;8>h;h++)if(a=f<<9|49408|e<<3|h,-1===v[a].op)v[a]=ia(a,"ABCD",0==e?[6,1,0]:[18,3,1]),v[a].p.Rx=f,v[a].p.Ry=h,0==e?(v[a].f=Ug,v[a].d=ha(0,1,h,1,f,1,0)):(v[a].f=Hf,v[a].d=ha(0,3,h,3,f,1,0)),b++;else return SAEF_error("cpu.mkITab() op exists ABCD "+a),!1;for(h=0;8>h;h++)for(e=0;2>e;e++)for(f=0;8>f;f++)if(a=h<<9|33024|e<<3|f,-1===v[a].op)v[a]=ia(a,"SBCD",0==e?[6,1,0]:[18,3,1]),v[a].p.Ry=h,v[a].p.Rx=
f,0==e?(v[a].f=zd,v[a].d=ha(0,1,f,1,h,1,0)):(v[a].f=wh,v[a].d=ha(0,3,f,3,h,1,0)),b++;else return SAEF_error("cpu.mkITab() op exists SBCD "+a),!1;h=[1,3,4,5,6,7,10,11];for(e=0;61>e;e++)if(jb(e,h))if(a=18432|e,-1===v[a].op)d=Ib(e),v[a]=ia(a,"NBCD",1==d?[6,1,0]:[8,1,1]),1==d?(v[a].p.Dd=e&7,v[a].f=Pg):(v[a].p.ea=e,v[a].p.cyc=V(v[a].p.cyc,Jb(e,1)),v[a].f=fc),v[a].d=ha(0,!1,!1,10,e,1,0),b++;else return SAEF_error("cpu.mkITab() op exists NBCD "+a),!1;if(68020<=Wa)for(h=0;8>h;h++)for(e=0;2>e;e++)for(f=0;8>
f;f++)if(a=h<<9|33088|e<<3|f,-1===v[a].op)v[a]=ia(a,"PACK",[4,0,0]),v[a].p.Ry=h,v[a].p.Rx=f,0==e?(v[a].f=re,v[a].d=ha(1,1,f,1,h,0,0)):(v[a].f=He,v[a].d=ha(1,3,f,3,h,0,0)),b++;else return SAEF_error("cpu.mkITab() op exists PACK "+a),!1;if(68020<=Wa)for(h=0;8>h;h++)for(e=0;2>e;e++)for(f=0;8>f;f++)if(a=h<<9|33152|e<<3|f,-1===v[a].op)v[a]=ia(a,"PACK",[4,0,0]),v[a].p.Ry=h,v[a].p.Rx=f,0==e?(v[a].f=Ge,v[a].d=ha(1,1,f,1,h,0,0)):(v[a].f=Wb,v[a].d=ha(1,3,f,3,h,0,0)),b++;else return SAEF_error("cpu.mkITab() op exists UNPK "+
a),!1;for(d=2;16>d;d++)for(t=0;t<(68020<=Wa?256:255);t++)if(a=24576|d<<8|t,-1===v[a].op)v[a]=ia(a,"B"+Yc[d],255==t?[12,1,0]:[8,1,0]),v[a].p.cc=d,v[a].p.dp=t,v[a].p.cycTaken=[10,2,2],v[a].f=vd,v[a].d=ha(0,!1,!1,8,t,255==t?2:1,0),b++;else return SAEF_error("cpu.mkITab() op exists B"+Yc[d]+" "+a),!1;for(d=0;16>d;d++)for(f=0;8>f;f++)if(a=d<<8|20680|f,-1===v[a].op)v[a]=ia(a,"DB"+Yc[d],[10,2,0]),v[a].p.cc=d,v[a].p.Dn=f,v[a].p.cycNotTakenTrue=[12,2,0],v[a].p.cycNotTakenFalse=[14,3,0],v[a].f=xe,v[a].d=ha(0,
1,f,8,0,2,0),b++;else return SAEF_error("cpu.mkITab() op exists DB"+Yc[d]+" "+a),!1;h=[1,3,4,5,6,7,10,11];for(d=0;16>d;d++)for(e=0;61>e;e++)if(jb(e,h))if(a=d<<8|20672|e,-1===v[a].op)q=1==Ib(e)?[8,1,1]:V([8,1,1],Jb(e,1)),v[a]=ia(a,"S"+Yc[d],q),v[a].p.cc=d,v[a].p.ea=e,v[a].p.cycFalse=[4,1,0],v[a].p.cycTrue=[6,1,0],v[a].f=Ue,v[a].d=ha(0,!1,!1,10,e,1,0),b++;else return SAEF_error("cpu.mkITab() op exists S"+Yc[d]+" "+a),!1;for(t=0;t<(68020<=Wa?256:255);t++)if(a=24576|t,-1===v[a].op)v[a]=ia(a,"BRA",[10,
2,0]),v[a].p.dp=t,v[a].f=oe,v[a].d=ha(0,!1,!1,8,t,0==t?2:255==t?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BRA "+a),!1;for(t=0;t<(68020<=Wa?256:255);t++)if(a=24832|t,-1===v[a].op)v[a]=ia(a,"BSR",[18,2,2]),v[a].p.dp=t,v[a].f=Be,v[a].d=ha(0,!1,!1,8,t,0==t?2:255==t?4:1,0),b++;else return SAEF_error("cpu.mkITab() op exists BSR "+a),!1;h=[3,6,7,8,9,10,11];for(e=0;61>e;e++)if(jb(e,h))if(a=20160|e,-1===v[a].op){switch(Ib(e)){case 3:q=[8,2,0];break;case 6:q=[10,2,0];break;case 7:q=[14,3,0];
break;case 8:q=[10,2,0];break;case 9:q=[14,3,0];break;case 10:q=[10,2,0];break;case 11:q=[12,3,0]}v[a]=ia(a,"JMP",q);v[a].p.ea=e;v[a].f=Wd;v[a].d=ha(0,!1,!1,10,e,0,0);b++}else return SAEF_error("cpu.mkITab() op exists JMP "+a),!1;h=[3,6,7,8,9,10,11];for(e=0;61>e;e++)if(jb(e,h))if(a=20096|e,-1===v[a].op){switch(Ib(e)){case 3:q=[16,2,2];break;case 6:q=[18,2,2];break;case 7:q=[22,2,2];break;case 8:q=[18,2,2];break;case 9:q=[22,2,2];break;case 10:q=[18,2,2];break;case 11:q=[20,3,2]}v[a]=ia(a,"JSR",q);
v[a].p.ea=e;v[a].f=Rd;v[a].d=ha(0,!1,!1,10,e,0,0);b++}else return SAEF_error("cpu.mkITab() op exists JSR "+a),!1;a=20081;if(-1===v[a].op)v[a]=ia(a,"NOP",[4,1,0]),v[a].f=Ch,v[a].d=ha(0,!1,!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists NOP "+a),!1;if(68010<=Wa)if(a=20084,-1===v[a].op)v[a]=ia(a,"RTD",[4,0,0]),v[a].f=Xd,v[a].d=ha(0,!1,!1,7,1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists RTD "+a),!1;a=20087;if(-1===v[a].op)v[a]=ia(a,"RTR",[20,5,0]),v[a].f=Dh,v[a].d=ha(0,!1,
!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists RTR "+a),!1;a=20085;if(-1===v[a].op)v[a]=ia(a,"RTS",[16,4,0]),v[a].f=Eh,v[a].d=ha(0,!1,!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists RTS "+a),!1;h=[1,2,3,4,5,6,7,10,11,12];68020<=Wa&&h.push(8,9);for(r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h)&&(d=Ib(e),!(68020<=Wa&&0==r&&2==d)))if(a=18944|r<<6|e,-1===v[a].op)q=1==d||2==d?[4,1,0]:V([4,1,0],Jb(e,t)),v[a]=ia(a,"TST",q),v[a].p.ea=e,v[a].p.zm=4==t?2147483648:
2==t?32768:128,v[a].f=4==t?hf:2==t?Id:Xe,v[a].d=ha(0,!1,!1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists TST "+a),!1;a=572;if(-1===v[a].op)v[a]=ia(a,"ANDI",[20,3,0]),v[a].f=Sg,v[a].d=ha(0,7,1,11,0,1,0),b++;else return SAEF_error("cpu.mkITab() op exists ANDI_CCR "+a),!1;a=2620;if(-1===v[a].op)v[a]=ia(a,"EORI",[20,3,0]),v[a].f=Gb,v[a].d=ha(0,7,1,11,0,1,0),b++;else return SAEF_error("cpu.mkITab() op exists EORI "+a),!1;a=60;if(-1===v[a].op)v[a]=ia(a,"ORI",[20,3,0]),v[a].f=Eb,v[a].d=ha(0,
7,1,11,0,1,0),b++;else return SAEF_error("cpu.mkITab() op exists ORI_CCR "+a),!1;if(68010<=Wa)for(h=[1,3,4,5,6,7,10,11],e=0;61>e;e++)if(jb(e,h))if(a=17088|e,-1===v[a].op)v[a]=ia(a,"MOVE",[4,1,0]),v[a].p.ea=e,v[a].f=Ya,v[a].d=ha(0,11,0,10,e,2,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVE_CCR2 "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(e=0;61>e;e++)if(jb(e,h))if(a=17600|e,-1===v[a].op)q=1==Ib(e)?[12,1,0]:V([12,1,0],Jb(e,2)),v[a]=ia(a,"MOVE",q),v[a].p.ea=e,v[a].f=Fb,v[a].d=ha(0,10,e,11,0,
2,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVE_2CCR "+a),!1;a=636;if(-1===v[a].op)v[a]=ia(a,"ANDI",[20,3,0]),v[a].f=gb,v[a].d=ha(0,7,1,12,0,2,0),b++;else return SAEF_error("cpu.mkITab() op exists ANDI_SR "+a),!1;a=2684;if(-1===v[a].op)v[a]=ia(a,"EORI",[20,3,0]),v[a].f=Ce,v[a].d=ha(0,7,1,12,0,2,0),b++;else return SAEF_error("cpu.mkITab() op exists EORI "+a),!1;a=124;if(-1===v[a].op)v[a]=ia(a,"ORI",[20,3,0]),v[a].f=Df,v[a].d=ha(0,7,1,12,0,2,0),b++;else return SAEF_error("cpu.mkITab() op exists ORI_SR "+
a),!1;h=[1,3,4,5,6,7,10,11];for(e=0;61>e;e++)if(jb(e,h))if(a=16576|e,-1===v[a].op)q=1==Ib(e)?[6,1,0]:V([8,1,1],Jb(e,2)),v[a]=ia(a,"MOVE",q),v[a].p.ea=e,v[a].f=di,v[a].d=ha(0,12,0,10,e,2,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVE_SR2 "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(e=0;61>e;e++)if(jb(e,h))if(a=18112|e,-1===v[a].op)q=1==Ib(e)?[12,1,0]:V([12,1,0],Jb(e,2)),v[a]=ia(a,"MOVE",q),v[a].p.ea=e,v[a].f=Mg,v[a].d=ha(0,10,e,12,0,2,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVE_2SR "+
a),!1;for(f=0;2>f;f++)for(m=0;8>m;m++)if(a=20064|f<<3|m,-1===v[a].op)v[a]=ia(a,"MOVE",[4,1,0]),v[a].p.An=m,0==f?(v[a].f=ei,v[a].d=ha(0,2,m,13,0,4,0)):(v[a].f=zf,v[a].d=ha(0,13,0,2,m,4,0)),b++;else return SAEF_error("cpu.mkITab() op exists MOVE_USP "+a),!1;if(68010<=Wa)for(f=0;2>f;f++)if(a=20090|f,-1===v[a].op)v[a]=ia(a,"MOVEC",[4,0,0]),v[a].f=0==f?gc:xh,v[a].d=ha(1,!1,!1,22,0==f,4,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVEC "+a),!1;if(68010<=Wa)for(h=[3,4,5,6,7,10,11],r=0;3>r;r++)for(t=
0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=3584|r<<6|e,-1===v[a].op)v[a]=ia(a,"MOVES",[4,0,0]),v[a].p.ea=e,v[a].f=4==t?mc:2==t?oh:Cf,v[a].d=ha(1,!1,!1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists MOVES "+a),!1;if(68010<=Wa)for(t=0;8>t;t++)if(a=18504|t,-1===v[a].op)v[a]=ia(a,"BKPT",[45,5,4]),v[a].p.v=t,v[a].f=cg,v[a].d=ha(0,!1,!1,6,t,0,0),b++;else return SAEF_error("cpu.mkITab() op exists BKPT "+a),!1;h=[1,3,4,5,6,7,8,9,10,11,12];for(f=0;8>f;f++)for(r=0;r<(68020<=Wa?2:1);r++)for(t=
0==r?2:4,y=0==r?3:2,e=0;61>e;e++)if(jb(e,h))if(a=16384|f<<9|y<<7|e,-1===v[a].op)q=1==Ib(e)?[10,1,0]:V([10,1,0],Jb(e,t)),v[a]=ia(a,"CHK",q),v[a].p.Dn=f,v[a].p.ea=e,v[a].f=2==t?rd:Tg,v[a].d=ha(0,10,e,1,f,t,0),b++;else return SAEF_error("cpu.mkITab() op exists CHK "+a),!1;if(68020<=Wa)for(h=[3,6,7,8,9,10,11],r=0;3>r;r++)for(t=0==r?1:1==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=r<<9|192|e,-1===v[a].op)q=1==Ib(e)?[10,1,0]:V([10,1,0],Jb(e,t)),v[a]=ia(a,"CHK2",q),v[a].p.ea=e,v[a].f=4==t?Kd:2==t?Bh:qe,v[a].d=ha(1,
!1,!1,10,e,t,0),b++;else return SAEF_error("cpu.mkITab() op exists CHK2 "+a),!1;a=19196;if(-1===v[a].op)v[a]=ia(a,"ILLEGAL",[0,0,0]),v[a].f=Ih,v[a].d=ha(0,!1,!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists ILLEGAL "+a),!1;a=20080;if(-1===v[a].op)v[a]=ia(a,"RESET",[132,1,0]),v[a].f=bf,v[a].d=ha(0,!1,!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists RESET "+a),!1;a=20083;if(-1===v[a].op)v[a]=ia(a,"RTE",[20,5,0]),v[a].f=Ob,v[a].d=ha(0,!1,!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists RTE "+
a),!1;a=20082;if(-1===v[a].op)v[a]=ia(a,"STOP",[4,0,0]),v[a].f=Zc,v[a].d=ha(0,!1,!1,7,1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists STOP "+a),!1;for(t=0;16>t;t++)if(a=20032|t,-1===v[a].op)v[a]=ia(a,"TRAP",[38,4,3]),v[a].p.v=t,v[a].f=wc,v[a].d=ha(0,!1,!1,6,t,0,0),b++;else return SAEF_error("cpu.mkITab() op exists TRAP "+a),!1;if(68020<=Wa)for(r=0;3>r;r++)for(t=0==r?0:1==r?2:4,e=0==r?4:1==r?2:3,d=0;16>d;d++)if(a=d<<8|20728|e,-1===v[a].op)v[a]=ia(a,"TRAP"+Yc[d],[4,1,0]),v[a].p.cc=d,v[a].f=
4==t?ze:2==t?de:Nc,t&&(v[a].d=ha(0,!1,!1,6,2==t?1:2,t,0)),b++;else return SAEF_error("cpu.mkITab() op exists TRAP"+Yc[d]+" "+a),!1;a=20086;if(-1===v[a].op)v[a]=ia(a,"TRAPV",[4,1,0]),v[a].f=ff,v[a].d=ha(0,!1,!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists TRAPV "+a),!1;if(68020<=Wa)for(h=[3,4,5,6,7,10,11],r=1;3>=r;r++)for(t=1==r?1:2==r?2:4,e=0;61>e;e++)if(jb(e,h))if(a=r<<9|2240|e,-1===v[a].op)v[a]=ia(a,"CAS",[4,0,0]),v[a].p.ea=e,v[a].f=4==t?ph:2==t?ye:me,v[a].d=ha(1,!1,!1,10,e,t,0),
b++;else return SAEF_error("cpu.mkITab() op exists CAS "+a),!1;if(68020<=Wa)for(r=2;3>=r;r++)if(t=2==r?2:4,a=r<<9|2300,-1===v[a].op)v[a]=ia(a,"CAS2",[4,0,0]),v[a].f=4==t?cd:ce,v[a].d=ha(2,!1,!1,!1,!1,t,0),b++;else return SAEF_error("cpu.mkITab() op exists CAS2 "+a),!1;h=[1,3,4,5,6,7,10,11];for(e=0;61>e;e++)if(jb(e,h))if(a=19136|e,-1===v[a].op)q=1==Ib(e)?[4,1,0]:V([10,1,1],Jb(e,1)),v[a]=ia(a,"TAS",q),v[a].p.ea=e,v[a].f=ee,v[a].d=ha(0,!1,!1,10,e,1,0),b++;else return SAEF_error("cpu.mkITab() op exists TAS "+
a),!1;if(68020==Wa)for(h=[3,6,7,8,9,10,11],e=0;61>e;e++)if(jb(e,h))if(a=1728|e,-1===v[a].op)v[a]=ia(a,"CALLM",[4,0,0]),v[a].p.ea=e,v[a].f=ne,v[a].d=ha(0,7,1,10,e,0,0),b++;else return SAEF_error("cpu.mkITab() op exists CALLM "+a),!1;if(68020==Wa)for(t=0;1>t;t++)for(q=0;8>q;q++)if(a=1728|t<<3|q,-1===v[a].op)v[a]=ia(a,"RTM",[4,0,0]),v[a].p.da=t,v[a].p.Rn=q,v[a].f=Ig,v[a].d=ha(0,!1,!1,t?1:2,q,0,0),b++;else return SAEF_error("cpu.mkITab() op exists RTM "+a),!1;if(68030==Wa)for(q=0,h=[3,6,7,10,11],e=0;61>
e;e++)if(jb(e,h))if(a=61440|q<<9|e,-1===v[a].op)v[a]=ia(a,"MMU",[4,0,0]),v[a].p.ea=e,v[a].f=sh,v[a].d=ha(1,10,e,25,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists PFLUSH "+a),!1;if(68020==Wa||68030==Wa)for(q=0;8>q;q++)if(0!=q||68030!=Wa)for(r=0;2>r;r++)for(t=0==r?2:4,d=0;64>d;d++)if(a=q<<9|61568|r<<6|d,-1===v[a].op)v[a]=ia(a,"cpBcc",[4,0,0]),v[a].p.cid=q,v[a].p.ccc=d,v[a].p.z=t,v[a].f=ac,v[a].d=ha(1+(2==t?1:2),!1,!1,8,0==r?0:255,t,0),b++;else return SAEF_error("cpu.mkITab() op exists cpBcc "+
a),!1;if(68020==Wa||68030==Wa)for(q=0;8>q;q++)if(0!=q||68030!=Wa)for(t=0;8>t;t++)if(a=q<<9|61512|t,-1===v[a].op)v[a]=ia(a,"cpDBcc",[4,0,0]),v[a].p.cid=q,v[a].p.dn=t,v[a].f=bc,v[a].d=ha(2,1,t,!1,!1,2,0),b++;else return SAEF_error("cpu.mkITab() op exists cpDBcc "+a),!1;if(68020==Wa||68030==Wa)for(q=0;8>q;q++)if(0!=q||68030!=Wa)for(e=0;61>e;e++)if(a=61440|q<<9|e,-1===v[a].op)v[a]=ia(a,"cpGEN",[4,0,0]),v[a].p.cid=q,v[a].p.ea=e,v[a].f=kd,v[a].d=ha(2,!1,!1,!1,!1,0,0),b++;else return SAEF_error("cpu.mkITab() op exists cpGEN "+
a),!1;if(68020==Wa||68030==Wa)for(h=[3,4,6,7,8,9,10,11,12],q=0;8>q;q++)if(0!=q||68030!=Wa)for(e=0;61>e;e++)if(jb(e,h))if(a=q<<9|61760|e,-1===v[a].op)v[a]=ia(a,"cpRESTORE",[4,0,0]),v[a].p.cid=q,v[a].p.ea=e,v[a].f=ai,v[a].d=ha(0,!1,!1,10,e,0,0),b++;else return SAEF_error("cpu.mkITab() op exists cpRESTORE "+a),!1;if(68020==Wa||68030==Wa)for(h=[3,4,6,7,10,11],q=0;8>q;q++)if(0!=q||68030!=Wa)for(e=0;61>e;e++)if(jb(e,h))if(a=q<<9|61696|e,-1===v[a].op)v[a]=ia(a,"cpSAVE",[4,0,0]),v[a].p.cid=q,v[a].p.ea=e,
v[a].f=Lg,v[a].d=ha(0,!1,!1,10,e,0,0),b++;else return SAEF_error("cpu.mkITab() op exists cpSAVE "+a),!1;if(68020==Wa||68030==Wa)for(h=[1,3,4,5,6,7,10,11],q=0;8>q;q++)if(0!=q||68030!=Wa)for(e=0;61>e;e++)if(jb(e,h))if(a=q<<9|61504|e,-1===v[a].op)v[a]=ia(a,"cpScc",[4,0,0]),v[a].p.cid=q,v[a].p.ea=e,v[a].f=Gd,v[a].d=ha(2,!1,!1,10,e,1,0),b++;else return SAEF_error("cpu.mkITab() op exists cpScc "+a),!1;if(68020==Wa||68030==Wa)for(q=0;8>q;q++)if(0!=q||68030!=Wa)for(e=2;4>=e;e++)if(t=2==e?2:e=4,a=q<<9|61560|
e,-1===v[a].op)v[a]=ia(a,"cpTRAPcc",[4,0,0]),v[a].p.cid=q,v[a].p.opm=e,v[a].f=Ra,v[a].d=ha(1+(1==t?0:2==t?2:4),!1,!1,!1,!1,t,0),b++;else return SAEF_error("cpu.mkITab() op exists cpTRAPcc "+a),!1;"undefined"!=typeof SAER&&SAEF_log("cpu.mkiTab() %d instructions created",b);return!0}a.prototype=Error();for(var ld=0,Te=0,Zf=0,ge=!1,$b=!1,jf=!1,Jd=0,ae=Array(64),nd=0;64>nd;nd++)ae[nd]=new f;for(var je=Array(16),nd=0;16>nd;nd++)je[nd]=new d;for(var Nd=Array(16),nd=0;16>nd;nd++)Nd[nd]=new d;var $f=0,sf=
0,Bg=0,wf=0,xf=0,ag=0,af=0,Zd=0,e=new function(){this.a=new Uint32Array(8);this.d=new Uint32Array(8);this.msp=this.isp=this.usp=this.ir=this.irc=this.db=this.instruction_pc=this.opcode=this.pc_oldp=this.pc_p=this.pc=0;this.m=this.s=this.t0=this.t1=!1;this.intmask=0;this.stopped=this.c=this.v=this.z=this.n=this.x=!1;this.caar=this.cacr=this.dfc=this.sfc=this.vbr=this.halted=0;this.prefetch020=new Uint32Array(4);this.cacheholdingaddr020=this.cacheholdingdata020=this.prefetch020addr=0};SAER_CPU_regs=
e;var cf=0,be=0,Fd=0,bg=0,pc=2,rc=null,Ed=null,M=null,Q=null,oc=null,Ha=null,ba=null,La=null,ga=null,Ja=null,Ka=null,Yc="T F HI LS CC CS NE EQ VC VS PL MI GE LT GT LE".split(" "),v=[],Hc=[],Y=[],Xa=[],hb=[],Qa=[],Na=[],Va=[],ob=[],Wa=0;this.setup=function(){cf=0;SAEV_config.cpu.speed!=SAEC_Config_CPU_Speed_Maximum&&(0>SAEV_config.cpu.speedThrottle?cf=Math.floor(8192E3/(1E3+SAEV_config.cpu.speedThrottle)):0<SAEV_config.cpu.speedThrottle&&(cf=Math.floor(8192E3/(1E3+SAEV_config.cpu.speedThrottle))));
be=SAEC_Events_CYCLE_UNIT/2;SAEV_config.cpu.clock.multiplier?be=256<=SAEV_config.cpu.clock.multiplier?SAEC_Events_CYCLE_UNIT/(SAEV_config.cpu.clock.multiplier>>8):SAEC_Events_CYCLE_UNIT*SAEV_config.cpu.clock.multiplier:SAEV_config.cpu.clock.frequency&&(be=Math.floor(8*SAEC_Events_CYCLE_UNIT*(SAEV_config.chipset.ntsc?SAEC_Playfield_CLOCK_NTSC:SAEC_Playfield_CLOCK_PAL)/SAEV_config.cpu.clock.frequency));1>be&&(be=1);SAEF_log("cpu.update_cycles() cycleunit: %d (%.3f), cycles_mult %d",be,be/SAEC_Events_CYCLE_UNIT,
cf);SAER_CPU_run_func=SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?SAEV_config.cpu.compatible?Ub:Dc:SAEV_config.cpu.compatible?sc:Dc;SAEV_config.cpu.compatible?(rc=ea,Ed=Ua,SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?(M=r,Q=Da,oc=sb,Ha=Sa,ba=ta,La=ka,ga=qa,Ja=nb,Ka=$a):SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020?(M=R,Q=Ga,oc=fa,La=SAER_Memory_get32,Ka=SAER_Memory_put32,ba=SAER_Memory_get16,Ja=SAER_Memory_put16,Ha=SAER_Memory_get8,ga=SAER_Memory_put8):SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030&&
(M=Fa,Q=U,oc=na,Ha=G,ba=ja,La=pa,ga=y,Ja=ua,Ka=kb)):(rc=q,Ed=b,M=Z,Q=Lb,oc=t,La=SAER_Memory_get32,Ka=SAER_Memory_put32,ba=SAER_Memory_get16,Ja=SAER_Memory_put16,Ha=SAER_Memory_get8,ga=SAER_Memory_put8);if(v.length&&Wa==SAEV_config.cpu.model)SAEF_log("cpu.setup_core() instruction table is cached");else if(Wa=SAEV_config.cpu.model,!Tb())return SAEE_CPU_Internal;Hc.length||Ef();Y.length||Og();return SAEE_None};this.reset=function(a){e.a[7]=SAER_Memory_get32(0);this.setPC_normal(SAER_Memory_get32(4));
e.t1=!1;e.t0=!1;e.s=!0;e.m=!1;e.intmask=7;e.x=e.n=e.z=e.v=e.c=!1;e.vbr=e.sfc=e.dfc=0;e.irc=65535;e.db=0;SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020?(e.caar=0,e.cacr=8,J(!1)):SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030&&(e.caar=0,e.cacr=2056,J(!1));SAER.memory.a3000_fakekick(!1);af&=~2147483648;xf&=~2147483648;ag&=~2147483648;if(a||e.halted)xf=ag=af=Bg=wf=$f=sf=0;Zd=0;wa();bg=0};this.dump=function(){var a,b="";for(a=0;8>a;a++)b+=sprintf("D%d $%08x ",a,e.d[a]);b+="\n";for(a=0;8>a;a++)b+=
sprintf("A%d $%08x ",a,e.a[a]);e.s||(e.usp=e.a[7]);e.s&&e.m&&(e.msp=e.a[7]);e.s&&!e.m&&(e.isp=e.a[7]);b=b+"\n"+sprintf("PC $%08x USP $%08x ISP $%08x ",q(),e.usp,e.isp);Wa>=SAEC_Config_CPU_Model_68020&&(b+=sprintf("MSP $%08x ",e.msp));Wa>=SAEC_Config_CPU_Model_68010&&(b+=sprintf("SFC $%08x DFC $%08x VBR $%08x",e.sfc,e.dfc,e.vbr));b+="\n";b+=sprintf("SR T=%d%d S=%d M=%d IMASK=%d X=%d N=%d Z=%d V=%d C=%d\n",e.t1?1:0,e.t0?1:0,e.s?1:0,e.m?1:0,e.intmask,e.x?1:0,e.n?1:0,e.z?1:0,e.v?1:0,e.c?1:0);if(Wa>=SAEC_Config_CPU_Model_68020){a=
b;if(SAEV_config.cpu.compatible)if(b=sprintf("CACR $%08x CAAR $%08x\n",e.cacr,e.caar),SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020)for(var b=b+"68020 inst-cache:\n",d=0;64>d;d+=4){for(var f=0;4>f;f++)var h=d+f,m=ae[h],r=m.tag&-2,r=r|h<<2,b=b+sprintf("%08X:%08X%s ",r,m.data,m.valid?"*":" ");b+="\n"}else{if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030){b+="68030 inst-cache: ["+(e.cacr&1?"enabled":"disabled")+"]\n";for(d=0;16>d;d++){m=je[d];r=m.tag&-2;r|=d<<4;b+=sprintf("%02d %08X: ",d,r);
for(f=0;4>f;f++)b+=sprintf("%08X%s ",m.data[f],m.valid[f]?"*":" ");b+="\n"}b+="68030 data-cache: ["+(e.cacr&256?"enabled":"disabled")+"]\n";for(d=0;16>d;d++){m=Nd[d];r=m.tag&-2;r|=d<<4;b+=sprintf("%02d %08X: ",d,r);for(f=0;4>f;f++)b+=sprintf("%08X%s ",m.data[f],m.valid[f]?"*":" ");b+="\n"}}}else b="CACHE disabled\n";b=a+b}SAEF_log(b)};SAER_CPU_fill_prefetch=wa;SAER_CPU_setPC=b;SAER_CPU_getPC=q;this.setPC_normal=function(a){SAEV_config.cpu.compatible?(e.pc_p=e.pc_oldp=0,e.instruction_pc=e.pc=a):b(a)};
this.getPC_normal=function(){return SAEV_config.cpu.compatible?e.pc:q()};this.incPC_normal=function(a){SAEV_config.cpu.compatible?e.pc+=a:e.pc_p+=a};SAER_CPU_exception=zb;this.exception2=function(b,d,f,h){Te=q()+0;Zf=b;ge=0==d;$b=0==(h&1);ld=e.opcode;jf=0!=Jd;throw new a(2);};this.pc_in_rom=function(){var a=q();return 16252928==(xb(a)&4294443008)};var ab=new function(){this.memory=null;this.io=this.pc=0;this.fmt32=this.fmt16=this.fmt8="%x"},Se=null;config_da=new function(){this.code="";this.offset=
0;this.limit=32;this.radix=16;this.prefx="$";this.width=0;this.reloc=!0};this.getConfig_da=function(){return config_da};this.setup_da=function(a){Wa=a;if(!Tb())return SAEE_CPU_Internal;Ef();Og();return SAEE_None};this.disassemble=function(){0<config_da.code.length&&(ab.memory=new Uint8Array(config_da.code.length),ab.memory.set(SAEF_String2Array(config_da.code,0,config_da.code.length)),config_da.code="");if(null===ab.memory)throw 1;ab.pc+ab.io>=ab.memory.length&&(ab.pc=ab.io=0);0>=config_da.limit&&
(config_da.limit=8);ab.fmt8=ab.fmt16=ab.fmt32=config_da.prefx;0==config_da.width?(ab.fmt8+="%x",ab.fmt16+="%x",ab.fmt32+="%x"):(ab.fmt8+="%02x",ab.fmt16+="%04x",ab.fmt32+=24==config_da.width?"%06x":"%08x");ab.pc=config_da.offset;ab.io=0;for(var a,b,d,e,f=[],h=0;h++<config_da.limit;){b=ab.pc;d=[];for(a=0;5>a;a++)d.push(z(b+2*a));a=Ba();e=la(v[a]);a=ab.io>>1;f.push([b,d,a,e]);ab.pc+=ab.io;ab.io=0}return f};this.diss=function(a,b){"undefined"==typeof a&&(a=rc());if("undefined"==typeof b||0==b)b=8;var d=
SAER_Memory_getBank(a);ab.memory=d.baseaddr;ab.pc=a-d.start;for(var e=ab.io=0;e++<b;){for(var f="",f=f+sprintf("$%08x: ",ab.pc+d.start),h=0;5>h;h++)f+=sprintf("$%04x ",z(ab.pc+2*h));h=Ba();f+=la(v[h]);f+=sprintf(" (%d)",ab.io>>1);SAEF_log(f);ab.pc+=ab.io;ab.io=0}};var jc=[[],[1,1,1,1,1,1,1,2],[2,2,2,2,2,2,2,2],[],[4,4,4,4,4,4,4,4]]};var SAEC_Version=0,SAEC_Revision=9,SAEC_Patch=0;function SAEO_Error(a,f){this.err=a;this.msg=f}SAEO_Error.prototype=Error();
var SAEE_None=0,SAEE_AlreadyRunning=1,SAEE_NotRunning=2,SAEE_NoTimer=3,SAEE_NoMemory=4,SAEE_Assert=5,SAEE_Internal=6,SAEE_Config_Invalid=10,SAEE_Config_Compressed=11,SAEE_CPU_Internal=20,SAEE_CPU_Requires68020=21,SAEE_CPU_Requires680EC20=22,SAEE_CPU_Requires68030=23,SAEE_CPU_Requires68040=24,SAEE_Memory_NoKickstartRom=30,SAEE_Memory_NoExtendedRom=31,SAEE_Memory_RomSize=32,SAEE_Memory_RomKey=33,SAEE_Memory_RomDecode=34,SAEE_Memory_RomChecksum=35,SAEE_Memory_RomUnknown=36,SAEE_Video_ElementNotFound=
40,SAEE_Video_RequiresCanvas=41,SAEE_Video_RequiresWegGl=42,SAEE_Video_ComphileShader=43,SAEE_Video_LinkShader=44,SAEE_Audio_RequiresWebAudio=50,SAER=null,SAEC_spcflag_STOP=2,SAEC_spcflag_COPPER=4,SAEC_spcflag_INT=8,SAEC_spcflag_BRK=16,SAEC_spcflag_TRACE=64,SAEC_spcflag_DOTRACE=128,SAEC_spcflag_DOINT=256,SAEC_spcflag_BLTNASTY=512,SAEC_spcflag_MODE_CHANGE=8192,SAEC_spcflag_CHECK=32768,SAEC_command_Quit=1,SAEC_command_Reset=2,SAEC_command_KeyboardReset=3,SAEC_command_HardReset=4,SAEC_command_Pause=
5,SAEC_command_Resume=6,SAEC_Info_Brower_ID_Unknown=0,SAEC_Info_Brower_ID_Chrome=1,SAEC_Info_Brower_ID_Safari=2,SAEC_Info_Brower_ID_Opera=3,SAEC_Info_Brower_ID_Firefox=4,SAEC_Info_Brower_ID_InternetExplorer=5,SAEC_info=function(){var a={browser:{id:SAEC_Info_Brower_ID_Unknown,name:"Unknown",plat:"Unknown",lang:"en"},memory:{maxSize:0},audio:{webAudio:!1},video:{canvas:!1,webGL:!1}};-1<navigator.userAgent.indexOf("Chrome")?(a.browser.id=SAEC_Info_Brower_ID_Chrome,a.browser.name="Google Chrome"):-1<
navigator.userAgent.indexOf("Safari")?(a.browser.id=SAEC_Info_Brower_ID_Safari,a.browser.name="Apple Safari"):-1<navigator.userAgent.indexOf("Opera")?(a.browser.id=SAEC_Info_Brower_ID_Opera,a.browser.name="Opera"):-1<navigator.userAgent.indexOf("Firefox")?(a.browser.id=SAEC_Info_Brower_ID_Firefox,a.browser.name="Mozilla Firefox"):-1<navigator.userAgent.indexOf("MSIE")&&(a.browser.id=SAEC_Info_Brower_ID_InternetExplorer,a.browser.name="Microsoft Internet Explorer");a.browser.plat=navigator.platform;
a.browser.lang=navigator.language;a.memory.maxSize=1073741824;var f=null;try{f=new (window.AudioContext||window.webkitAudioContext),f.createScriptProcessor(1024,2,2),a.audio.webAudio=!0,f.close&&f.close().then(function(){}),f=null}catch(d){f&&(f.close&&f.close().then(function(){}),f=null)}if((f=document.createElement("canvas"))&&f.getContext)try{var J=f.getContext("2d");J.createImageData(16,16);a.video.canvas=!0;try{J={alpha:!1,depth:!0,stencil:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,
failIfMajorPerformanceCaveat:!1},J=f.getContext("webgl",J)||f.getContext("experimental-webgl",J),a.video.webGL=!0}catch(h){}}catch(N){}return a}(),SAEV_spcflags=0,SAEV_command=0;function SAEF_setSpcFlags(a){SAEV_spcflags|=a}function SAEF_clrSpcFlags(a){SAEV_spcflags&=~a}function SAEF_now(){return Math.floor(1E3*performance.now())}function SAEF_sleep(a){for(var f=performance.now();performance.now()-f<a;);}
function SAEF_log(){if(SAEV_config.debug.level>=SAEC_Config_Debug_Level_Log&&arguments.length){var a=sprintf.apply(this,arguments);console.log&&console.log(a)}}function SAEF_info(){if(SAEV_config.debug.level>=SAEC_Config_Debug_Level_Info&&arguments.length){var a=sprintf.apply(this,arguments);console.info&&console.info(a)}}function SAEF_warn(){if(SAEV_config.debug.level>=SAEC_Config_Debug_Level_Warn&&arguments.length){var a=sprintf.apply(this,arguments);console.warn&&console.warn(a)}}
function SAEF_error(){if(SAEV_config.debug.level>=SAEC_Config_Debug_Level_Error&&arguments.length){var a=sprintf.apply(this,arguments);console.error&&console.error(a)}}function SAEF_fatal(){var a=Array.prototype.slice.call(arguments),f=a[0],a=sprintf.apply(this,a.slice(1));console.error&&console.error(a);throw new SAEO_Error(f,a);}
function SAEF_assert(a){if(!a)throw a=SAEE_Assert,console.error&&console.error("Assertion failed. This is a bug in SAE."),new SAEO_Error(a,"Assertion failed. This is a bug in SAE.");}
function ScriptedAmigaEmulator(){SAER=this;this.autoconf=new SAEO_AutoConf;this.audio=new SAEO_Audio;this.blitter=new SAEO_Blitter;this.cia=new SAEO_CIA;this.config=new SAEO_Configuration;this.copper=new SAEO_Copper;this.cpu=new SAEO_CPU;this.custom=new SAEO_Custom;this.devices=new SAEO_Devices;this.disk=new SAEO_Disk;this.events=new SAEO_Events;this.expansion=new SAEO_Expansion;this.filesys=new SAEO_Filesys;this.gayle=new SAEO_Gayle;this.gui=new SAEO_GUI;this.hardfile=new SAEO_Hardfile;this.ide=
new SAEO_IDE;this.input=new SAEO_Input;this.m68k=new SAEO_M68K;this.memory=new SAEO_Memory;this.playfield=new SAEO_Playfield;this.roms=new SAEO_Roms;this.rtc=new SAEO_RTC;this.serial=new SAEO_Serial;this.video=new SAEO_Video;this.paused=this.running=!1;this.dump=function(){this.m68k.dump()};this.do_start_program=function(){0<=SAEV_command&&(SAEV_command=SAEC_command_Reset);this.m68k.m68k_go(!0)};this.do_leave_program=function(){this.video.cleanup();this.input.cleanup();this.disk.cleanup();this.audio.cleanup();
this.serial.cleanup();this.expansion.cleanup();this.filesys.cleanup();this.gayle.cleanup();this.memory.cleanup();this.autoconf.cleanup()};this.start_program=function(){this.do_start_program();"function"===typeof SAEV_config.hook.event.started&&SAEV_config.hook.event.started()};this.leave_program=function(){this.dump();this.do_leave_program();"function"===typeof SAEV_config.hook.event.stopped&&SAEV_config.hook.event.stopped()};this.pause_program=function(a){this.audio.pauseResume(a);this.events.pauseResume(a);
"function"===typeof SAEV_config.hook.event.paused&&SAEV_config.hook.event.paused(a)};this.getVersion=function(a){return a?sprintf("%d.%d.%d",SAEC_Version,SAEC_Revision,SAEC_Patch):[SAEC_Version,SAEC_Revision,SAEC_Patch]};this.getInfo=function(){return SAEC_info};this.getConfig=function(){return SAEV_config};this.setDefaults=function(){return this.config.setDefaults()};this.setModel=function(a,f){return this.config.setModel(a,f)};this.setMountInfoDefaults=function(a){this.filesys.uci_set_defaults(SAEV_config.mount.config[a].ci,
!1)};this.start=function(){if(SAER.running)return SAEF_warn("sae.start() emulation already running"),SAEE_AlreadyRunning;SAEF_info("sae.start() starting...");var a;if((a=this.config.setup())!=SAEE_None||(a=this.video.obtain())!=SAEE_None||(a=this.audio.obtain())!=SAEE_None)return a;this.input.setup();if((a=this.gui.setup())!=SAEE_None)return a;this.memory.hardreset(2);if((a=this.memory.reset(!0))==SAEE_None&&(this.custom.setup(),this.blitter.setup(),this.playfield.setup(),this.serial.setup(),this.disk.setup(),
this.events.reset_frame_rate_hack(),(a=this.m68k.setup())==SAEE_None&&(a=this.video.setup(!0))==SAEE_None)){if((a=this.audio.setup())==SAEE_None)return this.start_program(),SAEF_info("sae.start() ...done"),SAEE_None;this.video.cleanup()}this.input.cleanup();SAEF_error("sae.start() ...error %d",a);return a};this.stop=function(){if(this.running)return SAEF_info("sae.stop()"),SAEV_command!=-SAEC_command_Quit&&(SAEV_command=-SAEC_command_Quit),SAEE_None;SAEF_warn("sae.stop() emulation not running");return SAEE_NotRunning};
this.reset=function(a,f){"undefined"==typeof a&&(a=!1);"undefined"==typeof f&&(f=!1);if(this.running)return SAEF_info("sae.reset() hard %d, keyboard %d",a?1:0,f?1:0),0==SAEV_command&&(SAEV_command=-SAEC_command_Reset,f&&(SAEV_command=-SAEC_command_KeyboardReset),a&&(SAEV_command=-SAEC_command_HardReset)),SAEE_None;SAEF_warn("sae.reset() emulation not running");return SAEE_NotRunning};this.pause=function(a){if(this.running)return!this.paused&&a?(SAEF_info("sae.pause() pausing emulation"),SAEV_command=
SAEC_command_Pause):this.paused&&!a&&(SAEF_info("sae.pause() resuming emulation"),SAEV_command=SAEC_command_Resume),SAEE_None;SAEF_warn("sae.pause() emulation not running");return SAEE_NotRunning};this.insert=function(a){if(this.running){var f=SAEV_config.floppy.drive[a].file;this.disk.insert(a,f);SAEF_info("sae.insert() unit %d inserted, name '%s', size %d, protected %d",a,f.name,f.size,f.prot?1:0);return SAEE_None}SAEF_warn("sae.insert() emulation not running");return SAEE_NotRunning};this.eject=
function(a){if(this.running)return this.disk.eject(a),SAEF_info("sae.eject() unit %d ejected",a),SAEE_None;SAEF_warn("sae.eject() emulation not running");return SAEE_NotRunning};this.getRomInfo=function(a,f){return this.roms.examine(a,f)};this.getDiskInfo=function(a,f){return this.disk.examine(a,f)};this.createDisk=function(a,f,d,J,h,N,I){return this.disk.create(a,f,d,J,h,N,I)?SAEE_None:SAEE_NoMemory};this.mute=function(a){if(this.running)return this.audio.mute(a),a?SAEF_log("sae.mute() audio muted"):
SAEF_log("sae.mute() playing audio"),SAEE_None;SAEF_warn("sae.mute() emulation not running");return SAEE_NotRunning};this.keyPress=function(a,f){this.input.keyPress(a,f);return SAEE_None};SAEF_info("SAE %d.%d.%d",SAEC_Version,SAEC_Revision,SAEC_Patch)};
/*
//@ sourceMappingURL=scriptedamigaemulator.js.map
*/